└── app/
├── lib/
│   ├── app/
│   │   ├── app.dart
│   │   │   │   import 'package:flutter/material.dart';
│   │   │   │   import 'package:flutter_localizations/flutter_localizations.dart';
│   │   │   │   import 'package:get/get.dart';
│   │   │   │   import 'package:localization/localization.dart';
│   │   │   │   
│   │   │   │   // Import the initializer screen
│   │   │   │   import '../features/initializer/screen.dart'; // Make sure path is correct
│   │   │   │   
│   │   │   │   class BoatRentalApp extends StatelessWidget {
│   │   │   │     const BoatRentalApp({super.key});
│   │   │   │   
│   │   │   │     @override
│   │   │   │     Widget build(BuildContext context) {
│   │   │   │       LocalJsonLocalization.delegate.directories = ['assets/i18n'];
│   │   │   │   
│   │   │   │       return GetMaterialApp(
│   │   │   │         title: 'Boat Rental',
│   │   │   │         debugShowCheckedModeBanner: false,
│   │   │   │         theme: ThemeData(
│   │   │   │           cardColor: const Color(0xFFF5F7FA),
│   │   │   │           primarySwatch: Colors.blue,
│   │   │   │           colorScheme: ColorScheme.fromSeed(
│   │   │   │             seedColor: const Color(0xFF1976D2),
│   │   │   │             primary: const Color(0xFF1976D2),
│   │   │   │             secondary: const Color(0xFF03A9F4),
│   │   │   │             tertiary: const Color(0xFF0288D1),
│   │   │   │             surface: const Color(0xFFF5F7FA),
│   │   │   │             onPrimary: Colors.white,
│   │   │   │           ),
│   │   │   │           scaffoldBackgroundColor: const Color(0xFFF5F7FA),
│   │   │   │           // textTheme: GoogleFonts.poppinsTextTheme(),
│   │   │   │           useMaterial3: true,
│   │   │   │         ),
│   │   │   │         // --- Use InitializerScreen as the entry point ---
│   │   │   │         home: const InitializerScreen(),
│   │   │   │         // --- ---
│   │   │   │   
│   │   │   │         localizationsDelegates: [
│   │   │   │           LocalJsonLocalization.delegate,
│   │   │   │           GlobalMaterialLocalizations.delegate,
│   │   │   │           GlobalWidgetsLocalizations.delegate,
│   │   │   │           GlobalCupertinoLocalizations.delegate,
│   │   │   │         ],
│   │   │   │         supportedLocales: const [
│   │   │   │           Locale('en', 'US'), // English
│   │   │   │           Locale('ar', 'SA'), // Arabic
│   │   │   │         ],
│   │   │   │         localeResolutionCallback: (locale, supportedLocales) {
│   │   │   │           // Example: Default to English if locale not supported explicitly
│   │   │   │           for (var supportedLocale in supportedLocales) {
│   │   │   │             if (supportedLocale.languageCode == locale?.languageCode) {
│   │   │   │               // Simplified check
│   │   │   │               // return const Locale('ar', 'SA'); // Your previous forced Arabic
│   │   │   │               return const Locale('en', 'US'); // Force English for now
│   │   │   │             }
│   │   │   │           }
│   │   │   │           // Fallback to the first supported locale if no match (usually English)
│   │   │   │           return supportedLocales.first;
│   │   │   │         },
│   │   │   │       );
│   │   │   │     }
│   │   │   │   }
│   │   ├── initializer.dart
│   │   └── theme.dart
│   │       │   import 'package:flutter/material.dart';
│   │       │   // For Cupertino widgets if needed - trendy look sometimes uses platform-specific elements
│   │       │   // GetX for low professionality state management (if needed, keeping it minimal for now)
│   │       │   const Color colorPrimaryDark = Color(0xFF03045E);   // Deep Blue
│   │       │   const Color colorPrimary = Color(0xFF0077B6);      // Medium Blue
│   │       │   const Color colorPrimaryLight = Color(0xFF00B4D8);  // Light Blue (Seed Color)
│   │       │   const Color colorSecondaryLight = Color(0xFF90E0EF); // Very Light Blue
│   │       │   const Color colorAccentLight = Color(0xFFCAF0F8);    // Pale Blue (Accent)
│   │       │   // Define your color palette based on a seed color
│   │       │   class AppColors {
│   │       │     static Color seedColor = const Color(0xFF4AB7BD); // Trendy Teal as a starting point for boat app - you can change this!
│   │       │   
│   │       │     // Generate color scheme from seed color for Material 3 theming
│   │       │     static ColorScheme lightColorScheme = ColorScheme.fromSeed(
│   │       │       seedColor: seedColor,
│   │       │       brightness: Brightness.light,
│   │       │     );
│   │       │   
│   │       │     static ColorScheme darkColorScheme = ColorScheme.fromSeed(
│   │       │       seedColor: seedColor,
│   │       │       brightness: Brightness.dark,
│   │       │     );
│   │       │   
│   │       │     // Extended color palette for more control - adjust these based on your seed color and design needs
│   │       │     static Color primary = lightColorScheme.primary;
│   │       │     static Color onPrimary = lightColorScheme.onPrimary;
│   │       │     static Color primaryContainer = lightColorScheme.primaryContainer;
│   │       │     static Color onPrimaryContainer = lightColorScheme.onPrimaryContainer;
│   │       │     static Color secondary = lightColorScheme.secondary;
│   │       │     static Color onSecondary = lightColorScheme.onSecondary;
│   │       │     static Color secondaryContainer = lightColorScheme.secondaryContainer;
│   │       │     static Color onSecondaryContainer = lightColorScheme.onSecondaryContainer;
│   │       │     static Color tertiary = lightColorScheme.tertiary;
│   │       │     static Color onTertiary = lightColorScheme.onTertiary;
│   │       │     static Color tertiaryContainer = lightColorScheme.tertiaryContainer;
│   │       │     static Color onTertiaryContainer = lightColorScheme.onTertiaryContainer;
│   │       │     static Color error = lightColorScheme.error;
│   │       │     static Color onError = lightColorScheme.onError;
│   │       │     static Color errorContainer = lightColorScheme.errorContainer;
│   │       │     static Color onErrorContainer = lightColorScheme.onErrorContainer;
│   │       │     static Color background = Colors.white; // Light background for boat app - can be adjusted
│   │       │     static Color onBackground = lightColorScheme.onSurface;
│   │       │     static Color surface = Colors.white; // Light surface color - can be adjusted
│   │       │     static Color onSurface = lightColorScheme.onSurface;
│   │       │     static Color surfaceVariant = lightColorScheme.surfaceContainerHighest;
│   │       │     static Color onSurfaceVariant = lightColorScheme.onSurfaceVariant;
│   │       │     static Color outline = lightColorScheme.outline;
│   │       │     static Color shadow = lightColorScheme.shadow;
│   │       │     static Color inverseSurface = lightColorScheme.inverseSurface;
│   │       │     static Color onInverseSurface = lightColorScheme.onInverseSurface;
│   │       │     static Color inversePrimary = lightColorScheme.inversePrimary;
│   │       │     static Color surfaceTint = lightColorScheme.surfaceTint;
│   │       │     static Color scaffoldBackgroundColor = Colors.white; // Match background for seamless look
│   │       │   
│   │       │     // Custom colors - you can add more based on your design system
│   │       │     static Color highlightColor = Colors.amberAccent; // Example highlight color for emphasis
│   │       │     static Color subtleTextColor = Colors.grey.shade700; // For less prominent text
│   │       │     static Color shimmerBaseColor = Colors.grey.shade200; // For shimmer effects
│   │       │     static Color shimmerHighlightColor = Colors.grey.shade100; // For shimmer effects
│   │       │   }
│   │       │   
│   │       │   
│   │       │   // --- Theme Data Builder Function ---
│   │       │   ThemeData buildAppTheme({required Color seedColor, required String professionality}) {
│   │       │     // Update AppColors' seed color for dynamic theming
│   │       │     AppColors.seedColor = seedColor;
│   │       │     AppColors.lightColorScheme = ColorScheme.fromSeed(seedColor: seedColor, brightness: Brightness.light);
│   │       │     AppColors.darkColorScheme = ColorScheme.fromSeed(seedColor: seedColor, brightness: Brightness.dark);
│   │       │     AppColors.primary = AppColors.lightColorScheme.primary;
│   │       │     AppColors.onPrimary = AppColors.lightColorScheme.onPrimary;
│   │       │     AppColors.primaryContainer = AppColors.lightColorScheme.primaryContainer;
│   │       │     AppColors.onPrimaryContainer = AppColors.lightColorScheme.onPrimaryContainer;
│   │       │     AppColors.secondary = AppColors.lightColorScheme.secondary;
│   │       │     AppColors.onSecondary = AppColors.lightColorScheme.onSecondary;
│   │       │     AppColors.secondaryContainer = AppColors.lightColorScheme.secondaryContainer;
│   │       │     AppColors.onSecondaryContainer = AppColors.lightColorScheme.onSecondaryContainer;
│   │       │     AppColors.tertiary = AppColors.lightColorScheme.tertiary;
│   │       │     AppColors.onTertiary = AppColors.lightColorScheme.onTertiary;
│   │       │     AppColors.tertiaryContainer = AppColors.lightColorScheme.tertiaryContainer;
│   │       │     AppColors.onTertiaryContainer = AppColors.lightColorScheme.onTertiaryContainer;
│   │       │   
│   │       │   
│   │       │     return ThemeData(
│   │       │       useMaterial3: true, // Enable Material 3 for latest design trends
│   │       │       colorScheme: AppColors.lightColorScheme, // Use the generated light color scheme
│   │       │   
│   │       │       scaffoldBackgroundColor: AppColors.scaffoldBackgroundColor, // Set scaffold background color
│   │       │   
│   │       │       // --- AppBar Theme ---
│   │       │       appBarTheme: AppBarTheme(
│   │       │         backgroundColor: Colors.white.withOpacity(0.8), // Semi-transparent AppBar for glass effect
│   │       │         elevation: 0, // Flat, modern look
│   │       │         scrolledUnderElevation: 0, // No shadow when scrolled under
│   │       │         centerTitle: true, // Center the title for modern style
│   │       │         titleTextStyle: TextStyle( // Trendy title text style
│   │       │           fontFamily: 'SF-Pro-Rounded', // Example of a modern font - consider adding this to your pubspec.yaml
│   │       │           fontWeight: FontWeight.w800,
│   │       │           fontSize: 22, // Slightly smaller and bolder for AppBar
│   │       │           color: AppColors.primary, // Use primary color for AppBar title
│   │       │           letterSpacing: 0.8, // Increased letter spacing for modern look
│   │       │         ),
│   │       │         iconTheme: IconThemeData(color: AppColors.primary), // Primary color for AppBar icons
│   │       │         actionsIconTheme: IconThemeData(color: AppColors.primary), // Primary color for AppBar action icons
│   │       │       ),
│   │       │   
│   │       │       // --- Text Theme ---
│   │       │       textTheme: TextTheme(
│   │       │         displayLarge: TextStyle( // For very large text - headings 1
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w900,
│   │       │           fontSize: 57,
│   │       │           color: AppColors.onSurface,
│   │       │         ),
│   │       │         displayMedium: TextStyle( // Headings 2
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w800,
│   │       │           fontSize: 45,
│   │       │           color: AppColors.onSurface,
│   │       │         ),
│   │       │         displaySmall: TextStyle( // Headings 3
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w700,
│   │       │           fontSize: 36,
│   │       │           color: AppColors.onSurface,
│   │       │         ),
│   │       │         headlineLarge: TextStyle( // Headings 4
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w700,
│   │       │           fontSize: 32,
│   │       │           color: AppColors.onSurface,
│   │       │         ),
│   │       │         headlineMedium: TextStyle( // Headings 5
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w600,
│   │       │           fontSize: 28,
│   │       │           color: AppColors.onSurface,
│   │       │         ),
│   │       │         headlineSmall: TextStyle( // Headings 6
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w600,
│   │       │           fontSize: 24,
│   │       │           color: AppColors.onSurface,
│   │       │         ),
│   │       │         titleLarge: TextStyle( // Titles - for sections, cards etc.
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w700,
│   │       │           fontSize: 22,
│   │       │           color: AppColors.primary, // Primary color for titles
│   │       │           letterSpacing: 0.5,
│   │       │         ),
│   │       │         titleMedium: TextStyle( // Subtitles
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w600,
│   │       │           fontSize: 18,
│   │       │           color: AppColors.primary,
│   │       │           letterSpacing: 0.25,
│   │       │         ),
│   │       │         titleSmall: TextStyle( // Small titles, captions
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w500,
│   │       │           fontSize: 16,
│   │       │           color: AppColors.primary,
│   │       │           letterSpacing: 0.15,
│   │       │         ),
│   │       │         bodyLarge: TextStyle( // Main body text
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w500,
│   │       │           fontSize: 16,
│   │       │           color: AppColors.subtleTextColor, // More subtle body text color
│   │       │           letterSpacing: 0.5,
│   │       │         ),
│   │       │         bodyMedium: TextStyle( // Secondary body text
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.normal,
│   │       │           fontSize: 14,
│   │       │           color: AppColors.subtleTextColor,
│   │       │           letterSpacing: 0.25,
│   │       │         ),
│   │       │         bodySmall: TextStyle( // Small body text, hints, captions
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.normal,
│   │       │           fontSize: 12,
│   │       │           color: Colors.grey.shade600, // Even more subtle for small text
│   │       │           letterSpacing: 0.4,
│   │       │         ),
│   │       │         labelLarge: TextStyle( // Button text, tab labels
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w700,
│   │       │           fontSize: 16,
│   │       │           color: AppColors.onPrimary, // Text color on primary buttons
│   │       │           letterSpacing: 0.5,
│   │       │         ),
│   │       │         labelMedium: TextStyle( // Smaller labels
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w600,
│   │       │           fontSize: 14,
│   │       │           color: AppColors.primary,
│   │       │           letterSpacing: 0.5,
│   │       │         ),
│   │       │         labelSmall: TextStyle( // Very small labels, chip text
│   │       │           fontFamily: 'SF-Pro-Rounded',
│   │       │           fontWeight: FontWeight.w500,
│   │       │           fontSize: 11,
│   │       │           color: AppColors.primary,
│   │       │           letterSpacing: 0.5,
│   │       │         ),
│   │       │       ),
│   │       │   
│   │       │       // --- ElevatedButton Theme (for primary action buttons) ---
│   │       │       elevatedButtonTheme: ElevatedButtonThemeData(
│   │       │         style: ElevatedButton.styleFrom(
│   │       │           backgroundColor: AppColors.primary, // Primary button color
│   │       │           foregroundColor: AppColors.onPrimary, // Text color on primary buttons
│   │       │           elevation: 3, // Subtle shadow for depth
│   │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)), // Rounded button corners
│   │       │           padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 14),
│   │       │           textStyle: const TextStyle(fontWeight: FontWeight.w700),
│   │       │           // --- Animated Button Properties ---
│   │       │           animationDuration: const Duration(milliseconds: 150), // Quick animation
│   │       │           // --- Hover/Focus Effects ---
│   │       │           // More sophisticated hover effect could be added using states if needed
│   │       │         ),
│   │       │       ),
│   │       │   
│   │       │       // --- OutlinedButton Theme (for secondary/less important buttons) ---
│   │       │       outlinedButtonTheme: OutlinedButtonThemeData(
│   │       │         style: OutlinedButton.styleFrom(
│   │       │           foregroundColor: AppColors.primary, // Primary color for outline and text
│   │       │           side: BorderSide(color: AppColors.primary, width: 1.5), // Thicker outline
│   │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
│   │       │           padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 14),
│   │       │           textStyle: const TextStyle(fontWeight: FontWeight.w600),
│   │       │           // --- Animated Button Properties ---
│   │       │           animationDuration: const Duration(milliseconds: 150),
│   │       │         ),
│   │       │       ),
│   │       │   
│   │       │       // --- TextButton Theme (for tertiary/subtle actions) ---
│   │       │       textButtonTheme: TextButtonThemeData(
│   │       │         style: TextButton.styleFrom(
│   │       │           foregroundColor: AppColors.primary, // Primary color for text
│   │       │           textStyle: const TextStyle(fontWeight: FontWeight.w600),
│   │       │           padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 10),
│   │       │           // --- Animated Button Properties ---
│   │       │           animationDuration: const Duration(milliseconds: 150),
│   │       │         ),
│   │       │       ),
│   │       │   
│   │       │   
│   │       │       // --- Card Theme ---
│   │       │       cardTheme: CardTheme(
│   │       │         elevation: 2, // Subtle card shadow
│   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(16)), // Rounded card corners
│   │       │         color: Colors.white, // White cards for clean look
│   │       │         margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8), // Default card margin
│   │       │       ),
│   │       │   
│   │       │       // --- Input Decoration Theme (for TextFields) ---
│   │       │       inputDecorationTheme: InputDecorationTheme(
│   │       │         filled: true,
│   │       │         fillColor: Colors.grey.shade50, // Very light grey fill for input fields
│   │       │         border: OutlineInputBorder(
│   │       │           borderRadius: BorderRadius.circular(12), // Rounded input field corners
│   │       │           borderSide: BorderSide.none, // No visible border by default - relies on fill and shape
│   │       │         ),
│   │       │         focusedBorder: OutlineInputBorder( // Border when focused
│   │       │           borderRadius: BorderRadius.circular(12),
│   │       │           borderSide: BorderSide(color: AppColors.primary, width: 2), // Primary color border when focused
│   │       │         ),
│   │       │         labelStyle: TextStyle(color: AppColors.subtleTextColor.withOpacity(0.8)), // Label text color
│   │       │         hintStyle: TextStyle(color: Colors.grey.shade500), // Hint text color
│   │       │         contentPadding: const EdgeInsets.symmetric(horizontal: 20, vertical: 16),
│   │       │       ),
│   │       │   
│   │       │       // --- List Tile Theme ---
│   │       │       listTileTheme: ListTileThemeData(
│   │       │         contentPadding: const EdgeInsets.symmetric(horizontal: 20, vertical: 8),
│   │       │         titleTextStyle: TextStyle(fontWeight: FontWeight.w600, color: AppColors.primary),
│   │       │         subtitleTextStyle: TextStyle(color: AppColors.subtleTextColor),
│   │       │         iconColor: AppColors.primary,
│   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)), // Rounded corners for ListTiles
│   │       │         tileColor: Colors.white, // Default tile color
│   │       │         selectedTileColor: AppColors.primary.withOpacity(0.1), // Highlight color when selected
│   │       │         // Add more customization as needed for ListTile hover/focus effects if desired.
│   │       │       ),
│   │       │   
│   │       │       // --- Icon Theme ---
│   │       │       iconTheme: IconThemeData(
│   │       │         color: AppColors.primary, // Default icon color
│   │       │         size: 24, // Default icon size
│   │       │       ),
│   │       │   
│   │       │       // --- Chip Theme ---
│   │       │       chipTheme: ChipThemeData(
│   │       │         backgroundColor: AppColors.primaryContainer.withOpacity(0.3), // Subtle background for chips
│   │       │         padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
│   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │       │         labelStyle: TextStyle(color: AppColors.primary),
│   │       │         secondarySelectedColor: AppColors.primary,
│   │       │         // Add more chip customization as needed
│   │       │       ),
│   │       │   
│   │       │       // --- Slider Theme ---
│   │       │       sliderTheme: SliderThemeData(
│   │       │         activeTrackColor: AppColors.primary,
│   │       │         inactiveTrackColor: Colors.grey.shade300,
│   │       │         thumbColor: AppColors.primary,
│   │       │         overlayColor: AppColors.primary.withOpacity(0.2),
│   │       │         thumbShape: const RoundSliderThumbShape(),
│   │       │         overlayShape: const RoundSliderOverlayShape(overlayRadius: 24),
│   │       │       ),
│   │       │   
│   │       │       // --- Switch Theme (if using switches) ---
│   │       │       switchTheme: SwitchThemeData(
│   │       │         thumbColor: WidgetStateProperty.resolveWith<Color?>((Set<WidgetState> states) {
│   │       │           if (states.contains(WidgetState.selected)) {
│   │       │             return AppColors.onPrimary; // Thumb color when selected
│   │       │           }
│   │       │           return Colors.grey.shade400; // Default thumb color
│   │       │         }),
│   │       │         trackColor: WidgetStateProperty.resolveWith<Color?>((Set<WidgetState> states) {
│   │       │           if (states.contains(WidgetState.selected)) {
│   │       │             return AppColors.primary; // Track color when selected
│   │       │           }
│   │       │           return Colors.grey.shade300; // Default track color
│   │       │         }),
│   │       │       ),
│   │       │   
│   │       │       // --- Progress Indicator Theme ---
│   │       │       progressIndicatorTheme: ProgressIndicatorThemeData(
│   │       │         color: AppColors.primary, // Color for progress indicators
│   │       │         circularTrackColor: Colors.grey.shade200, // Track color for circular indicators
│   │       │       ),
│   │       │   
│   │       │       // --- Bottom Navigation Bar Theme (if used) ---
│   │       │       bottomNavigationBarTheme: BottomNavigationBarThemeData(
│   │       │         backgroundColor: Colors.white.withOpacity(0.9), // Semi-transparent bottom bar
│   │       │         elevation: 3,
│   │       │         selectedItemColor: AppColors.primary,
│   │       │         unselectedItemColor: Colors.grey.shade600,
│   │       │         selectedLabelStyle: const TextStyle(fontWeight: FontWeight.w600),
│   │       │         unselectedLabelStyle: const TextStyle(fontWeight: FontWeight.normal),
│   │       │         type: BottomNavigationBarType.fixed, // Or shifting if you prefer
│   │       │       ),
│   │       │   
│   │       │       // --- Dialog Theme ---
│   │       │       dialogTheme: DialogTheme(
│   │       │         backgroundColor: Colors.white,
│   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(16)),
│   │       │         titleTextStyle: TextStyle(fontFamily: 'SF-Pro-Rounded', fontWeight: FontWeight.w700, fontSize: 20, color: AppColors.primary),
│   │       │         contentTextStyle: TextStyle(fontFamily: 'SF-Pro-Rounded', fontSize: 16, color: AppColors.subtleTextColor),
│   │       │       ),
│   │       │   
│   │       │       // --- SnackBar Theme ---
│   │       │       snackBarTheme: SnackBarThemeData(
│   │       │         backgroundColor: Colors.black87, // Darker snackbar for contrast
│   │       │         contentTextStyle: const TextStyle(color: Colors.white),
│   │       │         actionTextColor: AppColors.highlightColor, // Highlight action text
│   │       │         elevation: 6,
│   │       │         behavior: SnackBarBehavior.floating, // Modern floating snackbars
│   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
│   │       │       ),
│   │       │   
│   │       │       // --- ExpansionTile Theme ---
│   │       │       expansionTileTheme: ExpansionTileThemeData(
│   │       │         tilePadding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),
│   │       │         childrenPadding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),
│   │       │         iconColor: AppColors.primary,
│   │       │         collapsedIconColor: AppColors.subtleTextColor,
│   │       │         textColor: AppColors.primary,
│   │       │         collapsedTextColor: AppColors.subtleTextColor,
│   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
│   │       │         collapsedShape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
│   │       │         backgroundColor: Colors.grey.shade50,
│   │       │         collapsedBackgroundColor: Colors.white,
│   │       │       ),
│   │       │     );
│   │       │   }
│   │       │   
│   ├── config/
│   │   └── api_config.dart
│   │       │   class ApiConfig {
│   │       │     static const String baseUrl = "http://13.61.219.12:8000/api";
│   │       │   }
│   ├── controllers/
│   │   ├── auth.dart
│   │   │   │   import 'dart:convert';
│   │   │   │   import 'package:app/utils/snackbar.dart';
│   │   │   │   import 'package:flutter/foundation.dart';
│   │   │   │   import 'package:flutter_secure_storage/flutter_secure_storage.dart';
│   │   │   │   import 'package:http/http.dart' as http;
│   │   │   │   import 'package:app/models/auth_token.dart';
│   │   │   │   import 'package:app/models/user.dart';
│   │   │   │   import 'package:app/config/api_config.dart';
│   │   │   │   
│   │   │   │   class AuthController {
│   │   │   │     AuthController._privateConstructor();
│   │   │   │     static final AuthController _instance = AuthController._privateConstructor();
│   │   │   │     static AuthController get instance => _instance;
│   │   │   │     final String _authBaseUrl = "${ApiConfig.baseUrl}/auth";
│   │   │   │   
│   │   │   │     /// Attempts to log in a user with email and password.
│   │   │   │     /// Returns AuthToken on success, null on failure.
│   │   │   │     Future<AuthToken?> login(String email, String password) async {
│   │   │   │       final Uri loginUrl = Uri.parse("$_authBaseUrl/login/custom/");
│   │   │   │       try {
│   │   │   │         final response = await http.post(
│   │   │   │           loginUrl,
│   │   │   │           headers: {'Content-Type': 'application/json; charset=UTF-8'},
│   │   │   │           body: jsonEncode(<String, String>{
│   │   │   │             'email': email,
│   │   │   │             'password': password,
│   │   │   │           }),
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           final authToken = AuthToken.fromJson(data);
│   │   │   │   
│   │   │   │           // Save tokens to secure storage
│   │   │   │           await _saveTokens(authToken);
│   │   │   │   
│   │   │   │           // Save user data if needed
│   │   │   │           if (data.containsKey('user')) {
│   │   │   │             await _saveUserData(data['user']);
│   │   │   │           }
│   │   │   │   
│   │   │   │           return authToken;
│   │   │   │         } else {
│   │   │   │           // Handle different error status codes (401 Unauthorized, etc.)
│   │   │   │           debugPrint('Login failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Login error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Saves access and refresh tokens to secure storage
│   │   │   │     Future<void> _saveTokens(AuthToken authToken) async {
│   │   │   │       try {
│   │   │   │         final _storage =
│   │   │   │             const FlutterSecureStorage(); // Instance for secure storage
│   │   │   │         await _storage.write(key: 'accessToken', value: authToken.access);
│   │   │   │         await _storage.write(key: 'refreshToken', value: authToken.refresh);
│   │   │   │         debugPrint('Tokens saved successfully');
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Error saving tokens: $e');
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Saves user data to secure storage
│   │   │   │     Future<void> _saveUserData(Map<String, dynamic> userData) async {
│   │   │   │       try {
│   │   │   │         final _storage =
│   │   │   │             const FlutterSecureStorage(); // Instance for secure storage
│   │   │   │   
│   │   │   │         // Convert user data to JSON string
│   │   │   │         final userDataString = jsonEncode(userData);
│   │   │   │         await _storage.write(key: 'userData', value: userDataString);
│   │   │   │   
│   │   │   │         // Save individual user properties if needed
│   │   │   │         await _storage.write(key: 'userId', value: userData['id'].toString());
│   │   │   │         await _storage.write(
│   │   │   │             key: 'userEmail', value: userData['email'].toString());
│   │   │   │         await _storage.write(key: 'userRole', value: userData['role'].toString());
│   │   │   │   
│   │   │   │         debugPrint('User data saved successfully');
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Error saving user data: $e');
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Registers a new user.
│   │   │   │     /// Returns the created User object on success (status code 201), null otherwise.
│   │   │   │     Future<User?> register({
│   │   │   │       required String email,
│   │   │   │       required String password,
│   │   │   │       required String passwordConfirm,
│   │   │   │       required String firstName,
│   │   │   │       required String lastName,
│   │   │   │       required String role, // 'RENTER' or 'OWNER'
│   │   │   │     }) async {
│   │   │   │       final Uri registerUrl = Uri.parse("$_authBaseUrl/register/");
│   │   │   │       try {
│   │   │   │         final response = await http.post(
│   │   │   │           registerUrl,
│   │   │   │           headers: {'Content-Type': 'application/json; charset=UTF-8'},
│   │   │   │           body: jsonEncode(<String, String>{
│   │   │   │             'email': email,
│   │   │   │             'password': password,
│   │   │   │             'password_confirm': passwordConfirm,
│   │   │   │             'first_name': firstName,
│   │   │   │             'last_name': lastName,
│   │   │   │             'role': role,
│   │   │   │           }),
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 201) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           // The registration endpoint returns user details directly
│   │   │   │           return User.fromJson(data);
│   │   │   │         } else {
│   │   │   │           SnackBarUtil.showErrorSnackBar(
│   │   │   │               message: (json.decode(response.body) as Map<String, dynamic>)
│   │   │   │                   .values
│   │   │   │                   .elementAt(0)
│   │   │   │                   .toString()
│   │   │   │                   .replaceAll('[', '')
│   │   │   │                   .replaceAll(']', ''),
│   │   │   │               title: 'Failed');
│   │   │   │           // Handle registration errors (400 Bad Request for validation, etc.)
│   │   │   │           debugPrint(
│   │   │   │               'Registration failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Registration error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Fetches the profile of the currently authenticated user.
│   │   │   │     /// Requires the user's access token.
│   │   │   │     /// Returns User object on success, null on failure.
│   │   │   │     Future<User?> getUserProfile(String accessToken) async {
│   │   │   │       final Uri profileUrl = Uri.parse("$_authBaseUrl/profile/");
│   │   │   │       try {
│   │   │   │         final response = await http.get(
│   │   │   │           profileUrl,
│   │   │   │           headers: {
│   │   │   │             'Content-Type': 'application/json; charset=UTF-8',
│   │   │   │             'Authorization': 'Bearer $accessToken',
│   │   │   │           },
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return User.fromJson(data);
│   │   │   │         } else {
│   │   │   │           // Handle errors (401 Unauthorized, etc.)
│   │   │   │           debugPrint(
│   │   │   │               'Get Profile failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Get Profile error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Updates the profile of the currently authenticated user.
│   │   │   │     /// Only allows updating 'first_name' and 'last_name'.
│   │   │   │     /// Requires the user's access token.
│   │   │   │     /// Returns updated User object on success, null on failure.
│   │   │   │     Future<User?> updateUserProfile({
│   │   │   │       required String accessToken,
│   │   │   │       required String firstName,
│   │   │   │       required String lastName,
│   │   │   │       // Add other updateable fields here if needed
│   │   │   │     }) async {
│   │   │   │       final Uri profileUrl = Uri.parse("$_authBaseUrl/profile/");
│   │   │   │       try {
│   │   │   │         final response = await http.patch(
│   │   │   │           // Use PATCH for partial updates
│   │   │   │           profileUrl,
│   │   │   │           headers: {
│   │   │   │             'Content-Type': 'application/json; charset=UTF-8',
│   │   │   │             'Authorization': 'Bearer $accessToken',
│   │   │   │           },
│   │   │   │           body: jsonEncode(<String, String>{
│   │   │   │             'first_name': firstName,
│   │   │   │             'last_name': lastName,
│   │   │   │             // Add other fields to update
│   │   │   │           }),
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return User.fromJson(data);
│   │   │   │         } else {
│   │   │   │           // Handle errors (401 Unauthorized, 400 Bad Request, etc.)
│   │   │   │           debugPrint(
│   │   │   │               'Update Profile failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Update Profile error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Requests a password reset email for the given email address.
│   │   │   │     /// Returns true on success (API returns 200 regardless of email existence), false on network error.
│   │   │   │     Future<bool> requestPasswordReset(String email) async {
│   │   │   │       final Uri resetUrl = Uri.parse("$_authBaseUrl/password/reset/");
│   │   │   │       try {
│   │   │   │         final response = await http.post(
│   │   │   │           resetUrl,
│   │   │   │           headers: {'Content-Type': 'application/json; charset=UTF-8'},
│   │   │   │           body: jsonEncode(<String, String>{'email': email}),
│   │   │   │         );
│   │   │   │   
│   │   │   │         // API is designed to return 200 OK even if email doesn't exist
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           debugPrint('Password reset request successful (simulated email sent).');
│   │   │   │           return true;
│   │   │   │         } else {
│   │   │   │           // Should ideally not happen based on API design, but handle other errors
│   │   │   │           debugPrint(
│   │   │   │               'Password Reset Request failed: ${response.statusCode} ${response.body}');
│   │   │   │           return false;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Password Reset Request error: $e');
│   │   │   │         return false;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Logs out the user by blacklisting the refresh token.
│   │   │   │     /// Requires the user's access and refresh tokens.
│   │   │   │     /// Returns true on success, false on failure.
│   │   │   │     Future<void> logout() async {
│   │   │   │       //      remove access & refresh keys
│   │   │   │       try {
│   │   │   │         const _storage = FlutterSecureStorage(); // Instance for secure storage
│   │   │   │         await _storage.delete(key: 'accessToken');
│   │   │   │         await _storage.delete(key: 'refreshToken');
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Logout error: $e');
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │   //   get access key
│   │   │   │     Future<String?> getAccessKey() async {
│   │   │   │       try {
│   │   │   │         //   await _storage.write(key: 'accessToken', value: authToken.access);
│   │   │   │         //         await _storage.write(key: 'refreshToken', value: authToken.refresh);
│   │   │   │         final _storage =
│   │   │   │             const FlutterSecureStorage(); // Instance for secure storage
│   │   │   │         final accessKey = await _storage.read(key: 'accessToken');
│   │   │   │         return accessKey;
│   │   │   │       } catch (e) {
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Retrieves the saved user data from secure storage
│   │   │   │     Future<Map<String, dynamic>?> getSavedUserData() async {
│   │   │   │       try {
│   │   │   │         const _storage = FlutterSecureStorage();
│   │   │   │         final userDataString = await _storage.read(key: 'userData');
│   │   │   │         print(userDataString);
│   │   │   │   
│   │   │   │         if (userDataString != null) {
│   │   │   │           return jsonDecode(userDataString) as Map<String, dynamic>;
│   │   │   │         }
│   │   │   │         return null;
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Error retrieving user data: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Check if user is logged in
│   │   │   │     Future<bool> isLoggedIn() async {
│   │   │   │       final accessToken = await getAccessKey();
│   │   │   │       return accessToken != null;
│   │   │   │     }
│   │   │   │   }
│   │   ├── boat.dart
│   │   │   │   import 'dart:convert';
│   │   │   │   import 'dart:io'; // Required for File type if handling image uploads
│   │   │   │   import 'package:app/controllers/auth.dart';
│   │   │   │   import 'package:flutter/foundation.dart';
│   │   │   │   import 'package:http/http.dart' as http;
│   │   │   │   import 'package:http_parser/http_parser.dart'; // Required for MediaType
│   │   │   │   import 'package:app/models/boat.dart'; // Adjust import path if needed
│   │   │   │   import 'package:app/config/api_config.dart'; // Adjust import path if needed
│   │   │   │   
│   │   │   │   class BoatController {
│   │   │   │     final String _boatsBaseUrl = "${ApiConfig.baseUrl}/boats";
│   │   │   │   
│   │   │   │     /// Fetches a list of boats, applying optional filters.
│   │   │   │     /// Use accessToken for owner-specific view or general renter view.
│   │   │   │     /// Filters can include boat_type, capacity, location, etc.
│   │   │   │     /// Ordering can be specified e.g., 'rental_price_per_day' or '-average_rating'.
│   │   │   │     Future<List<Boat>> fetchBoats({
│   │   │   │       // Null for public/renter view, provide for owner view
│   │   │   │       Map<String, String>? filters,
│   │   │   │       String? ordering,
│   │   │   │       String? searchQuery,
│   │   │   │     }) async {
│   │   │   │       // Construct query parameters
│   │   │   │       Map<String, String> queryParams = {};
│   │   │   │       if (filters != null) {
│   │   │   │         queryParams.addAll(filters);
│   │   │   │       }
│   │   │   │       if (ordering != null && ordering.isNotEmpty) {
│   │   │   │         queryParams['ordering'] = ordering;
│   │   │   │       }
│   │   │   │       if (searchQuery != null && searchQuery.isNotEmpty) {
│   │   │   │         queryParams['search'] = searchQuery;
│   │   │   │       }
│   │   │   │   
│   │   │   │       final Uri boatsUrl = Uri.parse(_boatsBaseUrl)
│   │   │   │           .replace(queryParameters: queryParams.isEmpty ? null : queryParams);
│   │   │   │   
│   │   │   │       try {
│   │   │   │         final headers = {'Content-Type': 'application/json; charset=UTF-8'};
│   │   │   │         String? accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         if (accessToken != null) {
│   │   │   │           headers['Authorization'] = 'Bearer $accessToken';
│   │   │   │         } else {}
│   │   │   │   
│   │   │   │         final response = await http.get(boatsUrl, headers: headers);
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           // Assuming the list is under a 'results' key for pagination
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           if (data['results'] != null && data['results'] is List) {
│   │   │   │             final List<dynamic> results = data['results'];
│   │   │   │             return results
│   │   │   │                 .map((json) => Boat.fromJson(json as Map<String, dynamic>))
│   │   │   │                 .toList();
│   │   │   │           } else {
│   │   │   │             debugPrint('Fetch Boats: ${data.toString()}');
│   │   │   │             // Handle cases where 'results' key is missing or not a list
│   │   │   │             debugPrint(
│   │   │   │                 'Fetch Boats: Invalid response format - missing "results" list.');
│   │   │   │             return [];
│   │   │   │           }
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Fetch Boats failed: ${response.statusCode} ${response.body}');
│   │   │   │           return []; // Return empty list on failure
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Fetch Boats error: $e');
│   │   │   │         return []; // Return empty list on error
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Fetches details for a specific boat by its ID.
│   │   │   │     Future<Boat?> fetchBoatDetails(int boatId, {String? accessToken}) async {
│   │   │   │       final Uri detailUrl = Uri.parse("$_boatsBaseUrl/$boatId/");
│   │   │   │       try {
│   │   │   │         final headers = {'Content-Type': 'application/json; charset=UTF-8'};
│   │   │   │         if (accessToken != null) {
│   │   │   │           headers['Authorization'] = 'Bearer $accessToken';
│   │   │   │         }
│   │   │   │         final response = await http.get(detailUrl, headers: headers);
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Boat.fromJson(data);
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Fetch Boat Details failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Fetch Boat Details error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Creates a new boat listing. Requires owner's access token.
│   │   │   │     /// Handles image uploads using multipart request.
│   │   │   │     Future<Boat?> createBoat({
│   │   │   │       required String accessToken,
│   │   │   │       required String name,
│   │   │   │       required String boatType,
│   │   │   │       required double rentalPricePerDay,
│   │   │   │       required String locationDescription,
│   │   │   │       String? description,
│   │   │   │       double? length,
│   │   │   │       int? capacity,
│   │   │   │       int? cabins,
│   │   │   │       bool driverAvailable = false,
│   │   │   │       String? driverName,
│   │   │   │       String? driverDetails,
│   │   │   │       String status = 'DRAFT', // Default status
│   │   │   │       File? mainImageFile, // Main image file
│   │   │   │       List<File>? additionalImageFiles, // List of additional image files
│   │   │   │     }) async {
│   │   │   │       final Uri createUrl = Uri.parse("$_boatsBaseUrl/");
│   │   │   │       try {
│   │   │   │         var request = http.MultipartRequest('POST', createUrl);
│   │   │   │         request.headers['Authorization'] = 'Bearer $accessToken';
│   │   │   │         request.headers['Accept'] =
│   │   │   │             'application/json'; // Important for error responses
│   │   │   │   
│   │   │   │         // Add text fields
│   │   │   │         request.fields['name'] = name;
│   │   │   │         request.fields['boat_type'] = boatType;
│   │   │   │         request.fields['rental_price_per_day'] = rentalPricePerDay.toString();
│   │   │   │         request.fields['location_description'] = locationDescription;
│   │   │   │         if (description != null) request.fields['description'] = description;
│   │   │   │         if (length != null) request.fields['length'] = length.toString();
│   │   │   │         if (capacity != null) request.fields['capacity'] = capacity.toString();
│   │   │   │         if (cabins != null) request.fields['cabins'] = cabins.toString();
│   │   │   │         request.fields['driver_available'] = driverAvailable.toString();
│   │   │   │         if (driverName != null) request.fields['driver_name'] = driverName;
│   │   │   │         if (driverDetails != null)
│   │   │   │           request.fields['driver_details'] = driverDetails;
│   │   │   │         request.fields['status'] = status;
│   │   │   │   
│   │   │   │         // Add main image if provided
│   │   │   │         if (mainImageFile != null) {
│   │   │   │           request.files.add(await http.MultipartFile.fromPath(
│   │   │   │             'main_image', // Matches serializer field name
│   │   │   │             mainImageFile.path,
│   │   │   │             contentType:
│   │   │   │                 MediaType('image', 'jpeg'), // Adjust content type as needed
│   │   │   │           ));
│   │   │   │         }
│   │   │   │   
│   │   │   │         // Add additional images if provided
│   │   │   │         if (additionalImageFiles != null) {
│   │   │   │           for (var file in additionalImageFiles) {
│   │   │   │             request.files.add(await http.MultipartFile.fromPath(
│   │   │   │               'uploaded_images', // Matches serializer field name
│   │   │   │               file.path,
│   │   │   │               contentType: MediaType('image', 'jpeg'), // Adjust content type
│   │   │   │             ));
│   │   │   │           }
│   │   │   │         }
│   │   │   │   
│   │   │   │         final streamedResponse = await request.send();
│   │   │   │         final response = await http.Response.fromStream(streamedResponse);
│   │   │   │   
│   │   │   │         if (response.statusCode == 201) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Boat.fromJson(data);
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Create Boat failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Create Boat error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Updates an existing boat listing. Requires owner's access token.
│   │   │   │     /// Can partially update fields. Handles adding new images.
│   │   │   │     /// Note: This implementation doesn't handle DELETING existing images via the update.
│   │   │   │     Future<Boat?> updateBoat({
│   │   │   │       required int boatId,
│   │   │   │       required String accessToken,
│   │   │   │       String? name,
│   │   │   │       String? boatType,
│   │   │   │       double? rentalPricePerDay,
│   │   │   │       String? locationDescription,
│   │   │   │       String? description,
│   │   │   │       double? length,
│   │   │   │       int? capacity,
│   │   │   │       int? cabins,
│   │   │   │       bool? driverAvailable,
│   │   │   │       String? driverName,
│   │   │   │       String? driverDetails,
│   │   │   │       String? status,
│   │   │   │       File? mainImageFile, // New main image file (optional)
│   │   │   │       List<File>?
│   │   │   │           additionalImageFiles, // List of NEW additional image files (optional)
│   │   │   │     }) async {
│   │   │   │       final Uri updateUrl = Uri.parse("$_boatsBaseUrl/$boatId/");
│   │   │   │       try {
│   │   │   │         var request = http.MultipartRequest('PATCH', updateUrl); // Use PATCH
│   │   │   │         request.headers['Authorization'] = 'Bearer $accessToken';
│   │   │   │         request.headers['Accept'] = 'application/json';
│   │   │   │   
│   │   │   │         // Add fields that are being updated
│   │   │   │         if (name != null) request.fields['name'] = name;
│   │   │   │         if (boatType != null) request.fields['boat_type'] = boatType;
│   │   │   │         if (rentalPricePerDay != null)
│   │   │   │           request.fields['rental_price_per_day'] = rentalPricePerDay.toString();
│   │   │   │         if (locationDescription != null)
│   │   │   │           request.fields['location_description'] = locationDescription;
│   │   │   │         if (description != null) request.fields['description'] = description;
│   │   │   │         if (length != null) request.fields['length'] = length.toString();
│   │   │   │         if (capacity != null) request.fields['capacity'] = capacity.toString();
│   │   │   │         if (cabins != null) request.fields['cabins'] = cabins.toString();
│   │   │   │         if (driverAvailable != null)
│   │   │   │           request.fields['driver_available'] = driverAvailable.toString();
│   │   │   │         if (driverName != null) request.fields['driver_name'] = driverName;
│   │   │   │         if (driverDetails != null)
│   │   │   │           request.fields['driver_details'] = driverDetails;
│   │   │   │         if (status != null) request.fields['status'] = status;
│   │   │   │   
│   │   │   │         // Add new main image if provided
│   │   │   │         if (mainImageFile != null) {
│   │   │   │           request.files.add(await http.MultipartFile.fromPath(
│   │   │   │               'main_image', mainImageFile.path,
│   │   │   │               contentType: MediaType('image', 'jpeg'))); // Adjust
│   │   │   │         }
│   │   │   │   
│   │   │   │         // Add new additional images if provided
│   │   │   │         if (additionalImageFiles != null) {
│   │   │   │           for (var file in additionalImageFiles) {
│   │   │   │             request.files.add(await http.MultipartFile.fromPath(
│   │   │   │                 'uploaded_images', file.path,
│   │   │   │                 contentType: MediaType('image', 'jpeg'))); // Adjust
│   │   │   │           }
│   │   │   │         }
│   │   │   │   
│   │   │   │         final streamedResponse = await request.send();
│   │   │   │         final response = await http.Response.fromStream(streamedResponse);
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Boat.fromJson(data);
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Update Boat failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Update Boat error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Deletes a boat listing. Requires owner's access token.
│   │   │   │     /// Returns true on success (204 No Content), false otherwise.
│   │   │   │     Future<bool> deleteBoat(int boatId, String accessToken) async {
│   │   │   │       final Uri deleteUrl = Uri.parse("$_boatsBaseUrl/$boatId/");
│   │   │   │       try {
│   │   │   │         final response = await http.delete(
│   │   │   │           deleteUrl,
│   │   │   │           headers: {'Authorization': 'Bearer $accessToken'},
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 204) {
│   │   │   │           return true; // Successfully deleted
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Delete Boat failed: ${response.statusCode} ${response.body}');
│   │   │   │           return false;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Delete Boat error: $e');
│   │   │   │         return false;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   }
│   │   ├── booking.dart
│   │   │   │   import 'dart:convert';
│   │   │   │   
│   │   │   │   import 'package:app/config/api_config.dart';
│   │   │   │   import 'package:app/models/booking.dart'; // Adjust import path if needed
│   │   │   │   import 'package:flutter/foundation.dart';
│   │   │   │   import 'package:http/http.dart' as http;
│   │   │   │   
│   │   │   │   import 'auth.dart'; // Adjust import path if needed
│   │   │   │   
│   │   │   │   class BookingController {
│   │   │   │     final String _bookingsBaseUrl = "${ApiConfig.baseUrl}/bookings";
│   │   │   │   
│   │   │   │     /// Fetches bookings based on the user's role (renter or owner).
│   │   │   │     /// Requires the user's access token.
│   │   │   │     Future<List<Booking>> fetchBookings() async {
│   │   │   │       // The backend view automatically filters based on the authenticated user's role
│   │   │   │       final Uri bookingsUrl = Uri.parse("$_bookingsBaseUrl/");
│   │   │   │       try {
│   │   │   │         String? accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         final response = await http.get(
│   │   │   │           bookingsUrl,
│   │   │   │           headers: {
│   │   │   │             'Content-Type': 'application/json; charset=UTF-8',
│   │   │   │             'Authorization': 'Bearer $accessToken',
│   │   │   │           },
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           // Assuming pagination with 'results' key
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           if (data['results'] != null && data['results'] is List) {
│   │   │   │             final List<dynamic> results = data['results'];
│   │   │   │             return results
│   │   │   │                 .map((json) => Booking.fromJson(json as Map<String, dynamic>))
│   │   │   │                 .toList();
│   │   │   │           } else {
│   │   │   │             print(data);
│   │   │   │             debugPrint(
│   │   │   │                 'Fetch Bookings: Invalid response format - missing "results" list.');
│   │   │   │             return [];
│   │   │   │           }
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Fetch Bookings failed: ${response.statusCode} ${response.body}');
│   │   │   │           return [];
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Fetch Bookings error: $e');
│   │   │   │         return [];
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Fetches details for a specific booking by its ID.
│   │   │   │     /// Requires access token of either the renter or the boat owner.
│   │   │   │     Future<Booking?> fetchBookingDetails(
│   │   │   │       int bookingId,
│   │   │   │     ) async {
│   │   │   │       final Uri detailUrl = Uri.parse("$_bookingsBaseUrl/$bookingId/");
│   │   │   │       try {
│   │   │   │         String? accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         final response = await http.get(
│   │   │   │           detailUrl,
│   │   │   │           headers: {
│   │   │   │             'Content-Type': 'application/json; charset=UTF-8',
│   │   │   │             'Authorization': 'Bearer $accessToken',
│   │   │   │           },
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Booking.fromJson(data);
│   │   │   │         } else {
│   │   │   │           // Handle 403 Forbidden, 404 Not Found
│   │   │   │           debugPrint(
│   │   │   │               'Fetch Booking Details failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Fetch Booking Details error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Creates a new booking request (Renter only).
│   │   │   │     Future<Booking?> createBooking({
│   │   │   │       required,
│   │   │   │       required int boatId,
│   │   │   │       required DateTime startDate,
│   │   │   │       required DateTime endDate,
│   │   │   │       required int passengerCount,
│   │   │   │       String? specialRequests,
│   │   │   │     }) async {
│   │   │   │       final Uri createUrl = Uri.parse("$_bookingsBaseUrl/");
│   │   │   │       try {
│   │   │   │         String? accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         final response = await http.post(
│   │   │   │           createUrl,
│   │   │   │           headers: {
│   │   │   │             'Content-Type': 'application/json; charset=UTF-8',
│   │   │   │             'Authorization': 'Bearer $accessToken',
│   │   │   │           },
│   │   │   │           body: jsonEncode(<String, dynamic>{
│   │   │   │             'boat_id': boatId,
│   │   │   │   // Format dates to ISO 8601 string expected by Django DateTimeField
│   │   │   │             'start_date': startDate.toIso8601String(),
│   │   │   │             'end_date': endDate.toIso8601String(),
│   │   │   │             'passenger_count': passengerCount,
│   │   │   │             if (specialRequests != null) 'special_requests': specialRequests,
│   │   │   │   // total_price is calculated by backend
│   │   │   │           }),
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 201) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Booking.fromJson(data);
│   │   │   │         } else {
│   │   │   │   // Handle 400 Bad Request (validation errors, capacity exceeded, etc.), 403 Forbidden
│   │   │   │           debugPrint(
│   │   │   │               'Create Booking failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Create Booking error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Accepts a pending booking (Boat Owner only).
│   │   │   │     Future<Booking?> acceptBooking(
│   │   │   │       int bookingId,
│   │   │   │     ) async {
│   │   │   │       final Uri acceptUrl = Uri.parse("$_bookingsBaseUrl/$bookingId/accept/");
│   │   │   │       try {
│   │   │   │         String? accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         final response = await http.post(
│   │   │   │           acceptUrl,
│   │   │   │           headers: {'Authorization': 'Bearer $accessToken'}, // No body needed
│   │   │   │         );
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Booking.fromJson(data); // Returns the updated booking
│   │   │   │         } else {
│   │   │   │   // Handle 400 (not pending), 403 (not owner), 404
│   │   │   │           debugPrint(
│   │   │   │               'Accept Booking failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Accept Booking error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Rejects a pending booking (Boat Owner only).
│   │   │   │     Future<Booking?> rejectBooking(
│   │   │   │       int bookingId,
│   │   │   │     ) async {
│   │   │   │       final Uri rejectUrl = Uri.parse("$_bookingsBaseUrl/$bookingId/reject/");
│   │   │   │       try {
│   │   │   │         String? accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         final response = await http.post(
│   │   │   │           rejectUrl,
│   │   │   │           headers: {'Authorization': 'Bearer $accessToken'},
│   │   │   │         );
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Booking.fromJson(data); // Returns the updated booking
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Reject Booking failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Reject Booking error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Cancels a booking (Renter or Boat Owner).
│   │   │   │     Future<Booking?> cancelBooking(
│   │   │   │       int bookingId,
│   │   │   │     ) async {
│   │   │   │       final Uri cancelUrl = Uri.parse("$_bookingsBaseUrl/$bookingId/cancel/");
│   │   │   │       try {
│   │   │   │         String? accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         final response = await http.post(
│   │   │   │           cancelUrl,
│   │   │   │           headers: {'Authorization': 'Bearer $accessToken'},
│   │   │   │         );
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return Booking.fromJson(data); // Returns the updated booking
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               'Cancel Booking failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Cancel Booking error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   }
│   │   ├── chat.dart
│   │   │   │   import 'dart:convert';
│   │   │   │   import 'package:app/controllers/auth.dart';
│   │   │   │   import 'package:flutter/foundation.dart';
│   │   │   │   import 'package:http/http.dart' as http;
│   │   │   │   import 'package:app/models/chat_room.dart'; // Adjust import path
│   │   │   │   import 'package:app/models/message.dart'; // Adjust import path
│   │   │   │   import 'package:app/config/api_config.dart'; // Adjust import path
│   │   │   │   
│   │   │   │   class ChatController {
│   │   │   │     final String _chatBaseUrl = "${ApiConfig.baseUrl}/chat";
│   │   │   │   
│   │   │   │     /// Fetches chat rooms the user participates in.
│   │   │   │     Future<List<ChatRoom>> fetchChatRooms(String accessToken) async {
│   │   │   │       final Uri roomsUrl = Uri.parse("$_chatBaseUrl/rooms/");
│   │   │   │       try {
│   │   │   │         final response = await http.get(
│   │   │   │           roomsUrl,
│   │   │   │           headers: {'Authorization': 'Bearer $accessToken'},
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           // Assuming pagination with 'results' key
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           if (data['results'] != null && data['results'] is List) {
│   │   │   │             final List<dynamic> results = data['results'];
│   │   │   │             return results
│   │   │   │                 .map((json) => ChatRoom.fromJson(json as Map<String, dynamic>))
│   │   │   │                 .toList();
│   │   │   │           } else {
│   │   │   │             debugPrint(
│   │   │   │                 '[REST] Fetch ChatRooms: Invalid response format - missing "results" list.');
│   │   │   │             return [];
│   │   │   │           }
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               '[REST] Fetch Chat Rooms failed: ${response.statusCode} ${response.body}');
│   │   │   │           return [];
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('[REST] Fetch Chat Rooms error: $e');
│   │   │   │         return [];
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │     /// Fetches messages for a specific chat room (used for initial history load).
│   │   │   │     Future<List<Message>> fetchMessages(int roomId, String accessToken) async {
│   │   │   │       final Uri messagesUrl = Uri.parse("$_chatBaseUrl/messages/")
│   │   │   │           .replace(queryParameters: {'room': roomId.toString()});
│   │   │   │       try {
│   │   │   │         final response = await http.get(
│   │   │   │           messagesUrl,
│   │   │   │           headers: {'Authorization': 'Bearer $accessToken'},
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 200) {
│   │   │   │           // Assuming pagination with 'results' key
│   │   │   │           final List<dynamic> data = jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │   
│   │   │   │           // Messages are fetched successfully, they will be added via ChatService
│   │   │   │           return data
│   │   │   │               .map((json) => Message.fromJson(json as Map<String, dynamic>))
│   │   │   │               .toList();
│   │   │   │           // return data.map((json) => print(json));
│   │   │   │         } else {
│   │   │   │           // Handle 403 Forbidden if user not participant
│   │   │   │           debugPrint(
│   │   │   │               '[REST] Fetch Messages failed: ${response.statusCode} ${response.body}');
│   │   │   │           return [];
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('[REST] Fetch Messages error: $e');
│   │   │   │         return [];
│   │   │   │       }
│   │   │   │     }
│   │   │   │   
│   │   │   │   // Optional: Keep REST method for marking read if needed as a backup
│   │   │   │   // Future<bool> markMessagesReadREST(int roomId, String accessToken) async { ... }
│   │   │   │   
│   │   │   │   // Optional: Add REST method for creating a room if not triggered elsewhere
│   │   │   │     Future<ChatRoom?> createChatRoom({required String targetUserId}) async {
│   │   │   │       final Uri createUrl = Uri.parse("$_chatBaseUrl/rooms/");
│   │   │   │       try {
│   │   │   │         final accessToken = await AuthController.instance.getAccessKey();
│   │   │   │         final response = await http.post(
│   │   │   │           createUrl,
│   │   │   │           headers: {
│   │   │   │             'Authorization': 'Bearer $accessToken',
│   │   │   │             'Content-Type': 'application/json; charset=UTF-8'
│   │   │   │           },
│   │   │   │           body: jsonEncode({'target_user': targetUserId}),
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 201 || response.statusCode == 200) {
│   │   │   │           final Map<String, dynamic> data =
│   │   │   │               jsonDecode(utf8.decode(response.bodyBytes));
│   │   │   │           return ChatRoom.fromJson(data as Map<String, dynamic>);
│   │   │   │         } else {
│   │   │   │           debugPrint(
│   │   │   │               '[REST] Create Chat Room failed: ${response.statusCode} ${response.body}');
│   │   │   │           return null;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('[REST] Create Chat Room error: $e');
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   }
│   │   ├── contact.dart
│   │   │   │   import 'dart:convert';
│   │   │   │   import 'package:flutter/foundation.dart';
│   │   │   │   import 'package:http/http.dart' as http;
│   │   │   │   import 'package:app/config/api_config.dart';
│   │   │   │   
│   │   │   │   class ContactController {
│   │   │   │     final String _contactUrl = "${ApiConfig.baseUrl}/contact/";
│   │   │   │   
│   │   │   │     /// Submits a contact message.
│   │   │   │     /// Returns true on success (API returns 201), false otherwise.
│   │   │   │     Future<bool> submitContactMessage({
│   │   │   │       required String name,
│   │   │   │       required String email,
│   │   │   │       required String message,
│   │   │   │     }) async {
│   │   │   │       final Uri url = Uri.parse(_contactUrl);
│   │   │   │       try {
│   │   │   │         final response = await http.post(
│   │   │   │           url,
│   │   │   │           headers: {'Content-Type': 'application/json; charset=UTF-8'},
│   │   │   │           body: jsonEncode(<String, String>{
│   │   │   │             'name': name,
│   │   │   │             'email': email,
│   │   │   │             'message': message,
│   │   │   │           }),
│   │   │   │         );
│   │   │   │   
│   │   │   │         if (response.statusCode == 201) {
│   │   │   │           // API returns a success message in the body, but 201 status is enough indication
│   │   │   │           debugPrint('Contact message submitted successfully.');
│   │   │   │           return true;
│   │   │   │         } else {
│   │   │   │           // Handle 400 Bad Request (validation errors)
│   │   │   │           debugPrint(
│   │   │   │               'Submit Contact Message failed: ${response.statusCode} ${response.body}');
│   │   │   │           return false;
│   │   │   │         }
│   │   │   │       } catch (e) {
│   │   │   │         debugPrint('Submit Contact Message error: $e');
│   │   │   │         return false;
│   │   │   │       }
│   │   │   │     }
│   │   │   │   }
│   │   └── review.dart
│   │       │   import 'dart:convert';
│   │       │   import 'package:app/controllers/auth.dart';
│   │       │   import 'package:flutter/foundation.dart';
│   │       │   import 'package:http/http.dart' as http;
│   │       │   import 'package:app/models/review.dart'; // Adjust import path if needed
│   │       │   import 'package:app/config/api_config.dart'; // Adjust import path if needed
│   │       │   
│   │       │   class ReviewController {
│   │       │     final String _reviewsBaseUrl = "${ApiConfig.baseUrl}/reviews";
│   │       │   
│   │       │     /// Fetches reviews, typically filtered by boat ID.
│   │       │     Future<List<Review>> fetchReviews({
│   │       │       int? boatId,
│   │       │     }) async {
│   │       │       Map<String, String> queryParams = {};
│   │       │       String? accessToken = await AuthController.instance.getAccessKey();
│   │       │       if (boatId != null) {
│   │       │         queryParams['boat'] = boatId.toString();
│   │       │       }
│   │       │   
│   │       │       final Uri reviewsUrl = Uri.parse(_reviewsBaseUrl)
│   │       │           .replace(queryParameters: queryParams.isEmpty ? null : queryParams);
│   │       │   
│   │       │       try {
│   │       │         final headers = {'Content-Type': 'application/json; charset=UTF-8'};
│   │       │         // Reviews are often public, but token might be needed for certain views if implemented
│   │       │         if (accessToken != null) {
│   │       │           headers['Authorization'] = 'Bearer $accessToken';
│   │       │         }
│   │       │   
│   │       │         final response = await http.get(reviewsUrl, headers: headers);
│   │       │   
│   │       │         if (response.statusCode == 200) {
│   │       │           // Assuming pagination with 'results' key
│   │       │           final Map<String, dynamic> data =
│   │       │               jsonDecode(utf8.decode(response.bodyBytes));
│   │       │   
│   │       │           if (data['results'] != null && data['results'] is List) {
│   │       │             final List<dynamic> results = data['results'];
│   │       │             return results
│   │       │                 .map((json) => Review.fromJson(json as Map<String, dynamic>))
│   │       │                 .toList();
│   │       │           } else {
│   │       │             debugPrint(
│   │       │                 'Fetch Reviews: Invalid response format - missing "results" list.');
│   │       │             return [];
│   │       │           }
│   │       │         } else {
│   │       │           debugPrint(
│   │       │               'Fetch Reviews failed: ${response.statusCode} ${response.body}');
│   │       │           return [];
│   │       │         }
│   │       │       } catch (e) {
│   │       │         debugPrint('Fetch Reviews error: $e');
│   │       │         return [];
│   │       │       }
│   │       │     }
│   │       │   
│   │       │     /// Creates a new review for a boat (Renter only).
│   │       │     Future<Review?> createReview({
│   │       │       required int bookingId,
│   │       │       required int rating, // 1-5
│   │       │       String? comment,
│   │       │     }) async {
│   │       │       String? accessToken = await AuthController.instance.getAccessKey();
│   │       │       final Uri createUrl = Uri.parse("$_reviewsBaseUrl/");
│   │       │       try {
│   │       │         final response = await http.post(
│   │       │           createUrl,
│   │       │           headers: {
│   │       │             'Content-Type': 'application/json; charset=UTF-8',
│   │       │             'Authorization': 'Bearer $accessToken',
│   │       │           },
│   │       │           body: jsonEncode(<String, dynamic>{
│   │       │             'booking_id': bookingId,
│   │       │             'rating': rating,
│   │       │             if (comment != null) 'comment': comment,
│   │       │           }),
│   │       │         );
│   │       │   
│   │       │         if (response.statusCode == 201) {
│   │       │           final Map<String, dynamic> data =
│   │       │               jsonDecode(utf8.decode(response.bodyBytes));
│   │       │           return Review.fromJson(data);
│   │       │         } else {
│   │       │           // Handle 400 (validation, already reviewed), 403 (not renter or no completed booking)
│   │       │           debugPrint(
│   │       │               'Create Review failed: ${response.statusCode} ${response.body}');
│   │       │           return null;
│   │       │         }
│   │       │       } catch (e) {
│   │       │         debugPrint('Create Review error: $e');
│   │       │         return null;
│   │       │       }
│   │       │     }
│   │       │   
│   │       │   // --- Add update/delete methods if renters should be able to modify/delete their own reviews ---
│   │       │   // Future<Review?> updateReview(...) async { ... http.patch ... }
│   │       │   // Future<bool> deleteReview(...) async { ... http.delete ... }
│   │       │   }
│   ├── features/
│   │   ├── auth/
│   │   │   ├── forgot_password/
│   │   │   │   └── screen.dart
│   │   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:app/app/theme.dart'; // Ensure correct import path to your theme.dart
│   │   │   │       │   import 'package:localization/localization.dart'; // For localization
│   │   │   │       │   // Keep import for ImageFilter if you still want subtle background effect
│   │   │   │       │   
│   │   │   │       │   class ForgotPasswordScreen extends StatefulWidget {
│   │   │   │       │     const ForgotPasswordScreen({super.key});
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<ForgotPasswordScreen> createState() => _ForgotPasswordScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   class _ForgotPasswordScreenState extends State<ForgotPasswordScreen>
│   │   │   │       │       with TickerProviderStateMixin {
│   │   │   │       │     final _formKey = GlobalKey<FormState>();
│   │   │   │       │     final _emailController = TextEditingController();
│   │   │   │       │     late AnimationController _logoAnimationController;
│   │   │   │       │     late Animation<double> _logoAnimation;
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       _logoAnimationController = AnimationController(
│   │   │   │       │         duration: const Duration(milliseconds: 1500),
│   │   │   │       │         vsync: this,
│   │   │   │       │       )..forward();
│   │   │   │       │   
│   │   │   │       │       _logoAnimation = CurvedAnimation(
│   │   │   │       │         parent: _logoAnimationController,
│   │   │   │       │         curve: Curves.easeInOutCubic,
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       _emailController.dispose();
│   │   │   │       │       _logoAnimationController.dispose();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       return Scaffold(
│   │   │   │       │         backgroundColor: Theme.of(context)
│   │   │   │       │             .scaffoldBackgroundColor, // Use theme's light background
│   │   │   │       │         body: Center(
│   │   │   │       │           child: SingleChildScrollView(
│   │   │   │       │             padding: const EdgeInsets.all(32.0),
│   │   │   │       │             child: Column(
│   │   │   │       │               crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │               mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │               children: <Widget>[
│   │   │   │       │                 _buildAppLogo(),
│   │   │   │       │                 const SizedBox(height: 50),
│   │   │   │       │                 _buildForgotPasswordForm(
│   │   │   │       │                     context), // Changed to _buildForgotPasswordForm
│   │   │   │       │                 const SizedBox(height: 40),
│   │   │   │       │                 _buildBackToLoginLink(
│   │   │   │       │                     context), // Changed to _buildBackToLoginLink
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildAppLogo() {
│   │   │   │       │       return ScaleTransition(
│   │   │   │       │         scale: _logoAnimation,
│   │   │   │       │         child: FadeTransition(
│   │   │   │       │           opacity: _logoAnimation,
│   │   │   │       │           child: Hero(
│   │   │   │       │             tag: 'app-logo',
│   │   │   │       │             child: Image.asset('assets/logo.png', width: 64, height: 64),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildForgotPasswordForm(BuildContext context) {
│   │   │   │       │       // Changed to _buildForgotPasswordForm
│   │   │   │       │       return Container(
│   │   │   │       │         // No BackdropFilter or ClipRRect for light theme form
│   │   │   │       │         padding: const EdgeInsets.all(32.0),
│   │   │   │       │         decoration: BoxDecoration(
│   │   │   │       │           color: Colors.white, // Solid white form background for light theme
│   │   │   │       │           borderRadius: BorderRadius.circular(20),
│   │   │   │       │           boxShadow: [
│   │   │   │       │             // Subtle shadow for light theme form
│   │   │   │       │             BoxShadow(
│   │   │   │       │               color: Colors.grey.shade200,
│   │   │   │       │               blurRadius: 10,
│   │   │   │       │               spreadRadius: 2,
│   │   │   │       │               offset: const Offset(0, 4),
│   │   │   │       │             )
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │         child: Form(
│   │   │   │       │           key: _formKey,
│   │   │   │       │           child: Column(
│   │   │   │       │             children: <Widget>[
│   │   │   │       │               Text('forgot_password_form_title'.i18n(),
│   │   │   │       │                   style: Theme.of(context).textTheme.headlineMedium?.copyWith(
│   │   │   │       │                       color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                       fontSize: 24)), // Primary color for title
│   │   │   │       │               const SizedBox(height: 30),
│   │   │   │       │               TextFormField(
│   │   │   │       │                 controller: _emailController,
│   │   │   │       │                 keyboardType: TextInputType.emailAddress,
│   │   │   │       │                 style: TextStyle(
│   │   │   │       │                     color: AppColors.onSurface), // Use onSurface for dark text
│   │   │   │       │                 decoration: InputDecoration(
│   │   │   │       │                   labelText: 'email_label'.i18n(), // Reusing email label
│   │   │   │       │                   hintText: 'email_hint_reset_password'
│   │   │   │       │                       .i18n(), // Specific hint for reset password
│   │   │   │       │                   prefixIcon: Icon(Icons.email_outlined,
│   │   │   │       │                       color: Theme.of(context)
│   │   │   │       │                           .colorScheme
│   │   │   │       │                           .primary), // Primary color icon
│   │   │   │       │                   labelStyle: TextStyle(
│   │   │   │       │                       color: AppColors
│   │   │   │       │                           .subtleTextColor), // Subtle text color for label
│   │   │   │       │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │   │       │                   enabledBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(
│   │   │   │       │                         color: Colors.grey.shade300), // Light grey border
│   │   │   │       │                   ),
│   │   │   │       │                   focusedBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(
│   │   │   │       │                         color: Theme.of(context).colorScheme.secondary),
│   │   │   │       │                   ),
│   │   │   │       │                   errorBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(color: Colors.red.shade300),
│   │   │   │       │                   ),
│   │   │   │       │                   focusedErrorBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: const BorderSide(color: Colors.red),
│   │   │   │       │                   ),
│   │   │   │       │                   filled: true,
│   │   │   │       │                   fillColor: Colors.grey.shade50, // Light fill color
│   │   │   │       │                 ),
│   │   │   │       │                 validator: (value) {
│   │   │   │       │                   if (value == null || value.isEmpty) {
│   │   │   │       │                     return 'email_required_error'
│   │   │   │       │                         .i18n(); // Reusing email required error
│   │   │   │       │                   }
│   │   │   │       │                   if (!value.contains('@')) {
│   │   │   │       │                     return 'invalid_email_format_error'
│   │   │   │       │                         .i18n(); // Reusing invalid email format error
│   │   │   │       │                   }
│   │   │   │       │                   return null;
│   │   │   │       │                 },
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 30),
│   │   │   │       │               ElevatedButton(
│   │   │   │       │                 onPressed: () {
│   │   │   │       │                   if (_formKey.currentState!.validate()) {
│   │   │   │       │                     _simulateForgotPassword(context,
│   │   │   │       │                         _emailController.text); // Simulate forgot password
│   │   │   │       │                   }
│   │   │   │       │                 },
│   │   │   │       │                 style: ElevatedButton.styleFrom(
│   │   │   │       │                   shape: RoundedRectangleBorder(
│   │   │   │       │                       borderRadius: BorderRadius.circular(15)),
│   │   │   │       │                   maximumSize: const Size(double.maxFinite, 50),
│   │   │   │       │                   minimumSize: const Size(double.maxFinite, 50),
│   │   │   │       │                   backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │   │       │                   foregroundColor: Colors.white,
│   │   │   │       │                 ),
│   │   │   │       │                 child: Text('reset_password_button'.i18n(),
│   │   │   │       │                     style: const TextStyle(
│   │   │   │       │                         fontSize: 16)), // Localized reset password button text
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildBackToLoginLink(BuildContext context) {
│   │   │   │       │       // Changed to _buildBackToLoginLink
│   │   │   │       │       return Row(
│   │   │   │       │         mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │         children: <Widget>[
│   │   │   │       │           Text('remember_password_prompt'.i18n(),
│   │   │   │       │               style: TextStyle(
│   │   │   │       │                   color: AppColors
│   │   │   │       │                       .subtleTextColor)), // Localized "remember password" prompt
│   │   │   │       │           TextButton(
│   │   │   │       │             onPressed: () {
│   │   │   │       │               // Navigate to login screen (not implemented in this example)
│   │   │   │       │               _showSnackBar(
│   │   │   │       │                   context,
│   │   │   │       │                   'login_navigation_message'
│   │   │   │       │                       .i18n()); // Reusing login navigation message
│   │   │   │       │             },
│   │   │   │       │             child: Text('back_to_login_link'.i18n(),
│   │   │   │       │                 style: TextStyle(
│   │   │   │       │                     color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                     fontWeight: FontWeight.bold)), // Primary color for login link
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Simulate Forgot Password Function (Replace with actual logic) ---
│   │   │   │       │     void _simulateForgotPassword(BuildContext context, String email) {
│   │   │   │       │       _showSnackBar(
│   │   │   │       │           context,
│   │   │   │       │           'forgot_password_request_message'
│   │   │   │       │               .i18n([email])); // Localized forgot password request message
│   │   │   │       │       // In real app, you would call your forgot password service here
│   │   │   │       │       // and handle sending a reset password email.
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Utility function to show SnackBar ---
│   │   │   │       │     void _showSnackBar(BuildContext context, String message) {
│   │   │   │       │       SnackBarUtil.showSuccessSnackBar(
│   │   │   │       │           message: message,
│   │   │   │       │           title: 'Success'); // Using SnackBarUtil for consistent styling
│   │   │   │       │     }
│   │   │   │       │   }
│   │   │   ├── login/
│   │   │   │   └── screen.dart
│   │   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:app/app/theme.dart';
│   │   │   │       │   import 'package:localization/localization.dart';
│   │   │   │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // Import secure storage
│   │   │   │       │   
│   │   │   │       │   // Import Controller, Model, and Home Screen
│   │   │   │       │   import 'package:app/controllers/auth.dart';
│   │   │   │       │   import 'package:app/models/auth_token.dart';
│   │   │   │       │   import 'package:app/features/home/screen.dart';
│   │   │   │       │   import 'package:app/features/auth/signup/screen.dart'; // For navigation to signup
│   │   │   │       │   import 'package:app/features/auth/forgot_password/screen.dart'; // For forgot password nav
│   │   │   │       │   
│   │   │   │       │   class LoginScreen extends StatefulWidget {
│   │   │   │       │     const LoginScreen({super.key});
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<LoginScreen> createState() => _LoginScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   // --- COMPLETE STATE CLASS ---
│   │   │   │       │   class _LoginScreenState extends State<LoginScreen>
│   │   │   │       │       with TickerProviderStateMixin {
│   │   │   │       │     final _formKey = GlobalKey<FormState>();
│   │   │   │       │     final _emailController = TextEditingController();
│   │   │   │       │     final _passwordController = TextEditingController();
│   │   │   │       │     bool _passwordVisible = false;
│   │   │   │       │     late AnimationController _logoAnimationController;
│   │   │   │       │     late Animation<double> _logoAnimation;
│   │   │   │       │   
│   │   │   │       │     // Controller and loading state
│   │   │   │       │     final AuthController _authController = AuthController.instance;
│   │   │   │       │     bool _isLoading = false;
│   │   │   │       │     final _storage = const FlutterSecureStorage(); // Instance for secure storage
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       _logoAnimationController = AnimationController(
│   │   │   │       │         duration: const Duration(milliseconds: 1500),
│   │   │   │       │         vsync: this,
│   │   │   │       │       )..forward();
│   │   │   │       │   
│   │   │   │       │       _logoAnimation = CurvedAnimation(
│   │   │   │       │         parent: _logoAnimationController,
│   │   │   │       │         curve: Curves.easeInOutCubic,
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       _emailController.dispose();
│   │   │   │       │       _passwordController.dispose();
│   │   │   │       │       _logoAnimationController.dispose();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Login Function with API Call and Token Storage ---
│   │   │   │       │     Future<void> _performLogin() async {
│   │   │   │       │       if (!_formKey.currentState!.validate()) {
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │       setState(() => _isLoading = true);
│   │   │   │       │       final email = _emailController.text.trim();
│   │   │   │       │       final password = 
│   │   │   │       │   
│   │   │   │       │       try {
│   │   │   │       │         AuthToken? authToken = await _authController.login(email, password);
│   │   │   │       │         if (!mounted) return;
│   │   │   │       │   
│   │   │   │       │         if (authToken != null) {
│   │   │   │       │           // --- Login Success: Store Tokens ---
│   │   │   │       │           await _storage.write(key: 'accessToken', value: authToken.access);
│   │   │   │       │           await _storage.write(key: 'refreshToken', value: authToken.refresh);
│   │   │   │       │           // Optionally store user ID/email if needed frequently (less secure than token)
│   │   │   │       │           // await _storage.write(key: 'userId', value: authToken.userId.toString());
│   │   │   │       │   
│   │   │   │       │           debugPrint('Tokens stored successfully.');
│   │   │   │       │   
│   │   │   │       │           Navigator.pushReplacement(
│   │   │   │       │             context,
│   │   │   │       │             MaterialPageRoute(builder: (context) => const HomeScreen()),
│   │   │   │       │           );
│   │   │   │       │           _showSnackBar(context, 'Login Successful!');
│   │   │   │       │         } else {
│   │   │   │       │           _showSnackBar(
│   │   │   │       │               context, 'Login Failed: Invalid credentials or server error.');
│   │   │   │       │         }
│   │   │   │       │       } catch (e) {
│   │   │   │       │         debugPrint("Login Page Error: $e");
│   │   │   │       │         if (mounted) {
│   │   │   │       │           _showSnackBar(
│   │   │   │       │               context, 'An unexpected error occurred. Please try again.');
│   │   │   │       │         }
│   │   │   │       │       } finally {
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() => _isLoading = false);
│   │   │   │       │         }
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │     // --- End of Login Function ---
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       // Using the existing build method structure from your UI code
│   │   │   │       │       return Scaffold(
│   │   │   │       │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │   │       │         body: Center(
│   │   │   │       │           child: SingleChildScrollView(
│   │   │   │       │             padding: const EdgeInsets.all(32.0),
│   │   │   │       │             child: Column(
│   │   │   │       │               crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │               mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │               children: <Widget>[
│   │   │   │       │                 _buildAppLogo(),
│   │   │   │       │                 const SizedBox(height: 50),
│   │   │   │       │                 _buildLoginForm(context),
│   │   │   │       │                 const SizedBox(height: 40),
│   │   │   │       │                 _buildSignupLink(context),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Helper methods copied/adapted from your UI code ---
│   │   │   │       │   
│   │   │   │       │     Widget _buildAppLogo() {
│   │   │   │       │       return ScaleTransition(
│   │   │   │       │         scale: _logoAnimation,
│   │   │   │       │         child: FadeTransition(
│   │   │   │       │           opacity: _logoAnimation,
│   │   │   │       │           child: Hero(
│   │   │   │       │             tag: 'app-logo',
│   │   │   │       │             child: Image.asset('assets/logo.png', width: 64, height: 64),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildLoginForm(BuildContext context) {
│   │   │   │       │       // Using existing form structure, only button logic is changed
│   │   │   │       │       return Container(
│   │   │   │       │         padding: const EdgeInsets.all(32.0),
│   │   │   │       │         decoration: BoxDecoration(
│   │   │   │       │           color: Colors.white,
│   │   │   │       │           borderRadius: BorderRadius.circular(20),
│   │   │   │       │           boxShadow: [
│   │   │   │       │             BoxShadow(
│   │   │   │       │               color: Colors.grey.shade200,
│   │   │   │       │               blurRadius: 10,
│   │   │   │       │               spreadRadius: 2,
│   │   │   │       │               offset: const Offset(0, 4),
│   │   │   │       │             )
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │         child: Form(
│   │   │   │       │           key: _formKey,
│   │   │   │       │           child: Column(
│   │   │   │       │             children: <Widget>[
│   │   │   │       │               Text(
│   │   │   │       │                 'login_title'.i18n(),
│   │   │   │       │                 style: Theme.of(context).textTheme.headlineMedium?.copyWith(
│   │   │   │       │                       color: Theme.of(context).primaryColor,
│   │   │   │       │                       fontSize: 24,
│   │   │   │       │                     ),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 30),
│   │   │   │       │               TextFormField(
│   │   │   │       │                 controller: _emailController,
│   │   │   │       │                 keyboardType: TextInputType.emailAddress,
│   │   │   │       │                 style: TextStyle(color: AppColors.onSurface),
│   │   │   │       │                 decoration: InputDecoration(
│   │   │   │       │                   /* ... Email Field Decoration ... */
│   │   │   │       │                   labelText: 'email_label'.i18n(),
│   │   │   │       │                   hintText: 'email_hint'.i18n(),
│   │   │   │       │                   prefixIcon: Icon(Icons.email_outlined,
│   │   │   │       │                       color: Theme.of(context).primaryColor),
│   │   │   │       │                   labelStyle: TextStyle(color: AppColors.subtleTextColor),
│   │   │   │       │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │   │       │                   enabledBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │   │       │                   ),
│   │   │   │       │                   focusedBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(color: Theme.of(context).primaryColor),
│   │   │   │       │                   ),
│   │   │   │       │                   errorBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(color: Colors.red.shade300),
│   │   │   │       │                   ),
│   │   │   │       │                   focusedErrorBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: const BorderSide(color: Colors.red),
│   │   │   │       │                   ),
│   │   │   │       │                   filled: true,
│   │   │   │       │                   fillColor: Colors.grey.shade50,
│   │   │   │       │                 ),
│   │   │   │       │                 validator: (value) {
│   │   │   │       │                   if (value == null || value.isEmpty)
│   │   │   │       │                     return 'email_required_error'.i18n();
│   │   │   │       │                   if (!value.contains('@'))
│   │   │   │       │                     return 'invalid_email_format_error'.i18n();
│   │   │   │       │                   return null;
│   │   │   │       │                 },
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 20),
│   │   │   │       │               TextFormField(
│   │   │   │       │                 controller: _passwordController,
│   │   │   │       │                 obscureText: !_passwordVisible,
│   │   │   │       │                 style: TextStyle(color: AppColors.onSurface),
│   │   │   │       │                 decoration: InputDecoration(
│   │   │   │       │                   /* ... Password Field Decoration ... */
│   │   │   │       │                   labelText: 'password_label'.i18n(),
│   │   │   │       │                   hintText: 'password_hint'.i18n(),
│   │   │   │       │                   prefixIcon: Icon(Icons.lock_outline,
│   │   │   │       │                       color: Theme.of(context).primaryColor),
│   │   │   │       │                   labelStyle: TextStyle(color: AppColors.subtleTextColor),
│   │   │   │       │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │   │       │                   enabledBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │   │       │                   ),
│   │   │   │       │                   focusedBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(color: Theme.of(context).primaryColor),
│   │   │   │       │                   ),
│   │   │   │       │                   errorBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: BorderSide(color: Colors.red.shade300),
│   │   │   │       │                   ),
│   │   │   │       │                   focusedErrorBorder: OutlineInputBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15),
│   │   │   │       │                     borderSide: const BorderSide(color: Colors.red),
│   │   │   │       │                   ),
│   │   │   │       │                   filled: true,
│   │   │   │       │                   fillColor: Colors.grey.shade50,
│   │   │   │       │                   suffixIcon: IconButton(
│   │   │   │       │                     icon: Icon(
│   │   │   │       │                         _passwordVisible
│   │   │   │       │                             ? Icons.visibility
│   │   │   │       │                             : Icons.visibility_off,
│   │   │   │       │                         color: Theme.of(context).primaryColor),
│   │   │   │       │                     onPressed: () =>
│   │   │   │       │                         setState(() => _passwordVisible = !_passwordVisible),
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │                 validator: (value) {
│   │   │   │       │                   if (value == null || value.isEmpty)
│   │   │   │       │                     return 'password_required_error'.i18n();
│   │   │   │       │                   return null;
│   │   │   │       │                 },
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 30),
│   │   │   │       │               ElevatedButton(
│   │   │   │       │                 // Updated onPressed and child for loading state
│   │   │   │       │                 onPressed: _isLoading ? null : _performLogin,
│   │   │   │       │                 style: ElevatedButton.styleFrom(
│   │   │   │       │                   shape: RoundedRectangleBorder(
│   │   │   │       │                       borderRadius: BorderRadius.circular(15)),
│   │   │   │       │                   maximumSize: const Size(double.maxFinite, 50),
│   │   │   │       │                   minimumSize: const Size(double.maxFinite, 50),
│   │   │   │       │                   backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │   │       │                   foregroundColor: Colors.white,
│   │   │   │       │                   disabledBackgroundColor: Theme.of(context)
│   │   │   │       │                       .colorScheme
│   │   │   │       │                       .primary
│   │   │   │       │                       .withOpacity(0.6), // Visual feedback when disabled
│   │   │   │       │                 ),
│   │   │   │       │                 child: _isLoading
│   │   │   │       │                     ? const SizedBox(
│   │   │   │       │                         width: 24,
│   │   │   │       │                         height: 24,
│   │   │   │       │                         child: CircularProgressIndicator(
│   │   │   │       │                             strokeWidth: 2.5, color: Colors.white),
│   │   │   │       │                       )
│   │   │   │       │                     : Text('login_button'.i18n(),
│   │   │   │       │                         style: const TextStyle(fontSize: 16)),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildSignupLink(BuildContext context) {
│   │   │   │       │       return Row(
│   │   │   │       │         mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │         children: <Widget>[
│   │   │   │       │           Text('no_account_prompt'.i18n(),
│   │   │   │       │               style: TextStyle(color: AppColors.subtleTextColor)),
│   │   │   │       │           TextButton(
│   │   │   │       │             onPressed: () {
│   │   │   │       │               // Navigate to Signup Screen
│   │   │   │       │               Navigator.push(
│   │   │   │       │                 context,
│   │   │   │       │                 MaterialPageRoute(builder: (_) => const SignupScreen()),
│   │   │   │       │               );
│   │   │   │       │             },
│   │   │   │       │             child: Text('signup_link'.i18n(),
│   │   │   │       │                 style: TextStyle(
│   │   │   │       │                     color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                     fontWeight: FontWeight.bold)),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     void _showSnackBar(BuildContext context, String message) {
│   │   │   │       │       SnackBarUtil.showSuccessSnackBar(
│   │   │   │       │         message: message,
│   │   │   │       │         title: '',
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   // --- End of Helper methods ---
│   │   │   │       │   }
│   │   │   │       │   // --- END OF COMPLETE STATE CLASS ---
│   │   │   └── signup/
│   │   │       └── screen.dart
│   │   │           │   import 'package:app/utils/snackbar.dart';
│   │   │           │   import 'package:flutter/material.dart';
│   │   │           │   import 'package:app/app/theme.dart'; // Ensure correct import path to your theme.dart
│   │   │           │   import 'package:localization/localization.dart'; // For localization
│   │   │           │   // import 'dart:ui'; // Keep if needed
│   │   │           │   
│   │   │           │   // --- Import Controller and Model ---
│   │   │           │   import 'package:app/controllers/auth.dart'; // Use the new name
│   │   │           │   import 'package:app/models/user.dart'; // Use the new name
│   │   │           │   import 'package:app/features/auth/login/screen.dart'; // Import LoginScreen for navigation
│   │   │           │   
│   │   │           │   class SignupScreen extends StatefulWidget {
│   │   │           │     const SignupScreen({super.key});
│   │   │           │   
│   │   │           │     @override
│   │   │           │     State<SignupScreen> createState() => _SignupScreenState();
│   │   │           │   }
│   │   │           │   
│   │   │           │   class _SignupScreenState extends State<SignupScreen>
│   │   │           │       with TickerProviderStateMixin {
│   │   │           │     final _formKey = GlobalKey<FormState>();
│   │   │           │     final _nameController = TextEditingController();
│   │   │           │     final _emailController = TextEditingController();
│   │   │           │     final _passwordController = TextEditingController();
│   │   │           │     final _confirmPasswordController = TextEditingController();
│   │   │           │     String _selectedRole =
│   │   │           │         'RENTER'; // Default role - Ensure it matches API choices ('RENTER', 'OWNER')
│   │   │           │     bool _passwordVisible = false;
│   │   │           │     late AnimationController _logoAnimationController;
│   │   │           │     late Animation<double> _logoAnimation;
│   │   │           │   
│   │   │           │     // --- Add Controller Instance and Loading State ---
│   │   │           │     final AuthController _authController = AuthController.instance;
│   │   │           │     bool _isLoading = false;
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void initState() {
│   │   │           │       super.initState();
│   │   │           │       _logoAnimationController = AnimationController(
│   │   │           │         duration: const Duration(milliseconds: 1500),
│   │   │           │         vsync: this,
│   │   │           │       )..forward();
│   │   │           │   
│   │   │           │       _logoAnimation = CurvedAnimation(
│   │   │           │         parent: _logoAnimationController,
│   │   │           │         curve: Curves.easeInOutCubic,
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void dispose() {
│   │   │           │       _nameController.dispose();
│   │   │           │       _emailController.dispose();
│   │   │           │       _passwordController.dispose();
│   │   │           │       _confirmPasswordController.dispose();
│   │   │           │       _logoAnimationController.dispose();
│   │   │           │       super.dispose();
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- New function to handle API registration ---
│   │   │           │     Future<void> _performSignup() async {
│   │   │           │       // Validate the form first
│   │   │           │       if (!_formKey.currentState!.validate()) {
│   │   │           │         return;
│   │   │           │       }
│   │   │           │   
│   │   │           │       // Set loading state
│   │   │           │       setState(() => _isLoading = true);
│   │   │           │   
│   │   │           │       // Extract data (split first/last name)
│   │   │           │       final fullName = _nameController.text.trim();
│   │   │           │       // Simple split - adjust if names are more complex
│   │   │           │       final firstName = fullName.split(' ').first;
│   │   │           │       final lastName = fullName.split(' ').length > 1
│   │   │           │           ? fullName.substring(firstName.length).trim()
│   │   │           │           : ''; // Handle single names
│   │   │           │   
│   │   │           │       final email = _emailController.text.trim();
│   │   │           │       final password = 
│   │   │           │       final passwordConfirm = _confirmPasswordController.text;
│   │   │           │       final role = _selectedRole; // Use the selected role
│   │   │           │   
│   │   │           │       try {
│   │   │           │         // Call the controller method
│   │   │           │         User? newUser = await _authController.register(
│   │   │           │           email: email,
│   │   │           │           password: 
│   │   │           │           passwordConfirm: passwordConfirm,
│   │   │           │           firstName: firstName,
│   │   │           │           lastName: lastName.isEmpty
│   │   │           │               ? "."
│   │   │           │               : lastName, // API requires last name, provide placeholder if needed
│   │   │           │           role: role,
│   │   │           │         );
│   │   │           │   
│   │   │           │         // Check if the widget is still mounted before updating state
│   │   │           │         if (!mounted) return;
│   │   │           │   
│   │   │           │         if (newUser != null) {
│   │   │           │           // --- Registration Success ---
│   │   │           │           debugPrint('Registration Successful! User ID: ${newUser.id}');
│   │   │           │   
│   │   │           │           _showSnackBar(context, 'Registration Successful! Please log in.');
│   │   │           │   
│   │   │           │           // Navigate to the Login Screen after successful registration
│   │   │           │           Navigator.pushReplacement(
│   │   │           │             // Replace signup screen with login
│   │   │           │             context,
│   │   │           │             MaterialPageRoute(builder: (context) => const LoginScreen()),
│   │   │           │           );
│   │   │           │         } else {
│   │   │           │           // --- Registration Failed ---
│   │   │           │           // Controller returns null on failure (e.g., 400 duplicate email, validation error)
│   │   │           │           // Note: The specific error message might be in the response body,
│   │   │           │           // which the controller currently prints. You might want to parse it
│   │   │           │           // in the controller and return a more specific error message/enum.
│   │   │           │           // _showSnackBar(context,
│   │   │           │           //     'Registration Failed: Email might be taken or invalid data.');
│   │   │           │         }
│   │   │           │       } catch (e) {
│   │   │           │         // --- Handle Network or other unexpected errors ---
│   │   │           │         debugPrint("Signup Page Error: $e");
│   │   │           │         if (mounted) {
│   │   │           │           _showSnackBar(
│   │   │           │               context, 'An unexpected error occurred. Please try again.');
│   │   │           │         }
│   │   │           │       } finally {
│   │   │           │         // --- Stop Loading ---
│   │   │           │         if (mounted) {
│   │   │           │           setState(() => _isLoading = false);
│   │   │           │         }
│   │   │           │       }
│   │   │           │     }
│   │   │           │     // --- End of new signup function ---
│   │   │           │   
│   │   │           │     @override
│   │   │           │     Widget build(BuildContext context) {
│   │   │           │       return Scaffold(
│   │   │           │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │           │         body: Center(
│   │   │           │           child: SingleChildScrollView(
│   │   │           │             padding: const EdgeInsets.all(32.0),
│   │   │           │             child: Column(
│   │   │           │               crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │           │               mainAxisAlignment: MainAxisAlignment.center,
│   │   │           │               children: <Widget>[
│   │   │           │                 const SizedBox(height: 48),
│   │   │           │                 _buildAppLogo(),
│   │   │           │                 const SizedBox(height: 50),
│   │   │           │                 _buildSignupForm(context), // Calls the form builder
│   │   │           │                 const SizedBox(height: 40),
│   │   │           │                 _buildLoginLink(context),
│   │   │           │               ],
│   │   │           │             ),
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildAppLogo() {
│   │   │           │       return ScaleTransition(
│   │   │           │         scale: _logoAnimation,
│   │   │           │         child: FadeTransition(
│   │   │           │           opacity: _logoAnimation,
│   │   │           │           child: Hero(
│   │   │           │             tag: 'app-logo',
│   │   │           │             child: Image.asset('assets/logo.png', width: 64, height: 64),
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildSignupForm(BuildContext context) {
│   │   │           │       return Container(
│   │   │           │         padding: const EdgeInsets.all(32.0),
│   │   │           │         decoration: BoxDecoration(
│   │   │           │           color: Colors.white,
│   │   │           │           borderRadius: BorderRadius.circular(20),
│   │   │           │           boxShadow: [
│   │   │           │             BoxShadow(
│   │   │           │               color: Colors.grey.shade200,
│   │   │           │               blurRadius: 10,
│   │   │           │               spreadRadius: 2,
│   │   │           │               offset: const Offset(0, 4),
│   │   │           │             )
│   │   │           │           ],
│   │   │           │         ),
│   │   │           │         child: Form(
│   │   │           │           key: _formKey, // Use the global key
│   │   │           │           child: Column(
│   │   │           │             children: <Widget>[
│   │   │           │               Text(
│   │   │           │                 'signup_title'.i18n(),
│   │   │           │                 style: Theme.of(context).textTheme.headlineMedium?.copyWith(
│   │   │           │                       color: Theme.of(context).colorScheme.primary,
│   │   │           │                       fontSize: 24,
│   │   │           │                     ),
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 30),
│   │   │           │               TextFormField(
│   │   │           │                 // Full Name Field
│   │   │           │                 controller: _nameController, // Use controller
│   │   │           │                 keyboardType: TextInputType.name,
│   │   │           │                 style: TextStyle(color: AppColors.onSurface),
│   │   │           │                 decoration: InputDecoration(
│   │   │           │                   labelText: 'name_label'.i18n(),
│   │   │           │                   hintText: 'name_hint'.i18n(),
│   │   │           │                   prefixIcon: Icon(Icons.person_outline,
│   │   │           │                       color: Theme.of(context).colorScheme.primary),
│   │   │           │                   labelStyle: TextStyle(color: AppColors.subtleTextColor),
│   │   │           │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │           │                   enabledBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(
│   │   │           │                         color: Theme.of(context).colorScheme.secondary),
│   │   │           │                   ),
│   │   │           │                   errorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.red.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedErrorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: const BorderSide(color: Colors.red),
│   │   │           │                   ),
│   │   │           │                   filled: true,
│   │   │           │                   fillColor: Colors.grey.shade50,
│   │   │           │                 ),
│   │   │           │                 validator: (value) {
│   │   │           │                   // Keep validation
│   │   │           │                   if (value == null || value.isEmpty) {
│   │   │           │                     return 'name_required_error'.i18n();
│   │   │           │                   }
│   │   │           │                   if (!value.trim().contains(' ')) {
│   │   │           │                     // Simple check for at least one space
│   │   │           │                     return 'Please enter both first and last name.';
│   │   │           │                   }
│   │   │           │                   return null;
│   │   │           │                 },
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 20),
│   │   │           │               TextFormField(
│   │   │           │                 // Email Field
│   │   │           │                 controller: _emailController, // Use controller
│   │   │           │                 keyboardType: TextInputType.emailAddress,
│   │   │           │                 style: TextStyle(color: AppColors.onSurface),
│   │   │           │                 decoration: InputDecoration(
│   │   │           │                   labelText: 'email_label'.i18n(),
│   │   │           │                   hintText: 'email_hint'.i18n(),
│   │   │           │                   prefixIcon: Icon(Icons.email_outlined,
│   │   │           │                       color: Theme.of(context).colorScheme.primary),
│   │   │           │                   labelStyle: TextStyle(color: AppColors.subtleTextColor),
│   │   │           │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │           │                   enabledBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(
│   │   │           │                         color: Theme.of(context).colorScheme.secondary),
│   │   │           │                   ),
│   │   │           │                   errorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.red.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedErrorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: const BorderSide(color: Colors.red),
│   │   │           │                   ),
│   │   │           │                   filled: true,
│   │   │           │                   fillColor: Colors.grey.shade50,
│   │   │           │                 ),
│   │   │           │                 validator: (value) {
│   │   │           │                   // Keep validation
│   │   │           │                   if (value == null || value.isEmpty) {
│   │   │           │                     return 'email_required_error'.i18n();
│   │   │           │                   }
│   │   │           │                   if (!value.contains('@')) {
│   │   │           │                     return 'invalid_email_format_error'.i18n();
│   │   │           │                   }
│   │   │           │                   return null;
│   │   │           │                 },
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 20),
│   │   │           │               TextFormField(
│   │   │           │                 // Password Field
│   │   │           │                 controller: _passwordController, // Use controller
│   │   │           │                 obscureText: !_passwordVisible,
│   │   │           │                 style: TextStyle(color: AppColors.onSurface),
│   │   │           │                 decoration: InputDecoration(
│   │   │           │                   labelText: 'password_label'.i18n(),
│   │   │           │                   hintText: 'password_hint'.i18n(),
│   │   │           │                   prefixIcon: Icon(Icons.lock_outline,
│   │   │           │                       color: Theme.of(context).colorScheme.primary),
│   │   │           │                   labelStyle: TextStyle(color: AppColors.subtleTextColor),
│   │   │           │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │           │                   enabledBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(
│   │   │           │                         color: Theme.of(context).colorScheme.secondary),
│   │   │           │                   ),
│   │   │           │                   errorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.red.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedErrorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: const BorderSide(color: Colors.red),
│   │   │           │                   ),
│   │   │           │                   filled: true,
│   │   │           │                   fillColor: Colors.grey.shade50,
│   │   │           │                   suffixIcon: IconButton(
│   │   │           │                     // Keep visibility toggle
│   │   │           │                     icon: Icon(
│   │   │           │                       _passwordVisible ? Icons.visibility : Icons.visibility_off,
│   │   │           │                       color: Theme.of(context).colorScheme.primary,
│   │   │           │                     ),
│   │   │           │                     onPressed: () {
│   │   │           │                       setState(() {
│   │   │           │                         _passwordVisible = !_passwordVisible;
│   │   │           │                       });
│   │   │           │                     },
│   │   │           │                   ),
│   │   │           │                 ),
│   │   │           │                 validator: (value) {
│   │   │           │                   // Keep validation
│   │   │           │                   if (value == null || value.isEmpty) {
│   │   │           │                     return 'password_required_error'.i18n();
│   │   │           │                   }
│   │   │           │                   // You might want to enforce complexity on the client-side too,
│   │   │           │                   // but the backend validation is the most critical.
│   │   │           │                   if (value.length < 8) {
│   │   │           │                     // Example: Enforce min length 8
│   │   │           │                     return 'password_min_length_error'
│   │   │           │                         .i18n(); // Ensure this key exists
│   │   │           │                   }
│   │   │           │                   return null;
│   │   │           │                 },
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 20),
│   │   │           │               TextFormField(
│   │   │           │                 // Confirm Password Field
│   │   │           │                 controller: _confirmPasswordController, // Use controller
│   │   │           │                 obscureText: !_passwordVisible,
│   │   │           │                 style: TextStyle(color: AppColors.onSurface),
│   │   │           │                 decoration: InputDecoration(
│   │   │           │                   labelText: 'confirm_password_label'.i18n(),
│   │   │           │                   hintText: 'confirm_password_hint'.i18n(),
│   │   │           │                   prefixIcon: Icon(Icons.lock_outline,
│   │   │           │                       color: Theme.of(context).colorScheme.primary),
│   │   │           │                   labelStyle: TextStyle(color: AppColors.subtleTextColor),
│   │   │           │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │           │                   enabledBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(
│   │   │           │                         color: Theme.of(context).colorScheme.secondary),
│   │   │           │                   ),
│   │   │           │                   errorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.red.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedErrorBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: const BorderSide(color: Colors.red),
│   │   │           │                   ),
│   │   │           │                   filled: true,
│   │   │           │                   fillColor: Colors.grey.shade50,
│   │   │           │                   suffixIcon: IconButton(
│   │   │           │                     icon: Icon(
│   │   │           │                       _passwordVisible ? Icons.visibility : Icons.visibility_off,
│   │   │           │                       color: Theme.of(context).colorScheme.primary,
│   │   │           │                     ),
│   │   │           │                     onPressed: () {
│   │   │           │                       setState(() {
│   │   │           │                         _passwordVisible = !_passwordVisible;
│   │   │           │                       });
│   │   │           │                     },
│   │   │           │                   ),
│   │   │           │                 ),
│   │   │           │                 validator: (value) {
│   │   │           │                   // Keep validation
│   │   │           │                   if (value == null || value.isEmpty) {
│   │   │           │                     return 'confirm_password_required_error'.i18n();
│   │   │           │                   }
│   │   │           │                   if (value != _passwordController.text) {
│   │   │           │                     return 'password_mismatch_error'.i18n();
│   │   │           │                   }
│   │   │           │                   return null;
│   │   │           │                 },
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 20),
│   │   │           │               DropdownButtonFormField<String>(
│   │   │           │                 // Role Dropdown
│   │   │           │                 value: _selectedRole,
│   │   │           │                 decoration: InputDecoration(
│   │   │           │                   labelText: 'role_label'.i18n(),
│   │   │           │                   prefixIcon: Icon(Icons.group_outlined,
│   │   │           │                       color: Theme.of(context).colorScheme.primary),
│   │   │           │                   labelStyle: TextStyle(color: AppColors.subtleTextColor),
│   │   │           │                   enabledBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(15),
│   │   │           │                     borderSide: BorderSide(
│   │   │           │                         color: Theme.of(context).colorScheme.secondary),
│   │   │           │                   ),
│   │   │           │                   filled: true,
│   │   │           │                   fillColor: Colors.grey.shade50,
│   │   │           │                 ),
│   │   │           │                 items: <String>[
│   │   │           │                   'RENTER',
│   │   │           │                   'OWNER'
│   │   │           │                 ] // Match the choices in Django Model/Serializer
│   │   │           │                     .map<DropdownMenuItem<String>>((String value) {
│   │   │           │                   return DropdownMenuItem<String>(
│   │   │           │                     value: value,
│   │   │           │                     // Use localization keys for display text
│   │   │           │                     child: Text(value == 'RENTER'
│   │   │           │                         ? 'renter_role'.i18n()
│   │   │           │                         : 'owner_role'.i18n()),
│   │   │           │                   );
│   │   │           │                 }).toList(),
│   │   │           │                 onChanged: (String? newValue) {
│   │   │           │                   setState(() {
│   │   │           │                     _selectedRole = newValue!;
│   │   │           │                   });
│   │   │           │                 },
│   │   │           │                 validator: (value) =>
│   │   │           │                     value == null ? 'role_required_error'.i18n() : null,
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 30),
│   │   │           │               ElevatedButton(
│   │   │           │                 // --- Use _isLoading state and call _performSignup ---
│   │   │           │                 onPressed: _isLoading
│   │   │           │                     ? null
│   │   │           │                     : _performSignup, // Disable button when loading
│   │   │           │                 style: ElevatedButton.styleFrom(
│   │   │           │                   shape: RoundedRectangleBorder(
│   │   │           │                       borderRadius: BorderRadius.circular(15)),
│   │   │           │                   maximumSize: const Size(double.maxFinite, 50),
│   │   │           │                   minimumSize: const Size(double.maxFinite, 50),
│   │   │           │                   backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │           │                   foregroundColor: Colors.white,
│   │   │           │                 ),
│   │   │           │                 child: _isLoading
│   │   │           │                     ? const SizedBox(
│   │   │           │                         // Show loading indicator inside button
│   │   │           │                         width: 24,
│   │   │           │                         height: 24,
│   │   │           │                         child: CircularProgressIndicator(
│   │   │           │                           strokeWidth: 2.5,
│   │   │           │                           color: Colors.white,
│   │   │           │                         ),
│   │   │           │                       )
│   │   │           │                     : Text('signup_button'.i18n(),
│   │   │           │                         style: const TextStyle(fontSize: 16)),
│   │   │           │               ),
│   │   │           │             ],
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildLoginLink(BuildContext context) {
│   │   │           │       // No changes needed here for signup API call itself
│   │   │           │       return Row(
│   │   │           │         mainAxisAlignment: MainAxisAlignment.center,
│   │   │           │         children: <Widget>[
│   │   │           │           Text('already_have_account_prompt'.i18n(),
│   │   │           │               style: TextStyle(color: AppColors.subtleTextColor)),
│   │   │           │           TextButton(
│   │   │           │             onPressed: () {
│   │   │           │               // Navigate back to login screen
│   │   │           │               Navigator.pushReplacement(
│   │   │           │                 // Or just pop if login is the previous screen
│   │   │           │                 context,
│   │   │           │                 MaterialPageRoute(builder: (context) => const LoginScreen()),
│   │   │           │               );
│   │   │           │             },
│   │   │           │             child: Text('login_link'.i18n(),
│   │   │           │                 style: TextStyle(
│   │   │           │                     color: Theme.of(context).colorScheme.primary,
│   │   │           │                     fontWeight: FontWeight.bold)),
│   │   │           │           ),
│   │   │           │         ],
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // Remove the _simulateSignup function
│   │   │           │     // void _simulateSignup(...) { ... }
│   │   │           │   
│   │   │           │     // Utility function to show SnackBar (keep this)
│   │   │           │     void _showSnackBar(BuildContext context, String message) {
│   │   │           │       SnackBarUtil.showSuccessSnackBar(
│   │   │           │         message: message,
│   │   │           │         title: '',
│   │   │           │       );
│   │   │           │     }
│   │   │           │   }
│   │   ├── bookings/
│   │   │   ├── add/
│   │   │   │   └── screen.dart
│   │   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:app/app/theme.dart';
│   │   │   │       │   import 'package:localization/localization.dart';
│   │   │   │       │   import 'package:carousel_slider/carousel_slider.dart';
│   │   │   │       │   import 'package:flutter_animate/flutter_animate.dart';
│   │   │   │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token access
│   │   │   │       │   
│   │   │   │       │   // --- Import Controller and Model ---
│   │   │   │       │   import 'package:app/controllers/booking.dart'; // Use correct controller name
│   │   │   │       │   import 'package:app/models/booking.dart'; // Use correct model name
│   │   │   │       │   import 'package:app/models/boat.dart'; // Keep Boat model for dummy data/display
│   │   │   │       │   import 'package:app/features/renter/review/screen.dart'; // Assuming Boat model definition is here or shared
│   │   │   │       │   
│   │   │   │       │   class BookBoatScreen extends StatefulWidget {
│   │   │   │       │     final String boatId; // Keep this if you fetch details separately later
│   │   │   │       │     final Boat boat; // Keep using the dummy Boat object for now
│   │   │   │       │   
│   │   │   │       │     BookBoatScreen({
│   │   │   │       │       super.key,
│   │   │   │       │       required this.boatId, // Pass the actual ID
│   │   │   │       │       required this.boat, // Pass the fetched/dummy boat details
│   │   │   │       │     });
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<BookBoatScreen> createState() => _BookBoatScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   class _BookBoatScreenState extends State<BookBoatScreen>
│   │   │   │       │       with TickerProviderStateMixin {
│   │   │   │       │     // --- Add Controller Instance and Loading State ---
│   │   │   │       │     final BookingController _bookingController = BookingController();
│   │   │   │       │     bool _isLoading = false;
│   │   │   │       │     final _storage = const FlutterSecureStorage(); // For retrieving token
│   │   │   │       │   
│   │   │   │       │     late AnimationController _logoAnimationController;
│   │   │   │       │     late Animation<double> _logoAnimation;
│   │   │   │       │     DateTime _startDate = DateTime.now();
│   │   │   │       │     DateTime _endDate = DateTime.now().add(const Duration(days: 3));
│   │   │   │       │     int _passengerCount = 1;
│   │   │   │       │     final _specialRequestsController = TextEditingController();
│   │   │   │       │     final _durationController =
│   │   │   │       │         TextEditingController(text: '1'); // Still needed for UI?
│   │   │   │       │   
│   │   │   │       │     int _currentImageIndex = 0;
│   │   │   │       │     // Use image URLs from the passed 'widget.boat' object
│   │   │   │       │     late List<String> _boatImageUrls;
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       _boatImageUrls = widget.boat.imageUrls; // Use images from the passed boat
│   │   │   │       │       // ... (keep existing animation controller setup) ...
│   │   │   │       │       _logoAnimationController = AnimationController(
│   │   │   │       │         duration: const Duration(milliseconds: 1500),
│   │   │   │       │         vsync: this,
│   │   │   │       │       )..forward();
│   │   │   │       │   
│   │   │   │       │       _logoAnimation = CurvedAnimation(
│   │   │   │       │         parent: _logoAnimationController,
│   │   │   │       │         curve: Curves.easeInOutCubic,
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       _logoAnimationController.dispose();
│   │   │   │       │       _specialRequestsController.dispose();
│   │   │   │       │       _durationController.dispose();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- New function to handle API booking ---
│   │   │   │       │     Future<void> _performBooking() async {
│   │   │   │       │       // Retrieve the access token (Replace with your actual token fetching logic)
│   │   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │   
│   │   │   │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │   │       │         if (mounted) {
│   │   │   │       │           _showSnackBar(context, 'Authentication error. Please log in again.',
│   │   │   │       │               isError: true);
│   │   │   │       │         }
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       // Set loading state
│   │   │   │       │       setState(() => _isLoading = true);
│   │   │   │       │   
│   │   │   │       │       try {
│   │   │   │       │         // Call the controller method
│   │   │   │       │         Booking? newBooking = await _bookingController.createBooking(
│   │   │   │       │           boatId: widget.boat.id, // Use ID from the passed boat object
│   │   │   │       │           startDate: _startDate,
│   │   │   │       │           endDate: _endDate,
│   │   │   │       │           passengerCount: _passengerCount,
│   │   │   │       │           specialRequests: _specialRequestsController.text.trim().isNotEmpty
│   │   │   │       │               ? _specialRequestsController.text.trim()
│   │   │   │       │               : null, // Send null if empty
│   │   │   │       │         );
│   │   │   │       │   
│   │   │   │       │         // Check if the widget is still mounted before updating state
│   │   │   │       │         if (!mounted) return;
│   │   │   │       │   
│   │   │   │       │         if (newBooking != null) {
│   │   │   │       │           // --- Booking Success ---
│   │   │   │       │           debugPrint('Booking Successful! Booking ID: ${newBooking.bookingId}');
│   │   │   │       │           // Show the confirmation dialog (already implemented)
│   │   │   │       │           _showBookingConfirmationDialog(context);
│   │   │   │       │         } else {
│   │   │   │       │           // --- Booking Failed ---
│   │   │   │       │           // Controller returns null on failure (e.g., validation, capacity exceeded)
│   │   │   │       │           _showSnackBar(context,
│   │   │   │       │               'Booking failed. Please check details or boat availability.',
│   │   │   │       │               isError: true);
│   │   │   │       │         }
│   │   │   │       │       } catch (e) {
│   │   │   │       │         // --- Handle Network or other unexpected errors ---
│   │   │   │       │         debugPrint("Booking Page Error: $e");
│   │   │   │       │         if (mounted) {
│   │   │   │       │           _showSnackBar(
│   │   │   │       │               context, 'An unexpected error occurred. Please try again.',
│   │   │   │       │               isError: true);
│   │   │   │       │         }
│   │   │   │       │       } finally {
│   │   │   │       │         // --- Stop Loading ---
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() => _isLoading = false);
│   │   │   │       │         }
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │     // --- End of new booking function ---
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       // ... (keep existing Scaffold structure) ...
│   │   │   │       │       return Scaffold(
│   │   │   │       │         backgroundColor: const Color(0xFFF9FAFC),
│   │   │   │       │         extendBodyBehindAppBar: true,
│   │   │   │       │         appBar: _buildAppBar(context),
│   │   │   │       │         body: SingleChildScrollView(
│   │   │   │       │           child: Column(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │             children: <Widget>[
│   │   │   │       │               _buildHeroImageCarousel(context), // Use the updated image carousel
│   │   │   │       │               Transform.translate(
│   │   │   │       │                 offset: const Offset(0, -30),
│   │   │   │       │                 child: Container(
│   │   │   │       │                   decoration: const BoxDecoration(
│   │   │   │       │                     color: Color(0xFFF9FAFC),
│   │   │   │       │                     borderRadius: BorderRadius.only(
│   │   │   │       │                       topLeft: Radius.circular(40),
│   │   │   │       │                       topRight: Radius.circular(40),
│   │   │   │       │                     ),
│   │   │   │       │                   ),
│   │   │   │       │                   padding: const EdgeInsets.fromLTRB(24.0, 30.0, 24.0, 24.0),
│   │   │   │       │                   child: Column(
│   │   │   │       │                     crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │                     children: [
│   │   │   │       │                       _buildBoatInfoSection(
│   │   │   │       │                           context), // Use boat info from widget.boat
│   │   │   │       │                       const SizedBox(height: 30),
│   │   │   │       │                       _buildBookingForm(context),
│   │   │   │       │                       const SizedBox(height: 30),
│   │   │   │       │                       _buildFancyBookingSummaryPreviewCard(
│   │   │   │       │                           context), // Update with current selections
│   │   │   │       │                       const SizedBox(height: 40),
│   │   │   │       │                       _buildConfirmBookingButton(context), // Updated button logic
│   │   │   │       │                       const SizedBox(height: 30),
│   │   │   │       │                     ],
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │   │       │       return AppBar(
│   │   │   │       │         title: Text(
│   │   │   │       │           'book_boat_title_appbar'.i18n(),
│   │   │   │       │           style: const TextStyle(
│   │   │   │       │             fontWeight: FontWeight.w700,
│   │   │   │       │             fontSize: 18,
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │         centerTitle: true,
│   │   │   │       │         elevation: 0,
│   │   │   │       │         backgroundColor: Colors.transparent,
│   │   │   │       │         foregroundColor: Colors.white,
│   │   │   │       │         actions: [
│   │   │   │       │           IconButton(
│   │   │   │       │             icon: const Icon(Icons.favorite_border_rounded),
│   │   │   │       │             onPressed: () {/* TODO: Implement favorite action */},
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │         leading: IconButton(
│   │   │   │       │           icon: Container(
│   │   │   │       │             padding: const EdgeInsets.all(8),
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               color: Colors.black.withOpacity(0.2),
│   │   │   │       │               borderRadius: BorderRadius.circular(12),
│   │   │   │       │             ),
│   │   │   │       │             child: const Icon(Icons.arrow_back_ios_new_rounded, size: 18),
│   │   │   │       │           ),
│   │   │   │       │           onPressed: () => Navigator.pop(context),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Update Carousel to use widget.boat.imageUrls ---
│   │   │   │       │     Widget _buildHeroImageCarousel(BuildContext context) {
│   │   │   │       │       return Stack(
│   │   │   │       │         children: [
│   │   │   │       │           CarouselSlider(
│   │   │   │       │             options: CarouselOptions(
│   │   │   │       │               height: 450,
│   │   │   │       │               viewportFraction: 1.0,
│   │   │   │       │               enlargeCenterPage: false,
│   │   │   │       │               enableInfiniteScroll:
│   │   │   │       │                   _boatImageUrls.length > 1, // Only scroll if multiple images
│   │   │   │       │               autoPlay:
│   │   │   │       │                   _boatImageUrls.length > 1, // Only autoplay if multiple images
│   │   │   │       │               onPageChanged: (index, reason) {
│   │   │   │       │                 setState(() {
│   │   │   │       │                   _currentImageIndex = index;
│   │   │   │       │                 });
│   │   │   │       │               },
│   │   │   │       │             ),
│   │   │   │       │             items: _boatImageUrls.isNotEmpty
│   │   │   │       │                 ? _boatImageUrls.map((url) {
│   │   │   │       │                     return Builder(
│   │   │   │       │                       builder: (BuildContext context) {
│   │   │   │       │                         return Container(
│   │   │   │       │                           // ... (keep image container styling) ...
│   │   │   │       │                           width: MediaQuery.of(context).size.width,
│   │   │   │       │                           decoration: BoxDecoration(
│   │   │   │       │                             image: DecorationImage(
│   │   │   │       │                               image: NetworkImage(url), // Use image URL from list
│   │   │   │       │                               fit: BoxFit.cover,
│   │   │   │       │                             ),
│   │   │   │       │                           ),
│   │   │   │       │                           child: Container(
│   │   │   │       │                             // Gradient overlay
│   │   │   │       │                             decoration: BoxDecoration(
│   │   │   │       │                               gradient: LinearGradient(
│   │   │   │       │                                 begin: Alignment.topCenter,
│   │   │   │       │                                 end: Alignment.bottomCenter,
│   │   │   │       │                                 colors: [
│   │   │   │       │                                   Colors.transparent,
│   │   │   │       │                                   Colors.black.withOpacity(0.6),
│   │   │   │       │                                 ],
│   │   │   │       │                               ),
│   │   │   │       │                             ),
│   │   │   │       │                           ),
│   │   │   │       │                         );
│   │   │   │       │                       },
│   │   │   │       │                     );
│   │   │   │       │                   }).toList()
│   │   │   │       │                 : [
│   │   │   │       │                     // Show placeholder if no images
│   │   │   │       │                     Container(
│   │   │   │       │                       color: Colors.grey[300],
│   │   │   │       │                       child: const Center(
│   │   │   │       │                           child: Icon(Icons.image_not_supported,
│   │   │   │       │                               size: 50, color: Colors.grey)),
│   │   │   │       │                     )
│   │   │   │       │                   ],
│   │   │   │       │           ),
│   │   │   │       │           // --- Update Indicator to use _boatImageUrls.length ---
│   │   │   │       │           if (_boatImageUrls.length > 1)
│   │   │   │       │             Positioned(
│   │   │   │       │               bottom: 60,
│   │   │   │       │               left: 0,
│   │   │   │       │               right: 0,
│   │   │   │       │               child: Row(
│   │   │   │       │                 mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │                 children: _boatImageUrls.asMap().entries.map((entry) {
│   │   │   │       │                   return Container(
│   │   │   │       │                     width: 8.0,
│   │   │   │       │                     height: 8.0,
│   │   │   │       │                     margin: const EdgeInsets.symmetric(horizontal: 4.0),
│   │   │   │       │                     decoration: BoxDecoration(
│   │   │   │       │                       shape: BoxShape.circle,
│   │   │   │       │                       color: Colors.white.withOpacity(
│   │   │   │       │                         _currentImageIndex == entry.key ? 0.9 : 0.4,
│   │   │   │       │                       ),
│   │   │   │       │                     ),
│   │   │   │       │                   );
│   │   │   │       │                 }).toList(),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           // --- Update Rating display to use widget.boat.averageRating ---
│   │   │   │       │           Positioned(
│   │   │   │       │             bottom: 90,
│   │   │   │       │             left: 24,
│   │   │   │       │             child: Column(
│   │   │   │       │               crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │               children: [
│   │   │   │       │                 Container(
│   │   │   │       │                   padding:
│   │   │   │       │                       const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
│   │   │   │       │                   decoration: BoxDecoration(
│   │   │   │       │                     color: Theme.of(context).colorScheme.primary.withOpacity(0.8),
│   │   │   │       │                     borderRadius: BorderRadius.circular(20),
│   │   │   │       │                   ),
│   │   │   │       │                   child: Row(
│   │   │   │       │                     mainAxisSize: MainAxisSize.min,
│   │   │   │       │                     children: [
│   │   │   │       │                       const Icon(Icons.star, color: Colors.amber, size: 16),
│   │   │   │       │                       const SizedBox(width: 4),
│   │   │   │       │                       Text(
│   │   │   │       │                         // Use average rating from the boat object
│   │   │   │       │                         widget.boat.averageRating.toStringAsFixed(1),
│   │   │   │       │                         style: const TextStyle(
│   │   │   │       │                           color: Colors.white,
│   │   │   │       │                           fontWeight: FontWeight.bold,
│   │   │   │       │                           fontSize: 12,
│   │   │   │       │                         ),
│   │   │   │       │                       ),
│   │   │   │       │                       // Optionally add review count if available and needed here
│   │   │   │       │                       // const SizedBox(width: 4),
│   │   │   │       │                       // Text(
│   │   │   │       │                       //   '(128)', // Replace with actual review count if fetched
│   │   │   │       │                       //   style: const TextStyle(color: Colors.white70, fontSize: 12),
│   │   │   │       │                       // ),
│   │   │   │       │                     ],
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Update Boat Info Section to use widget.boat ---
│   │   │   │       │     Widget _buildBoatInfoSection(BuildContext context) {
│   │   │   │       │       return Column(
│   │   │   │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │         children: [
│   │   │   │       │           Row(
│   │   │   │       │             mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │   │       │             children: [
│   │   │   │       │               Expanded(
│   │   │   │       │                 child: Text(
│   │   │   │       │                   widget.boat.name, // Use name from boat object
│   │   │   │       │                   style: const TextStyle(
│   │   │   │       │                     fontSize: 28,
│   │   │   │       │                     fontWeight: FontWeight.w800,
│   │   │   │       │                     color: Color(0xFF1A1A2E),
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               Container(
│   │   │   │       │                 padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary.withOpacity(0.1),
│   │   │   │       │                   borderRadius: BorderRadius.circular(16),
│   │   │   │       │                 ),
│   │   │   │       │                 child: Text(
│   │   │   │       │                   // Use price from boat object
│   │   │   │       │                   'SAR ${widget.boat.rentalPricePerDay.toStringAsFixed(0)}/day',
│   │   │   │       │                   style: TextStyle(
│   │   │   │       │                     fontWeight: FontWeight.w800,
│   │   │   │       │                     color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 16),
│   │   │   │       │           Row(
│   │   │   │       │             children: [
│   │   │   │       │               // Use type, capacity, length from boat object
│   │   │   │       │               _buildFeatureChip(
│   │   │   │       │                   context, Icons.anchor_rounded, widget.boat.boatType),
│   │   │   │       │               const SizedBox(width: 8),
│   │   │   │       │               if (widget.boat.capacity != null) ...[
│   │   │   │       │                 _buildFeatureChip(context, Icons.people_alt_rounded,
│   │   │   │       │                     '${widget.boat.capacity} Max'),
│   │   │   │       │                 const SizedBox(width: 8),
│   │   │   │       │               ],
│   │   │   │       │               if (widget.boat.length != null)
│   │   │   │       │                 _buildFeatureChip(context, Icons.straighten_rounded,
│   │   │   │       │                     '${widget.boat.length} ft'),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 24),
│   │   │   │       │           // Use description from boat object
│   │   │   │       │           Text(
│   │   │   │       │             widget.boat.description ??
│   │   │   │       │                 'No description available.', // Handle null description
│   │   │   │       │             style: TextStyle(
│   │   │   │       │               fontSize: 14,
│   │   │   │       │               color: Colors.grey.shade700,
│   │   │   │       │               height: 1.5,
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           // Removed amenities section as it's now part of boat description/specs
│   │   │   │       │           // const SizedBox(height: 24),
│   │   │   │       │           // _buildAmenitiesSection(context),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // ... (Keep _buildFeatureChip - no changes needed) ...
│   │   │   │       │     Widget _buildFeatureChip(BuildContext context, IconData icon, String label) {
│   │   │   │       │       return Container(
│   │   │   │       │         padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
│   │   │   │       │         decoration: BoxDecoration(
│   │   │   │       │           color: Colors.grey.shade100,
│   │   │   │       │           borderRadius: BorderRadius.circular(16),
│   │   │   │       │           border: Border.all(color: Colors.grey.shade300),
│   │   │   │       │         ),
│   │   │   │       │         child: Row(
│   │   │   │       │           mainAxisSize: MainAxisSize.min,
│   │   │   │       │           children: [
│   │   │   │       │             Icon(icon, size: 16, color: Colors.grey.shade700),
│   │   │   │       │             const SizedBox(width: 6),
│   │   │   │       │             Text(
│   │   │   │       │               label,
│   │   │   │       │               style: TextStyle(
│   │   │   │       │                 fontSize: 12,
│   │   │   │       │                 color: Colors.grey.shade800,
│   │   │   │       │                 fontWeight: FontWeight.w500,
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // ... (Keep _buildBookingForm and its sub-widgets: _buildDateRangeSelector, _buildDateButton, _buildPassengerCountSelector, _buildDurationSelector, _buildSpecialRequestsField - these manage local state for the form) ...
│   │   │   │       │     Widget _buildBookingForm(BuildContext context) {
│   │   │   │       │       return Card(
│   │   │   │       │         elevation: 8,
│   │   │   │       │         shadowColor: Colors.black12,
│   │   │   │       │         shape: RoundedRectangleBorder(
│   │   │   │       │           borderRadius: BorderRadius.circular(32),
│   │   │   │       │         ),
│   │   │   │       │         child: Container(
│   │   │   │       │           padding: const EdgeInsets.all(24.0),
│   │   │   │       │           decoration: BoxDecoration(
│   │   │   │       │             borderRadius: BorderRadius.circular(32),
│   │   │   │       │             gradient: LinearGradient(
│   │   │   │       │               begin: Alignment.topLeft,
│   │   │   │       │               end: Alignment.bottomRight,
│   │   │   │       │               colors: [
│   │   │   │       │                 Colors.white,
│   │   │   │       │                 Colors.grey.shade50,
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           child: Column(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │             children: [
│   │   │   │       │               Text(
│   │   │   │       │                 'booking_details_title'.i18n(),
│   │   │   │       │                 style: const TextStyle(
│   │   │   │       │                   fontSize: 20,
│   │   │   │       │                   fontWeight: FontWeight.w800,
│   │   │   │       │                   color: Color(0xFF1A1A2E),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 30),
│   │   │   │       │               _buildDateRangeSelector(context),
│   │   │   │       │               const SizedBox(height: 24),
│   │   │   │       │               _buildPassengerCountSelector(context),
│   │   │   │       │               const SizedBox(height: 24),
│   │   │   │       │               //_buildDurationSelector(context), // Duration might be implicitly calculated by dates now
│   │   │   │       │               //const SizedBox(height: 24),
│   │   │   │       │               _buildSpecialRequestsField(context),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       ).animate().fadeIn(duration: 600.ms).slideY(begin: 0.2, end: 0);
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildDateRangeSelector(BuildContext context) {
│   │   │   │       │       return Column(
│   │   │   │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │         children: [
│   │   │   │       │           Text(
│   │   │   │       │             'select_date_range_label'.i18n(),
│   │   │   │       │             style: const TextStyle(
│   │   │   │       │               fontSize: 15,
│   │   │   │       │               fontWeight: FontWeight.w700,
│   │   │   │       │               color: Color(0xFF1A1A2E),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 16),
│   │   │   │       │           Row(
│   │   │   │       │             children: [
│   │   │   │       │               Expanded(
│   │   │   │       │                 child: _buildDateButton(
│   │   │   │       │                   context,
│   │   │   │       │                   'Start Date',
│   │   │   │       │                   _formatDate(_startDate),
│   │   │   │       │                   Icons.calendar_month_rounded,
│   │   │   │       │                   () => _selectDate(context, true),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(width: 16),
│   │   │   │       │               Expanded(
│   │   │   │       │                 child: _buildDateButton(
│   │   │   │       │                   context,
│   │   │   │       │                   'End Date',
│   │   │   │       │                   _formatDate(_endDate),
│   │   │   │       │                   Icons.event_rounded,
│   │   │   │       │                   () => _selectDate(context, false),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildDateButton(
│   │   │   │       │       BuildContext context,
│   │   │   │       │       String label,
│   │   │   │       │       String date,
│   │   │   │       │       IconData icon,
│   │   │   │       │       VoidCallback onTap,
│   │   │   │       │     ) {
│   │   │   │       │       return Container(
│   │   │   │       │         decoration: BoxDecoration(
│   │   │   │       │           borderRadius: BorderRadius.circular(20),
│   │   │   │       │           border: Border.all(color: Colors.grey.shade300),
│   │   │   │       │           color: Colors.white,
│   │   │   │       │         ),
│   │   │   │       │         child: Material(
│   │   │   │       │           color: Colors.transparent,
│   │   │   │       │           child: InkWell(
│   │   │   │       │             borderRadius: BorderRadius.circular(20),
│   │   │   │       │             onTap: onTap,
│   │   │   │       │             child: Padding(
│   │   │   │       │               padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
│   │   │   │       │               child: Column(
│   │   │   │       │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                 children: [
│   │   │   │       │                   Text(
│   │   │   │       │                     label,
│   │   │   │       │                     style: TextStyle(
│   │   │   │       │                       fontSize: 11,
│   │   │   │       │                       color: Colors.grey.shade600,
│   │   │   │       │                     ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 6),
│   │   │   │       │                   Row(
│   │   │   │       │                     mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │   │       │                     children: [
│   │   │   │       │                       Text(
│   │   │   │       │                         date,
│   │   │   │       │                         style: TextStyle(
│   │   │   │       │                           fontSize: 14,
│   │   │   │       │                           fontWeight: FontWeight.w600,
│   │   │   │       │                           color: Colors.grey.shade800,
│   │   │   │       │                         ),
│   │   │   │       │                       ),
│   │   │   │       │                       Icon(
│   │   │   │       │                         icon,
│   │   │   │       │                         size: 18,
│   │   │   │       │                         color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                       ),
│   │   │   │       │                     ],
│   │   │   │       │                   ),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildPassengerCountSelector(BuildContext context) {
│   │   │   │       │       // --- Add validation based on boat capacity ---
│   │   │   │       │       final int maxCapacity = widget.boat.capacity ?? 1; // Default to 1 if null
│   │   │   │       │   
│   │   │   │       │       return Column(
│   │   │   │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │         children: [
│   │   │   │       │           Row(
│   │   │   │       │             mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │   │       │             children: [
│   │   │   │       │               Text(
│   │   │   │       │                 'passenger_count_label'.i18n(),
│   │   │   │       │                 style: const TextStyle(
│   │   │   │       │                   fontSize: 15,
│   │   │   │       │                   fontWeight: FontWeight.w700,
│   │   │   │       │                   color: Color(0xFF1A1A2E),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               Container(
│   │   │   │       │                 padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 6),
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary.withOpacity(0.1),
│   │   │   │       │                   borderRadius: BorderRadius.circular(16),
│   │   │   │       │                 ),
│   │   │   │       │                 child: Text(
│   │   │   │       │                   '$_passengerCount ${_passengerCount == 1 ? 'person' : 'people'}',
│   │   │   │       │                   style: TextStyle(
│   │   │   │       │                     fontSize: 14,
│   │   │   │       │                     fontWeight: FontWeight.w600,
│   │   │   │       │                     color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 16),
│   │   │   │       │           SliderTheme(
│   │   │   │       │             data: SliderTheme.of(context).copyWith(
│   │   │   │       │               activeTrackColor: Theme.of(context).colorScheme.primary,
│   │   │   │       │               inactiveTrackColor: Colors.grey.shade200,
│   │   │   │       │               thumbColor: Colors.white,
│   │   │   │       │               thumbShape: const RoundSliderThumbShape(enabledThumbRadius: 14),
│   │   │   │       │               overlayColor:
│   │   │   │       │                   Theme.of(context).colorScheme.primary.withOpacity(0.2),
│   │   │   │       │               valueIndicatorColor: Theme.of(context).colorScheme.primary,
│   │   │   │       │               valueIndicatorTextStyle: const TextStyle(
│   │   │   │       │                 color: Colors.white,
│   │   │   │       │                 fontWeight: FontWeight.bold,
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             child: Slider(
│   │   │   │       │               value: _passengerCount
│   │   │   │       │                   .toDouble()
│   │   │   │       │                   .clamp(1, maxCapacity.toDouble()), // Clamp value
│   │   │   │       │               min: 1,
│   │   │   │       │               max: maxCapacity.toDouble(), // Use boat capacity
│   │   │   │       │               divisions:
│   │   │   │       │                   (maxCapacity > 1) ? maxCapacity - 1 : 1, // Adjust divisions
│   │   │   │       │               label: _passengerCount.round().toString(),
│   │   │   │       │               onChanged: (double value) {
│   │   │   │       │                 setState(() => _passengerCount = value.toInt());
│   │   │   │       │               },
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           // --- Optional: Display capacity error inline ---
│   │   │   │       │           if (_passengerCount > maxCapacity)
│   │   │   │       │             Padding(
│   │   │   │       │               padding: const EdgeInsets.only(top: 4.0),
│   │   │   │       │               child: Text(
│   │   │   │       │                 'Exceeds boat capacity of $maxCapacity',
│   │   │   │       │                 style: TextStyle(color: Colors.red.shade700, fontSize: 12),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildSpecialRequestsField(BuildContext context) {
│   │   │   │       │       return Column(
│   │   │   │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │         children: [
│   │   │   │       │           Text(
│   │   │   │       │             'special_requests_label'.i18n(),
│   │   │   │       │             style: const TextStyle(
│   │   │   │       │               fontSize: 15,
│   │   │   │       │               fontWeight: FontWeight.w700,
│   │   │   │       │               color: Color(0xFF1A1A2E),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 16),
│   │   │   │       │           Container(
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               boxShadow: [
│   │   │   │       │                 BoxShadow(
│   │   │   │       │                   color: Colors.grey.shade200,
│   │   │   │       │                   blurRadius: 8,
│   │   │   │       │                   offset: const Offset(0, 3),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │             child: TextFormField(
│   │   │   │       │               controller: _specialRequestsController,
│   │   │   │       │               decoration: InputDecoration(
│   │   │   │       │                 hintText: 'special_requests_hint'.i18n(),
│   │   │   │       │                 filled: true,
│   │   │   │       │                 fillColor: Colors.white,
│   │   │   │       │                 prefixIcon: Icon(
│   │   │   │       │                   Icons.edit_note_outlined,
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                 ),
│   │   │   │       │                 border: OutlineInputBorder(
│   │   │   │       │                   borderRadius: BorderRadius.circular(15),
│   │   │   │       │                   borderSide: BorderSide.none,
│   │   │   │       │                 ),
│   │   │   │       │                 enabledBorder: OutlineInputBorder(
│   │   │   │       │                   borderRadius: BorderRadius.circular(15),
│   │   │   │       │                   borderSide: BorderSide.none,
│   │   │   │       │                 ),
│   │   │   │       │                 focusedBorder: OutlineInputBorder(
│   │   │   │       │                   borderRadius: BorderRadius.circular(15),
│   │   │   │       │                   borderSide: BorderSide(
│   │   │   │       │                     color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                     width: 2,
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               maxLines: 3,
│   │   │   │       │               style: const TextStyle(
│   │   │   │       │                 fontSize: 14,
│   │   │   │       │                 fontWeight: FontWeight.w500,
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Update Summary Card to use current state and boat price ---
│   │   │   │       │     Widget _buildFancyBookingSummaryPreviewCard(BuildContext context) {
│   │   │   │       │       final int durationDays = _endDate.difference(_startDate).inDays + 1;
│   │   │   │       │       final double estimatedPrice =
│   │   │   │       │           widget.boat.rentalPricePerDay * (durationDays > 0 ? durationDays : 1);
│   │   │   │       │   
│   │   │   │       │       return Card(/* ... */).animate(/* ... */); // Keep animation
│   │   │   │       │       // ... (rest of the summary card build method)
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Update Confirm Button ---
│   │   │   │       │     Widget _buildConfirmBookingButton(BuildContext context) {
│   │   │   │       │       return ElevatedButton(
│   │   │   │       │         // Call _performBooking on press, disable if loading
│   │   │   │       │         onPressed: _isLoading ? null : _performBooking,
│   │   │   │       │         style: ElevatedButton.styleFrom(
│   │   │   │       │           padding: const EdgeInsets.symmetric(vertical: 16),
│   │   │   │       │           shape: RoundedRectangleBorder(
│   │   │   │       │             borderRadius: BorderRadius.circular(24),
│   │   │   │       │           ),
│   │   │   │       │           backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │   │       │           foregroundColor: Colors.white,
│   │   │   │       │           elevation: 8,
│   │   │   │       │           shadowColor: Theme.of(context).colorScheme.primary.withOpacity(0.5),
│   │   │   │       │           disabledBackgroundColor: Theme.of(context)
│   │   │   │       │               .colorScheme
│   │   │   │       │               .primary
│   │   │   │       │               .withOpacity(0.5), // Visual feedback when disabled
│   │   │   │       │         ),
│   │   │   │       │         child: _isLoading
│   │   │   │       │             ? const SizedBox(
│   │   │   │       │                 // Show loading indicator
│   │   │   │       │                 width: 24,
│   │   │   │       │                 height: 24,
│   │   │   │       │                 child: CircularProgressIndicator(
│   │   │   │       │                     strokeWidth: 3, color: Colors.white),
│   │   │   │       │               )
│   │   │   │       │             : Row(
│   │   │   │       │                 // Original button content
│   │   │   │       │                 mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │                 children: [
│   │   │   │       │                   const Icon(Icons.check_circle_outline_rounded, size: 24),
│   │   │   │       │                   const SizedBox(width: 12),
│   │   │   │       │                   Text(
│   │   │   │       │                     'confirm_booking_button'.i18n(),
│   │   │   │       │                     style: const TextStyle(
│   │   │   │       │                       fontSize: 18,
│   │   │   │       │                       fontWeight: FontWeight.w800,
│   │   │   │       │                     ),
│   │   │   │       │                   ),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │       )
│   │   │   │       │           .animate() // Keep existing animation
│   │   │   │       │           .fadeIn(duration: 600.ms)
│   │   │   │       │           .slideY(begin: 0.2, end: 0, delay: 400.ms);
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // ... (Keep _selectDate, _formatDate, _showBookingConfirmationDialog) ...
│   │   │   │       │     Future<void> _selectDate(BuildContext context, bool isStartDate) async {
│   │   │   │       │       final DateTime? pickedDate = await showDatePicker(
│   │   │   │       │         context: context,
│   │   │   │       │         initialDate: isStartDate ? _startDate : _endDate,
│   │   │   │       │         firstDate:
│   │   │   │       │             DateTime.now().subtract(const Duration(days: 1)), // Allow today
│   │   │   │       │         lastDate: DateTime.now()
│   │   │   │       │             .add(const Duration(days: 365)), // Limit to one year ahead
│   │   │   │       │         builder: (context, child) {
│   │   │   │       │           return Theme(
│   │   │   │       │             data: Theme.of(context).copyWith(
│   │   │   │       │               colorScheme: ColorScheme.light(
│   │   │   │       │                 primary: Theme.of(context).colorScheme.primary,
│   │   │   │       │                 onPrimary: Colors.white,
│   │   │   │       │                 surface: Colors.white,
│   │   │   │       │                 onSurface: Colors.black87,
│   │   │   │       │               ),
│   │   │   │       │               textButtonTheme: TextButtonThemeData(
│   │   │   │       │                 style: TextButton.styleFrom(
│   │   │   │       │                   foregroundColor: Theme.of(context).colorScheme.primary,
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             child: child!,
│   │   │   │       │           );
│   │   │   │       │         },
│   │   │   │       │       );
│   │   │   │       │       if (pickedDate != null) {
│   │   │   │       │         setState(() {
│   │   │   │       │           if (isStartDate) {
│   │   │   │       │             _startDate = pickedDate;
│   │   │   │       │             // Ensure end date is not before start date
│   │   │   │       │             if (_endDate.isBefore(_startDate)) {
│   │   │   │       │               _endDate = _startDate
│   │   │   │       │                   .add(const Duration(days: 1)); // Default to 1 day if invalid
│   │   │   │       │             }
│   │   │   │       │           } else {
│   │   │   │       │             // Ensure end date is not before start date
│   │   │   │       │             if (pickedDate.isAfter(_startDate) ||
│   │   │   │       │                 pickedDate.isAtSameMomentAs(_startDate)) {
│   │   │   │       │               _endDate = pickedDate;
│   │   │   │       │             } else {
│   │   │   │       │               _showSnackBar(context, "End date cannot be before start date.",
│   │   │   │       │                   isError: true);
│   │   │   │       │             }
│   │   │   │       │           }
│   │   │   │       │         });
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     String _formatDate(DateTime date) => "${date.day}/${date.month}/${date.year}";
│   │   │   │       │   
│   │   │   │       │     void _showBookingConfirmationDialog(BuildContext context) {
│   │   │   │       │       showDialog(
│   │   │   │       │           context: context,
│   │   │   │       │           builder: (BuildContext context) {
│   │   │   │       │             // Apply animation to the Dialog widget itself
│   │   │   │       │             return Dialog(
│   │   │   │       │               shape: RoundedRectangleBorder(
│   │   │   │       │                 borderRadius: BorderRadius.circular(32),
│   │   │   │       │               ),
│   │   │   │       │               elevation: 16,
│   │   │   │       │               child: ClipRRect(
│   │   │   │       │                 borderRadius: BorderRadius.circular(32),
│   │   │   │       │                 child: Container(
│   │   │   │       │                   width: double.infinity,
│   │   │   │       │                   padding: const EdgeInsets.all(24),
│   │   │   │       │                   decoration: const BoxDecoration(
│   │   │   │       │                     color: Colors.white,
│   │   │   │       │                   ),
│   │   │   │       │                   child: Column(
│   │   │   │       │                     mainAxisSize: MainAxisSize.min,
│   │   │   │       │                     children: [
│   │   │   │       │                       Container(
│   │   │   │       │                         padding: const EdgeInsets.all(16),
│   │   │   │       │                         decoration: BoxDecoration(
│   │   │   │       │                           color: Theme.of(context)
│   │   │   │       │                               .colorScheme
│   │   │   │       │                               .primary
│   │   │   │       │                               .withOpacity(0.15),
│   │   │   │       │                           shape: BoxShape.circle,
│   │   │   │       │                         ),
│   │   │   │       │                         child: Icon(
│   │   │   │       │                           Icons.check_circle_rounded,
│   │   │   │       │                           color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                           size: 50,
│   │   │   │       │                         ),
│   │   │   │       │                       ),
│   │   │   │       │                       const SizedBox(height: 20),
│   │   │   │       │                       Text(
│   │   │   │       │                         'booking_confirmed_title'.i18n(),
│   │   │   │       │                         textAlign: TextAlign.center,
│   │   │   │       │                         style: const TextStyle(
│   │   │   │       │                           fontSize: 22,
│   │   │   │       │                           fontWeight: FontWeight.w800,
│   │   │   │       │                           color: Color(0xFF1A1A2E),
│   │   │   │       │                         ),
│   │   │   │       │                       ),
│   │   │   │       │                       const SizedBox(height: 12),
│   │   │   │       │                       Text(
│   │   │   │       │                         'booking_confirmed_message'.i18n(),
│   │   │   │       │                         textAlign: TextAlign.center,
│   │   │   │       │                         style: TextStyle(
│   │   │   │       │                           fontSize: 14,
│   │   │   │       │                           color: Colors.grey.shade700,
│   │   │   │       │                         ),
│   │   │   │       │                       ),
│   │   │   │       │                       const SizedBox(height: 30),
│   │   │   │       │                       ElevatedButton(
│   │   │   │       │                         onPressed: () {
│   │   │   │       │                           // Close the dialog first
│   │   │   │       │                           Navigator.pop(context);
│   │   │   │       │                           // Then pop the booking screen to go back
│   │   │   │       │                           Navigator.pop(context);
│   │   │   │       │                           _showSnackBar(context,
│   │   │   │       │                               'booking_confirmed_snackbar_message'.i18n());
│   │   │   │       │                         },
│   │   │   │       │                         style: ElevatedButton.styleFrom(
│   │   │   │       │                           padding: const EdgeInsets.symmetric(
│   │   │   │       │                               vertical: 16, horizontal: 32),
│   │   │   │       │                           shape: RoundedRectangleBorder(
│   │   │   │       │                             borderRadius: BorderRadius.circular(16),
│   │   │   │       │                           ),
│   │   │   │       │                           backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │   │       │                           foregroundColor: Colors.white,
│   │   │   │       │                         ),
│   │   │   │       │                         child: Text(
│   │   │   │       │                           'view_bookings_button_dialog'.i18n(),
│   │   │   │       │                           style: const TextStyle(
│   │   │   │       │                             fontWeight: FontWeight.w700,
│   │   │   │       │                           ),
│   │   │   │       │                         ),
│   │   │   │       │                       ),
│   │   │   │       │                     ],
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               // Apply animation here, AFTER the Dialog widget
│   │   │   │       │             ).animate().scaleXY(duration: 300.ms, curve: Curves.easeInOut);
│   │   │   │       │             // --- End Applying Animation ---
│   │   │   │       │           }
│   │   │   │       │           // REMOVE .animate() from here
│   │   │   │       │           );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Update SnackBar function to handle errors ---
│   │   │   │       │     void _showSnackBar(BuildContext context, String message,
│   │   │   │       │         {bool isError = false}) {
│   │   │   │       │       SnackBarUtil.showSuccessSnackBar(message: message, title: '');
│   │   │   │       │     }
│   │   │   │       │   }
│   │   │   ├── details/
│   │   │   │   └── screen.dart
│   │   │   │       │   import 'package:app/controllers/booking.dart'; // Use correct controller name
│   │   │   │       │   import 'package:app/controllers/chat.dart';
│   │   │   │       │   import 'package:app/features/chat/details/screen.dart';
│   │   │   │       │   import 'package:app/features/renter/review/screen.dart';
│   │   │   │       │   // --- Import Models and Controller ---
│   │   │   │       │   import 'package:app/models/booking.dart'; // Use correct model name
│   │   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │   │       │   import 'package:get/get.dart';
│   │   │   │       │   import 'package:localization/localization.dart';
│   │   │   │       │   
│   │   │   │       │   // Remove the old dummy data model if no longer needed at the top level
│   │   │   │       │   // class Booking { ... }
│   │   │   │       │   
│   │   │   │       │   class BookingDetailsScreen extends StatefulWidget {
│   │   │   │       │     // --- Accept bookingId instead of a full Booking object ---
│   │   │   │       │     final int bookingId;
│   │   │   │       │   
│   │   │   │       │     const BookingDetailsScreen({
│   │   │   │       │       super.key,
│   │   │   │       │       required this.bookingId, // Require the ID
│   │   │   │       │     });
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<BookingDetailsScreen> createState() => _BookingDetailsScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   class _BookingDetailsScreenState extends State<BookingDetailsScreen>
│   │   │   │       │       with TickerProviderStateMixin {
│   │   │   │       │     // --- Controller and State Variables ---
│   │   │   │       │     final BookingController _bookingController = BookingController();
│   │   │   │       │     final _storage = const FlutterSecureStorage();
│   │   │   │       │     Booking? _bookingDetails; // To hold the fetched details
│   │   │   │       │     bool _isLoading = true; // Start in loading state
│   │   │   │       │     String? _errorMessage;
│   │   │   │       │     bool _isCancelling = false; // For cancel button loading state
│   │   │   │       │   
│   │   │   │       │     // Remove animation controllers if not used directly in this screen's core logic
│   │   │   │       │     // late AnimationController _logoAnimationController;
│   │   │   │       │     // late Animation<double> _logoAnimation;
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       // Fetch booking details when the screen initializes
│   │   │   │       │       _fetchBookingData();
│   │   │   │       │   
│   │   │   │       │       // Remove animation controller init if not used
│   │   │   │       │       // _logoAnimationController = AnimationController(...)
│   │   │   │       │       // _logoAnimation = CurvedAnimation(...)
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       // Dispose animation controllers if they were used
│   │   │   │       │       // _logoAnimationController.dispose();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Function to Fetch Booking Data ---
│   │   │   │       │     Future<void> _fetchBookingData() async {
│   │   │   │       │       setState(() {
│   │   │   │       │         _isLoading = true;
│   │   │   │       │         _errorMessage = null;
│   │   │   │       │       });
│   │   │   │       │   
│   │   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │   
│   │   │   │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() {
│   │   │   │       │             _isLoading = false;
│   │   │   │       │             _errorMessage = 'Authentication Error. Please log in.';
│   │   │   │       │           });
│   │   │   │       │         }
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       try {
│   │   │   │       │         final booking = await _bookingController.fetchBookingDetails(
│   │   │   │       │           widget.bookingId,
│   │   │   │       │         );
│   │   │   │       │         if (!mounted) return; // Check mount status after await
│   │   │   │       │   
│   │   │   │       │         if (booking != null) {
│   │   │   │       │           setState(() {
│   │   │   │       │             _bookingDetails = booking;
│   │   │   │       │             _isLoading = false;
│   │   │   │       │           });
│   │   │   │       │         } else {
│   │   │   │       │           setState(() {
│   │   │   │       │             _isLoading = false;
│   │   │   │       │             _errorMessage = 'Failed to load booking details.';
│   │   │   │       │           });
│   │   │   │       │         }
│   │   │   │       │       } catch (e) {
│   │   │   │       │         print("Fetch Booking Details Error: $e");
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() {
│   │   │   │       │             _isLoading = false;
│   │   │   │       │             _errorMessage = 'An error occurred: $e';
│   │   │   │       │           });
│   │   │   │       │         }
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Function to Handle Cancellation ---
│   │   │   │       │     Future<void> _performCancelBooking() async {
│   │   │   │       │       if (_bookingDetails == null) return;
│   │   │   │       │   
│   │   │   │       │       final bool? confirm = await showDialog<bool>(
│   │   │   │       │         context: context,
│   │   │   │       │         builder: (context) => AlertDialog(
│   │   │   │       │           title: Text('cancel_booking_confirmation_title'.i18n()),
│   │   │   │       │           content: Text('cancel_booking_confirmation_message'
│   │   │   │       │               .i18n([_bookingDetails!.boatName ?? 'this boat'])),
│   │   │   │       │           actions: [
│   │   │   │       │             TextButton(
│   │   │   │       │               onPressed: () => Navigator.of(context).pop(false), // Cancel
│   │   │   │       │               child: Text('no'.i18n()),
│   │   │   │       │             ),
│   │   │   │       │             TextButton(
│   │   │   │       │               onPressed: () => Navigator.of(context).pop(true), // Confirm
│   │   │   │       │               child: Text('yes_cancel'.i18n()),
│   │   │   │       │               style: TextButton.styleFrom(foregroundColor: Colors.red),
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │   
│   │   │   │       │       if (confirm != true) return; // User cancelled dialog
│   │   │   │       │   
│   │   │   │       │       setState(() => _isCancelling = true);
│   │   │   │       │   
│   │   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │   │       │         if (mounted) {
│   │   │   │       │           _showSnackBar(context, 'Authentication error. Please log in again.',
│   │   │   │       │               isError: true);
│   │   │   │       │           setState(() => _isCancelling = false);
│   │   │   │       │         }
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       try {
│   │   │   │       │         final updatedBooking = await _bookingController.cancelBooking(
│   │   │   │       │           widget.bookingId,
│   │   │   │       │         );
│   │   │   │       │         if (!mounted) return;
│   │   │   │       │   
│   │   │   │       │         if (updatedBooking != null) {
│   │   │   │       │           setState(() {
│   │   │   │       │             _bookingDetails =
│   │   │   │       │                 updatedBooking; // Update local state with new status
│   │   │   │       │             _isCancelling = false;
│   │   │   │       │           });
│   │   │   │       │           _showSnackBar(context, 'Booking successfully cancelled.');
│   │   │   │       │           // Optionally pop screen after successful cancellation
│   │   │   │       │           // Navigator.pop(context);
│   │   │   │       │         } else {
│   │   │   │       │           setState(() => _isCancelling = false);
│   │   │   │       │           _showSnackBar(context,
│   │   │   │       │               'Failed to cancel booking. It might already be cancelled or completed.',
│   │   │   │       │               isError: true);
│   │   │   │       │         }
│   │   │   │       │       } catch (e) {
│   │   │   │       │         print("Cancel Booking Error: $e");
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() => _isCancelling = false);
│   │   │   │       │           _showSnackBar(context, 'An error occurred while cancelling.',
│   │   │   │       │               isError: true);
│   │   │   │       │         }
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       return Scaffold(
│   │   │   │       │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │   │       │         appBar: _buildAppBar(context),
│   │   │   │       │         body: _buildBodyContent(), // Delegate body building
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Build Body based on State ---
│   │   │   │       │     Widget _buildBodyContent() {
│   │   │   │       │       if (_isLoading) {
│   │   │   │       │         return const Center(child: CircularProgressIndicator());
│   │   │   │       │       }
│   │   │   │       │       if (_errorMessage != null) {
│   │   │   │       │         return Center(
│   │   │   │       │             child: Padding(
│   │   │   │       │                 padding: const EdgeInsets.all(20.0),
│   │   │   │       │                 child: Column(
│   │   │   │       │                   mainAxisSize: MainAxisSize.min,
│   │   │   │       │                   children: [
│   │   │   │       │                     Text(_errorMessage!,
│   │   │   │       │                         textAlign: TextAlign.center,
│   │   │   │       │                         style: TextStyle(color: Colors.red.shade700)),
│   │   │   │       │                     const SizedBox(height: 16),
│   │   │   │       │                     ElevatedButton(
│   │   │   │       │                         onPressed: _fetchBookingData, child: const Text('Retry'))
│   │   │   │       │                   ],
│   │   │   │       │                 )));
│   │   │   │       │       }
│   │   │   │       │       if (_bookingDetails == null) {
│   │   │   │       │         return const Center(
│   │   │   │       │             child: Text(
│   │   │   │       │                 'Booking not found.')); // Should ideally be caught by error message
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       // --- Display Booking Details ---
│   │   │   │       │       // Use _bookingDetails instead of widget.booking
│   │   │   │       │       return SingleChildScrollView(
│   │   │   │       │         padding: const EdgeInsets.all(24.0),
│   │   │   │       │         child: Column(
│   │   │   │       │           crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │           children: <Widget>[
│   │   │   │       │             _buildBookingSummaryCard(context, _bookingDetails!),
│   │   │   │       │             // Pass fetched data
│   │   │   │       │             const SizedBox(height: 30),
│   │   │   │       │             // You might want separate sections for boat details vs booking specifics
│   │   │   │       │             _buildBookingSpecificsSection(context, _bookingDetails!),
│   │   │   │       │             // Pass fetched data
│   │   │   │       │             const SizedBox(height: 40),
│   │   │   │       │             _buildActionButtons(context, _bookingDetails!),
│   │   │   │       │             // Pass fetched data
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │   │       │       // Using your existing AppBar structure
│   │   │   │       │       return AppBar(
│   │   │   │       │         title: Text('booking_details_title_appbar'.i18n(),
│   │   │   │       │             style: const TextStyle(fontWeight: FontWeight.w700)),
│   │   │   │       │         centerTitle: true,
│   │   │   │       │         elevation: 1,
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildBookingSummaryCard(BuildContext context, Booking booking) {
│   │   │   │       │       // Use data from the passed 'booking' object
│   │   │   │       │       return Card(
│   │   │   │       │         elevation: 2,
│   │   │   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │   │   │       │         child: Padding(
│   │   │   │       │           padding: const EdgeInsets.all(20.0),
│   │   │   │       │           child: Column(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │             children: [
│   │   │   │       │               Text('booking_summary_title'.i18n(),
│   │   │   │       │                   style: Theme.of(context)
│   │   │   │       │                       .textTheme
│   │   │   │       │                       .titleLarge
│   │   │   │       │                       ?.copyWith(fontWeight: FontWeight.w700)),
│   │   │   │       │               const SizedBox(height: 20),
│   │   │   │       │               ClipRRect(
│   │   │   │       │                 borderRadius: BorderRadius.circular(16),
│   │   │   │       │                 // Use boatImageUrl from Booking model (list serializer) or boat.mainImageUrl (detail serializer)
│   │   │   │       │                 child: Image.network(
│   │   │   │       │                   booking.boatImageUrl ??
│   │   │   │       │                       booking.boat?.mainImageUrl ??
│   │   │   │       │                       'https://placehold.co/600x400/E0E0E0/BDBDBD?text=No+Image',
│   │   │   │       │                   // Provide fallback
│   │   │   │       │                   height: 200,
│   │   │   │       │                   width: double.infinity,
│   │   │   │       │                   fit: BoxFit.cover,
│   │   │   │       │                   errorBuilder: (context, error, stackTrace) => const Center(
│   │   │   │       │                       child: Icon(
│   │   │   │       │                     Icons.error_outline,
│   │   │   │       │                     size: 50,
│   │   │   │       │                     color: Colors.grey,
│   │   │   │       │                   )),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 20),
│   │   │   │       │               // Use boatName (list) or boat.name (detail)
│   │   │   │       │               Text(booking.boatName ?? booking.boat?.name ?? 'Unknown Boat',
│   │   │   │       │                   style: Theme.of(context)
│   │   │   │       │                       .textTheme
│   │   │   │       │                       .titleMedium
│   │   │   │       │                       ?.copyWith(fontWeight: FontWeight.w700)),
│   │   │   │       │               const SizedBox(height: 8),
│   │   │   │       │               Text('${'booking_id_label'.i18n()}: ${booking.bookingId}',
│   │   │   │       │                   style: Theme.of(context).textTheme.bodyMedium),
│   │   │   │       │               const SizedBox(height: 8),
│   │   │   │       │               // Use renterEmail (list) or renter.email (detail)
│   │   │   │       │               Text(
│   │   │   │       │                   '${'user_name_label'.i18n()}: ${booking.renterEmail ?? booking.renter?.email ?? 'Unknown Renter'}',
│   │   │   │       │                   style: Theme.of(context).textTheme.bodyMedium),
│   │   │   │       │               const SizedBox(height: 16),
│   │   │   │       │               Row(
│   │   │   │       │                 children: [
│   │   │   │       │                   Icon(Icons.calendar_today,
│   │   │   │       │                       color: Theme.of(context).primaryColor, size: 20),
│   │   │   │       │                   const SizedBox(width: 8),
│   │   │   │       │                   Text(
│   │   │   │       │                       '${'date_label'.i18n()}: ${_formatDate(booking.startDate)} - ${_formatDate(booking.endDate)}',
│   │   │   │       │                       style: Theme.of(context).textTheme.bodyMedium),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 8),
│   │   │   │       │               Row(
│   │   │   │       │                 children: [
│   │   │   │       │                   Icon(Icons.attach_money_rounded,
│   │   │   │       │                       color: Theme.of(context).primaryColor, size: 20),
│   │   │   │       │                   const SizedBox(width: 8),
│   │   │   │       │                   Text(
│   │   │   │       │                       '${'price_label'.i18n()}: SAR ${booking.totalPrice.toStringAsFixed(2)}',
│   │   │   │       │                       style: Theme.of(context).textTheme.bodyMedium),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 16),
│   │   │   │       │               _buildStatusBadge(booking.status, context),
│   │   │   │       │               // Use status from booking object
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildBookingSpecificsSection(BuildContext context, Booking booking) {
│   │   │   │       │       // Display details specific to this booking instance
│   │   │   │       │       return Card(
│   │   │   │       │         elevation: 2,
│   │   │   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │   │   │       │         child: Padding(
│   │   │   │       │           padding: const EdgeInsets.all(20.0),
│   │   │   │       │           child: Column(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │             children: [
│   │   │   │       │               Text('booking_specifics_title'.i18n(),
│   │   │   │       │                   style: Theme.of(context)
│   │   │   │       │                       .textTheme
│   │   │   │       │                       .titleLarge
│   │   │   │       │                       ?.copyWith(fontWeight: FontWeight.w700)), // NEW i18n key
│   │   │   │       │               const SizedBox(height: 16),
│   │   │   │       │               if (booking.passengerCount != null) ...[
│   │   │   │       │                 _buildDetailRow(context, Icons.people_outline,
│   │   │   │       │                     'passengers_label'.i18n(), booking.passengerCount.toString()),
│   │   │   │       │                 const Divider(height: 20, thickness: 0.5),
│   │   │   │       │               ],
│   │   │   │       │               if (booking.specialRequests != null &&
│   │   │   │       │                   booking.specialRequests!.isNotEmpty) ...[
│   │   │   │       │                 _buildDetailRow(context, Icons.notes_rounded,
│   │   │   │       │                     'special_requests_label'.i18n(), booking.specialRequests!),
│   │   │   │       │                 const Divider(height: 20, thickness: 0.5),
│   │   │   │       │               ],
│   │   │   │       │               if (booking.paymentStatus != null) ...[
│   │   │   │       │                 _buildDetailRow(context, Icons.payment_rounded,
│   │   │   │       │                     'payment_status_label'.i18n(), booking.paymentStatus!),
│   │   │   │       │                 // You might want to add payment details or actions here
│   │   │   │       │               ],
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildDetailRow(
│   │   │   │       │         BuildContext context, IconData icon, String label, String value) {
│   │   │   │       │       return Padding(
│   │   │   │       │         padding: const EdgeInsets.symmetric(vertical: 6.0),
│   │   │   │       │         child: Row(
│   │   │   │       │           children: [
│   │   │   │       │             Icon(icon, color: Theme.of(context).primaryColor, size: 20),
│   │   │   │       │             const SizedBox(width: 12),
│   │   │   │       │             Text('$label: ',
│   │   │   │       │                 style: Theme.of(context)
│   │   │   │       │                     .textTheme
│   │   │   │       │                     .bodyMedium
│   │   │   │       │                     ?.copyWith(fontWeight: FontWeight.w600)),
│   │   │   │       │             Expanded(
│   │   │   │       │                 child:
│   │   │   │       │                     Text(value, style: Theme.of(context).textTheme.bodyMedium)),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildActionButtons(BuildContext context, Booking booking) {
│   │   │   │       │       // Determine which buttons to show based on booking status
│   │   │   │       │       bool canCancel =
│   │   │   │       │           booking.status == 'PENDING' || booking.status == 'CONFIRMED';
│   │   │   │       │   
│   │   │   │       │       return Row(
│   │   │   │       │         mainAxisAlignment: MainAxisAlignment.spaceAround,
│   │   │   │       │         children: [
│   │   │   │       │           // Contact Owner Button (adjust action as needed)
│   │   │   │       │           OutlinedButton.icon(
│   │   │   │       │             onPressed: () async {
│   │   │   │       │               // TODO: Implement chat or contact functionality
│   │   │   │       │   
│   │   │   │       │               ChatController chatController = ChatController();
│   │   │   │       │               try {
│   │   │   │       │                 print(booking.boat!.owner!.id.toString());
│   │   │   │       │                 final roomId = await chatController.createChatRoom(
│   │   │   │       │                     targetUserId: booking.boat!.owner!.id.toString());
│   │   │   │       │   
│   │   │   │       │                 Get.to(() => ChatScreen(
│   │   │   │       │                     roomId: roomId!.id,
│   │   │   │       │                     chatPartnerName: booking.boat!.owner!.fullName));
│   │   │   │       │               } catch (e) {
│   │   │   │       │                 print("Error creating chat room: $e");
│   │   │   │       │               }
│   │   │   │       │             },
│   │   │   │       │             icon: const Icon(Icons.chat_bubble_outline_rounded, size: 20),
│   │   │   │       │             label: Text('contact_owner_button'.i18n(),
│   │   │   │       │                 style:
│   │   │   │       │                     const TextStyle(fontSize: 16, fontWeight: FontWeight.w600)),
│   │   │   │       │             style: OutlinedButton.styleFrom(
│   │   │   │       │               foregroundColor: Theme.of(context).primaryColor,
│   │   │   │       │               side: BorderSide(color: Theme.of(context).primaryColor),
│   │   │   │       │               minimumSize: const Size(120, 50),
│   │   │   │       │               shape:
│   │   │   │       │                   RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │   
│   │   │   │       │           // Review button
│   │   │   │       │           Visibility(
│   │   │   │       │             visible: !_isCancelling,
│   │   │   │       │             child: OutlinedButton.icon(
│   │   │   │       │               onPressed: () {
│   │   │   │       │                 Get.to(() => RateBoatScreen(booking: booking));
│   │   │   │       │               },
│   │   │   │       │               icon: const Icon(Icons.star_border_rounded, size: 20),
│   │   │   │       │               label: Text('review_button'.i18n(),
│   │   │   │       │                   style:
│   │   │   │       │                       const TextStyle(fontSize: 16, fontWeight: FontWeight.w600)),
│   │   │   │       │               style: OutlinedButton.styleFrom(
│   │   │   │       │                 foregroundColor: Theme.of(context).primaryColor,
│   │   │   │       │                 side: BorderSide(color: Theme.of(context).primaryColor),
│   │   │   │       │                 minimumSize: const Size(120, 50),
│   │   │   │       │                 shape: RoundedRectangleBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15)),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │   
│   │   │   │       │           // Cancel Booking Button
│   │   │   │       │           Visibility(
│   │   │   │       │             visible: _isCancelling,
│   │   │   │       │             child: OutlinedButton.icon(
│   │   │   │       │               // Call _performCancelBooking, disable if not cancellable or already cancelling
│   │   │   │       │               onPressed:
│   │   │   │       │                   canCancel && !_isCancelling ? _performCancelBooking : null,
│   │   │   │       │               icon: _isCancelling
│   │   │   │       │                   ? const SizedBox(
│   │   │   │       │                       width: 18,
│   │   │   │       │                       height: 18,
│   │   │   │       │                       child: CircularProgressIndicator(
│   │   │   │       │                           strokeWidth: 2, color: Colors.redAccent))
│   │   │   │       │                   : const Icon(Icons.cancel_rounded, size: 20),
│   │   │   │       │               label: Text('cancel_booking_button'.i18n(),
│   │   │   │       │                   style:
│   │   │   │       │                       const TextStyle(fontSize: 16, fontWeight: FontWeight.w600)),
│   │   │   │       │               style: OutlinedButton.styleFrom(
│   │   │   │       │                 foregroundColor: Colors.redAccent,
│   │   │   │       │                 side: BorderSide(color: Colors.redAccent.shade200),
│   │   │   │       │                 minimumSize: const Size(120, 50),
│   │   │   │       │                 shape: RoundedRectangleBorder(
│   │   │   │       │                     borderRadius: BorderRadius.circular(15)),
│   │   │   │       │                 disabledForegroundColor: Colors.grey.withOpacity(0.5),
│   │   │   │       │                 // Visual feedback when disabled
│   │   │   │       │                 disabledMouseCursor: SystemMouseCursors.forbidden,
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // Reusing Status Badge Widget - Update choices if needed
│   │   │   │       │     // Reusing Status Badge Widget - Corrected Status Check
│   │   │   │       │     Widget _buildStatusBadge(String status, BuildContext context) {
│   │   │   │       │       Color badgeColor;
│   │   │   │       │       Color textColor;
│   │   │   │       │   
│   │   │   │       │       // --- Use String Comparison ---
│   │   │   │       │       switch (status) {
│   │   │   │       │         case 'PENDING':
│   │   │   │       │           badgeColor = Colors.orange.shade100;
│   │   │   │       │           textColor = Colors.orange.shade800;
│   │   │   │       │           break;
│   │   │   │       │         case 'CONFIRMED':
│   │   │   │       │           badgeColor = Colors.green.shade100;
│   │   │   │       │           textColor = Colors.green.shade800;
│   │   │   │       │           break;
│   │   │   │       │         case 'REJECTED': // Fallthrough if style is the same
│   │   │   │       │         case 'CANCELLED_OWNER': // Fallthrough
│   │   │   │       │         case 'CANCELLED_RENTER':
│   │   │   │       │           badgeColor = Colors.red.shade100;
│   │   │   │       │           textColor = Colors.red.shade800;
│   │   │   │       │           break;
│   │   │   │       │         case 'COMPLETED':
│   │   │   │       │           badgeColor = Colors.blue.shade100;
│   │   │   │       │           textColor = Colors.blue.shade800;
│   │   │   │       │           break;
│   │   │   │       │         default: // Fallback for any unknown status
│   │   │   │       │           badgeColor = Colors.grey.shade200;
│   │   │   │       │           textColor = Colors.grey.shade800;
│   │   │   │       │       }
│   │   │   │       │       // --- End String Comparison ---
│   │   │   │       │   
│   │   │   │       │       // Capitalize status string for display (moved from switch)
│   │   │   │       │       String displayStatus =
│   │   │   │       │           status.replaceAll('_', ' ').toLowerCase().capitalizeFirst ?? status;
│   │   │   │       │   
│   │   │   │       │       return Container(
│   │   │   │       │         padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
│   │   │   │       │         decoration: BoxDecoration(
│   │   │   │       │             color: badgeColor,
│   │   │   │       │             borderRadius: BorderRadius.circular(20),
│   │   │   │       │             boxShadow: [
│   │   │   │       │               BoxShadow(
│   │   │   │       │                 color: badgeColor.withOpacity(0.5),
│   │   │   │       │                 blurRadius: 4,
│   │   │   │       │                 offset: const Offset(0, 2),
│   │   │   │       │               )
│   │   │   │       │             ]),
│   │   │   │       │         child: Text(
│   │   │   │       │           displayStatus, // Use the formatted display string
│   │   │   │       │           style: TextStyle(
│   │   │   │       │             color: textColor,
│   │   │   │       │             fontWeight: FontWeight.w600,
│   │   │   │       │             fontSize: 13,
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     String _formatDate(DateTime date) {
│   │   │   │       │       // Using your existing format function
│   │   │   │       │       return "${date.day}/${date.month}/${date.year}";
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     void _showSnackBar(BuildContext context, String message,
│   │   │   │       │         {bool isError = false}) {
│   │   │   │       │       if (isError) {
│   │   │   │       │         SnackBarUtil.showErrorSnackBar(message: message, title: '');
│   │   │   │       │       } else {
│   │   │   │       │         SnackBarUtil.showSuccessSnackBar(message: message, title: '');
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   }
│   │   │   ├── owner-list/
│   │   │   │   └── screen.dart
│   │   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:app/app/theme.dart';
│   │   │   │       │   import 'package:get/get.dart';
│   │   │   │       │   import 'package:localization/localization.dart';
│   │   │   │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │   │       │   
│   │   │   │       │   // --- Import Models and Controller ---
│   │   │   │       │   import 'package:app/controllers/booking.dart'; // Use correct controller name
│   │   │   │       │   import 'package:app/models/booking.dart'; // Use correct model name
│   │   │   │       │   // Import details screen for potential navigation
│   │   │   │       │   import 'package:app/features/bookings/details/screen.dart';
│   │   │   │       │   
│   │   │   │       │   // Dummy Booking Data Model - Can be removed if not used for placeholders
│   │   │   │       │   // class Booking { ... }
│   │   │   │       │   
│   │   │   │       │   class ManageBookingsScreen extends StatefulWidget {
│   │   │   │       │     const ManageBookingsScreen({super.key});
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<ManageBookingsScreen> createState() => _ManageBookingsScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   class _ManageBookingsScreenState extends State<ManageBookingsScreen>
│   │   │   │       │       with TickerProviderStateMixin {
│   │   │   │       │     // --- Controller and State Variables ---
│   │   │   │       │     final BookingController _bookingController = BookingController();
│   │   │   │       │     final _storage = const FlutterSecureStorage();
│   │   │   │       │     List<Booking> _bookings = []; // Holds fetched bookings
│   │   │   │       │     bool _isLoading = true; // Start in loading state
│   │   │   │       │     String? _errorMessage;
│   │   │   │       │     // State for action buttons loading state (Map bookingId -> isLoading)
│   │   │   │       │     final Map<int, bool> _isProcessingAction = {};
│   │   │   │       │   
│   │   │   │       │     // Animation controllers (keep if used, remove otherwise)
│   │   │   │       │     // late AnimationController _logoAnimationController;
│   │   │   │       │     // late Animation<double> _logoAnimation;
│   │   │   │       │   
│   │   │   │       │     // Filter/Search state (keep from previous UI code)
│   │   │   │       │     String _searchQuery = '';
│   │   │   │       │     String _filterStatus = 'all';
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       // Fetch bookings when the screen loads
│   │   │   │       │       _fetchBookings();
│   │   │   │       │   
│   │   │   │       │       // Initialize animation controllers if needed
│   │   │   │       │       // _logoAnimationController = AnimationController(...)
│   │   │   │       │       // _logoAnimation = CurvedAnimation(...)
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       // Dispose animation controllers if needed
│   │   │   │       │       // _logoAnimationController.dispose();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Function to Fetch Owner's Bookings ---
│   │   │   │       │     Future<void> _fetchBookings() async {
│   │   │   │       │       setState(() {
│   │   │   │       │         _isLoading = true;
│   │   │   │       │         _errorMessage = null;
│   │   │   │       │       });
│   │   │   │       │   
│   │   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() {
│   │   │   │       │             _isLoading = false;
│   │   │   │       │             _errorMessage = 'Authentication Error. Please log in.';
│   │   │   │       │           });
│   │   │   │       │         }
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       try {
│   │   │   │       │         // Controller fetches bookings relevant to the authenticated user (owner)
│   │   │   │       │         final fetchedBookings = await _bookingController.fetchBookings();
│   │   │   │       │         if (!mounted) return; // Check mount status after await
│   │   │   │       │   
│   │   │   │       │         setState(() {
│   │   │   │       │           _bookings = fetchedBookings;
│   │   │   │       │           _isLoading = false;
│   │   │   │       │         });
│   │   │   │       │       } catch (e) {
│   │   │   │       │         print("Fetch Owner Bookings Error: $e");
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() {
│   │   │   │       │             _isLoading = false;
│   │   │   │       │             _errorMessage = 'An error occurred: $e';
│   │   │   │       │           });
│   │   │   │       │         }
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Action Handlers ---
│   │   │   │       │     Future<void> _performAcceptBooking(int bookingId) async {
│   │   │   │       │       setState(() => _isProcessingAction[bookingId] = true);
│   │   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │       if (accessToken == null) {
│   │   │   │       │         if (mounted)
│   │   │   │       │           _showSnackBar(context, "Authentication Error", isError: true);
│   │   │   │       │         setState(() => _isProcessingAction.remove(bookingId));
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       final success = await _bookingController.acceptBooking(
│   │   │   │       │         bookingId,
│   │   │   │       │       );
│   │   │   │       │       if (!mounted) return;
│   │   │   │       │   
│   │   │   │       │       if (success != null) {
│   │   │   │       │         _showSnackBar(context, 'Booking accepted successfully.');
│   │   │   │       │         await _fetchBookings(); // Refresh list after action
│   │   │   │       │       } else {
│   │   │   │       │         _showSnackBar(context, 'Failed to accept booking.', isError: true);
│   │   │   │       │       }
│   │   │   │       │       setState(() => _isProcessingAction.remove(bookingId));
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Future<void> _performRejectBooking(int bookingId) async {
│   │   │   │       │       setState(() => _isProcessingAction[bookingId] = true);
│   │   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │       if (accessToken == null) {
│   │   │   │       │         if (mounted)
│   │   │   │       │           _showSnackBar(context, "Authentication Error", isError: true);
│   │   │   │       │         setState(() => _isProcessingAction.remove(bookingId));
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       final success = await _bookingController.rejectBooking(
│   │   │   │       │         bookingId,
│   │   │   │       │       );
│   │   │   │       │       if (!mounted) return;
│   │   │   │       │   
│   │   │   │       │       if (success != null) {
│   │   │   │       │         _showSnackBar(context, 'Booking rejected successfully.');
│   │   │   │       │         await _fetchBookings(); // Refresh list
│   │   │   │       │       } else {
│   │   │   │       │         _showSnackBar(context, 'Failed to reject booking.', isError: true);
│   │   │   │       │       }
│   │   │   │       │       setState(() => _isProcessingAction.remove(bookingId));
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Future<void> _performCancelBooking(int bookingId, String boatName) async {
│   │   │   │       │       // Confirmation Dialog (similar to details screen)
│   │   │   │       │       final bool? confirm = await showDialog<bool>(
│   │   │   │       │         context: context,
│   │   │   │       │         builder: (context) => AlertDialog(
│   │   │   │       │           title: Text('cancel_booking_confirmation_title'.i18n()),
│   │   │   │       │           content: Text('cancel_booking_confirmation_message'.i18n([boatName])),
│   │   │   │       │           actions: [
│   │   │   │       │             TextButton(
│   │   │   │       │                 onPressed: () => Navigator.of(context).pop(false),
│   │   │   │       │                 child: Text('no'.i18n())),
│   │   │   │       │             TextButton(
│   │   │   │       │                 onPressed: () => Navigator.of(context).pop(true),
│   │   │   │       │                 child: Text('yes_cancel'.i18n()),
│   │   │   │       │                 style: TextButton.styleFrom(foregroundColor: Colors.red)),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │   
│   │   │   │       │       if (confirm != true) return;
│   │   │   │       │   
│   │   │   │       │       setState(() => _isProcessingAction[bookingId] = true);
│   │   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │       if (accessToken == null) {
│   │   │   │       │         if (mounted)
│   │   │   │       │           _showSnackBar(context, "Authentication Error", isError: true);
│   │   │   │       │         setState(() => _isProcessingAction.remove(bookingId));
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       final success = await _bookingController.cancelBooking(
│   │   │   │       │         bookingId,
│   │   │   │       │       );
│   │   │   │       │       if (!mounted) return;
│   │   │   │       │   
│   │   │   │       │       if (success != null) {
│   │   │   │       │         _showSnackBar(context, 'Booking cancelled successfully.');
│   │   │   │       │         await _fetchBookings(); // Refresh list
│   │   │   │       │       } else {
│   │   │   │       │         _showSnackBar(context, 'Failed to cancel booking.', isError: true);
│   │   │   │       │       }
│   │   │   │       │       setState(() => _isProcessingAction.remove(bookingId));
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       return Scaffold(
│   │   │   │       │         resizeToAvoidBottomInset: false,
│   │   │   │       │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │   │       │         appBar: _buildAppBar(context),
│   │   │   │       │         body: _buildBodyContent(), // Delegate body building
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Build Body based on State ---
│   │   │   │       │     Widget _buildBodyContent() {
│   │   │   │       │       if (_isLoading) {
│   │   │   │       │         return const Center(child: CircularProgressIndicator());
│   │   │   │       │       }
│   │   │   │       │       if (_errorMessage != null) {
│   │   │   │       │         return Center(
│   │   │   │       │             child: Padding(
│   │   │   │       │                 padding: const EdgeInsets.all(20.0),
│   │   │   │       │                 child: Column(
│   │   │   │       │                   mainAxisSize: MainAxisSize.min,
│   │   │   │       │                   children: [
│   │   │   │       │                     Text(_errorMessage!,
│   │   │   │       │                         textAlign: TextAlign.center,
│   │   │   │       │                         style: TextStyle(color: Colors.red.shade700)),
│   │   │   │       │                     const SizedBox(height: 16),
│   │   │   │       │                     ElevatedButton(
│   │   │   │       │                         onPressed: _fetchBookings,
│   │   │   │       │                         child: const Text('Retry')) // Changed to _fetchBookings
│   │   │   │       │                   ],
│   │   │   │       │                 )));
│   │   │   │       │       }
│   │   │   │       │       if (_bookings.isEmpty) {
│   │   │   │       │         return _buildEmptyBookingList(); // Show empty state
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       // Display Booking List
│   │   │   │       │       return _buildBookingGridList();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // Keep AppBar and SearchBar structure from previous UI code
│   │   │   │       │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │   │       │       return AppBar(
│   │   │   │       │         title: Text('manage_bookings_title_appbar'.i18n(),
│   │   │   │       │             style: const TextStyle(fontWeight: FontWeight.w700)), // Updated title
│   │   │   │       │         centerTitle: true,
│   │   │   │       │         elevation: 2,
│   │   │   │       │         backgroundColor: Colors.white,
│   │   │   │       │         iconTheme: IconThemeData(color: Theme.of(context).colorScheme.primary),
│   │   │   │       │         actions: [
│   │   │   │       │           IconButton(
│   │   │   │       │             icon: const Icon(Icons.filter_alt_outlined, size: 28),
│   │   │   │       │             tooltip: 'filter_bookings_tooltip'.i18n(),
│   │   │   │       │             onPressed: () => _showFilterOptions(context),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │         bottom: PreferredSize(
│   │   │   │       │           preferredSize: const Size.fromHeight(70.0),
│   │   │   │       │           child: Padding(
│   │   │   │       │             padding: const EdgeInsets.symmetric(horizontal: 16.0, vertical: 12.0),
│   │   │   │       │             child: _buildSearchBar(),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildSearchBar() {
│   │   │   │       │       return TextField(
│   │   │   │       │         decoration: InputDecoration(
│   │   │   │       │           hintText: 'search_bookings_hint'.i18n(),
│   │   │   │       │           prefixIcon:
│   │   │   │       │               Icon(Icons.search, color: Theme.of(context).colorScheme.primary),
│   │   │   │       │           filled: true,
│   │   │   │       │           fillColor: Colors.grey.shade50,
│   │   │   │       │           border: OutlineInputBorder(
│   │   │   │       │             borderRadius: BorderRadius.circular(25),
│   │   │   │       │             borderSide: BorderSide.none,
│   │   │   │       │           ),
│   │   │   │       │           enabledBorder: OutlineInputBorder(
│   │   │   │       │             // Keep subtle border
│   │   │   │       │             borderRadius: BorderRadius.circular(25),
│   │   │   │       │             borderSide: BorderSide(color: Colors.grey.shade300, width: 1),
│   │   │   │       │           ),
│   │   │   │       │           focusedBorder: OutlineInputBorder(
│   │   │   │       │             // Highlight border on focus
│   │   │   │       │             borderRadius: BorderRadius.circular(25),
│   │   │   │       │             borderSide: BorderSide(
│   │   │   │       │                 color: Theme.of(context).colorScheme.primary, width: 1.5),
│   │   │   │       │           ),
│   │   │   │       │           contentPadding:
│   │   │   │       │               const EdgeInsets.symmetric(horizontal: 20, vertical: 14),
│   │   │   │       │         ),
│   │   │   │       │         onChanged: (value) {
│   │   │   │       │           setState(() => _searchQuery = value);
│   │   │   │       │         },
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildEmptyBookingList() {
│   │   │   │       │       // Using the empty state from your previous owner-list UI code
│   │   │   │       │       return Center(
│   │   │   │       │         child: Padding(
│   │   │   │       │           padding: const EdgeInsets.symmetric(horizontal: 40.0),
│   │   │   │       │           child: Column(
│   │   │   │       │             mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │             children: [
│   │   │   │       │               // _buildAppLogo(), // Consider adding a relevant icon here if needed
│   │   │   │       │               const Icon(Icons.event_busy_outlined, size: 80, color: Colors.grey),
│   │   │   │       │               const SizedBox(height: 30),
│   │   │   │       │               Text(
│   │   │   │       │                 'no_bookings_owner_message'.i18n(),
│   │   │   │       │                 style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │   │       │                     color: AppColors.subtleTextColor,
│   │   │   │       │                     fontWeight: FontWeight.w500),
│   │   │   │       │                 textAlign: TextAlign.center,
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 30),
│   │   │   │       │               // Optional: Add a button to refresh or go elsewhere
│   │   │   │       │               // ElevatedButton.icon(...)
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildBookingGridList() {
│   │   │   │       │       // Filter bookings based on search query and status filter
│   │   │   │       │       List<Booking> filteredBookings = _bookings.where((booking) {
│   │   │   │       │         // Search logic (adjust as needed)
│   │   │   │       │         final boatNameLower =
│   │   │   │       │             (booking.boatName ?? booking.boat?.name ?? '').toLowerCase();
│   │   │   │       │         final renterEmailLower =
│   │   │   │       │             (booking.renterEmail ?? booking.renter?.email ?? '').toLowerCase();
│   │   │   │       │         final queryLower = _searchQuery.toLowerCase();
│   │   │   │       │         bool nameMatch = boatNameLower.contains(queryLower) ||
│   │   │   │       │             renterEmailLower.contains(queryLower);
│   │   │   │       │         // Status filtering
│   │   │   │       │         bool statusMatch = _filterStatus == 'all' ||
│   │   │   │       │             booking.status.toLowerCase() == _filterStatus;
│   │   │   │       │   
│   │   │   │       │         return nameMatch && statusMatch;
│   │   │   │       │       }).toList();
│   │   │   │       │   
│   │   │   │       │       if (filteredBookings.isEmpty && _searchQuery.isNotEmpty) {
│   │   │   │       │         return const Center(
│   │   │   │       │             child: Text("No bookings found matching your search."));
│   │   │   │       │       }
│   │   │   │       │       if (filteredBookings.isEmpty && _filterStatus != 'all') {
│   │   │   │       │         return const Center(
│   │   │   │       │             child: Text("No bookings found with the selected status."));
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       // Use the fetched and filtered list
│   │   │   │       │       return GridView.builder(
│   │   │   │       │         padding: const EdgeInsets.all(16.0),
│   │   │   │       │         gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
│   │   │   │       │           crossAxisCount:
│   │   │   │       │               1, // Keep 1 column layout for owner list? Adjust if needed
│   │   │   │       │           crossAxisSpacing: 16,
│   │   │   │       │           mainAxisSpacing: 16,
│   │   │   │       │           childAspectRatio: 1.5, // Adjust as needed for card content
│   │   │   │       │         ),
│   │   │   │       │         itemCount: filteredBookings.length,
│   │   │   │       │         itemBuilder: (context, index) {
│   │   │   │       │           final booking = filteredBookings[index];
│   │   │   │       │           return _buildFancyBookingCard(
│   │   │   │       │               context, booking); // Build card with fetched data
│   │   │   │       │         },
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Updated Fancy Booking Card with Owner Actions ---
│   │   │   │       │     Widget _buildFancyBookingCard(BuildContext context, Booking booking) {
│   │   │   │       │       bool isPending = booking.status == 'PENDING';
│   │   │   │       │       bool isConfirmed = booking.status == 'CONFIRMED';
│   │   │   │       │       bool isCancellable =
│   │   │   │       │           isPending || isConfirmed; // Owner can cancel pending or confirmed
│   │   │   │       │       bool isProcessing = _isProcessingAction[booking.id] ?? false;
│   │   │   │       │   
│   │   │   │       │       return Card(
│   │   │   │       │         elevation: 3,
│   │   │   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │   │   │       │         child: Padding(
│   │   │   │       │           padding: const EdgeInsets.all(8.0),
│   │   │   │       │           child: Column(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │             children: [
│   │   │   │       │               ListTile(
│   │   │   │       │                 contentPadding: EdgeInsets.zero,
│   │   │   │       │                 leading: ClipRRect(
│   │   │   │       │                   borderRadius: BorderRadius.circular(12),
│   │   │   │       │                   child: Image.network(
│   │   │   │       │                     // Use appropriate image URL
│   │   │   │       │                     booking.boatImageUrl ??
│   │   │   │       │                         booking.boat?.mainImageUrl ??
│   │   │   │       │                         'https://placehold.co/70x70/E0E0E0/BDBDBD?text=N/A',
│   │   │   │       │                     width: 70, height: 70, fit: BoxFit.cover,
│   │   │   │       │                     errorBuilder: (context, error, stackTrace) => const Icon(
│   │   │   │       │                         Icons.broken_image,
│   │   │   │       │                         size: 50,
│   │   │   │       │                         color: Colors.grey),
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │                 title: Text(
│   │   │   │       │                     booking.boatName ?? booking.boat?.name ?? 'Unknown Boat',
│   │   │   │       │                     style: Theme.of(context)
│   │   │   │       │                         .textTheme
│   │   │   │       │                         .titleMedium
│   │   │   │       │                         ?.copyWith(fontWeight: FontWeight.w700)),
│   │   │   │       │                 subtitle: Column(
│   │   │   │       │                   crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                   children: [
│   │   │   │       │                     Text(
│   │   │   │       │                         '${'user_name_label'.i18n()}: ${booking.renterEmail ?? booking.renter?.email ?? 'Unknown'}'),
│   │   │   │       │                     Text('${'booking_id_label'.i18n()}: ${booking.bookingId}'),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               Padding(
│   │   │   │       │                 padding:
│   │   │   │       │                     const EdgeInsets.only(left: 16.0, top: 12.0, bottom: 8.0),
│   │   │   │       │                 child: Column(
│   │   │   │       │                   crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                   children: [
│   │   │   │       │                     RichText(
│   │   │   │       │                       text: TextSpan(
│   │   │   │       │                         style: Theme.of(context).textTheme.bodyLarge?.copyWith(
│   │   │   │       │                             color: Theme.of(context).textTheme.bodyLarge?.color ??
│   │   │   │       │                                 Colors.black87), // Ensure default color
│   │   │   │       │                         children: <TextSpan>[
│   │   │   │       │                           TextSpan(
│   │   │   │       │                               text: '${'date_range_label'.i18n()}: ',
│   │   │   │       │                               style:
│   │   │   │       │                                   const TextStyle(fontWeight: FontWeight.bold)),
│   │   │   │       │                           TextSpan(
│   │   │   │       │                               text:
│   │   │   │       │                                   '${_formatDate(booking.startDate)} - ${_formatDate(booking.endDate)}'),
│   │   │   │       │                         ],
│   │   │   │       │                       ),
│   │   │   │       │                     ),
│   │   │   │       │                     const SizedBox(height: 8),
│   │   │   │       │                     _buildStatusBadge(booking.status, context),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               const Spacer(), // Pushes buttons to the bottom
│   │   │   │       │               // --- Conditional Action Buttons ---
│   │   │   │       │               if (isPending) // Show Accept/Reject for Pending
│   │   │   │       │                 Row(
│   │   │   │       │                   mainAxisSize: MainAxisSize.max,
│   │   │   │       │                   mainAxisAlignment: MainAxisAlignment.spaceAround,
│   │   │   │       │                   children: [
│   │   │   │       │                     _buildActionButton(
│   │   │   │       │                       context: context,
│   │   │   │       │                       label: 'accept_button'.i18n(),
│   │   │   │       │                       icon: Icons.check_circle_rounded,
│   │   │   │       │                       color: Colors.green,
│   │   │   │       │                       isLoading: isProcessing,
│   │   │   │       │                       onPressed: () => _performAcceptBooking(booking.id),
│   │   │   │       │                     ),
│   │   │   │       │                     _buildActionButton(
│   │   │   │       │                       context: context,
│   │   │   │       │                       label: 'reject_button'.i18n(),
│   │   │   │       │                       icon: Icons.cancel_rounded,
│   │   │   │       │                       color: Colors.redAccent,
│   │   │   │       │                       isLoading: isProcessing,
│   │   │   │       │                       onPressed: () => _performRejectBooking(booking.id),
│   │   │   │       │                     ),
│   │   │   │       │                   ],
│   │   │   │       │                 )
│   │   │   │       │               else // Show View/Cancel for other statuses
│   │   │   │       │                 Row(
│   │   │   │       │                   mainAxisSize: MainAxisSize.max,
│   │   │   │       │                   mainAxisAlignment: isCancellable
│   │   │   │       │                       ? MainAxisAlignment.spaceAround
│   │   │   │       │                       : MainAxisAlignment
│   │   │   │       │                           .end, // Adjust alignment if cancel isn't possible
│   │   │   │       │                   children: [
│   │   │   │       │                     if (isCancellable) // Show Cancel only if appropriate
│   │   │   │       │                       _buildActionButton(
│   │   │   │       │                         context: context,
│   │   │   │       │                         label: 'cancel_booking_button'.i18n(), // Use cancel text
│   │   │   │       │                         icon: Icons.block_rounded,
│   │   │   │       │                         color: Colors.orange.shade700,
│   │   │   │       │                         isLoading: isProcessing,
│   │   │   │       │                         onPressed: () => _performCancelBooking(
│   │   │   │       │                             booking.id,
│   │   │   │       │                             booking.boatName ??
│   │   │   │       │                                 booking.boat?.name ??
│   │   │   │       │                                 'this boat'),
│   │   │   │       │                       ),
│   │   │   │       │   
│   │   │   │       │                     // Always show View Details (or adjust logic)
│   │   │   │       │                     _buildActionButton(
│   │   │   │       │                       context: context,
│   │   │   │       │                       label: 'view_details_button'.i18n(),
│   │   │   │       │                       icon: Icons.visibility_rounded,
│   │   │   │       │                       color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                       isLoading:
│   │   │   │       │                           false, // View details doesn't usually have loading state here
│   │   │   │       │                       onPressed: () {
│   │   │   │       │                         Navigator.push(
│   │   │   │       │                           context,
│   │   │   │       │                           MaterialPageRoute(
│   │   │   │       │                               builder: (_) =>
│   │   │   │       │                                   BookingDetailsScreen(bookingId: booking.id)),
│   │   │   │       │                         );
│   │   │   │       │                       },
│   │   │   │       │                     ),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               const SizedBox(height: 8), // Add spacing at the bottom
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Helper to build Action Buttons with Loading ---
│   │   │   │       │     Widget _buildActionButton({
│   │   │   │       │       required BuildContext context,
│   │   │   │       │       required String label,
│   │   │   │       │       required IconData icon,
│   │   │   │       │       required Color color,
│   │   │   │       │       required bool isLoading,
│   │   │   │       │       required VoidCallback? onPressed,
│   │   │   │       │     }) {
│   │   │   │       │       return OutlinedButton.icon(
│   │   │   │       │         onPressed: isLoading ? null : onPressed, // Disable if loading
│   │   │   │       │         icon: isLoading
│   │   │   │       │             ? SizedBox(
│   │   │   │       │                 width: 18,
│   │   │   │       │                 height: 18,
│   │   │   │       │                 child: CircularProgressIndicator(strokeWidth: 2, color: color))
│   │   │   │       │             : Icon(icon, size: 20),
│   │   │   │       │         label: Text(label),
│   │   │   │       │         style: OutlinedButton.styleFrom(
│   │   │   │       │           foregroundColor: color,
│   │   │   │       │           side: BorderSide(color: color.withOpacity(0.5)),
│   │   │   │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
│   │   │   │       │           disabledForegroundColor:
│   │   │   │       │               Colors.grey.withOpacity(0.7), // Feedback when disabled
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // Keep Status Badge and Date Formatters
│   │   │   │       │     Widget _buildStatusBadge(String status, BuildContext context) {
│   │   │   │       │       // ... (same implementation as in details screen, using string comparison)
│   │   │   │       │       Color badgeColor;
│   │   │   │       │       Color textColor;
│   │   │   │       │       switch (status) {
│   │   │   │       │         case 'PENDING':
│   │   │   │       │           badgeColor = Colors.orange.shade100;
│   │   │   │       │           textColor = Colors.orange.shade800;
│   │   │   │       │           break;
│   │   │   │       │         case 'CONFIRMED':
│   │   │   │       │           badgeColor = Colors.green.shade100;
│   │   │   │       │           textColor = Colors.green.shade800;
│   │   │   │       │           break;
│   │   │   │       │         case 'REJECTED':
│   │   │   │       │         case 'CANCELLED_OWNER':
│   │   │   │       │         case 'CANCELLED_RENTER':
│   │   │   │       │           badgeColor = Colors.red.shade100;
│   │   │   │       │           textColor = Colors.red.shade800;
│   │   │   │       │           break;
│   │   │   │       │         case 'COMPLETED':
│   │   │   │       │           badgeColor = Colors.blue.shade100;
│   │   │   │       │           textColor = Colors.blue.shade800;
│   │   │   │       │           break;
│   │   │   │       │         default:
│   │   │   │       │           badgeColor = Colors.grey.shade200;
│   │   │   │       │           textColor = Colors.grey.shade800;
│   │   │   │       │       }
│   │   │   │       │       String displayStatus =
│   │   │   │       │           status.replaceAll('_', ' ').toLowerCase().capitalizeFirst ?? status;
│   │   │   │       │       return Container(
│   │   │   │       │           /* ... rest of badge styling ... */
│   │   │   │       │           padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
│   │   │   │       │           decoration: BoxDecoration(
│   │   │   │       │               color: badgeColor,
│   │   │   │       │               borderRadius: BorderRadius.circular(20),
│   │   │   │       │               boxShadow: [
│   │   │   │       │                 BoxShadow(
│   │   │   │       │                     color: badgeColor.withOpacity(0.5),
│   │   │   │       │                     blurRadius: 4,
│   │   │   │       │                     offset: const Offset(0, 2))
│   │   │   │       │               ]),
│   │   │   │       │           child: Text(
│   │   │   │       │             displayStatus,
│   │   │   │       │             style: TextStyle(
│   │   │   │       │               color: textColor,
│   │   │   │       │               fontWeight: FontWeight.w600,
│   │   │   │       │               fontSize: 13,
│   │   │   │       │             ),
│   │   │   │       │           ));
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     void _showFilterOptions(BuildContext context) {
│   │   │   │       │       // ... (Keep your filter options modal sheet implementation) ...
│   │   │   │       │       showModalBottomSheet(
│   │   │   │       │         context: context,
│   │   │   │       │         shape: const RoundedRectangleBorder(
│   │   │   │       │             borderRadius: BorderRadius.vertical(top: Radius.circular(25.0))),
│   │   │   │       │         builder: (BuildContext context) {
│   │   │   │       │           return Padding(
│   │   │   │       │             padding: const EdgeInsets.symmetric(vertical: 16.0),
│   │   │   │       │             child: Column(
│   │   │   │       │               mainAxisSize: MainAxisSize.min,
│   │   │   │       │               children: <Widget>[
│   │   │   │       │                 ListTile(
│   │   │   │       │                   leading: const Icon(Icons.all_inclusive_rounded),
│   │   │   │       │                   title: Text('filter_all_status'.i18n(),
│   │   │   │       │                       style: const TextStyle(fontWeight: FontWeight.w500)),
│   │   │   │       │                   onTap: () {
│   │   │   │       │                     setState(() => _filterStatus = 'all');
│   │   │   │       │                     Navigator.pop(context);
│   │   │   │       │                   },
│   │   │   │       │                 ),
│   │   │   │       │                 ListTile(
│   │   │   │       │                   leading:
│   │   │   │       │                       Icon(Icons.pending_actions, color: Colors.orange.shade400),
│   │   │   │       │                   title: Text('filter_pending_status'.i18n(),
│   │   │   │       │                       style: const TextStyle(fontWeight: FontWeight.w500)),
│   │   │   │       │                   onTap: () {
│   │   │   │       │                     setState(() => _filterStatus = 'pending');
│   │   │   │       │                     Navigator.pop(context);
│   │   │   │       │                   },
│   │   │   │       │                 ),
│   │   │   │       │                 ListTile(
│   │   │   │       │                   leading: Icon(Icons.check_circle_rounded,
│   │   │   │       │                       color: Colors.green.shade400),
│   │   │   │       │                   title: Text('filter_confirmed_status'.i18n(),
│   │   │   │       │                       style: const TextStyle(fontWeight: FontWeight.w500)),
│   │   │   │       │                   onTap: () {
│   │   │   │       │                     setState(() => _filterStatus = 'confirmed');
│   │   │   │       │                     Navigator.pop(context);
│   │   │   │       │                   },
│   │   │   │       │                 ),
│   │   │   │       │                 ListTile(
│   │   │   │       │                   leading: Icon(Icons.cancel_rounded, color: Colors.red.shade400),
│   │   │   │       │                   title: Text('filter_cancelled_status'.i18n(),
│   │   │   │       │                       style: const TextStyle(
│   │   │   │       │                           fontWeight: FontWeight.w500)), // Combine cancelled?
│   │   │   │       │                   onTap: () {
│   │   │   │       │                     setState(() => _filterStatus = 'cancelled_renter');
│   │   │   │       │                     Navigator.pop(context);
│   │   │   │       │                   }, // Adjust based on backend choices
│   │   │   │       │                 ),
│   │   │   │       │                 ListTile(
│   │   │   │       │                   leading: Icon(Icons.block_rounded, color: Colors.red.shade400),
│   │   │   │       │                   title: Text('filter_rejected_status'.i18n(),
│   │   │   │       │                       style: const TextStyle(fontWeight: FontWeight.w500)),
│   │   │   │       │                   onTap: () {
│   │   │   │       │                     setState(() => _filterStatus = 'rejected');
│   │   │   │       │                     Navigator.pop(context);
│   │   │   │       │                   },
│   │   │   │       │                 ),
│   │   │   │       │                 ListTile(
│   │   │   │       │                   leading:
│   │   │   │       │                       Icon(Icons.done_all_rounded, color: Colors.blue.shade400),
│   │   │   │       │                   title: Text('filter_completed_status'.i18n(),
│   │   │   │       │                       style: const TextStyle(fontWeight: FontWeight.w500)),
│   │   │   │       │                   onTap: () {
│   │   │   │       │                     setState(() => _filterStatus = 'completed');
│   │   │   │       │                     Navigator.pop(context);
│   │   │   │       │                   },
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           );
│   │   │   │       │         },
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     String _formatDate(DateTime date) {
│   │   │   │       │       return "${date.day}/${date.month}/${date.year}";
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     void _showSnackBar(BuildContext context, String message,
│   │   │   │       │         {bool isError = false}) {
│   │   │   │       │       if (isError) {
│   │   │   │       │         SnackBarUtil.showErrorSnackBar(
│   │   │   │       │           message: message,
│   │   │   │       │           title: 'Error',
│   │   │   │       │         );
│   │   │   │       │       } else {
│   │   │   │       │         SnackBarUtil.showSuccessSnackBar(
│   │   │   │       │           message: message,
│   │   │   │       │           title: 'Success',
│   │   │   │       │         );
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   }
│   │   │   └── renter-list/
│   │   │       └── screen.dart
│   │   │           │   // lib/features/bookings/renter-list/screen.dart
│   │   │           │   
│   │   │           │   import 'package:app/features/home/screen.dart';
│   │   │           │   import 'package:app/utils/snackbar.dart';
│   │   │           │   import 'package:flutter/material.dart';
│   │   │           │   import 'package:app/app/theme.dart'; // Ensure correct import path
│   │   │           │   import 'package:get/get.dart';
│   │   │           │   import 'package:localization/localization.dart';
│   │   │           │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │           │   
│   │   │           │   // --- Import Models and Controller ---
│   │   │           │   import 'package:app/controllers/booking.dart'; // Use correct controller name
│   │   │           │   import 'package:app/models/booking.dart'; // Use correct model name
│   │   │           │   // Import details screen for navigation
│   │   │           │   import 'package:app/features/bookings/details/screen.dart';
│   │   │           │   
│   │   │           │   // Dummy Booking Data Model - Can be removed if not used for placeholders
│   │   │           │   // class Booking { ... }
│   │   │           │   
│   │   │           │   class ListBookingsScreen extends StatefulWidget {
│   │   │           │     const ListBookingsScreen({super.key});
│   │   │           │   
│   │   │           │     @override
│   │   │           │     State<ListBookingsScreen> createState() => _ListBookingsScreenState();
│   │   │           │   }
│   │   │           │   
│   │   │           │   class _ListBookingsScreenState extends State<ListBookingsScreen>
│   │   │           │       with TickerProviderStateMixin {
│   │   │           │     // --- Controller and State Variables ---
│   │   │           │     final BookingController _bookingController = BookingController();
│   │   │           │     final _storage = const FlutterSecureStorage();
│   │   │           │     List<Booking> _bookings = []; // Holds fetched bookings
│   │   │           │     bool _isLoading = true; // Start in loading state
│   │   │           │     String? _errorMessage;
│   │   │           │     // State for cancel button loading state (Map bookingId -> isLoading)
│   │   │           │     final Map<int, bool> _isCancellingAction = {};
│   │   │           │   
│   │   │           │     // Animation controllers (keep if used, remove otherwise)
│   │   │           │     // late AnimationController _logoAnimationController;
│   │   │           │     // late Animation<double> _logoAnimation;
│   │   │           │   
│   │   │           │     // Filter/Search state (keep from previous UI code)
│   │   │           │     String _searchQuery = '';
│   │   │           │     String _filterStatus = 'all';
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void initState() {
│   │   │           │       super.initState();
│   │   │           │       // Fetch bookings when the screen loads
│   │   │           │       _fetchBookings();
│   │   │           │   
│   │   │           │       // Initialize animation controllers if needed
│   │   │           │       // _logoAnimationController = AnimationController(...)
│   │   │           │       // _logoAnimation = CurvedAnimation(...)
│   │   │           │     }
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void dispose() {
│   │   │           │       // Dispose animation controllers if needed
│   │   │           │       // _logoAnimationController.dispose();
│   │   │           │       super.dispose();
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Function to Fetch Renter's Bookings ---
│   │   │           │     Future<void> _fetchBookings() async {
│   │   │           │       setState(() {
│   │   │           │         _isLoading = true;
│   │   │           │         _errorMessage = null;
│   │   │           │       });
│   │   │           │   
│   │   │           │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │           │       if (accessToken == null || accessToken.isEmpty) {
│   │   │           │         if (mounted) {
│   │   │           │           setState(() {
│   │   │           │             _isLoading = false;
│   │   │           │             _errorMessage = 'Authentication Error. Please log in.';
│   │   │           │           });
│   │   │           │         }
│   │   │           │         return;
│   │   │           │       }
│   │   │           │   
│   │   │           │       try {
│   │   │           │         // Controller fetches bookings relevant to the authenticated user (renter)
│   │   │           │         final fetchedBookings = await _bookingController.fetchBookings();
│   │   │           │         if (!mounted) return;
│   │   │           │   
│   │   │           │         setState(() {
│   │   │           │           _bookings = fetchedBookings;
│   │   │           │           _isLoading = false;
│   │   │           │         });
│   │   │           │       } catch (e) {
│   │   │           │         print("Fetch Renter Bookings Error: $e");
│   │   │           │         if (mounted) {
│   │   │           │           setState(() {
│   │   │           │             _isLoading = false;
│   │   │           │             _errorMessage = 'An error occurred: $e';
│   │   │           │           });
│   │   │           │         }
│   │   │           │       }
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Action Handlers ---
│   │   │           │     Future<void> _performCancelBooking(int bookingId, String boatName) async {
│   │   │           │       // Confirmation Dialog
│   │   │           │       final bool? confirm = await showDialog<bool>(
│   │   │           │         context: context,
│   │   │           │         builder: (context) => AlertDialog(
│   │   │           │           title: Text('cancel_booking_confirmation_title'.i18n()),
│   │   │           │           content: Text('cancel_booking_confirmation_message'.i18n([boatName])),
│   │   │           │           actions: [
│   │   │           │             TextButton(
│   │   │           │                 onPressed: () => Navigator.of(context).pop(false),
│   │   │           │                 child: Text('no'.i18n())),
│   │   │           │             TextButton(
│   │   │           │                 onPressed: () => Navigator.of(context).pop(true),
│   │   │           │                 child: Text('yes_cancel'.i18n()),
│   │   │           │                 style: TextButton.styleFrom(foregroundColor: Colors.red)),
│   │   │           │           ],
│   │   │           │         ),
│   │   │           │       );
│   │   │           │   
│   │   │           │       if (confirm != true) return;
│   │   │           │   
│   │   │           │       setState(() => _isCancellingAction[bookingId] = true);
│   │   │           │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │           │       if (accessToken == null) {
│   │   │           │         if (mounted)
│   │   │           │           _showSnackBar(context, "Authentication Error", isError: true);
│   │   │           │         setState(() => _isCancellingAction.remove(bookingId));
│   │   │           │         return;
│   │   │           │       }
│   │   │           │   
│   │   │           │       final success = await _bookingController.cancelBooking(
│   │   │           │         bookingId,
│   │   │           │       );
│   │   │           │       if (!mounted) return;
│   │   │           │   
│   │   │           │       if (success != null) {
│   │   │           │         _showSnackBar(context, 'Booking cancelled successfully.');
│   │   │           │         await _fetchBookings(); // Refresh list
│   │   │           │       } else {
│   │   │           │         _showSnackBar(context, 'Failed to cancel booking (already processed?).',
│   │   │           │             isError: true);
│   │   │           │       }
│   │   │           │       setState(() => _isCancellingAction.remove(bookingId));
│   │   │           │     }
│   │   │           │   
│   │   │           │     @override
│   │   │           │     Widget build(BuildContext context) {
│   │   │           │       return Scaffold(
│   │   │           │         resizeToAvoidBottomInset: false,
│   │   │           │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │           │         appBar: _buildAppBar(context),
│   │   │           │         body: _buildBodyContent(), // Delegate body building
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Build Body based on State ---
│   │   │           │     Widget _buildBodyContent() {
│   │   │           │       if (_isLoading) {
│   │   │           │         return const Center(child: CircularProgressIndicator());
│   │   │           │       }
│   │   │           │       if (_errorMessage != null) {
│   │   │           │         return Center(
│   │   │           │             child: Padding(
│   │   │           │                 padding: const EdgeInsets.all(20.0),
│   │   │           │                 child: Column(
│   │   │           │                   mainAxisSize: MainAxisSize.min,
│   │   │           │                   children: [
│   │   │           │                     Text(_errorMessage!,
│   │   │           │                         textAlign: TextAlign.center,
│   │   │           │                         style: TextStyle(color: Colors.red.shade700)),
│   │   │           │                     const SizedBox(height: 16),
│   │   │           │                     ElevatedButton(
│   │   │           │                         onPressed: _fetchBookings, child: const Text('Retry'))
│   │   │           │                   ],
│   │   │           │                 )));
│   │   │           │       }
│   │   │           │       if (_bookings.isEmpty) {
│   │   │           │         return _buildEmptyBookingList(); // Show empty state
│   │   │           │       }
│   │   │           │   
│   │   │           │       // Display Booking List
│   │   │           │       return _buildBookingGridList();
│   │   │           │     }
│   │   │           │   
│   │   │           │     // Keep AppBar and SearchBar structure from previous UI code
│   │   │           │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │           │       return AppBar(
│   │   │           │         title: Text('list_bookings_title_appbar'.i18n(),
│   │   │           │             style: const TextStyle(fontWeight: FontWeight.w700)),
│   │   │           │         centerTitle: true,
│   │   │           │         elevation: 2,
│   │   │           │         backgroundColor: Colors.white,
│   │   │           │         iconTheme: IconThemeData(color: Theme.of(context).colorScheme.primary),
│   │   │           │         actions: [
│   │   │           │           IconButton(
│   │   │           │             icon: const Icon(Icons.filter_alt_outlined, size: 28),
│   │   │           │             tooltip: 'filter_bookings_tooltip'.i18n(),
│   │   │           │             onPressed: () => _showFilterOptions(context),
│   │   │           │           ),
│   │   │           │         ],
│   │   │           │         bottom: PreferredSize(
│   │   │           │           preferredSize: const Size.fromHeight(70.0),
│   │   │           │           child: Padding(
│   │   │           │             padding: const EdgeInsets.symmetric(horizontal: 16.0, vertical: 12.0),
│   │   │           │             child: _buildSearchBar(),
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildSearchBar() {
│   │   │           │       return TextField(
│   │   │           │         decoration: InputDecoration(
│   │   │           │           hintText: 'search_bookings_hint'.i18n(),
│   │   │           │           prefixIcon:
│   │   │           │               Icon(Icons.search, color: Theme.of(context).colorScheme.primary),
│   │   │           │           filled: true,
│   │   │           │           fillColor: Colors.grey.shade50,
│   │   │           │           border: OutlineInputBorder(
│   │   │           │             borderRadius: BorderRadius.circular(25),
│   │   │           │             borderSide: BorderSide.none,
│   │   │           │           ),
│   │   │           │           enabledBorder: OutlineInputBorder(
│   │   │           │             borderRadius: BorderRadius.circular(25),
│   │   │           │             borderSide: BorderSide(color: Colors.grey.shade300, width: 1),
│   │   │           │           ), // Keep subtle border
│   │   │           │           focusedBorder: OutlineInputBorder(
│   │   │           │             borderRadius: BorderRadius.circular(25),
│   │   │           │             borderSide:
│   │   │           │                 BorderSide(color: Theme.of(context).primaryColor, width: 1.5),
│   │   │           │           ), // Highlight on focus
│   │   │           │           contentPadding:
│   │   │           │               const EdgeInsets.symmetric(horizontal: 20, vertical: 14),
│   │   │           │         ),
│   │   │           │         onChanged: (value) {
│   │   │           │           setState(() => _searchQuery = value);
│   │   │           │         },
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildEmptyBookingList() {
│   │   │           │       // Using the empty state from your previous renter-list UI code
│   │   │           │       return Center(
│   │   │           │         child: Padding(
│   │   │           │           padding: const EdgeInsets.symmetric(horizontal: 40.0),
│   │   │           │           child: Column(
│   │   │           │             mainAxisAlignment: MainAxisAlignment.center,
│   │   │           │             children: [
│   │   │           │               // _buildAppLogo(), // Consider adding a relevant icon
│   │   │           │               const Icon(Icons.event_note_outlined, size: 80, color: Colors.grey),
│   │   │           │               const SizedBox(height: 30),
│   │   │           │               Text(
│   │   │           │                 'no_bookings_message'.i18n(), // Message for renter's empty list
│   │   │           │                 style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │           │                     color: AppColors.subtleTextColor,
│   │   │           │                     fontWeight: FontWeight.w500),
│   │   │           │                 textAlign: TextAlign.center,
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 30),
│   │   │           │               ElevatedButton.icon(
│   │   │           │                 onPressed: () {
│   │   │           │                   // Navigate to Find Boats Screen (or Home Screen)
│   │   │           │                   // Example: Navigate to Home
│   │   │           │                   Navigator.pushAndRemoveUntil(
│   │   │           │                       context,
│   │   │           │                       MaterialPageRoute(
│   │   │           │                           builder: (_) =>
│   │   │           │                               const HomeScreen()), // Replace with appropriate screen
│   │   │           │                       (route) => false);
│   │   │           │                   _showSnackBar(context, 'browse_boats_message'.i18n());
│   │   │           │                 },
│   │   │           │                 icon: const Icon(Icons.search_rounded),
│   │   │           │                 label: Text('find_boats_button'.i18n(),
│   │   │           │                     style: const TextStyle(
│   │   │           │                         fontSize: 16, fontWeight: FontWeight.w600)),
│   │   │           │                 style: ElevatedButton.styleFrom(
│   │   │           │                   padding:
│   │   │           │                       const EdgeInsets.symmetric(horizontal: 30, vertical: 16),
│   │   │           │                   shape: RoundedRectangleBorder(
│   │   │           │                       borderRadius: BorderRadius.circular(15)),
│   │   │           │                   elevation: 2,
│   │   │           │                 ),
│   │   │           │               ),
│   │   │           │             ],
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildBookingGridList() {
│   │   │           │       // Filter bookings based on search query and status filter
│   │   │           │       List<Booking> filteredBookings = _bookings.where((booking) {
│   │   │           │         final boatNameLower =
│   │   │           │             (booking.boatName ?? booking.boat?.name ?? '').toLowerCase();
│   │   │           │         // Optionally search renter email if needed, but typically not relevant for renter's own list
│   │   │           │         // final renterEmailLower = (booking.renterEmail ?? booking.renter?.email ?? '').toLowerCase();
│   │   │           │         final queryLower = _searchQuery.toLowerCase();
│   │   │           │         bool nameMatch = boatNameLower.contains(queryLower);
│   │   │           │         bool statusMatch = _filterStatus == 'all' ||
│   │   │           │             booking.status.toLowerCase() == _filterStatus;
│   │   │           │   
│   │   │           │         return nameMatch && statusMatch;
│   │   │           │       }).toList();
│   │   │           │   
│   │   │           │       if (filteredBookings.isEmpty && _searchQuery.isNotEmpty) {
│   │   │           │         return const Center(
│   │   │           │             child: Text("No bookings found matching your search."));
│   │   │           │       }
│   │   │           │       if (filteredBookings.isEmpty && _filterStatus != 'all') {
│   │   │           │         return const Center(
│   │   │           │             child: Text("No bookings found with the selected status."));
│   │   │           │       }
│   │   │           │   
│   │   │           │       // Use the fetched and filtered list
│   │   │           │       return GridView.builder(
│   │   │           │         padding: const EdgeInsets.all(11.0),
│   │   │           │         gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
│   │   │           │           crossAxisCount: 1, // Keep 1 column layout for list view
│   │   │           │           crossAxisSpacing: 16,
│   │   │           │           mainAxisSpacing: 16,
│   │   │           │           childAspectRatio: 1.8, // Increased from 1.6 to provide more height
│   │   │           │         ),
│   │   │           │         itemCount: filteredBookings.length,
│   │   │           │         itemBuilder: (context, index) {
│   │   │           │           final booking = filteredBookings[index];
│   │   │           │           return _buildFancyBookingCard(context, booking);
│   │   │           │         },
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Updated Fancy Booking Card for Renter Actions ---
│   │   │           │     Widget _buildFancyBookingCard(BuildContext context, Booking booking) {
│   │   │           │       bool canCancel =
│   │   │           │           booking.status == 'PENDING' || booking.status == 'CONFIRMED';
│   │   │           │       bool isProcessing = _isCancellingAction[booking.id] ?? false;
│   │   │           │   
│   │   │           │       return Card(
│   │   │           │         elevation: 3,
│   │   │           │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │   │           │         child: Padding(
│   │   │           │           padding: const EdgeInsets.all(12.0),
│   │   │           │           child: Column(
│   │   │           │             mainAxisSize: MainAxisSize.min, // Use minimum required space
│   │   │           │             crossAxisAlignment: CrossAxisAlignment.start,
│   │   │           │             children: [
│   │   │           │               ListTile(
│   │   │           │                 contentPadding: EdgeInsets.zero,
│   │   │           │                 leading: ClipRRect(
│   │   │           │                   borderRadius: BorderRadius.circular(12),
│   │   │           │                   child: Image.network(
│   │   │           │                     booking.boatImageUrl ??
│   │   │           │                         booking.boat?.mainImageUrl ??
│   │   │           │                         'https://placehold.co/70x70/E0E0E0/BDBDBD?text=N/A', // Fallback
│   │   │           │                     width: 70, height: 70, fit: BoxFit.cover,
│   │   │           │                     errorBuilder: (context, error, stackTrace) => const Icon(
│   │   │           │                         Icons.broken_image,
│   │   │           │                         size: 50,
│   │   │           │                         color: Colors.grey),
│   │   │           │                   ),
│   │   │           │                 ),
│   │   │           │                 title: Text(
│   │   │           │                     booking.boatName ?? booking.boat?.name ?? 'Unknown Boat',
│   │   │           │                     style: Theme.of(context)
│   │   │           │                         .textTheme
│   │   │           │                         .titleMedium
│   │   │           │                         ?.copyWith(fontWeight: FontWeight.w700)),
│   │   │           │                 subtitle:
│   │   │           │                     Text('${'booking_id_label'.i18n()}: ${booking.bookingId}'),
│   │   │           │               ),
│   │   │           │               Padding(
│   │   │           │                 padding: const EdgeInsets.only(left: 16.0, top: 8.0, bottom: 8.0),
│   │   │           │                 child: Column(
│   │   │           │                   crossAxisAlignment: CrossAxisAlignment.start,
│   │   │           │                   children: [
│   │   │           │                     RichText(
│   │   │           │                       text: TextSpan(
│   │   │           │                         style: Theme.of(context).textTheme.bodyLarge?.copyWith(
│   │   │           │                             color: Theme.of(context).textTheme.bodyLarge?.color ??
│   │   │           │                                 Colors.black87),
│   │   │           │                         children: <TextSpan>[
│   │   │           │                           TextSpan(
│   │   │           │                               text: '${'date_range_label'.i18n()}: ',
│   │   │           │                               style:
│   │   │           │                                   const TextStyle(fontWeight: FontWeight.bold)),
│   │   │           │                           TextSpan(
│   │   │           │                               text:
│   │   │           │                                   '${_formatDate(booking.startDate)} - ${_formatDate(booking.endDate)}'),
│   │   │           │                         ],
│   │   │           │                       ),
│   │   │           │                     ),
│   │   │           │                     const SizedBox(height: 8),
│   │   │           │                     _buildStatusBadge(booking.status, context),
│   │   │           │                   ],
│   │   │           │                 ),
│   │   │           │               ),
│   │   │           │               const Spacer(), // Pushes buttons to the bottom
│   │   │           │               // --- Renter Action Buttons ---
│   │   │           │               Row(
│   │   │           │                 mainAxisAlignment: MainAxisAlignment.end,
│   │   │           │                 children: [
│   │   │           │                   if (canCancel) // Show Cancel button if applicable
│   │   │           │                     OutlinedButton.icon(
│   │   │           │                       onPressed: isProcessing
│   │   │           │                           ? null
│   │   │           │                           : () => _performCancelBooking(
│   │   │           │                               booking.id,
│   │   │           │                               booking.boatName ??
│   │   │           │                                   booking.boat?.name ??
│   │   │           │                                   'this boat'),
│   │   │           │                       icon: isProcessing
│   │   │           │                           ? const SizedBox(
│   │   │           │                               width: 16,
│   │   │           │                               height: 16,
│   │   │           │                               child: CircularProgressIndicator(
│   │   │           │                                   strokeWidth: 2, color: Colors.redAccent))
│   │   │           │                           : const Icon(Icons.cancel_rounded, size: 18),
│   │   │           │                       label: Text('cancel_booking_button'.i18n()),
│   │   │           │                       style: OutlinedButton.styleFrom(
│   │   │           │                         foregroundColor: Colors.redAccent,
│   │   │           │                         side: BorderSide(color: Colors.redAccent.shade200),
│   │   │           │                         shape: RoundedRectangleBorder(
│   │   │           │                             borderRadius: BorderRadius.circular(12)),
│   │   │           │                         disabledForegroundColor: Colors.grey.withOpacity(0.7),
│   │   │           │                         padding: const EdgeInsets.symmetric(
│   │   │           │                             horizontal: 10, vertical: 8),
│   │   │           │                       ),
│   │   │           │                     ),
│   │   │           │                   if (canCancel) const SizedBox(width: 8),
│   │   │           │                   TextButton.icon(
│   │   │           │                     onPressed: () {
│   │   │           │                       Navigator.push(
│   │   │           │                         context,
│   │   │           │                         MaterialPageRoute(
│   │   │           │                             builder: (_) =>
│   │   │           │                                 BookingDetailsScreen(bookingId: booking.id)),
│   │   │           │                       );
│   │   │           │                     },
│   │   │           │                     icon: const Icon(Icons.visibility_rounded, size: 18),
│   │   │           │                     label: Text('view_details_button'.i18n()),
│   │   │           │                     style: TextButton.styleFrom(
│   │   │           │                       foregroundColor: Theme.of(context).colorScheme.primary,
│   │   │           │                       padding:
│   │   │           │                           const EdgeInsets.symmetric(horizontal: 10, vertical: 8),
│   │   │           │                     ),
│   │   │           │                   ),
│   │   │           │                 ],
│   │   │           │               ),
│   │   │           │             ],
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // Keep Status Badge, Filter Options, Date Formatter, SnackBar
│   │   │           │     Widget _buildStatusBadge(String status, BuildContext context) {
│   │   │           │       // ... (same implementation as owner list, using string comparison) ...
│   │   │           │       Color badgeColor;
│   │   │           │       Color textColor;
│   │   │           │       switch (status) {
│   │   │           │         case 'PENDING':
│   │   │           │           badgeColor = Colors.orange.shade100;
│   │   │           │           textColor = Colors.orange.shade800;
│   │   │           │           break;
│   │   │           │         case 'CONFIRMED':
│   │   │           │           badgeColor = Colors.green.shade100;
│   │   │           │           textColor = Colors.green.shade800;
│   │   │           │           break;
│   │   │           │         case 'REJECTED':
│   │   │           │         case 'CANCELLED_OWNER':
│   │   │           │         case 'CANCELLED_RENTER':
│   │   │           │           badgeColor = Colors.red.shade100;
│   │   │           │           textColor = Colors.red.shade800;
│   │   │           │           break;
│   │   │           │         case 'COMPLETED':
│   │   │           │           badgeColor = Colors.blue.shade100;
│   │   │           │           textColor = Colors.blue.shade800;
│   │   │           │           break;
│   │   │           │         default:
│   │   │           │           badgeColor = Colors.grey.shade200;
│   │   │           │           textColor = Colors.grey.shade800;
│   │   │           │       }
│   │   │           │       String displayStatus =
│   │   │           │           status.replaceAll('_', ' ').toLowerCase().capitalizeFirst ?? status;
│   │   │           │       return Container(
│   │   │           │           padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
│   │   │           │           decoration: BoxDecoration(
│   │   │           │               color: badgeColor,
│   │   │           │               borderRadius: BorderRadius.circular(20),
│   │   │           │               boxShadow: [
│   │   │           │                 BoxShadow(
│   │   │           │                     color: badgeColor.withOpacity(0.5),
│   │   │           │                     blurRadius: 4,
│   │   │           │                     offset: const Offset(0, 2))
│   │   │           │               ]),
│   │   │           │           child: Text(
│   │   │           │             displayStatus,
│   │   │           │             style: TextStyle(
│   │   │           │               color: textColor,
│   │   │           │               fontWeight: FontWeight.w600,
│   │   │           │               fontSize: 13,
│   │   │           │             ),
│   │   │           │           ));
│   │   │           │     }
│   │   │           │   
│   │   │           │     void _showFilterOptions(BuildContext context) {
│   │   │           │       // ... (same filter options as owner list) ...
│   │   │           │       showModalBottomSheet(
│   │   │           │         context: context,
│   │   │           │         shape: const RoundedRectangleBorder(
│   │   │           │             borderRadius: BorderRadius.vertical(top: Radius.circular(25.0))),
│   │   │           │         builder: (BuildContext context) {
│   │   │           │           return Padding(
│   │   │           │             padding: const EdgeInsets.symmetric(vertical: 16.0),
│   │   │           │             child: Column(
│   │   │           │               mainAxisSize: MainAxisSize.min,
│   │   │           │               children: <Widget>[
│   │   │           │                 ListTile(
│   │   │           │                     title: Text('filter_all_status'.i18n()),
│   │   │           │                     onTap: () {
│   │   │           │                       setState(() => _filterStatus = 'all');
│   │   │           │                       Navigator.pop(context);
│   │   │           │                     }),
│   │   │           │                 ListTile(
│   │   │           │                     title: Text('filter_pending_status'.i18n()),
│   │   │           │                     onTap: () {
│   │   │           │                       setState(() => _filterStatus = 'pending');
│   │   │           │                       Navigator.pop(context);
│   │   │           │                     }),
│   │   │           │                 ListTile(
│   │   │           │                     title: Text('filter_confirmed_status'.i18n()),
│   │   │           │                     onTap: () {
│   │   │           │                       setState(() => _filterStatus = 'confirmed');
│   │   │           │                       Navigator.pop(context);
│   │   │           │                     }),
│   │   │           │                 ListTile(
│   │   │           │                     title: Text('filter_cancelled_status'.i18n()),
│   │   │           │                     onTap: () {
│   │   │           │                       setState(() => _filterStatus = 'cancelled_renter');
│   │   │           │                       Navigator.pop(context);
│   │   │           │                     }), // Adjust filter value if needed
│   │   │           │                 ListTile(
│   │   │           │                     title: Text('filter_rejected_status'.i18n()),
│   │   │           │                     onTap: () {
│   │   │           │                       setState(() => _filterStatus = 'rejected');
│   │   │           │                       Navigator.pop(context);
│   │   │           │                     }),
│   │   │           │                 ListTile(
│   │   │           │                     title: Text('filter_completed_status'.i18n()),
│   │   │           │                     onTap: () {
│   │   │           │                       setState(() => _filterStatus = 'completed');
│   │   │           │                       Navigator.pop(context);
│   │   │           │                     }),
│   │   │           │               ],
│   │   │           │             ),
│   │   │           │           );
│   │   │           │         },
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     String _formatDate(DateTime date) {
│   │   │           │       return "${date.day}/${date.month}/${date.year}";
│   │   │           │     }
│   │   │           │   
│   │   │           │     void _showSnackBar(BuildContext context, String message,
│   │   │           │         {bool isError = false}) {
│   │   │           │       if (isError) {
│   │   │           │         SnackBarUtil.showErrorSnackBar(message: '', title: '');
│   │   │           │       } else {
│   │   │           │         SnackBarUtil.showSuccessSnackBar(message: '', title: '');
│   │   │           │       }
│   │   │           │     }
│   │   │           │   }
│   │   ├── chat/
│   │   │   ├── details/
│   │   │   │   └── screen.dart
│   │   │   │       │   // lib/features/chat/chat_screen.dart
│   │   │   │       │   import 'dart:async';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:app/services/chat.dart'; // Correct service import
│   │   │   │       │   import 'package:app/models/message.dart'; // Correct model import
│   │   │   │       │   import 'package:app/app/theme.dart'; // Assuming AppColors is here
│   │   │   │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart';
│   │   │   │       │   import 'package:flutter_animate/flutter_animate.dart';
│   │   │   │       │   import 'package:localization/localization.dart';
│   │   │   │       │   
│   │   │   │       │   // Import your way of getting the access token and current user ID
│   │   │   │       │   // import 'package:app/services/auth_service.dart'; // Example
│   │   │   │       │   
│   │   │   │       │   class ChatScreen extends StatefulWidget {
│   │   │   │       │     final int roomId;
│   │   │   │       │     final String chatPartnerName; // To display in AppBar
│   │   │   │       │   
│   │   │   │       │     const ChatScreen({
│   │   │   │       │       super.key,
│   │   │   │       │       required this.roomId,
│   │   │   │       │       required this.chatPartnerName,
│   │   │   │       │     });
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<ChatScreen> createState() => _ChatScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   class _ChatScreenState extends State<ChatScreen> {
│   │   │   │       │     final ChatService _chatService = ChatService();
│   │   │   │       │     final TextEditingController _messageController = TextEditingController();
│   │   │   │       │     final ScrollController _scrollController = ScrollController();
│   │   │   │       │     final _storage = const FlutterSecureStorage();
│   │   │   │       │     String? _accessToken; // Fetched in initState
│   │   │   │       │     int? _currentUserId; // Fetched in initState
│   │   │   │       │   
│   │   │   │       │     StreamSubscription? _errorSubscription;
│   │   │   │       │     bool _initialLoadComplete = false; // Track if initial history load is done
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       _initializeChat();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Future<void> _initializeChat() async {
│   │   │   │       │       // --- Fetch Auth Details ---
│   │   │   │       │       // Replace with your actual secure token/user ID retrieval
│   │   │   │       │       _accessToken = await _storage.read(key: 'accessToken');
│   │   │   │       │       // Example: Fetch user ID if stored separately
│   │   │   │       │       // final userIdString = await _storage.read(key: 'userId');
│   │   │   │       │       // _currentUserId = int.tryParse(userIdString ?? '');
│   │   │   │       │       _currentUserId = 1; // !! Placeholder - Replace with actual user ID !!
│   │   │   │       │   
│   │   │   │       │       if (_accessToken == null || _currentUserId == null) {
│   │   │   │       │         if (mounted) {
│   │   │   │       │           _showSnackBar(context, "Authentication error. Please log in again.",
│   │   │   │       │               isError: true);
│   │   │   │       │           Navigator.pop(context); // Go back if essential info is missing
│   │   │   │       │         }
│   │   │   │       │         return;
│   │   │   │       │       }
│   │   │   │       │       // --- End Fetch Auth Details ---
│   │   │   │       │   
│   │   │   │       │       // Connect ChatService
│   │   │   │       │       await _chatService.connect(widget.roomId, _accessToken!);
│   │   │   │       │       if (mounted) setState(() => _initialLoadComplete = true);
│   │   │   │       │   
│   │   │   │       │       // Listen for errors on the message stream
│   │   │   │       │       _errorSubscription = _chatService.messagesStream.handleError((error) {
│   │   │   │       │         if (mounted) {
│   │   │   │       │           print("Chat Stream Error: $error");
│   │   │   │       │           _showSnackBar(context, "Chat connection error. Please try again later.",
│   │   │   │       │               isError: true);
│   │   │   │       │           // Optionally try to reconnect or handle specific errors
│   │   │   │       │         }
│   │   │   │       │       }).listen((_) {
│   │   │   │       │         // Listen to messages arriving to potentially trigger scroll
│   │   │   │       │         // (though reverse=true handles most cases)
│   │   │   │       │         // _scrollToBottomIfNeeded();
│   │   │   │       │       });
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       _chatService.dispose(); // Crucial: Disconnects WebSocket, closes streams
│   │   │   │       │       _messageController.dispose();
│   │   │   │       │       _scrollController.dispose();
│   │   │   │       │       _errorSubscription?.cancel();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     void _sendMessage() {
│   │   │   │       │       if (_messageController.text.trim().isNotEmpty && _chatService.isConnected) {
│   │   │   │       │         _chatService.sendMessage(_messageController.text.trim());
│   │   │   │       │         _messageController.clear();
│   │   │   │       │         // Scroll to top of reversed list after sending
│   │   │   │       │         WidgetsBinding.instance.addPostFrameCallback((_) {
│   │   │   │       │           if (_scrollController.hasClients) {
│   │   │   │       │             _scrollController.animateTo(
│   │   │   │       │               0.0,
│   │   │   │       │               duration: const Duration(milliseconds: 400),
│   │   │   │       │               curve: Curves.easeOutQuad,
│   │   │   │       │             );
│   │   │   │       │           }
│   │   │   │       │         });
│   │   │   │       │       } else if (!_chatService.isConnected) {
│   │   │   │       │         _showSnackBar(context, "Cannot send message: Not connected.",
│   │   │   │       │             isError: true);
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       return Scaffold(
│   │   │   │       │         appBar: AppBar(
│   │   │   │       │           title: Text(widget.chatPartnerName),
│   │   │   │       │           backgroundColor: Colors.white,
│   │   │   │       │           foregroundColor: AppColors.primary,
│   │   │   │       │           elevation: 0.5,
│   │   │   │       │           centerTitle: true,
│   │   │   │       │           actions: [
│   │   │   │       │             // Loading indicator during initial history fetch
│   │   │   │       │             StreamBuilder<List<Message>>(
│   │   │   │       │                 stream: _chatService.messagesStream,
│   │   │   │       │                 builder: (context, snapshot) {
│   │   │   │       │                   if (_chatService.isLoadingHistory) {
│   │   │   │       │                     return const Padding(
│   │   │   │       │                       padding: EdgeInsets.symmetric(horizontal: 16.0),
│   │   │   │       │                       child: Center(
│   │   │   │       │                           child: SizedBox(
│   │   │   │       │                               width: 18,
│   │   │   │       │                               height: 18,
│   │   │   │       │                               child: CircularProgressIndicator(strokeWidth: 2))),
│   │   │   │       │                     );
│   │   │   │       │                   }
│   │   │   │       │                   return const SizedBox.shrink();
│   │   │   │       │                 }),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │         backgroundColor: AppColors.scaffoldBackgroundColor, // Light background
│   │   │   │       │         body: Column(
│   │   │   │       │           children: [
│   │   │   │       │             Expanded(
│   │   │   │       │               child: StreamBuilder<List<Message>>(
│   │   │   │       │                 stream: _chatService.messagesStream,
│   │   │   │       │                 builder: (context, snapshot) {
│   │   │   │       │                   // Show loading indicator ONLY during the initial history fetch phase
│   │   │   │       │                   if (!_initialLoadComplete && _chatService.isLoadingHistory) {
│   │   │   │       │                     return Center(
│   │   │   │       │                         child:
│   │   │   │       │                             const CircularProgressIndicator().animate().fadeIn());
│   │   │   │       │                   }
│   │   │   │       │                   // Show error message if stream reports an error AFTER initial load attempt
│   │   │   │       │                   if (snapshot.hasError && _initialLoadComplete) {
│   │   │   │       │                     return Center(
│   │   │   │       │                         child: Text('Error loading messages: ${snapshot.error}'));
│   │   │   │       │                   }
│   │   │   │       │                   // Handle empty state only AFTER initial load is complete
│   │   │   │       │                   if ((!snapshot.hasData || snapshot.data!.isEmpty) &&
│   │   │   │       │                       _initialLoadComplete) {
│   │   │   │       │                     return Center(
│   │   │   │       │                         child: Column(
│   │   │   │       │                       mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │                       children: [
│   │   │   │       │                         Icon(Icons.chat_bubble_outline_rounded,
│   │   │   │       │                             size: 60, color: Colors.grey[400]),
│   │   │   │       │                         const SizedBox(height: 16),
│   │   │   │       │                         Text('no_messages_yet'.i18n(),
│   │   │   │       │                             style: TextStyle(color: Colors.grey[600])),
│   │   │   │       │                       ],
│   │   │   │       │                     ).animate().fadeIn(delay: 200.ms));
│   │   │   │       │                   }
│   │   │   │       │                   // Show messages (or loading indicator if history hasn't arrived yet but WS is connecting)
│   │   │   │       │                   if (!snapshot.hasData && !_initialLoadComplete) {
│   │   │   │       │                     return Center(
│   │   │   │       │                         child:
│   │   │   │       │                             const CircularProgressIndicator().animate().fadeIn());
│   │   │   │       │                   }
│   │   │   │       │   
│   │   │   │       │                   final messages =
│   │   │   │       │                       snapshot.data ?? []; // Use fetched data or empty list
│   │   │   │       │   
│   │   │   │       │                   // ListView displays messages in reverse order (newest at bottom visually)
│   │   │   │       │                   return ListView.builder(
│   │   │   │       │                     controller: _scrollController,
│   │   │   │       │                     reverse: true, // Crucial for chat UI
│   │   │   │       │                     itemCount: messages.length,
│   │   │   │       │                     padding: const EdgeInsets.symmetric(
│   │   │   │       │                         vertical: 16.0, horizontal: 10.0),
│   │   │   │       │                     itemBuilder: (context, index) {
│   │   │   │       │                       final message = messages[index];
│   │   │   │       │                       // Ensure _currentUserId is available before checking isMe
│   │   │   │       │                       final bool isMe = (_currentUserId != null) &&
│   │   │   │       │                           (message.sender?.id == _currentUserId);
│   │   │   │       │   
│   │   │   │       │                       // Animate each message bubble using flutter_animate
│   │   │   │       │                       return _buildMessageBubble(message, isMe)
│   │   │   │       │                           .animate()
│   │   │   │       │                           .fadeIn(duration: 400.ms, delay: 50.ms)
│   │   │   │       │                           .slideY(begin: 0.2, curve: Curves.easeOutQuad);
│   │   │   │       │                     },
│   │   │   │       │                   );
│   │   │   │       │                 },
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             _buildMessageInputField(), // Input field area at the bottom
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Message Bubble Widget ---
│   │   │   │       │     Widget _buildMessageBubble(Message message, bool isMe) {
│   │   │   │       │       final theme = Theme.of(context);
│   │   │   │       │       return Container(
│   │   │   │       │         margin: const EdgeInsets.symmetric(
│   │   │   │       │             vertical: 6.0), // Increased vertical margin
│   │   │   │       │         child: Row(
│   │   │   │       │           mainAxisAlignment:
│   │   │   │       │               isMe ? MainAxisAlignment.end : MainAxisAlignment.start,
│   │   │   │       │           crossAxisAlignment: CrossAxisAlignment.end,
│   │   │   │       │           children: [
│   │   │   │       │             // Avatar for the other user
│   │   │   │       │             if (!isMe)
│   │   │   │       │               Padding(
│   │   │   │       │                 padding: const EdgeInsets.only(right: 8.0, bottom: 2),
│   │   │   │       │                 child: CircleAvatar(
│   │   │   │       │                   radius: 16,
│   │   │   │       │                   backgroundColor: AppColors.secondary.withOpacity(0.2),
│   │   │   │       │                   // TODO: Replace with actual user avatar URL
│   │   │   │       │                   // backgroundImage: NetworkImage(message.sender?.profilePictureUrl ?? ''),
│   │   │   │       │                   child: Text(
│   │   │   │       │                     message.sender?.firstName.isNotEmpty == true
│   │   │   │       │                         ? message.sender!.firstName[0].toUpperCase()
│   │   │   │       │                         : '?', // Fallback initial
│   │   │   │       │                     style: TextStyle(
│   │   │   │       │                         color: AppColors.secondary, fontWeight: FontWeight.bold),
│   │   │   │       │                   ),
│   │   │   │       │                 )
│   │   │   │       │                     .animate()
│   │   │   │       │                     .fadeIn(delay: 100.ms)
│   │   │   │       │                     .scale(begin: Offset(0.8, 0.8)), // Subtle animation
│   │   │   │       │               ),
│   │   │   │       │             // Message Content Bubble
│   │   │   │       │             Flexible(
│   │   │   │       │               // Prevents overflow
│   │   │   │       │               child: Container(
│   │   │   │       │                 padding: const EdgeInsets.symmetric(
│   │   │   │       │                     horizontal: 16.0, vertical: 11.0), // Slightly more padding
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                     color: isMe
│   │   │   │       │                         ? AppColors.primary
│   │   │   │       │                         : Colors.white, // Use primary for "me"
│   │   │   │       │                     borderRadius: BorderRadius.only(
│   │   │   │       │                       topLeft:
│   │   │   │       │                           const Radius.circular(22.0), // More pronounced rounding
│   │   │   │       │                       topRight: const Radius.circular(22.0),
│   │   │   │       │                       bottomLeft: isMe
│   │   │   │       │                           ? const Radius.circular(22.0)
│   │   │   │       │                           : const Radius.circular(6.0), // Different corner
│   │   │   │       │                       bottomRight: isMe
│   │   │   │       │                           ? const Radius.circular(6.0)
│   │   │   │       │                           : const Radius.circular(22.0),
│   │   │   │       │                     ),
│   │   │   │       │                     boxShadow: [
│   │   │   │       │                       // Softer shadow
│   │   │   │       │                       BoxShadow(
│   │   │   │       │                         color: Colors.black.withOpacity(0.08),
│   │   │   │       │                         blurRadius: 10,
│   │   │   │       │                         offset: const Offset(0, 3),
│   │   │   │       │                       )
│   │   │   │       │                     ]),
│   │   │   │       │                 child: Column(
│   │   │   │       │                   // Column for content and timestamp
│   │   │   │       │                   crossAxisAlignment:
│   │   │   │       │                       isMe ? CrossAxisAlignment.end : CrossAxisAlignment.start,
│   │   │   │       │                   mainAxisSize: MainAxisSize.min,
│   │   │   │       │                   children: [
│   │   │   │       │                     Text(
│   │   │   │       │                       message.content,
│   │   │   │       │                       style: TextStyle(
│   │   │   │       │                           color: isMe ? Colors.white : Colors.black87,
│   │   │   │       │                           fontSize: 15.5,
│   │   │   │       │                           height: 1.35), // Slightly increased line height
│   │   │   │       │                     ),
│   │   │   │       │                     Padding(
│   │   │   │       │                       padding: const EdgeInsets.only(top: 5.0),
│   │   │   │       │                       child: Text(
│   │   │   │       │                         _formatTimestamp(message.timestamp),
│   │   │   │       │                         style: TextStyle(
│   │   │   │       │                           color: isMe
│   │   │   │       │                               ? Colors.white.withOpacity(0.7)
│   │   │   │       │                               : Colors.black.withOpacity(0.5),
│   │   │   │       │                           fontSize: 10.5,
│   │   │   │       │                         ),
│   │   │   │       │                       ),
│   │   │   │       │                     ),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             // Spacer for own messages
│   │   │   │       │             if (isMe) const SizedBox(width: 5),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     String _formatTimestamp(DateTime timestamp) {
│   │   │   │       │       // Simple time formatting, consider using 'intl' package for better localization
│   │   │   │       │       return TimeOfDay.fromDateTime(timestamp)
│   │   │   │       │           .format(context); // Use context-aware time format
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Message Input Field Widget ---
│   │   │   │       │     Widget _buildMessageInputField() {
│   │   │   │       │       return Container(
│   │   │   │       │         padding: const EdgeInsets.symmetric(
│   │   │   │       │             horizontal: 12.0, vertical: 10.0), // Slightly more vertical padding
│   │   │   │       │         decoration: BoxDecoration(
│   │   │   │       │           color: Colors.white, // White background for contrast
│   │   │   │       │           boxShadow: [
│   │   │   │       │             BoxShadow(
│   │   │   │       │               offset: const Offset(0, -2),
│   │   │   │       │               blurRadius: 10, // Slightly larger blur
│   │   │   │       │               color: Colors.black.withOpacity(0.06), // Softer shadow
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │         child: SafeArea(
│   │   │   │       │           // Keep input above intrusions
│   │   │   │       │           child: Row(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.center,
│   │   │   │       │             children: [
│   │   │   │       │               // Optional: Attachment Button
│   │   │   │       │               IconButton(
│   │   │   │       │                 icon: Icon(Icons.add_circle_outline_rounded,
│   │   │   │       │                     color: Colors.grey[600]),
│   │   │   │       │                 onPressed: () {/* TODO: Handle attachments */},
│   │   │   │       │                 splashRadius: 22,
│   │   │   │       │                 tooltip: 'Attach File',
│   │   │   │       │               ),
│   │   │   │       │               Expanded(
│   │   │   │       │                 child: ConstrainedBox(
│   │   │   │       │                   // Limit text field height growth
│   │   │   │       │                   constraints: const BoxConstraints(maxHeight: 120),
│   │   │   │       │                   child: TextField(
│   │   │   │       │                     controller: _messageController,
│   │   │   │       │                     textCapitalization: TextCapitalization.sentences,
│   │   │   │       │                     textInputAction:
│   │   │   │       │                         TextInputAction.newline, // Allow newline entry
│   │   │   │       │                     keyboardType: TextInputType.multiline,
│   │   │   │       │                     minLines: 1,
│   │   │   │       │                     maxLines: 5, // Allow reasonable expansion
│   │   │   │       │                     decoration: InputDecoration(
│   │   │   │       │                       hintText: 'Type Message'.i18n(),
│   │   │   │       │                       hintStyle: TextStyle(color: Colors.grey[500]),
│   │   │   │       │                       border: OutlineInputBorder(
│   │   │   │       │                         borderRadius: BorderRadius.circular(25.0),
│   │   │   │       │                         borderSide: BorderSide.none, // No border, rely on fill
│   │   │   │       │                       ),
│   │   │   │       │                       filled: true,
│   │   │   │       │                       fillColor: AppColors.scaffoldBackgroundColor
│   │   │   │       │                           .withOpacity(0.8), // Slightly off-white fill
│   │   │   │       │                       contentPadding: const EdgeInsets.symmetric(
│   │   │   │       │                           horizontal: 16.0, vertical: 12.0),
│   │   │   │       │                     ),
│   │   │   │       │                     onChanged: (_) => setState(
│   │   │   │       │                         () {}), // Trigger rebuild to update send button state
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(width: 8.0),
│   │   │   │       │               // Animated Send Button
│   │   │   │       │               AnimatedSwitcher(
│   │   │   │       │                 duration: 200.ms,
│   │   │   │       │                 transitionBuilder: (child, animation) =>
│   │   │   │       │                     ScaleTransition(scale: animation, child: child),
│   │   │   │       │                 child: IconButton(
│   │   │   │       │                   key: ValueKey(_messageController.text
│   │   │   │       │                       .trim()
│   │   │   │       │                       .isNotEmpty), // Key triggers animation
│   │   │   │       │                   icon: Icon(Icons.send_rounded,
│   │   │   │       │                       color: Theme.of(context).colorScheme.primary),
│   │   │   │       │                   // Enable only if text exists and connected
│   │   │   │       │                   onPressed: _messageController.text.trim().isNotEmpty &&
│   │   │   │       │                           _chatService.isConnected
│   │   │   │       │                       ? _sendMessage
│   │   │   │       │                       : null,
│   │   │   │       │                   tooltip: 'Send Message',
│   │   │   │       │                   splashRadius: 24,
│   │   │   │       │                   padding: EdgeInsets.zero,
│   │   │   │       │                   visualDensity: VisualDensity.compact,
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- SnackBar Utility ---
│   │   │   │       │     void _showSnackBar(BuildContext context, String message,
│   │   │   │       │         {bool isError = false}) {
│   │   │   │       │       ScaffoldMessenger.of(context).removeCurrentSnackBar();
│   │   │   │       │       ScaffoldMessenger.of(context).showSnackBar(
│   │   │   │       │         SnackBar(
│   │   │   │       │           content: Text(message),
│   │   │   │       │           backgroundColor: isError ? Colors.redAccent.shade400 : Colors.black87,
│   │   │   │       │           behavior: SnackBarBehavior.floating,
│   │   │   │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
│   │   │   │       │           margin: const EdgeInsets.all(10), // Add margin
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   // Helper extension if not elsewhere
│   │   │   │       │   // extension StringExtension on String { ... capitalizeFirst ... }
│   │   │   └── list/
│   │   │       └── screen.dart
│   │   │           │   // lib/features/chat/list_screen.dart
│   │   │           │   import 'package:flutter/material.dart';
│   │   │           │   import 'package:app/app/theme.dart'; // Assuming AppColors is here
│   │   │           │   import 'package:localization/localization.dart';
│   │   │           │   import 'package:flutter_secure_storage/flutter_secure_storage.dart';
│   │   │           │   import 'package:flutter_animate/flutter_animate.dart';
│   │   │           │   
│   │   │           │   // --- Import Models, Controller, and Screens ---
│   │   │           │   import 'package:app/controllers/chat.dart'; // Use correct controller name
│   │   │           │   import 'package:app/models/chat_room.dart'; // Use correct model name
│   │   │           │   import 'package:app/features/chat/details/screen.dart'; // Import chat details screen
│   │   │           │   // Import your way of getting current user ID if needed for filtering participants display
│   │   │           │   // import 'package:app/services/auth_service.dart';
│   │   │           │   
│   │   │           │   class ChatListScreen extends StatefulWidget {
│   │   │           │     const ChatListScreen({super.key});
│   │   │           │   
│   │   │           │     @override
│   │   │           │     State<ChatListScreen> createState() => _ChatListScreenState();
│   │   │           │   }
│   │   │           │   
│   │   │           │   class _ChatListScreenState extends State<ChatListScreen> {
│   │   │           │     final ChatController _chatController = ChatController();
│   │   │           │     final _storage = const FlutterSecureStorage();
│   │   │           │     List<ChatRoom> _chatRooms = [];
│   │   │           │     bool _isLoading = true;
│   │   │           │     String? _errorMessage;
│   │   │           │     int? _currentUserId; // Store current user ID to filter display names
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void initState() {
│   │   │           │       super.initState();
│   │   │           │       // TODO: Replace with actual User ID fetching logic
│   │   │           │       _getCurrentUserId(); // Example function call
│   │   │           │       _fetchChatRooms();
│   │   │           │     }
│   │   │           │   
│   │   │           │     // Example function - Replace with your actual logic
│   │   │           │     Future<void> _getCurrentUserId() async {
│   │   │           │       // final userIdString = await _storage.read(key: 'userId');
│   │   │           │       // if (userIdString != null) {
│   │   │           │       //   _currentUserId = int.tryParse(userIdString);
│   │   │           │       // }
│   │   │           │       // Placeholder:
│   │   │           │       _currentUserId = 1; // Replace with actual logged-in user ID retrieval
│   │   │           │     }
│   │   │           │   
│   │   │           │     Future<void> _fetchChatRooms() async {
│   │   │           │       if (!mounted) return;
│   │   │           │       setState(() {
│   │   │           │         _isLoading = true;
│   │   │           │         _errorMessage = null;
│   │   │           │       });
│   │   │           │   
│   │   │           │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │           │       if (accessToken == null || accessToken.isEmpty) {
│   │   │           │         if (mounted) setState(() => _errorMessage = 'Authentication Error.');
│   │   │           │         return;
│   │   │           │       }
│   │   │           │   
│   │   │           │       try {
│   │   │           │         final fetchedRooms = await _chatController.fetchChatRooms(accessToken);
│   │   │           │         if (!mounted) return;
│   │   │           │         setState(() {
│   │   │           │           _chatRooms = fetchedRooms;
│   │   │           │           _isLoading = false;
│   │   │           │         });
│   │   │           │       } catch (e) {
│   │   │           │         print("Fetch Chat Rooms Error: $e");
│   │   │           │         if (mounted) {
│   │   │           │           setState(() {
│   │   │           │             _isLoading = false;
│   │   │           │             _errorMessage = 'Failed to load chats.';
│   │   │           │           });
│   │   │           │         }
│   │   │           │       }
│   │   │           │     }
│   │   │           │   
│   │   │           │     String _getChatPartnerNames(ChatRoom room) {
│   │   │           │       if (_currentUserId == null)
│   │   │           │         return room.name ?? 'Chat Room'; // Fallback if user ID not loaded
│   │   │           │       // Filter out the current user and join remaining names
│   │   │           │       return room.participants
│   │   │           │           .where((user) => user.id != _currentUserId)
│   │   │           │           .map((user) => user.firstName) // Display first name
│   │   │           │           .join(', ');
│   │   │           │     }
│   │   │           │   
│   │   │           │     // Helper to get the first initial of the partner for avatar fallback
│   │   │           │     String _getPartnerInitial(ChatRoom room) {
│   │   │           │       if (_currentUserId == null) return '?';
│   │   │           │       final partner = room.participants.firstWhere(
│   │   │           │         (user) => user.id != _currentUserId,
│   │   │           │         orElse: () =>
│   │   │           │             room.participants.first, // Fallback if only one participant somehow
│   │   │           │       );
│   │   │           │       return partner.firstName.isNotEmpty
│   │   │           │           ? partner.firstName[0].toUpperCase()
│   │   │           │           : '?';
│   │   │           │     }
│   │   │           │   
│   │   │           │     @override
│   │   │           │     Widget build(BuildContext context) {
│   │   │           │       return Scaffold(
│   │   │           │         appBar: AppBar(
│   │   │           │           title: Text('Chats'.i18n()), // Simple title
│   │   │           │           elevation: 1.0,
│   │   │           │           backgroundColor: Colors.white, // Or theme color
│   │   │           │           actions: [
│   │   │           │             IconButton(
│   │   │           │               icon: Icon(Icons.search, color: AppColors.primary),
│   │   │           │               onPressed: () {/* TODO: Implement Search */},
│   │   │           │             ),
│   │   │           │           ],
│   │   │           │         ),
│   │   │           │         backgroundColor:
│   │   │           │             AppColors.scaffoldBackgroundColor, // Use theme background
│   │   │           │         body: _buildBodyContent(),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildBodyContent() {
│   │   │           │       if (_isLoading) {
│   │   │           │         return const Center(child: CircularProgressIndicator());
│   │   │           │       }
│   │   │           │       if (_errorMessage != null) {
│   │   │           │         return Center(
│   │   │           │           child: Padding(
│   │   │           │             padding: const EdgeInsets.all(20.0),
│   │   │           │             child: Column(
│   │   │           │               mainAxisSize: MainAxisSize.min,
│   │   │           │               children: [
│   │   │           │                 Icon(Icons.error_outline, color: Colors.red.shade400, size: 50),
│   │   │           │                 const SizedBox(height: 16),
│   │   │           │                 Text(_errorMessage!,
│   │   │           │                     textAlign: TextAlign.center,
│   │   │           │                     style: TextStyle(color: Colors.red.shade700)),
│   │   │           │                 const SizedBox(height: 16),
│   │   │           │                 ElevatedButton.icon(
│   │   │           │                     onPressed: _fetchChatRooms,
│   │   │           │                     icon: const Icon(Icons.refresh),
│   │   │           │                     label: const Text('Retry')),
│   │   │           │               ],
│   │   │           │             ),
│   │   │           │           ),
│   │   │           │         );
│   │   │           │       }
│   │   │           │       if (_chatRooms.isEmpty) {
│   │   │           │         return Center(
│   │   │           │           child: Column(
│   │   │           │             mainAxisAlignment: MainAxisAlignment.center,
│   │   │           │             children: [
│   │   │           │               Icon(Icons.chat_bubble_outline_rounded,
│   │   │           │                   size: 80, color: Colors.grey[400]),
│   │   │           │               const SizedBox(height: 16),
│   │   │           │               Text(
│   │   │           │                 'No Chat Yet'.i18n(),
│   │   │           │                 style: Theme.of(context)
│   │   │           │                     .textTheme
│   │   │           │                     .titleMedium
│   │   │           │                     ?.copyWith(color: Colors.grey[600]),
│   │   │           │               ),
│   │   │           │             ],
│   │   │           │           ),
│   │   │           │         );
│   │   │           │       }
│   │   │           │   
│   │   │           │       // Display Chat List
│   │   │           │       return RefreshIndicator(
│   │   │           │         onRefresh: _fetchChatRooms,
│   │   │           │         child: ListView.separated(
│   │   │           │           padding: const EdgeInsets.symmetric(vertical: 12.0, horizontal: 8.0),
│   │   │           │           itemCount: _chatRooms.length,
│   │   │           │           separatorBuilder: (context, index) => const Divider(
│   │   │           │               height: 1,
│   │   │           │               indent: 72,
│   │   │           │               endIndent: 16,
│   │   │           │               thickness: 0.5), // Subtle divider
│   │   │           │           itemBuilder: (context, index) {
│   │   │           │             final room = _chatRooms[index];
│   │   │           │             // Animate each list item
│   │   │           │             return _buildChatListItem(room)
│   │   │           │                 .animate()
│   │   │           │                 .fadeIn(
│   │   │           │                     duration: 500.ms,
│   │   │           │                     delay: (100 * index).ms) // Staggered fade-in
│   │   │           │                 .slideX(
│   │   │           │                     begin: -0.1,
│   │   │           │                     duration: 400.ms,
│   │   │           │                     delay: (100 * index).ms,
│   │   │           │                     curve: Curves.easeOut); // Staggered slide-in
│   │   │           │           },
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget _buildChatListItem(ChatRoom room) {
│   │   │           │       String partnerNames = _getChatPartnerNames(room);
│   │   │           │       if (partnerNames.isEmpty)
│   │   │           │         partnerNames = room.name ?? 'Unknown Chat'; // Fallback name
│   │   │           │   
│   │   │           │       String lastMessageContent =
│   │   │           │           room.lastMessage?.content ?? 'No messages yet...';
│   │   │           │       String lastMessageTime = room.lastMessage != null
│   │   │           │           ? _formatTimestampRelative(room.lastMessage!.timestamp)
│   │   │           │           : '';
│   │   │           │       int unreadCount = room.unreadCount;
│   │   │           │   
│   │   │           │       return ListTile(
│   │   │           │         contentPadding:
│   │   │           │             const EdgeInsets.symmetric(vertical: 10.0, horizontal: 16.0),
│   │   │           │         leading: CircleAvatar(
│   │   │           │           radius: 28,
│   │   │           │           backgroundColor: AppColors.primary.withOpacity(0.1),
│   │   │           │           // TODO: Add user avatar logic
│   │   │           │           // backgroundImage: NetworkImage(partnerAvatarUrl),
│   │   │           │           child: Text(
│   │   │           │             _getPartnerInitial(room),
│   │   │           │             style: TextStyle(
│   │   │           │                 fontSize: 20,
│   │   │           │                 fontWeight: FontWeight.bold,
│   │   │           │                 color: AppColors.primary),
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │         title: Text(
│   │   │           │           partnerNames,
│   │   │           │           style: Theme.of(context)
│   │   │           │               .textTheme
│   │   │           │               .titleMedium
│   │   │           │               ?.copyWith(fontWeight: FontWeight.w600),
│   │   │           │           maxLines: 1,
│   │   │           │           overflow: TextOverflow.ellipsis,
│   │   │           │         ),
│   │   │           │         subtitle: Text(
│   │   │           │           lastMessageContent,
│   │   │           │           style: Theme.of(context)
│   │   │           │               .textTheme
│   │   │           │               .bodyMedium
│   │   │           │               ?.copyWith(color: Colors.grey[600]),
│   │   │           │           maxLines: 1,
│   │   │           │           overflow: TextOverflow.ellipsis,
│   │   │           │         ),
│   │   │           │         trailing: Column(
│   │   │           │           mainAxisAlignment: MainAxisAlignment.center,
│   │   │           │           crossAxisAlignment: CrossAxisAlignment.end,
│   │   │           │           children: [
│   │   │           │             Text(
│   │   │           │               lastMessageTime,
│   │   │           │               style: Theme.of(context)
│   │   │           │                   .textTheme
│   │   │           │                   .bodySmall
│   │   │           │                   ?.copyWith(color: Colors.grey[500]),
│   │   │           │             ),
│   │   │           │             const SizedBox(height: 4),
│   │   │           │             if (unreadCount > 0)
│   │   │           │               Container(
│   │   │           │                 padding: const EdgeInsets.symmetric(horizontal: 7, vertical: 3),
│   │   │           │                 decoration: BoxDecoration(
│   │   │           │                   color: AppColors
│   │   │           │                       .primary, // Or a notification color like Colors.red
│   │   │           │                   borderRadius: BorderRadius.circular(12),
│   │   │           │                 ),
│   │   │           │                 child: Text(
│   │   │           │                   unreadCount.toString(),
│   │   │           │                   style: const TextStyle(
│   │   │           │                       color: Colors.white,
│   │   │           │                       fontSize: 11,
│   │   │           │                       fontWeight: FontWeight.bold),
│   │   │           │                 ),
│   │   │           │               ),
│   │   │           │           ],
│   │   │           │         ),
│   │   │           │         onTap: () {
│   │   │           │           Navigator.push(
│   │   │           │             context,
│   │   │           │             MaterialPageRoute(
│   │   │           │               builder: (_) => ChatScreen(
│   │   │           │                 roomId: room.id,
│   │   │           │                 chatPartnerName:
│   │   │           │                     partnerNames, // Pass partner name for AppBar title
│   │   │           │               ),
│   │   │           │             ),
│   │   │           │           ).then(
│   │   │           │               (_) => _fetchChatRooms()); // Refresh list when returning from chat
│   │   │           │         },
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // Helper for relative timestamp formatting
│   │   │           │     String _formatTimestampRelative(DateTime timestamp) {
│   │   │           │       final now = DateTime.now();
│   │   │           │       final difference = now.difference(timestamp);
│   │   │           │   
│   │   │           │       if (difference.inDays > 1) {
│   │   │           │         return "${timestamp.day}/${timestamp.month}"; // Format as DD/MM
│   │   │           │       } else if (difference.inDays == 1 || now.day != timestamp.day) {
│   │   │           │         // Handle yesterday midnight case
│   │   │           │         return 'Yesterday'.i18n();
│   │   │           │       } else {
│   │   │           │         return "${timestamp.hour.toString().padLeft(2, '0')}:${timestamp.minute.toString().padLeft(2, '0')}"; // Format as HH:MM
│   │   │           │       }
│   │   │           │     }
│   │   │           │   
│   │   │           │     void _showSnackBar(BuildContext context, String message,
│   │   │           │         {bool isError = false}) {
│   │   │           │       ScaffoldMessenger.of(context).showSnackBar(
│   │   │           │         SnackBar(
│   │   │           │           content: Text(message),
│   │   │           │           backgroundColor: isError ? Colors.redAccent : Colors.black87,
│   │   │           │           behavior: SnackBarBehavior.floating,
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   }
│   │   ├── general/
│   │   │   ├── about-app/
│   │   │   │   └── screen.dart
│   │   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:app/app/theme.dart';
│   │   │   │       │   import 'package:package_info_plus/package_info_plus.dart';
│   │   │   │       │   
│   │   │   │       │   class AboutAppScreen extends StatefulWidget {
│   │   │   │       │     const AboutAppScreen({super.key});
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<AboutAppScreen> createState() => _AboutAppScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   class _AboutAppScreenState extends State<AboutAppScreen>
│   │   │   │       │       with TickerProviderStateMixin {
│   │   │   │       │     late AnimationController _logoAnimationController;
│   │   │   │       │     late Animation<double> _logoAnimation;
│   │   │   │       │     late AnimationController _cardAnimationController;
│   │   │   │       │     late Animation<double> _cardAnimation;
│   │   │   │       │   
│   │   │   │       │     PackageInfo _packageInfo = PackageInfo(
│   │   │   │       │       appName: 'Qarib',
│   │   │   │       │       packageName: 'com.qarib',
│   │   │   │       │       version: '1.0.0 beta',
│   │   │   │       │       buildNumber: 'Unknown',
│   │   │   │       │       buildSignature: 'Unknown',
│   │   │   │       │     );
│   │   │   │       │   
│   │   │   │       │     final List<Map<String, dynamic>> _teamMembers = [
│   │   │   │       │       {
│   │   │   │       │         'name': 'Lead Developer',
│   │   │   │       │         'role': 'Mobile & Backend',
│   │   │   │       │         'icon': Icons.code_rounded,
│   │   │   │       │       },
│   │   │   │       │       {
│   │   │   │       │         'name': 'UI/UX Designer',
│   │   │   │       │         'role': 'Visual Design',
│   │   │   │       │         'icon': Icons.design_services_rounded,
│   │   │   │       │       },
│   │   │   │       │       {
│   │   │   │       │         'name': 'Product Manager',
│   │   │   │       │         'role': 'Strategy & Planning',
│   │   │   │       │         'icon': Icons.analytics_rounded,
│   │   │   │       │       },
│   │   │   │       │     ];
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       _loadPackageInfo();
│   │   │   │       │   
│   │   │   │       │       // Logo animation setup
│   │   │   │       │       _logoAnimationController = AnimationController(
│   │   │   │       │         duration: const Duration(milliseconds: 1200),
│   │   │   │       │         vsync: this,
│   │   │   │       │       )..forward();
│   │   │   │       │   
│   │   │   │       │       _logoAnimation = CurvedAnimation(
│   │   │   │       │         parent: _logoAnimationController,
│   │   │   │       │         curve: Curves.elasticOut,
│   │   │   │       │       );
│   │   │   │       │   
│   │   │   │       │       // Card animation setup
│   │   │   │       │       _cardAnimationController = AnimationController(
│   │   │   │       │         duration: const Duration(milliseconds: 800),
│   │   │   │       │         vsync: this,
│   │   │   │       │       )..forward();
│   │   │   │       │   
│   │   │   │       │       _cardAnimation = CurvedAnimation(
│   │   │   │       │         parent: _cardAnimationController,
│   │   │   │       │         curve: Curves.easeOutQuart,
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Future<void> _loadPackageInfo() async {
│   │   │   │       │       final PackageInfo info = await PackageInfo.fromPlatform();
│   │   │   │       │       setState(() {
│   │   │   │       │         _packageInfo = info;
│   │   │   │       │       });
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       _logoAnimationController.dispose();
│   │   │   │       │       _cardAnimationController.dispose();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       return Scaffold(
│   │   │   │       │         backgroundColor: AppColors.scaffoldBackgroundColor,
│   │   │   │       │         appBar: _buildAppBar(context),
│   │   │   │       │         body: Container(
│   │   │   │       │           decoration: BoxDecoration(
│   │   │   │       │             gradient: LinearGradient(
│   │   │   │       │               begin: Alignment.topCenter,
│   │   │   │       │               end: Alignment.bottomCenter,
│   │   │   │       │               colors: [
│   │   │   │       │                 AppColors.scaffoldBackgroundColor,
│   │   │   │       │                 AppColors.scaffoldBackgroundColor.withOpacity(0.8),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           child: SingleChildScrollView(
│   │   │   │       │             padding: const EdgeInsets.symmetric(horizontal: 24.0, vertical: 16.0),
│   │   │   │       │             physics: const BouncingScrollPhysics(),
│   │   │   │       │             child: Column(
│   │   │   │       │               crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │               children: <Widget>[
│   │   │   │       │                 _buildAppLogo(context),
│   │   │   │       │                 const SizedBox(height: 40),
│   │   │   │       │                 _buildMissionCard(context),
│   │   │   │       │                 const SizedBox(height: 24),
│   │   │   │       │                 _buildFeaturesCard(context),
│   │   │   │       │                 const SizedBox(height: 24),
│   │   │   │       │                 _buildTeamSection(context),
│   │   │   │       │                 const SizedBox(height: 24),
│   │   │   │       │                 _buildSupportSection(context),
│   │   │   │       │                 const SizedBox(height: 32),
│   │   │   │       │                 _buildFooter(context),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     PreferredSizeWidget _buildAppBar(BuildContext context) => AppBar(
│   │   │   │       │           title: Text(
│   │   │   │       │             'About Qarib',
│   │   │   │       │             style: TextStyle(
│   │   │   │       │               fontWeight: FontWeight.w700,
│   │   │   │       │               fontSize: 18,
│   │   │   │       │               color: Theme.of(context).primaryColor,
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           centerTitle: true,
│   │   │   │       │           elevation: 0,
│   │   │   │       │           backgroundColor: Colors.transparent,
│   │   │   │       │           iconTheme: IconThemeData(color: AppColors.primary),
│   │   │   │       │         );
│   │   │   │       │   
│   │   │   │       │     Widget _buildAppLogo(BuildContext context) {
│   │   │   │       │       return Center(
│   │   │   │       │         child: Column(
│   │   │   │       │           children: [
│   │   │   │       │             ScaleTransition(
│   │   │   │       │               scale: _logoAnimation,
│   │   │   │       │               child: Container(
│   │   │   │       │                 height: 120,
│   │   │   │       │                 width: 120,
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary.withOpacity(0.1),
│   │   │   │       │                   shape: BoxShape.circle,
│   │   │   │       │                 ),
│   │   │   │       │                 child: Center(
│   │   │   │       │                   child: Image.asset('assets/logo.png', width: 64, height: 64),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             const SizedBox(height: 16),
│   │   │   │       │             FadeTransition(
│   │   │   │       │               opacity: _logoAnimation,
│   │   │   │       │               child: Text(
│   │   │   │       │                 _packageInfo.appName.toUpperCase(),
│   │   │   │       │                 style: Theme.of(context).textTheme.headlineMedium?.copyWith(
│   │   │   │       │                       fontWeight: FontWeight.w900,
│   │   │   │       │                       letterSpacing: 1.5,
│   │   │   │       │                       color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                     ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             const SizedBox(height: 8),
│   │   │   │       │             FadeTransition(
│   │   │   │       │               opacity: _logoAnimation,
│   │   │   │       │               child: Text(
│   │   │   │       │                 'Version: ${_packageInfo.version}',
│   │   │   │       │                 style: Theme.of(context).textTheme.bodyLarge?.copyWith(
│   │   │   │       │                       color: Theme.of(context).colorScheme.secondary,
│   │   │   │       │                       fontWeight: FontWeight.w500,
│   │   │   │       │                     ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             const SizedBox(height: 16),
│   │   │   │       │             FadeTransition(
│   │   │   │       │               opacity: _logoAnimation,
│   │   │   │       │               child: Text(
│   │   │   │       │                 'Connecting Boat Owners and Renters for Seamless Sea Adventures',
│   │   │   │       │                 textAlign: TextAlign.center,
│   │   │   │       │                 style: Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │   │       │                       fontWeight: FontWeight.w600,
│   │   │   │       │                       color: Theme.of(context).colorScheme.secondary,
│   │   │   │       │                     ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildMissionCard(BuildContext context) {
│   │   │   │       │       return SlideTransition(
│   │   │   │       │         position: Tween<Offset>(
│   │   │   │       │           begin: const Offset(0, 0.5),
│   │   │   │       │           end: Offset.zero,
│   │   │   │       │         ).animate(_cardAnimation),
│   │   │   │       │         child: FadeTransition(
│   │   │   │       │           opacity: _cardAnimation,
│   │   │   │       │           child: Container(
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               color: Colors.white,
│   │   │   │       │               borderRadius: BorderRadius.circular(24),
│   │   │   │       │               boxShadow: [
│   │   │   │       │                 BoxShadow(
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary.withOpacity(0.2),
│   │   │   │       │                   blurRadius: 10,
│   │   │   │       │                   spreadRadius: 2,
│   │   │   │       │                   offset: const Offset(0, 4),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │             child: Padding(
│   │   │   │       │               padding: const EdgeInsets.all(24.0),
│   │   │   │       │               child: Column(
│   │   │   │       │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                 children: [
│   │   │   │       │                   Text(
│   │   │   │       │                     'Our Mission',
│   │   │   │       │                     style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │   │       │                           fontWeight: FontWeight.w800,
│   │   │   │       │                           color: Theme.of(context).colorScheme.primary,
│   │   │   │       │                         ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   Text(
│   │   │   │       │                     'At Qarib, we believe that exploring the sea should be easy, transparent, and enjoyable. Our mission is to create a thriving community that connects boat owners with those seeking unforgettable on-water experiences.',
│   │   │   │       │                     style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │   │       │                           height: 1.6,
│   │   │   │       │                           fontSize: 16,
│   │   │   │       │                         ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 24),
│   │   │   │       │                   _buildMissionItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.touch_app_rounded,
│   │   │   │       │                     'Simplify Boat Rentals',
│   │   │   │       │                     'We\'ve streamlined the entire process, from searching for the perfect boat to booking your adventure, all within a user-friendly and intuitive mobile application.',
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   _buildMissionItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.verified_user_rounded,
│   │   │   │       │                     'Provide Transparency and Trust',
│   │   │   │       │                     'We believe in empowering you with all the information you need to make informed decisions with detailed specifications, transparent pricing, verified owner profiles, and user reviews.',
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   _buildMissionItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.settings_rounded,
│   │   │   │       │                     'Offer Unparalleled Customization',
│   │   │   │       │                     'Whether you\'re planning a fishing trip with specialized gear, a leisurely sightseeing cruise, or a thrilling watersports adventure, Qarib allows you to customize your rental perfectly.',
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   _buildMissionItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.eco_rounded,
│   │   │   │       │                     'Promote Sustainable Maritime Practices',
│   │   │   │       │                     'We are committed to responsible boating and aim to contribute to a shared economy that benefits both boat owners and renters while encouraging sustainable practices.',
│   │   │   │       │                   ),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildMissionItem(
│   │   │   │       │         BuildContext context, IconData icon, String title, String description) {
│   │   │   │       │       return Row(
│   │   │   │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │         children: [
│   │   │   │       │           Container(
│   │   │   │       │             padding: const EdgeInsets.all(10),
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               color: Theme.of(context).colorScheme.primary.withOpacity(0.1),
│   │   │   │       │               borderRadius: BorderRadius.circular(12),
│   │   │   │       │             ),
│   │   │   │       │             child: Icon(
│   │   │   │       │               icon,
│   │   │   │       │               color: Theme.of(context).colorScheme.primary,
│   │   │   │       │               size: 24,
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(width: 16),
│   │   │   │       │           Expanded(
│   │   │   │       │             child: Column(
│   │   │   │       │               crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │               children: [
│   │   │   │       │                 Text(
│   │   │   │       │                   title,
│   │   │   │       │                   style: Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │   │       │                         fontWeight: FontWeight.w700,
│   │   │   │       │                       ),
│   │   │   │       │                 ),
│   │   │   │       │                 const SizedBox(height: 4),
│   │   │   │       │                 Text(
│   │   │   │       │                   description,
│   │   │   │       │                   style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │   │       │                         color: AppColors.subtleTextColor,
│   │   │   │       │                       ),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildFeaturesCard(BuildContext context) {
│   │   │   │       │       return SlideTransition(
│   │   │   │       │         position: Tween<Offset>(
│   │   │   │       │           begin: const Offset(0, 0.5),
│   │   │   │       │           end: Offset.zero,
│   │   │   │       │         ).animate(_cardAnimation),
│   │   │   │       │         child: FadeTransition(
│   │   │   │       │           opacity: _cardAnimation,
│   │   │   │       │           child: Container(
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               color: Colors.white,
│   │   │   │       │               borderRadius: BorderRadius.circular(24),
│   │   │   │       │               boxShadow: [
│   │   │   │       │                 BoxShadow(
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary.withOpacity(0.2),
│   │   │   │       │                   blurRadius: 10,
│   │   │   │       │                   spreadRadius: 2,
│   │   │   │       │                   offset: const Offset(0, 4),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │             child: Padding(
│   │   │   │       │               padding: const EdgeInsets.all(24.0),
│   │   │   │       │               child: Column(
│   │   │   │       │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                 children: [
│   │   │   │       │                   Text(
│   │   │   │       │                     'What Makes Qarib Different?',
│   │   │   │       │                     style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │   │       │                           fontWeight: FontWeight.w800,
│   │   │   │       │                           color: Theme.of(context).colorScheme.secondary,
│   │   │   │       │                         ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 24),
│   │   │   │       │                   _buildFeatureItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.schedule_rounded,
│   │   │   │       │                     'Real-Time Availability',
│   │   │   │       │                     'Say goodbye to endless phone calls and uncertain bookings! Our platform provides real-time updates on boat availability, ensuring you always have the latest information at your fingertips.',
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   _buildFeatureItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.info_outline_rounded,
│   │   │   │       │                     'Detailed Boat Information',
│   │   │   │       │                     'We go beyond basic listings. Access comprehensive details about each boat, including specifications, photos, location maps, and even driver information (where applicable).',
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   _buildFeatureItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.settings_suggest_rounded,
│   │   │   │       │                     'Customizable Trip Options',
│   │   │   │       │                     'Tailor your experience! Choose from various trip types, select fishing equipment, and even customize your route for a truly personalized adventure.',
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   _buildFeatureItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.star_rounded,
│   │   │   │       │                     'Robust Review System',
│   │   │   │       │                     'Benefit from the experiences of other users. Our integrated review system allows you to rate boats and trips, helping build a community of informed renters.',
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   _buildFeatureItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.security_rounded,
│   │   │   │       │                     'Secure and User-Friendly',
│   │   │   │       │                     'Built using cutting-edge technologies like Flutter and Firebase, Qarib offers a secure, reliable, and visually appealing experience across all your devices.',
│   │   │   │       │                   ),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildFeatureItem(
│   │   │   │       │         BuildContext context, IconData icon, String title, String description) {
│   │   │   │       │       return Row(
│   │   │   │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │         children: [
│   │   │   │       │           Container(
│   │   │   │       │             padding: const EdgeInsets.all(10),
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               color: Theme.of(context).colorScheme.secondary.withOpacity(0.1),
│   │   │   │       │               borderRadius: BorderRadius.circular(12),
│   │   │   │       │             ),
│   │   │   │       │             child: Icon(
│   │   │   │       │               icon,
│   │   │   │       │               color: Theme.of(context).colorScheme.secondary,
│   │   │   │       │               size: 24,
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(width: 16),
│   │   │   │       │           Expanded(
│   │   │   │       │             child: Column(
│   │   │   │       │               crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │               children: [
│   │   │   │       │                 Text(
│   │   │   │       │                   title,
│   │   │   │       │                   style: Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │   │       │                         fontWeight: FontWeight.w700,
│   │   │   │       │                       ),
│   │   │   │       │                 ),
│   │   │   │       │                 const SizedBox(height: 4),
│   │   │   │       │                 Text(
│   │   │   │       │                   description,
│   │   │   │       │                   style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │   │       │                         color: AppColors.subtleTextColor,
│   │   │   │       │                       ),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildTeamSection(BuildContext context) {
│   │   │   │       │       return SlideTransition(
│   │   │   │       │         position: Tween<Offset>(
│   │   │   │       │           begin: const Offset(0, 0.5),
│   │   │   │       │           end: Offset.zero,
│   │   │   │       │         ).animate(_cardAnimation),
│   │   │   │       │         child: FadeTransition(
│   │   │   │       │           opacity: _cardAnimation,
│   │   │   │       │           child: Container(
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               color: Colors.white,
│   │   │   │       │               borderRadius: BorderRadius.circular(24),
│   │   │   │       │               boxShadow: [
│   │   │   │       │                 BoxShadow(
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary.withOpacity(0.2),
│   │   │   │       │                   blurRadius: 10,
│   │   │   │       │                   spreadRadius: 2,
│   │   │   │       │                   offset: const Offset(0, 4),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │             child: Padding(
│   │   │   │       │               padding: const EdgeInsets.all(24.0),
│   │   │   │       │               child: Column(
│   │   │   │       │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                 children: [
│   │   │   │       │                   Text(
│   │   │   │       │                     'Who We Are',
│   │   │   │       │                     style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │   │       │                           fontWeight: FontWeight.w800,
│   │   │   │       │                           color: Theme.of(context).colorScheme.secondary,
│   │   │   │       │                         ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   Text(
│   │   │   │       │                     'Qarib is a project born out of passion and innovation by a team of students at the Faculty of Computers and Information Technology. Driven by a vision to modernize and enhance the boat rental experience, we\'ve dedicated ourselves to creating a platform that is both functional and user-focused.',
│   │   │   │       │                     style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │   │       │                           height: 1.6,
│   │   │   │       │                           fontSize: 16,
│   │   │   │       │                         ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 24),
│   │   │   │       │                   ..._teamMembers.map((member) => Padding(
│   │   │   │       │                         padding: const EdgeInsets.only(bottom: 16.0),
│   │   │   │       │                         child: Row(
│   │   │   │       │                           children: [
│   │   │   │       │                             Container(
│   │   │   │       │                               width: 50,
│   │   │   │       │                               height: 50,
│   │   │   │       │                               decoration: BoxDecoration(
│   │   │   │       │                                 color: Theme.of(context)
│   │   │   │       │                                     .colorScheme
│   │   │   │       │                                     .secondary
│   │   │   │       │                                     .withOpacity(0.1),
│   │   │   │       │                                 borderRadius: BorderRadius.circular(25),
│   │   │   │       │                               ),
│   │   │   │       │                               child: Icon(
│   │   │   │       │                                 member['icon'],
│   │   │   │       │                                 color: Theme.of(context).colorScheme.secondary,
│   │   │   │       │                               ),
│   │   │   │       │                             ),
│   │   │   │       │                             const SizedBox(width: 16),
│   │   │   │       │                             Column(
│   │   │   │       │                               crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                               children: [
│   │   │   │       │                                 Text(
│   │   │   │       │                                   member['name'],
│   │   │   │       │                                   style: Theme.of(context)
│   │   │   │       │                                       .textTheme
│   │   │   │       │                                       .titleMedium
│   │   │   │       │                                       ?.copyWith(
│   │   │   │       │                                         fontWeight: FontWeight.w700,
│   │   │   │       │                                       ),
│   │   │   │       │                                 ),
│   │   │   │       │                                 Text(
│   │   │   │       │                                   member['role'],
│   │   │   │       │                                   style: Theme.of(context)
│   │   │   │       │                                       .textTheme
│   │   │   │       │                                       .bodyMedium
│   │   │   │       │                                       ?.copyWith(
│   │   │   │       │                                         color: AppColors.subtleTextColor,
│   │   │   │       │                                       ),
│   │   │   │       │                                 ),
│   │   │   │       │                               ],
│   │   │   │       │                             ),
│   │   │   │       │                           ],
│   │   │   │       │                         ),
│   │   │   │       │                       )),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   ListTile(
│   │   │   │       │                     contentPadding: EdgeInsets.zero,
│   │   │   │       │                     leading: Container(
│   │   │   │       │                       width: 50,
│   │   │   │       │                       height: 50,
│   │   │   │       │                       decoration: BoxDecoration(
│   │   │   │       │                         color: Theme.of(context)
│   │   │   │       │                             .colorScheme
│   │   │   │       │                             .secondary
│   │   │   │       │                             .withOpacity(0.1),
│   │   │   │       │                         borderRadius: BorderRadius.circular(25),
│   │   │   │       │                       ),
│   │   │   │       │                       child: Icon(
│   │   │   │       │                         Icons.copyright_rounded,
│   │   │   │       │                         color: Theme.of(context).colorScheme.secondary,
│   │   │   │       │                       ),
│   │   │   │       │                     ),
│   │   │   │       │                     title: Text(
│   │   │   │       │                       'Copyright',
│   │   │   │       │                       style: Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │   │       │                             fontWeight: FontWeight.w700,
│   │   │   │       │                           ),
│   │   │   │       │                     ),
│   │   │   │       │                     subtitle: Text(
│   │   │   │       │                       '© 2025 Qarib Inc.',
│   │   │   │       │                       style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │   │       │                             color: AppColors.subtleTextColor,
│   │   │   │       │                           ),
│   │   │   │       │                     ),
│   │   │   │       │                   ),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildSupportSection(BuildContext context) {
│   │   │   │       │       return SlideTransition(
│   │   │   │       │         position: Tween<Offset>(
│   │   │   │       │           begin: const Offset(0, 0.5),
│   │   │   │       │           end: Offset.zero,
│   │   │   │       │         ).animate(_cardAnimation),
│   │   │   │       │         child: FadeTransition(
│   │   │   │       │           opacity: _cardAnimation,
│   │   │   │       │           child: Container(
│   │   │   │       │             decoration: BoxDecoration(
│   │   │   │       │               color: Colors.white,
│   │   │   │       │               borderRadius: BorderRadius.circular(24),
│   │   │   │       │               boxShadow: [
│   │   │   │       │                 BoxShadow(
│   │   │   │       │                   color: Theme.of(context).colorScheme.primary.withOpacity(0.2),
│   │   │   │       │                   blurRadius: 10,
│   │   │   │       │                   spreadRadius: 2,
│   │   │   │       │                   offset: const Offset(0, 4),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │             child: Padding(
│   │   │   │       │               padding: const EdgeInsets.all(24.0),
│   │   │   │       │               child: Column(
│   │   │   │       │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                 children: [
│   │   │   │       │                   Text(
│   │   │   │       │                     'Ready to Set Sail?',
│   │   │   │       │                     style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │   │       │                           fontWeight: FontWeight.w800,
│   │   │   │       │                           color: Colors.blue,
│   │   │   │       │                         ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 16),
│   │   │   │       │                   Text(
│   │   │   │       │                     'Embark on your next sea adventure! Whether you\'re a boat owner looking to share your vessel or a renter seeking the perfect boat for your excursion, we invite you to join our growing community and experience the future of boat rentals.',
│   │   │   │       │                     style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │   │       │                           height: 1.6,
│   │   │   │       │                           fontSize: 16,
│   │   │   │       │                         ),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 24),
│   │   │   │       │                   _buildSupportItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.email_rounded,
│   │   │   │       │                     'Contact Support',
│   │   │   │       │                     'support@qarib.com',
│   │   │   │       │                     () => _showSnackBar(context, 'Email sent to support!'),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 12),
│   │   │   │       │                   _buildSupportItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.star_rounded,
│   │   │   │       │                     'Rate Our App',
│   │   │   │       │                     'Help us improve by sharing your experience',
│   │   │   │       │                     () => _showSnackBar(context, 'Thank you for rating our app!'),
│   │   │   │       │                   ),
│   │   │   │       │                   const SizedBox(height: 12),
│   │   │   │       │                   _buildSupportItem(
│   │   │   │       │                     context,
│   │   │   │       │                     Icons.help_outline_rounded,
│   │   │   │       │                     'Frequently Asked Questions',
│   │   │   │       │                     'Find answers to common questions',
│   │   │   │       │                     () => _showSnackBar(context, 'FAQ section opening soon!'),
│   │   │   │       │                   ),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildSupportItem(BuildContext context, IconData icon, String title,
│   │   │   │       │         String subtitle, VoidCallback onTap) {
│   │   │   │       │       return InkWell(
│   │   │   │       │         onTap: onTap,
│   │   │   │       │         borderRadius: BorderRadius.circular(16),
│   │   │   │       │         child: Padding(
│   │   │   │       │           padding: const EdgeInsets.all(8.0),
│   │   │   │       │           child: Row(
│   │   │   │       │             children: [
│   │   │   │       │               Container(
│   │   │   │       │                 padding: const EdgeInsets.all(12),
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                   color: Colors.blue.withOpacity(0.1),
│   │   │   │       │                   borderRadius: BorderRadius.circular(16),
│   │   │   │       │                 ),
│   │   │   │       │                 child: Icon(
│   │   │   │       │                   icon,
│   │   │   │       │                   color: Colors.blue,
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(width: 16),
│   │   │   │       │               Expanded(
│   │   │   │       │                 child: Column(
│   │   │   │       │                   crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                   children: [
│   │   │   │       │                     Text(
│   │   │   │       │                       title,
│   │   │   │       │                       style: Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │   │       │                             fontWeight: FontWeight.w600,
│   │   │   │       │                           ),
│   │   │   │       │                     ),
│   │   │   │       │                     Text(
│   │   │   │       │                       subtitle,
│   │   │   │       │                       style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │   │       │                             color: AppColors.subtleTextColor,
│   │   │   │       │                           ),
│   │   │   │       │                     ),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               Icon(
│   │   │   │       │                 Icons.arrow_forward_ios_rounded,
│   │   │   │       │                 size: 16,
│   │   │   │       │                 color: Colors.blue.withOpacity(0.7),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildFooter(BuildContext context) {
│   │   │   │       │       return Column(
│   │   │   │       │         children: [
│   │   │   │       │           Row(
│   │   │   │       │             mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │             children: [
│   │   │   │       │               _buildFooterButton(
│   │   │   │       │                 context,
│   │   │   │       │                 'Terms of Service',
│   │   │   │       │                 () => _showSnackBar(context, 'Terms of Service will open here'),
│   │   │   │       │               ),
│   │   │   │       │               Container(
│   │   │   │       │                 height: 16,
│   │   │   │       │                 width: 1,
│   │   │   │       │                 color: Colors.grey.withOpacity(0.5),
│   │   │   │       │                 margin: const EdgeInsets.symmetric(horizontal: 12),
│   │   │   │       │               ),
│   │   │   │       │               _buildFooterButton(
│   │   │   │       │                 context,
│   │   │   │       │                 'Privacy Policy',
│   │   │   │       │                 () => _showSnackBar(context, 'Privacy Policy will open here'),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 24),
│   │   │   │       │           Row(
│   │   │   │       │             mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │             children: [
│   │   │   │       │               _buildSocialButton(
│   │   │   │       │                 context,
│   │   │   │       │                 Icons.language,
│   │   │   │       │                 () => _showSnackBar(context, 'Visit our website'),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(width: 24),
│   │   │   │       │               _buildSocialButton(
│   │   │   │       │                 context,
│   │   │   │       │                 Icons.facebook,
│   │   │   │       │                 () => _showSnackBar(context, 'Follow us on Facebook'),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(width: 24),
│   │   │   │       │               _buildSocialButton(
│   │   │   │       │                 context,
│   │   │   │       │                 Icons.alternate_email,
│   │   │   │       │                 () => _showSnackBar(context, 'Follow us on Twitter'),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(width: 24),
│   │   │   │       │               _buildSocialButton(
│   │   │   │       │                 context,
│   │   │   │       │                 Icons.camera_alt_outlined,
│   │   │   │       │                 () => _showSnackBar(context, 'Follow us on Instagram'),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 24),
│   │   │   │       │           Text(
│   │   │   │       │             'Made with ❤️ for boat enthusiasts everywhere',
│   │   │   │       │             style: Theme.of(context).textTheme.bodySmall?.copyWith(
│   │   │   │       │                   color: AppColors.subtleTextColor,
│   │   │   │       │                 ),
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 8),
│   │   │   │       │           Text(
│   │   │   │       │             'Build: ${_packageInfo.buildNumber}',
│   │   │   │       │             style: Theme.of(context).textTheme.bodySmall?.copyWith(
│   │   │   │       │                   color: AppColors.subtleTextColor.withOpacity(0.7),
│   │   │   │       │                   fontSize: 10,
│   │   │   │       │                 ),
│   │   │   │       │           ),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildFooterButton(
│   │   │   │       │         BuildContext context, String text, VoidCallback onTap) {
│   │   │   │       │       return TextButton(
│   │   │   │       │         onPressed: onTap,
│   │   │   │       │         style: TextButton.styleFrom(
│   │   │   │       │           padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
│   │   │   │       │           minimumSize: Size.zero,
│   │   │   │       │           tapTargetSize: MaterialTapTargetSize.shrinkWrap,
│   │   │   │       │         ),
│   │   │   │       │         child: Text(
│   │   │   │       │           text,
│   │   │   │       │           style: TextStyle(
│   │   │   │       │             fontWeight: FontWeight.w600,
│   │   │   │       │             color: Theme.of(context).colorScheme.primary,
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     Widget _buildSocialButton(
│   │   │   │       │         BuildContext context, IconData icon, VoidCallback onTap) {
│   │   │   │       │       return InkWell(
│   │   │   │       │         onTap: onTap,
│   │   │   │       │         borderRadius: BorderRadius.circular(20),
│   │   │   │       │         child: Container(
│   │   │   │       │           width: 40,
│   │   │   │       │           height: 40,
│   │   │   │       │           decoration: BoxDecoration(
│   │   │   │       │             color: Theme.of(context).colorScheme.primary.withOpacity(0.1),
│   │   │   │       │             borderRadius: BorderRadius.circular(20),
│   │   │   │       │           ),
│   │   │   │       │           child: Icon(
│   │   │   │       │             icon,
│   │   │   │       │             color: Theme.of(context).colorScheme.primary,
│   │   │   │       │             size: 20,
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     void _showSnackBar(BuildContext context, String message) {
│   │   │   │       │       SnackBarUtil.showSuccessSnackBar(message: message, title: '');
│   │   │   │       │     }
│   │   │   │       │   }
│   │   │   ├── contact-us/
│   │   │   │   └── screen.dart
│   │   │   │       │   // lib/features/general/contact-us/screen.dart
│   │   │   │       │   
│   │   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │   │       │   import 'package:flutter/material.dart';
│   │   │   │       │   import 'package:app/app/theme.dart'; // Ensure correct import path
│   │   │   │       │   import 'package:localization/localization.dart';
│   │   │   │       │   import 'dart:ui'; // For BackdropFilter
│   │   │   │       │   
│   │   │   │       │   // --- Import Controller ---
│   │   │   │       │   import 'package:app/controllers/contact.dart'; // Use correct controller name
│   │   │   │       │   
│   │   │   │       │   class ContactUsScreen extends StatefulWidget {
│   │   │   │       │     const ContactUsScreen({super.key});
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     State<ContactUsScreen> createState() => _ContactUsScreenState();
│   │   │   │       │   }
│   │   │   │       │   
│   │   │   │       │   class _ContactUsScreenState extends State<ContactUsScreen>
│   │   │   │       │       with TickerProviderStateMixin {
│   │   │   │       │     // --- State Variables ---
│   │   │   │       │     final _formKey = GlobalKey<FormState>();
│   │   │   │       │     final _nameController = TextEditingController();
│   │   │   │       │     final _emailController = TextEditingController();
│   │   │   │       │     final _messageController = TextEditingController();
│   │   │   │       │     late AnimationController _logoAnimationController;
│   │   │   │       │     late Animation<double> _logoAnimation;
│   │   │   │       │     bool _isSubmitting = false; // Tracks submission state
│   │   │   │       │   
│   │   │   │       │     // --- Controller Instance ---
│   │   │   │       │     final ContactController _contactController = ContactController();
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void initState() {
│   │   │   │       │       super.initState();
│   │   │   │       │       // Logo animation setup
│   │   │   │       │       _logoAnimationController = AnimationController(
│   │   │   │       │         duration: const Duration(milliseconds: 1500),
│   │   │   │       │         vsync: this,
│   │   │   │       │       )..forward();
│   │   │   │       │       _logoAnimation = CurvedAnimation(
│   │   │   │       │         parent: _logoAnimationController,
│   │   │   │       │         curve: Curves.easeInOutCubic,
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     void dispose() {
│   │   │   │       │       // Dispose all controllers
│   │   │   │       │       _nameController.dispose();
│   │   │   │       │       _emailController.dispose();
│   │   │   │       │       _messageController.dispose();
│   │   │   │       │       _logoAnimationController.dispose();
│   │   │   │       │       super.dispose();
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Function to handle API submission ---
│   │   │   │       │     Future<void> _submitContactForm() async {
│   │   │   │       │       // Validate the form
│   │   │   │       │       if (!_formKey.currentState!.validate()) {
│   │   │   │       │         return; // Don't submit if validation fails
│   │   │   │       │       }
│   │   │   │       │   
│   │   │   │       │       // Set loading state
│   │   │   │       │       setState(() => _isSubmitting = true);
│   │   │   │       │   
│   │   │   │       │       final name = _nameController.text.trim();
│   │   │   │       │       final email = _emailController.text.trim();
│   │   │   │       │       final message = _messageController.text.trim();
│   │   │   │       │   
│   │   │   │       │       try {
│   │   │   │       │         // Call the controller method
│   │   │   │       │         final bool success = await _contactController.submitContactMessage(
│   │   │   │       │           name: name,
│   │   │   │       │           email: email,
│   │   │   │       │           message: message,
│   │   │   │       │         );
│   │   │   │       │   
│   │   │   │       │         if (!mounted) return; // Check mount status after await
│   │   │   │       │   
│   │   │   │       │         if (success) {
│   │   │   │       │           // --- Success ---
│   │   │   │       │           _showSuccessDialog(context); // Show success dialog
│   │   │   │       │           // Clear the form fields
│   │   │   │       │           _nameController.clear();
│   │   │   │       │           _emailController.clear();
│   │   │   │       │           _messageController.clear();
│   │   │   │       │         } else {
│   │   │   │       │           // --- Failure ---
│   │   │   │       │           // Controller handles printing errors, show a generic message here
│   │   │   │       │           _showSnackBar(context, 'Failed to send message. Please try again.',
│   │   │   │       │               isError: true);
│   │   │   │       │         }
│   │   │   │       │       } catch (e) {
│   │   │   │       │         // --- Handle Network or other unexpected errors ---
│   │   │   │       │         print("Contact Us Error: $e");
│   │   │   │       │         if (mounted) {
│   │   │   │       │           _showSnackBar(
│   │   │   │       │               context, 'An unexpected error occurred. Please try again.',
│   │   │   │       │               isError: true);
│   │   │   │       │         }
│   │   │   │       │       } finally {
│   │   │   │       │         // --- Stop Loading ---
│   │   │   │       │         if (mounted) {
│   │   │   │       │           setState(() => _isSubmitting = false);
│   │   │   │       │         }
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │     // --- End of API submission function ---
│   │   │   │       │   
│   │   │   │       │     @override
│   │   │   │       │     Widget build(BuildContext context) {
│   │   │   │       │       return Scaffold(
│   │   │   │       │         backgroundColor: AppColors.scaffoldBackgroundColor,
│   │   │   │       │         appBar: _buildAppBar(context),
│   │   │   │       │         body: Stack(
│   │   │   │       │           // Stack for background elements and main content
│   │   │   │       │           children: [
│   │   │   │       │             // Background design elements
│   │   │   │       │             Positioned(
│   │   │   │       │               top: -100,
│   │   │   │       │               right: -50,
│   │   │   │       │               child: Container(
│   │   │   │       │                 width: 200,
│   │   │   │       │                 height: 200,
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                   shape: BoxShape.circle,
│   │   │   │       │                   color: Theme.of(context).primaryColor.withOpacity(0.1),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             Positioned(
│   │   │   │       │               bottom: -80,
│   │   │   │       │               left: -60,
│   │   │   │       │               child: Container(
│   │   │   │       │                 width: 180,
│   │   │   │       │                 height: 180,
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                   shape: BoxShape.circle,
│   │   │   │       │                   color: Theme.of(context).primaryColor.withOpacity(0.15),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │             // Main content
│   │   │   │       │             SafeArea(
│   │   │   │       │               child: SingleChildScrollView(
│   │   │   │       │                 physics: const BouncingScrollPhysics(), // Nice scroll effect
│   │   │   │       │                 padding:
│   │   │   │       │                     const EdgeInsets.symmetric(horizontal: 24.0, vertical: 16.0),
│   │   │   │       │                 child: Column(
│   │   │   │       │                   crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │                   children: <Widget>[
│   │   │   │       │                     _buildAppLogo(),
│   │   │   │       │                     const SizedBox(height: 32),
│   │   │   │       │                     // Animated intro text
│   │   │   │       │                     TweenAnimationBuilder<double>(
│   │   │   │       │                       tween: Tween<double>(begin: 0, end: 1),
│   │   │   │       │                       duration: const Duration(milliseconds: 800),
│   │   │   │       │                       builder: (context, value, child) {
│   │   │   │       │                         return Opacity(
│   │   │   │       │                           opacity: value,
│   │   │   │       │                           child: Padding(
│   │   │   │       │                             padding: EdgeInsets.only(
│   │   │   │       │                                 left: 20 * (1 - value)), // Slide in effect
│   │   │   │       │                             child: Text(
│   │   │   │       │                               'contact_us_intro_text'.i18n(),
│   │   │   │       │                               style:
│   │   │   │       │                                   Theme.of(context).textTheme.bodyLarge?.copyWith(
│   │   │   │       │                                         color: AppColors
│   │   │   │       │                                             .secondary, // Assuming secondary color is defined in theme
│   │   │   │       │                                         fontWeight: FontWeight.w500,
│   │   │   │       │                                       ),
│   │   │   │       │                               textAlign: TextAlign.center,
│   │   │   │       │                             ),
│   │   │   │       │                           ),
│   │   │   │       │                         );
│   │   │   │       │                       },
│   │   │   │       │                     ),
│   │   │   │       │                     const SizedBox(height: 40),
│   │   │   │       │                     _buildContactFormCard(context), // Main contact form
│   │   │   │       │                     const SizedBox(height: 30),
│   │   │   │       │                     _buildContactInfoCard(context), // Additional contact info
│   │   │   │       │                     const SizedBox(height: 20),
│   │   │   │       │                     _buildSocialMediaLinks(), // Social media icons/links
│   │   │   │       │                     const SizedBox(height: 30),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- AppBar ---
│   │   │   │       │     PreferredSizeWidget _buildAppBar(BuildContext context) => AppBar(
│   │   │   │       │           title: Text(
│   │   │   │       │             'contact_us_title_appbar'.i18n(),
│   │   │   │       │             style: TextStyle(
│   │   │   │       │               fontWeight: FontWeight.w700,
│   │   │   │       │               fontSize: 18,
│   │   │   │       │               color: Theme.of(context).primaryColor, // Use theme color
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           centerTitle: true,
│   │   │   │       │           elevation: 0, // Flat AppBar
│   │   │   │       │           backgroundColor: Colors.transparent, // Transparent AppBar background
│   │   │   │       │           iconTheme: IconThemeData(
│   │   │   │       │               color: Theme.of(context).primaryColor), // Themed back button
│   │   │   │       │           actions: [
│   │   │   │       │             IconButton(
│   │   │   │       │               icon: const Icon(Icons.help_outline_rounded),
│   │   │   │       │               onPressed: () => _showHelpDialog(context),
│   │   │   │       │               tooltip: 'help_tooltip'.i18n(),
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │         );
│   │   │   │       │   
│   │   │   │       │     // --- Logo Widget ---
│   │   │   │       │     Widget _buildAppLogo() {
│   │   │   │       │       return ScaleTransition(
│   │   │   │       │         scale: _logoAnimation,
│   │   │   │       │         child: FadeTransition(
│   │   │   │       │           opacity: _logoAnimation,
│   │   │   │       │           child: Hero(
│   │   │   │       │             tag: 'contact-logo', // Unique tag for Hero animation
│   │   │   │       │             child: Container(
│   │   │   │       │               width: 120,
│   │   │   │       │               height: 120,
│   │   │   │       │               decoration: BoxDecoration(
│   │   │   │       │                 color: Theme.of(context)
│   │   │   │       │                     .primaryColor
│   │   │   │       │                     .withOpacity(0.1), // Subtle background
│   │   │   │       │                 shape: BoxShape.circle,
│   │   │   │       │               ),
│   │   │   │       │               child: Icon(
│   │   │   │       │                 Icons.support_agent_rounded, // Contact/support icon
│   │   │   │       │                 size: 80,
│   │   │   │       │                 color: Theme.of(context).colorScheme.primary,
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Contact Form Card ---
│   │   │   │       │     Widget _buildContactFormCard(BuildContext context) {
│   │   │   │       │       return Card(
│   │   │   │       │         elevation: 4,
│   │   │   │       │         shadowColor: Theme.of(context).primaryColor.withOpacity(0.3),
│   │   │   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(24)),
│   │   │   │       │         child: ClipRRect(
│   │   │   │       │           // Clip for BackdropFilter
│   │   │   │       │           borderRadius: BorderRadius.circular(24),
│   │   │   │       │           child: BackdropFilter(
│   │   │   │       │             // Frosted glass effect
│   │   │   │       │             filter: ImageFilter.blur(sigmaX: 10, sigmaY: 10),
│   │   │   │       │             child: Container(
│   │   │   │       │               padding: const EdgeInsets.all(24.0),
│   │   │   │       │               decoration: BoxDecoration(
│   │   │   │       │                 // Semi-transparent background
│   │   │   │       │                 gradient: LinearGradient(
│   │   │   │       │                   begin: Alignment.topLeft,
│   │   │   │       │                   end: Alignment.bottomRight,
│   │   │   │       │                   colors: [
│   │   │   │       │                     Colors.white.withOpacity(0.9),
│   │   │   │       │                     Colors.white.withOpacity(0.8),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │                 borderRadius: BorderRadius.circular(24),
│   │   │   │       │                 border: Border.all(
│   │   │   │       │                   color: Colors.white.withOpacity(0.2), // Subtle border
│   │   │   │       │                   width: 1.5,
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               child: Form(
│   │   │   │       │                 key: _formKey,
│   │   │   │       │                 child: Column(
│   │   │   │       │                   crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │                   children: <Widget>[
│   │   │   │       │                     Row(
│   │   │   │       │                       // Form Title
│   │   │   │       │                       children: [
│   │   │   │       │                         Icon(Icons.mail_outline_rounded,
│   │   │   │       │                             color: Theme.of(context).primaryColor),
│   │   │   │       │                         const SizedBox(width: 12),
│   │   │   │       │                         Text('contact_us_form_title'.i18n(),
│   │   │   │       │                             style:
│   │   │   │       │                                 Theme.of(context).textTheme.titleLarge?.copyWith(
│   │   │   │       │                                       fontWeight: FontWeight.w700,
│   │   │   │       │                                       color: Theme.of(context).primaryColor,
│   │   │   │       │                                     )),
│   │   │   │       │                       ],
│   │   │   │       │                     ),
│   │   │   │       │                     const SizedBox(height: 24),
│   │   │   │       │                     // Input Fields using helper
│   │   │   │       │                     _buildInputField(
│   │   │   │       │                       controller: _nameController,
│   │   │   │       │                       label: 'your_name_label'.i18n(),
│   │   │   │       │                       hint: 'your_name_hint'.i18n(),
│   │   │   │       │                       icon: Icons.person_outline_rounded,
│   │   │   │       │                       validator: (value) {
│   │   │   │       │                         if (value == null || value.isEmpty)
│   │   │   │       │                           return 'name_required_error'.i18n();
│   │   │   │       │                         return null;
│   │   │   │       │                       },
│   │   │   │       │                     ),
│   │   │   │       │                     const SizedBox(height: 20),
│   │   │   │       │                     _buildInputField(
│   │   │   │       │                       controller: _emailController,
│   │   │   │       │                       label: 'your_email_label'.i18n(),
│   │   │   │       │                       hint: 'your_email_hint'.i18n(),
│   │   │   │       │                       icon: Icons.email_outlined,
│   │   │   │       │                       keyboardType: TextInputType.emailAddress,
│   │   │   │       │                       validator: (value) {
│   │   │   │       │                         if (value == null || value.isEmpty)
│   │   │   │       │                           return 'email_required_error'.i18n();
│   │   │   │       │                         if (!value.contains('@'))
│   │   │   │       │                           return 'invalid_email_format_error'.i18n();
│   │   │   │       │                         return null;
│   │   │   │       │                       },
│   │   │   │       │                     ),
│   │   │   │       │                     const SizedBox(height: 20),
│   │   │   │       │                     _buildInputField(
│   │   │   │       │                       controller: _messageController,
│   │   │   │       │                       label: 'your_message_label'.i18n(),
│   │   │   │       │                       hint: 'your_message_hint'.i18n(),
│   │   │   │       │                       icon: Icons.message_outlined,
│   │   │   │       │                       maxLines: 5,
│   │   │   │       │                       validator: (value) {
│   │   │   │       │                         if (value == null || value.isEmpty)
│   │   │   │       │                           return 'message_required_error'.i18n();
│   │   │   │       │                         return null;
│   │   │   │       │                       },
│   │   │   │       │                     ),
│   │   │   │       │                     const SizedBox(height: 30),
│   │   │   │       │                     // Submit Button (using updated helper)
│   │   │   │       │                     _buildSubmitButton(context),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Input Field Helper ---
│   │   │   │       │     Widget _buildInputField({
│   │   │   │       │       required TextEditingController controller,
│   │   │   │       │       required String label,
│   │   │   │       │       required String hint,
│   │   │   │       │       required IconData icon,
│   │   │   │       │       TextInputType keyboardType = TextInputType.text,
│   │   │   │       │       int maxLines = 1,
│   │   │   │       │       String? Function(String?)? validator,
│   │   │   │       │     }) {
│   │   │   │       │       return TextFormField(
│   │   │   │       │         controller: controller,
│   │   │   │       │         maxLines: maxLines,
│   │   │   │       │         keyboardType: keyboardType,
│   │   │   │       │         style: const TextStyle(fontSize: 16), // Consistent text style
│   │   │   │       │         decoration: InputDecoration(
│   │   │   │       │           labelText: label,
│   │   │   │       │           hintText: hint,
│   │   │   │       │           floatingLabelBehavior:
│   │   │   │       │               FloatingLabelBehavior.always, // Label always visible
│   │   │   │       │           prefixIcon: Padding(
│   │   │   │       │             // Adjust icon padding for multiline fields
│   │   │   │       │             padding: EdgeInsets.only(
│   │   │   │       │                 bottom: maxLines > 1
│   │   │   │       │                     ? ((maxLines - 1) * 20.0)
│   │   │   │       │                     : 0), // Dynamic padding
│   │   │   │       │             child: Icon(icon, color: Theme.of(context).primaryColor),
│   │   │   │       │           ),
│   │   │   │       │           border: OutlineInputBorder(
│   │   │   │       │             borderRadius: BorderRadius.circular(16),
│   │   │   │       │             borderSide: BorderSide(
│   │   │   │       │                 color: Theme.of(context).primaryColor.withOpacity(0.3)),
│   │   │   │       │           ),
│   │   │   │       │           enabledBorder: OutlineInputBorder(
│   │   │   │       │             borderRadius: BorderRadius.circular(16),
│   │   │   │       │             borderSide: BorderSide(
│   │   │   │       │                 color: Theme.of(context).primaryColor.withOpacity(0.3)),
│   │   │   │       │           ),
│   │   │   │       │           focusedBorder: OutlineInputBorder(
│   │   │   │       │             borderRadius: BorderRadius.circular(16),
│   │   │   │       │             borderSide: BorderSide(
│   │   │   │       │                 color: Theme.of(context).primaryColor,
│   │   │   │       │                 width: 2), // Highlight on focus
│   │   │   │       │           ),
│   │   │   │       │           errorBorder: OutlineInputBorder(
│   │   │   │       │             borderRadius: BorderRadius.circular(16),
│   │   │   │       │             borderSide: BorderSide(color: Colors.red.shade300, width: 1),
│   │   │   │       │           ),
│   │   │   │       │           filled: true,
│   │   │   │       │           fillColor: Colors.white.withOpacity(0.9), // Slightly transparent fill
│   │   │   │       │           contentPadding: EdgeInsets.symmetric(
│   │   │   │       │             horizontal: 16,
│   │   │   │       │             vertical: maxLines > 1 ? 20 : 16, // Adjust vertical padding
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │         validator: validator,
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Submit Button Helper ---
│   │   │   │       │     Widget _buildSubmitButton(BuildContext context) {
│   │   │   │       │       return AnimatedContainer(
│   │   │   │       │         // Animate button changes (e.g., loading state)
│   │   │   │       │         duration: const Duration(milliseconds: 300),
│   │   │   │       │         height: 54,
│   │   │   │       │         decoration: BoxDecoration(
│   │   │   │       │           borderRadius: BorderRadius.circular(16),
│   │   │   │       │           boxShadow: [
│   │   │   │       │             BoxShadow(
│   │   │   │       │               color: Theme.of(context).primaryColor.withOpacity(
│   │   │   │       │                   _isSubmitting ? 0.2 : 0.4), // Adjust shadow based on state
│   │   │   │       │               blurRadius: 10,
│   │   │   │       │               offset: const Offset(0, 4),
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │           gradient: LinearGradient(
│   │   │   │       │             // Gradient background
│   │   │   │       │             colors: [
│   │   │   │       │               Theme.of(context).primaryColor,
│   │   │   │       │               Color.lerp(Theme.of(context).primaryColor, Colors.lightBlue, 0.6) ??
│   │   │   │       │                   Theme.of(context).primaryColor, // Blend color
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │         child: ElevatedButton.icon(
│   │   │   │       │           // --- Use _isSubmitting state and call _submitContactForm ---
│   │   │   │       │           onPressed: _isSubmitting
│   │   │   │       │               ? null
│   │   │   │       │               : _submitContactForm, // Disable when submitting
│   │   │   │       │           icon: _isSubmitting
│   │   │   │       │               ? const SizedBox(
│   │   │   │       │                   // Show loading indicator
│   │   │   │       │                   width: 20, height: 20,
│   │   │   │       │                   child: CircularProgressIndicator(
│   │   │   │       │                       strokeWidth: 2.5,
│   │   │   │       │                       valueColor: AlwaysStoppedAnimation<Color>(Colors.white)),
│   │   │   │       │                 )
│   │   │   │       │               : const Icon(Icons.send_rounded, size: 20),
│   │   │   │       │           label: Text(
│   │   │   │       │             _isSubmitting ? 'sending_message'.i18n() : 'submit_button'.i18n(),
│   │   │   │       │             style: const TextStyle(fontSize: 16, fontWeight: FontWeight.w700),
│   │   │   │       │           ),
│   │   │   │       │           style: ElevatedButton.styleFrom(
│   │   │   │       │             // Style for gradient background
│   │   │   │       │             foregroundColor: Colors.white,
│   │   │   │       │             backgroundColor:
│   │   │   │       │                 Colors.transparent, // Make button transparent for gradient
│   │   │   │       │             shadowColor: Colors.transparent,
│   │   │   │       │             elevation: 0,
│   │   │   │       │             shape:
│   │   │   │       │                 RoundedRectangleBorder(borderRadius: BorderRadius.circular(16)),
│   │   │   │       │             disabledForegroundColor: Colors.white70, // Style when disabled
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Contact Info Card ---
│   │   │   │       │     Widget _buildContactInfoCard(BuildContext context) {
│   │   │   │       │       return Card(
│   │   │   │       │         elevation: 3,
│   │   │   │       │         shadowColor: Theme.of(context).primaryColor.withOpacity(0.2),
│   │   │   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(24)),
│   │   │   │       │         child: Container(
│   │   │   │       │           padding: const EdgeInsets.all(20.0),
│   │   │   │       │           decoration: BoxDecoration(
│   │   │   │       │             borderRadius: BorderRadius.circular(24),
│   │   │   │       │             gradient: LinearGradient(
│   │   │   │       │               // Subtle gradient
│   │   │   │       │               begin: Alignment.topLeft,
│   │   │   │       │               end: Alignment.bottomRight,
│   │   │   │       │               colors: [
│   │   │   │       │                 Colors.white,
│   │   │   │       │                 Color.lerp(Colors.white, Theme.of(context).primaryColor, 0.05) ??
│   │   │   │       │                     Colors.white,
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           child: Column(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │       │             children: [
│   │   │   │       │               Row(
│   │   │   │       │                 // Title Row
│   │   │   │       │                 children: [
│   │   │   │       │                   Icon(Icons.contact_phone_rounded,
│   │   │   │       │                       color: Theme.of(context).primaryColor),
│   │   │   │       │                   const SizedBox(width: 12),
│   │   │   │       │                   Text('contact_information_title'.i18n(),
│   │   │   │       │                       style: Theme.of(context).textTheme.titleLarge?.copyWith(
│   │   │   │       │                             fontWeight: FontWeight.w700,
│   │   │   │       │                             color: Theme.of(context).primaryColor,
│   │   │   │       │                           )),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 20),
│   │   │   │       │               // Contact Items using helper
│   │   │   │       │               _buildContactInfoItem(
│   │   │   │       │                 icon: Icons.email_rounded,
│   │   │   │       │                 title: 'email_address'.i18n(),
│   │   │   │       │                 value: 'support@boatly.com', // Replace with actual email
│   │   │   │       │                 onTap: () {
│   │   │   │       │                   /* TODO: Implement email launch */ _showSnackBar(
│   │   │   │       │                       context, 'Launching email client...');
│   │   │   │       │                 },
│   │   │   │       │               ),
│   │   │   │       │               _buildDivider(),
│   │   │   │       │               _buildContactInfoItem(
│   │   │   │       │                 icon: Icons.phone_rounded,
│   │   │   │       │                 title: 'phone_number'.i18n(),
│   │   │   │       │                 value: '+1-555-BOATLY', // Replace with actual phone
│   │   │   │       │                 onTap: () {
│   │   │   │       │                   /* TODO: Implement phone call */ _showSnackBar(
│   │   │   │       │                       context, 'Dialing phone number...');
│   │   │   │       │                 },
│   │   │   │       │               ),
│   │   │   │       │               _buildDivider(),
│   │   │   │       │               _buildContactInfoItem(
│   │   │   │       │                 icon: Icons.location_on_rounded,
│   │   │   │       │                 title: 'address_label'.i18n(),
│   │   │   │       │                 value:
│   │   │   │       │                     '123 Marina Drive, Miami, FL, USA', // Replace with actual address
│   │   │   │       │                 onTap: () {
│   │   │   │       │                   /* TODO: Implement map launch */ _showSnackBar(
│   │   │   │       │                       context, 'Opening map...');
│   │   │   │       │                 },
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 10),
│   │   │   │       │               // Optional: View on Map Button
│   │   │   │       │               TextButton.icon(
│   │   │   │       │                 onPressed: () {
│   │   │   │       │                   /* TODO: Implement map launch */ _showSnackBar(
│   │   │   │       │                       context, 'Opening map...');
│   │   │   │       │                 },
│   │   │   │       │                 icon: const Icon(Icons.map_outlined, size: 18),
│   │   │   │       │                 label: Text('view_on_map'.i18n(),
│   │   │   │       │                     style: const TextStyle(fontWeight: FontWeight.w600)),
│   │   │   │       │                 style: TextButton.styleFrom(
│   │   │   │       │                   foregroundColor: Theme.of(context).primaryColor,
│   │   │   │       │                   padding: const EdgeInsets.symmetric(vertical: 8),
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Contact Info Item Helper ---
│   │   │   │       │     Widget _buildContactInfoItem({
│   │   │   │       │       required IconData icon,
│   │   │   │       │       required String title,
│   │   │   │       │       required String value,
│   │   │   │       │       required VoidCallback onTap,
│   │   │   │       │     }) {
│   │   │   │       │       return InkWell(
│   │   │   │       │         onTap: onTap,
│   │   │   │       │         borderRadius: BorderRadius.circular(12), // Match parent rounding
│   │   │   │       │         child: Padding(
│   │   │   │       │           padding: const EdgeInsets.symmetric(vertical: 12, horizontal: 8),
│   │   │   │       │           child: Row(
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │             children: [
│   │   │   │       │               Container(
│   │   │   │       │                 // Icon background
│   │   │   │       │                 padding: const EdgeInsets.all(8),
│   │   │   │       │                 decoration: BoxDecoration(
│   │   │   │       │                   color: Theme.of(context).primaryColor.withOpacity(0.1),
│   │   │   │       │                   borderRadius: BorderRadius.circular(10),
│   │   │   │       │                 ),
│   │   │   │       │                 child:
│   │   │   │       │                     Icon(icon, color: Theme.of(context).primaryColor, size: 22),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(width: 16),
│   │   │   │       │               Expanded(
│   │   │   │       │                 // Text content
│   │   │   │       │                 child: Column(
│   │   │   │       │                   crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │                   children: [
│   │   │   │       │                     Text(title,
│   │   │   │       │                         style: const TextStyle(
│   │   │   │       │                             fontWeight: FontWeight.w600,
│   │   │   │       │                             fontSize: 15,
│   │   │   │       │                             color: Colors.black87)),
│   │   │   │       │                     const SizedBox(height: 4),
│   │   │   │       │                     Text(value,
│   │   │   │       │                         style:
│   │   │   │       │                             const TextStyle(fontSize: 14, color: Colors.black54)),
│   │   │   │       │                   ],
│   │   │   │       │                 ),
│   │   │   │       │               ),
│   │   │   │       │               const Icon(Icons.arrow_forward_ios_rounded,
│   │   │   │       │                   size: 14, color: Colors.black38), // Chevron
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Divider Helper ---
│   │   │   │       │     Widget _buildDivider() {
│   │   │   │       │       return Padding(
│   │   │   │       │         padding: const EdgeInsets.symmetric(horizontal: 8),
│   │   │   │       │         child: Divider(color: Colors.grey.withOpacity(0.2), thickness: 1),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Social Media Links ---
│   │   │   │       │     Widget _buildSocialMediaLinks() {
│   │   │   │       │       return Card(
│   │   │   │       │         elevation: 3,
│   │   │   │       │         shadowColor: Theme.of(context).primaryColor.withOpacity(0.1),
│   │   │   │       │         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │   │   │       │         child: Padding(
│   │   │   │       │           padding: const EdgeInsets.symmetric(vertical: 16, horizontal: 20),
│   │   │   │       │           child: Column(
│   │   │   │       │             children: [
│   │   │   │       │               Text(
│   │   │   │       │                 'follow_us_on'.i18n(),
│   │   │   │       │                 style: TextStyle(
│   │   │   │       │                     fontWeight: FontWeight.w600,
│   │   │   │       │                     fontSize: 16,
│   │   │   │       │                     color: Theme.of(context).primaryColor),
│   │   │   │       │               ),
│   │   │   │       │               const SizedBox(height: 16),
│   │   │   │       │               Row(
│   │   │   │       │                 // Row of social icons
│   │   │   │       │                 mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │       │                 children: [
│   │   │   │       │                   _buildSocialButton(
│   │   │   │       │                       Icons.facebook_rounded,
│   │   │   │       │                       'Facebook',
│   │   │   │       │                       () => _showSnackBar(context,
│   │   │   │       │                           'Opening Facebook...')), // Replace with actual URLs/logic
│   │   │   │       │                   const SizedBox(width: 18),
│   │   │   │       │                   _buildSocialButton(Icons.public_rounded, 'Twitter',
│   │   │   │       │                       () => _showSnackBar(context, 'Opening Twitter...')),
│   │   │   │       │                   const SizedBox(width: 18),
│   │   │   │       │                   _buildSocialButton(Icons.camera_alt_rounded, 'Instagram',
│   │   │   │       │                       () => _showSnackBar(context, 'Opening Instagram...')),
│   │   │   │       │                   const SizedBox(width: 18),
│   │   │   │       │                   _buildSocialButton(Icons.video_collection_rounded, 'YouTube',
│   │   │   │       │                       () => _showSnackBar(context, 'Opening YouTube...')),
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Social Button Helper ---
│   │   │   │       │     Widget _buildSocialButton(IconData icon, String label, VoidCallback onTap) {
│   │   │   │       │       return Column(
│   │   │   │       │         children: [
│   │   │   │       │           InkWell(
│   │   │   │       │             onTap: onTap,
│   │   │   │       │             borderRadius: BorderRadius.circular(30), // Make it circular
│   │   │   │       │             child: Container(
│   │   │   │       │               padding: const EdgeInsets.all(12),
│   │   │   │       │               decoration: BoxDecoration(
│   │   │   │       │                 gradient: LinearGradient(
│   │   │   │       │                   // Gradient for button
│   │   │   │       │                   colors: [
│   │   │   │       │                     Theme.of(context).primaryColor.withOpacity(0.8),
│   │   │   │       │                     Theme.of(context).primaryColor
│   │   │   │       │                   ],
│   │   │   │       │                   begin: Alignment.topLeft, end: Alignment.bottomRight,
│   │   │   │       │                 ),
│   │   │   │       │                 borderRadius:
│   │   │   │       │                     BorderRadius.circular(14), // Slightly rounded square
│   │   │   │       │                 boxShadow: [
│   │   │   │       │                   BoxShadow(
│   │   │   │       │                       color: Theme.of(context).primaryColor.withOpacity(0.25),
│   │   │   │       │                       blurRadius: 8,
│   │   │   │       │                       offset: const Offset(0, 3))
│   │   │   │       │                 ],
│   │   │   │       │               ),
│   │   │   │       │               child: Icon(icon, color: Colors.white, size: 24),
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │           const SizedBox(height: 6),
│   │   │   │       │           Text(label,
│   │   │   │       │               style: const TextStyle(
│   │   │   │       │                   fontSize: 12, fontWeight: FontWeight.w500)), // Label below icon
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Help Dialog ---
│   │   │   │       │     void _showHelpDialog(BuildContext context) {
│   │   │   │       │       showDialog(
│   │   │   │       │         context: context,
│   │   │   │       │         builder: (context) => AlertDialog(
│   │   │   │       │           title: Text('contact_help_title'.i18n()),
│   │   │   │       │           content: Column(
│   │   │   │       │             mainAxisSize: MainAxisSize.min,
│   │   │   │       │             crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │       │             children: [
│   │   │   │       │               _buildHelpItem(
│   │   │   │       │                   Icons.timer, 'help_response_time'.i18n()), // Help item 1
│   │   │   │       │               const SizedBox(height: 12),
│   │   │   │       │               _buildHelpItem(
│   │   │   │       │                   Icons.question_answer, 'help_faqs'.i18n()), // Help item 2
│   │   │   │       │               const SizedBox(height: 12),
│   │   │   │       │               _buildHelpItem(
│   │   │   │       │                   Icons.support_agent, 'help_live_chat'.i18n()), // Help item 3
│   │   │   │       │             ],
│   │   │   │       │           ),
│   │   │   │       │           actions: [
│   │   │   │       │             TextButton(
│   │   │   │       │               onPressed: () => Navigator.of(context).pop(),
│   │   │   │       │               child: Text('close'.i18n()),
│   │   │   │       │             ),
│   │   │   │       │           ],
│   │   │   │       │           shape: RoundedRectangleBorder(
│   │   │   │       │               borderRadius: BorderRadius.circular(20)), // Rounded dialog
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Help Item Helper ---
│   │   │   │       │     Widget _buildHelpItem(IconData icon, String text) {
│   │   │   │       │       return Row(
│   │   │   │       │         children: [
│   │   │   │       │           Icon(icon, color: Theme.of(context).primaryColor, size: 20),
│   │   │   │       │           const SizedBox(width: 12),
│   │   │   │       │           Expanded(child: Text(text, style: const TextStyle(fontSize: 14))),
│   │   │   │       │         ],
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- Success Dialog ---
│   │   │   │       │     void _showSuccessDialog(BuildContext context) {
│   │   │   │       │       showDialog(
│   │   │   │       │         context: context,
│   │   │   │       │         builder: (context) => Dialog(
│   │   │   │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │   │   │       │           child: Padding(
│   │   │   │       │             padding: const EdgeInsets.all(20.0),
│   │   │   │       │             child: Column(
│   │   │   │       │               mainAxisSize: MainAxisSize.min,
│   │   │   │       │               children: [
│   │   │   │       │                 Container(
│   │   │   │       │                   // Success icon container
│   │   │   │       │                   width: 70, height: 70,
│   │   │   │       │                   decoration: BoxDecoration(
│   │   │   │       │                       color: Colors.green.withOpacity(0.1),
│   │   │   │       │                       shape: BoxShape.circle),
│   │   │   │       │                   child: const Icon(Icons.check_circle,
│   │   │   │       │                       color: Colors.green, size: 40),
│   │   │   │       │                 ),
│   │   │   │       │                 const SizedBox(height: 20),
│   │   │   │       │                 Text('thank_you_title'.i18n(),
│   │   │   │       │                     style: const TextStyle(
│   │   │   │       │                         fontSize: 18, fontWeight: FontWeight.bold)),
│   │   │   │       │                 const SizedBox(height: 12),
│   │   │   │       │                 Text(
│   │   │   │       │                   'contact_success_message'.i18n(),
│   │   │   │       │                   textAlign: TextAlign.center,
│   │   │   │       │                   style: const TextStyle(color: Colors.black87, fontSize: 14),
│   │   │   │       │                 ),
│   │   │   │       │                 const SizedBox(height: 24),
│   │   │   │       │                 SizedBox(
│   │   │   │       │                   // Button takes full width
│   │   │   │       │                   width: double.infinity,
│   │   │   │       │                   child: ElevatedButton(
│   │   │   │       │                     onPressed: () => Navigator.of(context).pop(),
│   │   │   │       │                     style: ElevatedButton.styleFrom(
│   │   │   │       │                       backgroundColor: Theme.of(context).primaryColor,
│   │   │   │       │                       foregroundColor: Colors.white,
│   │   │   │       │                       padding: const EdgeInsets.symmetric(vertical: 12),
│   │   │   │       │                       shape: RoundedRectangleBorder(
│   │   │   │       │                           borderRadius: BorderRadius.circular(12)),
│   │   │   │       │                     ),
│   │   │   │       │                     child: Text('got_it'.i18n()),
│   │   │   │       │                   ),
│   │   │   │       │                 ),
│   │   │   │       │               ],
│   │   │   │       │             ),
│   │   │   │       │           ),
│   │   │   │       │         ),
│   │   │   │       │       );
│   │   │   │       │     }
│   │   │   │       │   
│   │   │   │       │     // --- SnackBar Utility ---
│   │   │   │       │     void _showSnackBar(BuildContext context, String message,
│   │   │   │       │         {bool isError = false}) {
│   │   │   │       │       if (isError) {
│   │   │   │       │         SnackBarUtil.showErrorSnackBar(title: '', message: message);
│   │   │   │       │       } else {
│   │   │   │       │         SnackBarUtil.showSuccessSnackBar(title: '', message: message);
│   │   │   │       │       }
│   │   │   │       │     }
│   │   │   │       │   } // End of _ContactUsScreenState
│   │   │   └── onboarding/
│   │   │       └── screen.dart
│   │   │           │   import 'package:app/features/auth/login/screen.dart'; // Import LoginScreen
│   │   │           │   import 'package:flutter/material.dart';
│   │   │           │   import 'package:shared_preferences/shared_preferences.dart'; // Import SharedPreferences
│   │   │           │   
│   │   │           │   // Assuming OnboardingItem class is defined in the same file or imported
│   │   │           │   class OnboardingItem {
│   │   │           │     final String title;
│   │   │           │     final String description;
│   │   │           │     final String lottieAsset; // Placeholder for Lottie asset path
│   │   │           │     final Color bgColor;
│   │   │           │     final Color highlightColor;
│   │   │           │     final String? image; // Optional image path
│   │   │           │   
│   │   │           │     OnboardingItem({
│   │   │           │       required this.title,
│   │   │           │       required this.description,
│   │   │           │       required this.lottieAsset, // Keep this even if using Icons for now
│   │   │           │       required this.bgColor,
│   │   │           │       required this.highlightColor,
│   │   │           │       this.image, // Optional image path
│   │   │           │     });
│   │   │           │   }
│   │   │           │   
│   │   │           │   class OnboardingScreen extends StatefulWidget {
│   │   │           │     const OnboardingScreen({super.key});
│   │   │           │   
│   │   │           │     @override
│   │   │           │     State<OnboardingScreen> createState() => _OnboardingScreenState();
│   │   │           │   }
│   │   │           │   
│   │   │           │   // --- COMPLETE STATE CLASS ---
│   │   │           │   class _OnboardingScreenState extends State<OnboardingScreen>
│   │   │           │       with TickerProviderStateMixin {
│   │   │           │     final PageController _pageController = PageController();
│   │   │           │     int _currentPage = 0;
│   │   │           │     bool _isLastPage = false;
│   │   │           │   
│   │   │           │     late AnimationController
│   │   │           │         _lottieController; // Keep for potential Lottie integration
│   │   │           │     late AnimationController _fadeController;
│   │   │           │     late Animation<double> _fadeAnimation;
│   │   │           │   
│   │   │           │     // Same dummy data as provided in UI code
│   │   │           │     final List<OnboardingItem> _pages = [
│   │   │           │       OnboardingItem(
│   │   │           │         title: "Find Your Perfect Boat",
│   │   │           │         description:
│   │   │           │             "Discover a variety of boats for your next adventure, from luxury yachts to fishing boats.",
│   │   │           │         lottieAsset: 'assets/boat_search.json',
│   │   │           │         // Placeholder path
│   │   │           │         bgColor: const Color(0xFFE1F5FE),
│   │   │           │         highlightColor: const Color(0xFF0288D1),
│   │   │           │       ),
│   │   │           │       OnboardingItem(
│   │   │           │         title: "Easy Booking Process",
│   │   │           │         description:
│   │   │           │             "Book your boat with just a few taps. Select dates, location, and preferences hassle-free.",
│   │   │           │         lottieAsset: 'assets/booking_calendar.json',
│   │   │           │         // Placeholder path
│   │   │           │         bgColor: const Color(0xFFE8F5E9),
│   │   │           │         highlightColor: const Color(0xFF2E7D32),
│   │   │           │       ),
│   │   │           │       OnboardingItem(
│   │   │           │         title: "List Your Own Boat",
│   │   │           │         description:
│   │   │           │             "Boat owner? Earn by listing your boat for rent when you're not using it.",
│   │   │           │         lottieAsset: 'assets/money_boat.json',
│   │   │           │         // Placeholder path
│   │   │           │         bgColor: const Color(0xFFFFF3E0),
│   │   │           │         highlightColor: const Color(0xFFE65100),
│   │   │           │       ),
│   │   │           │       OnboardingItem(
│   │   │           │         title: "Set Sail Now",
│   │   │           │         description:
│   │   │           │             "Ready for your boating adventure? Let's get started and hit the waters!",
│   │   │           │         lottieAsset: 'assets/waves_boat.json',
│   │   │           │         // Placeholder path
│   │   │           │         bgColor: const Color(0xFFE0F7FA),
│   │   │           │         image: 'assets/logo.png',
│   │   │           │         // Placeholder path
│   │   │           │         highlightColor: const Color(0xFF006064),
│   │   │           │       ),
│   │   │           │     ];
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void initState() {
│   │   │           │       super.initState();
│   │   │           │       _lottieController = AnimationController(vsync: this); // Keep for Lottie
│   │   │           │       _fadeController = AnimationController(
│   │   │           │         duration: const Duration(milliseconds: 500),
│   │   │           │         vsync: this,
│   │   │           │       );
│   │   │           │       _fadeAnimation =
│   │   │           │           Tween<double>(begin: 0.0, end: 1.0).animate(_fadeController);
│   │   │           │       _fadeController.forward(); // Start fade-in animation
│   │   │           │     }
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void dispose() {
│   │   │           │       _pageController.dispose();
│   │   │           │       _lottieController.dispose(); // Keep for Lottie
│   │   │           │       _fadeController.dispose();
│   │   │           │       super.dispose();
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Updated navigateToApp function ---
│   │   │           │     void navigateToApp(BuildContext context) async {
│   │   │           │       // Save the onboarding flag using SharedPreferences
│   │   │           │       final prefs = await SharedPreferences.getInstance();
│   │   │           │       await prefs.setBool('hasSeenOnboarding', true);
│   │   │           │   
│   │   │           │       // Check if the widget is still mounted before navigating
│   │   │           │       if (!mounted) return;
│   │   │           │   
│   │   │           │       // Navigate to Login screen and replace the onboarding screen
│   │   │           │       Navigator.pushReplacement(
│   │   │           │         context,
│   │   │           │         MaterialPageRoute(builder: (context) => const LoginScreen()),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- End of updated function ---
│   │   │           │   
│   │   │           │     @override
│   │   │           │     Widget build(BuildContext context) {
│   │   │           │       return Scaffold(
│   │   │           │         body: Stack(
│   │   │           │           children: [
│   │   │           │             // Animated background (copied from your UI code)
│   │   │           │             AnimatedContainer(
│   │   │           │               duration: const Duration(milliseconds: 500),
│   │   │           │               color: _pages[_currentPage].bgColor,
│   │   │           │               curve: Curves.easeInOut,
│   │   │           │               child: Stack(
│   │   │           │                 children: [
│   │   │           │                   // Decorative wave patterns (copied from your UI code)
│   │   │           │                   Positioned(
│   │   │           │                     top: -100,
│   │   │           │                     right: -150,
│   │   │           │                     child: Transform.rotate(
│   │   │           │                       angle: 0.2,
│   │   │           │                       child: Container(
│   │   │           │                         height: 400,
│   │   │           │                         width: 400,
│   │   │           │                         decoration: BoxDecoration(
│   │   │           │                           color: _pages[_currentPage]
│   │   │           │                               .highlightColor
│   │   │           │                               .withOpacity(0.1),
│   │   │           │                           borderRadius: BorderRadius.circular(300),
│   │   │           │                         ),
│   │   │           │                       ),
│   │   │           │                     ),
│   │   │           │                   ),
│   │   │           │                   Positioned(
│   │   │           │                     bottom: -150,
│   │   │           │                     left: -100,
│   │   │           │                     child: Container(
│   │   │           │                       height: 300,
│   │   │           │                       width: 300,
│   │   │           │                       decoration: BoxDecoration(
│   │   │           │                         color:
│   │   │           │                             _pages[_currentPage].highlightColor.withOpacity(0.12),
│   │   │           │                         borderRadius: BorderRadius.circular(300),
│   │   │           │                       ),
│   │   │           │                     ),
│   │   │           │                   ),
│   │   │           │                 ],
│   │   │           │               ),
│   │   │           │             ),
│   │   │           │   
│   │   │           │             // Page content (copied from your UI code)
│   │   │           │             PageView.builder(
│   │   │           │               controller: _pageController,
│   │   │           │               itemCount: _pages.length,
│   │   │           │               onPageChanged: (int page) {
│   │   │           │                 setState(() {
│   │   │           │                   _currentPage = page;
│   │   │           │                   _isLastPage = page == _pages.length - 1;
│   │   │           │                   _fadeController.reset(); // Reset animation for new page
│   │   │           │                   _fadeController.forward();
│   │   │           │                 });
│   │   │           │               },
│   │   │           │               itemBuilder: (context, index) {
│   │   │           │                 return buildOnboardingPage(_pages[index]);
│   │   │           │               },
│   │   │           │             ),
│   │   │           │   
│   │   │           │             // Navigation controls (copied from your UI code, with updated onPressed)
│   │   │           │             Positioned(
│   │   │           │               bottom: 0,
│   │   │           │               left: 0,
│   │   │           │               right: 0,
│   │   │           │               child: Container(
│   │   │           │                 padding: const EdgeInsets.symmetric(horizontal: 20),
│   │   │           │                 height: 120,
│   │   │           │                 child: Row(
│   │   │           │                   mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │           │                   children: [
│   │   │           │                     // Skip button
│   │   │           │                     TextButton(
│   │   │           │                       // --- Call navigateToApp on Skip press ---
│   │   │           │                       onPressed: () => navigateToApp(context),
│   │   │           │                       child: Text(
│   │   │           │                         _isLastPage ? "" : "Skip", // Hide Skip on last page
│   │   │           │                         style: TextStyle(
│   │   │           │                           color: _pages[_currentPage].highlightColor,
│   │   │           │                           fontSize: 16,
│   │   │           │                           fontWeight: FontWeight.w600,
│   │   │           │                         ),
│   │   │           │                       ),
│   │   │           │                     ),
│   │   │           │   
│   │   │           │                     // Page indicators
│   │   │           │                     Row(
│   │   │           │                       children: List.generate(
│   │   │           │                         _pages.length,
│   │   │           │                         (index) => buildPageIndicator(index),
│   │   │           │                       ),
│   │   │           │                     ),
│   │   │           │   
│   │   │           │                     // Next/Get Started button
│   │   │           │                     AnimatedContainer(
│   │   │           │                       duration: const Duration(milliseconds: 300),
│   │   │           │                       height: 48,
│   │   │           │                       width: _isLastPage ? 160 : 48,
│   │   │           │                       decoration: BoxDecoration(
│   │   │           │                         color: _pages[_currentPage].highlightColor,
│   │   │           │                         borderRadius: BorderRadius.circular(24),
│   │   │           │                         boxShadow: [
│   │   │           │                           BoxShadow(
│   │   │           │                             color: _pages[_currentPage]
│   │   │           │                                 .highlightColor
│   │   │           │                                 .withOpacity(0.3),
│   │   │           │                             blurRadius: 10,
│   │   │           │                             offset: const Offset(0, 5),
│   │   │           │                           ),
│   │   │           │                         ],
│   │   │           │                       ),
│   │   │           │                       child: Material(
│   │   │           │                         color: Colors.transparent,
│   │   │           │                         child: InkWell(
│   │   │           │                           borderRadius: BorderRadius.circular(24),
│   │   │           │                           // --- Call navigateToApp on Get Started press ---
│   │   │           │                           onTap: () {
│   │   │           │                             if (_isLastPage) {
│   │   │           │                               navigateToApp(context); // Navigate on last page
│   │   │           │                             } else {
│   │   │           │                               _pageController.nextPage(
│   │   │           │                                 duration: const Duration(milliseconds: 500),
│   │   │           │                                 curve: Curves.easeInOut,
│   │   │           │                               );
│   │   │           │                             }
│   │   │           │                           },
│   │   │           │                           child: Center(
│   │   │           │                             child: _isLastPage
│   │   │           │                                 ? const Row(
│   │   │           │                                     mainAxisAlignment: MainAxisAlignment.center,
│   │   │           │                                     children: [
│   │   │           │                                       Text(
│   │   │           │                                         "Get Started",
│   │   │           │                                         style: TextStyle(
│   │   │           │                                           color: Colors.white,
│   │   │           │                                           fontSize: 16,
│   │   │           │                                           fontWeight: FontWeight.w600,
│   │   │           │                                         ),
│   │   │           │                                       ),
│   │   │           │                                       SizedBox(width: 8),
│   │   │           │                                       Icon(
│   │   │           │                                         Icons.arrow_forward_rounded,
│   │   │           │                                         color: Colors.white,
│   │   │           │                                       ),
│   │   │           │                                     ],
│   │   │           │                                   )
│   │   │           │                                 : const Icon(
│   │   │           │                                     Icons.arrow_forward_rounded,
│   │   │           │                                     color: Colors.white,
│   │   │           │                                   ),
│   │   │           │                           ),
│   │   │           │                         ),
│   │   │           │                       ),
│   │   │           │                     ),
│   │   │           │                   ],
│   │   │           │                 ),
│   │   │           │               ),
│   │   │           │             ),
│   │   │           │           ],
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Helper methods copied from your UI code ---
│   │   │           │   
│   │   │           │     Widget buildOnboardingPage(OnboardingItem item) {
│   │   │           │       return FadeTransition(
│   │   │           │         opacity: _fadeAnimation,
│   │   │           │         child: SafeArea(
│   │   │           │           child: Padding(
│   │   │           │             padding: const EdgeInsets.all(20.0),
│   │   │           │             child: Column(
│   │   │           │               mainAxisAlignment: MainAxisAlignment.center,
│   │   │           │               children: <Widget>[
│   │   │           │                 const SizedBox(height: 60),
│   │   │           │   
│   │   │           │                 // Lottie animation Placeholder (Using Icon)
│   │   │           │                 Hero(
│   │   │           │                   tag: "onboarding_image_${item.title}",
│   │   │           │                   child: Container(
│   │   │           │                     height: 250,
│   │   │           │                     decoration: BoxDecoration(
│   │   │           │                       color: Colors.white.withOpacity(0.7),
│   │   │           │                       borderRadius: BorderRadius.circular(30),
│   │   │           │                       boxShadow: [
│   │   │           │                         BoxShadow(
│   │   │           │                           color: item.highlightColor.withOpacity(0.1),
│   │   │           │                           blurRadius: 20,
│   │   │           │                           spreadRadius: 5,
│   │   │           │                         ),
│   │   │           │                       ],
│   │   │           │                     ),
│   │   │           │                     margin: const EdgeInsets.symmetric(horizontal: 20),
│   │   │           │                     padding: const EdgeInsets.all(20),
│   │   │           │                     // Replace with Lottie.asset(item.lottieAsset, controller: _lottieController, ...) in real app
│   │   │           │                     child: item.image == null
│   │   │           │                         ? Center(
│   │   │           │                             child: Icon(
│   │   │           │                               getIconForPage(item.title), // Placeholder Icon
│   │   │           │                               size: 120,
│   │   │           │                               color: item.highlightColor,
│   │   │           │                             ),
│   │   │           │                           )
│   │   │           │                         : Image.asset(
│   │   │           │                             item.image!,
│   │   │           │                             fit: BoxFit.cover,
│   │   │           │                             width: 120,
│   │   │           │                             height: 120,
│   │   │           │                           ),
│   │   │           │                   ),
│   │   │           │                 ),
│   │   │           │   
│   │   │           │                 const SizedBox(height: 40),
│   │   │           │   
│   │   │           │                 // Title
│   │   │           │                 Text(
│   │   │           │                   item.title,
│   │   │           │                   style: TextStyle(
│   │   │           │                     fontSize: 24,
│   │   │           │                     fontWeight: FontWeight.bold,
│   │   │           │                     color: item.highlightColor,
│   │   │           │                   ),
│   │   │           │                   textAlign: TextAlign.center,
│   │   │           │                 ),
│   │   │           │   
│   │   │           │                 const SizedBox(height: 8),
│   │   │           │   
│   │   │           │                 // Animated underline
│   │   │           │                 TweenAnimationBuilder<double>(
│   │   │           │                   tween: Tween(begin: 0.0, end: 1.0),
│   │   │           │                   duration: const Duration(milliseconds: 600),
│   │   │           │                   curve: Curves.easeInOut,
│   │   │           │                   builder: (context, value, child) {
│   │   │           │                     return Container(
│   │   │           │                       height: 4,
│   │   │           │                       width: 100 * value,
│   │   │           │                       decoration: BoxDecoration(
│   │   │           │                         color: item.highlightColor,
│   │   │           │                         borderRadius: BorderRadius.circular(2),
│   │   │           │                       ),
│   │   │           │                     );
│   │   │           │                   },
│   │   │           │                 ),
│   │   │           │   
│   │   │           │                 const SizedBox(height: 24),
│   │   │           │   
│   │   │           │                 // Description
│   │   │           │                 Text(
│   │   │           │                   item.description,
│   │   │           │                   style: const TextStyle(
│   │   │           │                     fontSize: 16,
│   │   │           │                     color: Colors.black87,
│   │   │           │                     height: 1.5,
│   │   │           │                   ),
│   │   │           │                   textAlign: TextAlign.center,
│   │   │           │                 ),
│   │   │           │               ],
│   │   │           │             ),
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     Widget buildPageIndicator(int index) {
│   │   │           │       bool isCurrentPage = index == _currentPage;
│   │   │           │   
│   │   │           │       return AnimatedContainer(
│   │   │           │         duration: const Duration(milliseconds: 300),
│   │   │           │         margin: const EdgeInsets.symmetric(horizontal: 5),
│   │   │           │         height: isCurrentPage ? 12 : 8,
│   │   │           │         width: isCurrentPage ? 30 : 8,
│   │   │           │         decoration: BoxDecoration(
│   │   │           │           color: isCurrentPage
│   │   │           │               ? _pages[_currentPage].highlightColor
│   │   │           │               : _pages[_currentPage].highlightColor.withOpacity(0.3),
│   │   │           │           borderRadius: BorderRadius.circular(12),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     IconData getIconForPage(String title) {
│   │   │           │       // Replace this with actual Lottie assets in a real implementation
│   │   │           │       if (title.contains("Find")) {
│   │   │           │         return Icons.search;
│   │   │           │       } else if (title.contains("Booking")) {
│   │   │           │         return Icons.calendar_today;
│   │   │           │       } else if (title.contains("List")) {
│   │   │           │         return Icons.monetization_on;
│   │   │           │       } else {
│   │   │           │         return Icons.sailing;
│   │   │           │       }
│   │   │           │     }
│   │   │           │   }
│   │   ├── home/
│   │   │   └── screen.dart
│   │   │       │   // lib/features/home/screen.dart
│   │   │       │   
│   │   │       │   import 'package:app/utils/snackbar.dart';
│   │   │       │   import 'package:app/widgets/drawer.dart';
│   │   │       │   import 'package:flutter/material.dart';
│   │   │       │   import 'dart:ui'; // For BackdropFilter
│   │   │       │   import 'package:collection/collection.dart'; // For groupBy
│   │   │       │   import 'package:app/app/theme.dart';
│   │   │       │   import 'package:carousel_slider/carousel_slider.dart';
│   │   │       │   import 'package:localization/localization.dart';
│   │   │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart';
│   │   │       │   
│   │   │       │   // --- Import Controllers, Models, and Screens ---
│   │   │       │   import 'package:app/controllers/boat.dart';
│   │   │       │   import 'package:app/models/boat.dart';
│   │   │       │   import 'package:app/features/renter/boats/list/screen.dart';
│   │   │       │   import 'package:app/features/owner/boats/details/screen.dart' as owner_details;
│   │   │       │   import 'package:app/controllers/auth.dart';
│   │   │       │   // Import other screens if needed for future navigation
│   │   │       │   // import 'package:app/features/bookings/add/screen.dart';
│   │   │       │   
│   │   │       │   class HomeScreen extends StatefulWidget {
│   │   │       │     const HomeScreen({super.key});
│   │   │       │   
│   │   │       │     @override
│   │   │       │     State<HomeScreen> createState() => _HomeScreenState();
│   │   │       │   }
│   │   │       │   
│   │   │       │   class _HomeScreenState extends State<HomeScreen> {
│   │   │       │     // --- State Variables ---
│   │   │       │     final BoatController _boatController = BoatController();
│   │   │       │     final _storage = const FlutterSecureStorage();
│   │   │       │     List<Boat> _featuredBoats = []; // Holds boats for the carousel
│   │   │       │     List<Map<String, dynamic>> _popularDestinations =
│   │   │       │         []; // Holds processed destination data
│   │   │       │     bool _isLoading = true; // Loading state for initial fetch
│   │   │       │     String? _errorMessage; // Error message if fetch fails
│   │   │       │     int _currentCarouselIndex = 0; // For carousel indicator dots
│   │   │       │   
│   │   │       │     // Constants
│   │   │       │     static const int MAX_FEATURED_BOATS = 5;
│   │   │       │     static const int MAX_POPULAR_DESTINATIONS = 6; // Max destinations to show
│   │   │       │     static const String FALLBACK_IMAGE_URL =
│   │   │       │         'https://placehold.co/600x400/E0E0E0/BDBDBD?text=No+Image';
│   │   │       │   
│   │   │       │     @override
│   │   │       │     void initState() {
│   │   │       │       super.initState();
│   │   │       │       _fetchData(); // Fetch data when the screen loads
│   │   │       │     }
│   │   │       │   
│   │   │       │     // Add method to load user data
│   │   │       │   
│   │   │       │     // --- Fetch Data (Featured Boats and Process Destinations) ---
│   │   │       │     Future<void> _fetchData() async {
│   │   │       │       if (!mounted) return;
│   │   │       │       setState(() {
│   │   │       │         _isLoading = true;
│   │   │       │         _errorMessage = null;
│   │   │       │         _featuredBoats = [];
│   │   │       │         _popularDestinations = [];
│   │   │       │       });
│   │   │       │   
│   │   │       │       // final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │       │   
│   │   │       │       try {
│   │   │       │         // Fetch active boats, ordered by rating
│   │   │       │         final allBoats = await _boatController.fetchBoats(
│   │   │       │           ordering: '-average_rating',
│   │   │       │         );
│   │   │       │   
│   │   │       │         if (!mounted) return;
│   │   │       │   
│   │   │       │         // Process fetched boats
│   │   │       │         _featuredBoats = allBoats.take(MAX_FEATURED_BOATS).toList();
│   │   │       │         _popularDestinations = _processDestinations(allBoats);
│   │   │       │   
│   │   │       │         setState(() {
│   │   │       │           _isLoading = false;
│   │   │       │         });
│   │   │       │       } catch (e) {
│   │   │       │         debugPrint("Home Screen Fetch Error: $e");
│   │   │       │         if (mounted) {
│   │   │       │           setState(() {
│   │   │       │             _isLoading = false;
│   │   │       │             _errorMessage = "Failed to load boat data. Please try again.";
│   │   │       │           });
│   │   │       │         }
│   │   │       │       }
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Process Fetched Boats to Extract Popular Destinations ---
│   │   │       │     List<Map<String, dynamic>> _processDestinations(List<Boat> boats) {
│   │   │       │       if (boats.isEmpty) return [];
│   │   │       │   
│   │   │       │       final groupedByLocation = groupBy(
│   │   │       │         boats,
│   │   │       │         (Boat boat) => boat.locationDescription.trim(),
│   │   │       │       );
│   │   │       │   
│   │   │       │       List<Map<String, dynamic>> destinations = [];
│   │   │       │   
│   │   │       │       groupedByLocation.forEach((location, boatsInLocation) {
│   │   │       │         if (location.isEmpty || boatsInLocation.isEmpty) return;
│   │   │       │   
│   │   │       │         Boat representativeBoat = boatsInLocation.first;
│   │   │       │         double highestRating = -1.0;
│   │   │       │         double minPrice = double.maxFinite;
│   │   │       │   
│   │   │       │         for (var boat in boatsInLocation) {
│   │   │       │           if (boat.rentalPricePerDay < minPrice) {
│   │   │       │             minPrice = boat.rentalPricePerDay;
│   │   │       │           }
│   │   │       │           if (boat.averageRating > highestRating) {
│   │   │       │             highestRating = boat.averageRating;
│   │   │       │             representativeBoat = boat;
│   │   │       │           }
│   │   │       │         }
│   │   │       │   
│   │   │       │         destinations.add({
│   │   │       │           'name': location,
│   │   │       │           'image': representativeBoat.mainImageUrl ?? FALLBACK_IMAGE_URL,
│   │   │       │           'rating': representativeBoat.averageRating.toStringAsFixed(1),
│   │   │       │           'price': 'starting_sar_day'.i18n([
│   │   │       │             minPrice.toStringAsFixed(0),
│   │   │       │           ]),
│   │   │       │           'location_filter': location,
│   │   │       │         });
│   │   │       │       });
│   │   │       │   
│   │   │       │       destinations.sort((a, b) =>
│   │   │       │           double.parse(b['rating']).compareTo(double.parse(a['rating'])));
│   │   │       │   
│   │   │       │       return destinations.take(MAX_POPULAR_DESTINATIONS).toList();
│   │   │       │     }
│   │   │       │   
│   │   │       │     @override
│   │   │       │     Widget build(BuildContext context) {
│   │   │       │       return Scaffold(
│   │   │       │         backgroundColor: AppColors.scaffoldBackgroundColor,
│   │   │       │         extendBodyBehindAppBar: true,
│   │   │       │         appBar: _buildAppBar(context),
│   │   │       │         body: _buildBodyContent(),
│   │   │       │         drawer: AppDrawer(
│   │   │       │           onLogout: () async {
│   │   │       │             await AuthController.instance.logout();
│   │   │       │             Navigator.pushReplacementNamed(context, '/login');
│   │   │       │           },
│   │   │       │           // Pass user data to drawer
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Build Body Content (Loading/Error/Data) ---
│   │   │       │     Widget _buildBodyContent() {
│   │   │       │       if (_isLoading) {
│   │   │       │         return const Center(child: CircularProgressIndicator());
│   │   │       │       }
│   │   │       │       if (_errorMessage != null) {
│   │   │       │         return Center(
│   │   │       │             child: Padding(
│   │   │       │                 padding: const EdgeInsets.all(20.0),
│   │   │       │                 child: Column(
│   │   │       │                   mainAxisSize: MainAxisSize.min,
│   │   │       │                   children: [
│   │   │       │                     Icon(Icons.cloud_off, color: Colors.grey.shade400, size: 60),
│   │   │       │                     const SizedBox(height: 16),
│   │   │       │                     Text(_errorMessage!,
│   │   │       │                         textAlign: TextAlign.center,
│   │   │       │                         style: TextStyle(color: Colors.red.shade700)),
│   │   │       │                     const SizedBox(height: 16),
│   │   │       │                     ElevatedButton.icon(
│   │   │       │                       onPressed: _fetchData,
│   │   │       │                       icon: const Icon(Icons.refresh),
│   │   │       │                       label: const Text('Retry'),
│   │   │       │                     )
│   │   │       │                   ],
│   │   │       │                 )));
│   │   │       │       }
│   │   │       │       // --- Main Content Display ---
│   │   │       │       return SafeArea(
│   │   │       │         child: RefreshIndicator(
│   │   │       │           onRefresh: _fetchData,
│   │   │       │           child: SingleChildScrollView(
│   │   │       │             physics: const BouncingScrollPhysics(
│   │   │       │                 parent: AlwaysScrollableScrollPhysics()),
│   │   │       │             child: Column(
│   │   │       │               crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │       │               children: <Widget>[
│   │   │       │                 const SizedBox(height: 20),
│   │   │       │                 _buildHeroCarousel(context),
│   │   │       │                 const SizedBox(height: 30),
│   │   │       │                 _buildBoatTypesSection(context),
│   │   │       │                 const SizedBox(height: 40),
│   │   │       │                 _buildPopularBoatDestinationsSection(
│   │   │       │                     context), // Now uses dynamic data
│   │   │       │                 const SizedBox(height: 40),
│   │   │       │                 _buildRentalIdeasSection(context),
│   │   │       │                 const SizedBox(height: 50),
│   │   │       │                 _buildKSAInspirationQuote(context),
│   │   │       │                 const SizedBox(height: 40),
│   │   │       │                 _buildNewsletter(context),
│   │   │       │                 const SizedBox(height: 40),
│   │   │       │               ],
│   │   │       │             ),
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- AppBar ---
│   │   │       │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │       │       return AppBar(
│   │   │       │         backgroundColor:
│   │   │       │             Theme.of(context).appBarTheme.backgroundColor?.withOpacity(0.85),
│   │   │       │         elevation: Theme.of(context).appBarTheme.elevation ?? 0,
│   │   │       │         scrolledUnderElevation:
│   │   │       │             Theme.of(context).appBarTheme.scrolledUnderElevation,
│   │   │       │         flexibleSpace: ClipRect(
│   │   │       │           child: BackdropFilter(
│   │   │       │             filter: ImageFilter.blur(sigmaX: 10, sigmaY: 10),
│   │   │       │             child: Container(color: Colors.transparent),
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │         title: Text('Qarib', style: Theme.of(context).appBarTheme.titleTextStyle),
│   │   │       │         centerTitle: Theme.of(context).appBarTheme.centerTitle ?? true,
│   │   │       │         iconTheme: Theme.of(context).appBarTheme.iconTheme,
│   │   │       │         actions: [
│   │   │       │           IconButton(
│   │   │       │             icon: const Icon(Icons.search, size: 26),
│   │   │       │             tooltip: 'search_boats_tooltip'.i18n(),
│   │   │       │             onPressed: () {
│   │   │       │               Navigator.push(
│   │   │       │                   context,
│   │   │       │                   MaterialPageRoute(
│   │   │       │                       builder: (_) => const RenterListBoatsScreen()));
│   │   │       │             },
│   │   │       │           ),
│   │   │       │         ],
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Hero Carousel - Using Fetched Data ---
│   │   │       │     Widget _buildHeroCarousel(BuildContext context) {
│   │   │       │       if (_featuredBoats.isEmpty) {
│   │   │       │         return Container(
│   │   │       │             height: 350,
│   │   │       │             alignment: Alignment.center,
│   │   │       │             padding: const EdgeInsets.symmetric(horizontal: 24),
│   │   │       │             child: Text(
│   │   │       │               'no_featured_boats_available'.i18n(),
│   │   │       │               style: TextStyle(color: Colors.grey[600]),
│   │   │       │               textAlign: TextAlign.center,
│   │   │       │             ));
│   │   │       │       }
│   │   │       │   
│   │   │       │       return Padding(
│   │   │       │         padding: const EdgeInsets.symmetric(horizontal: 16.0, vertical: 4),
│   │   │       │         child: Column(
│   │   │       │           crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │           children: [
│   │   │       │             Padding(
│   │   │       │               padding: const EdgeInsets.only(left: 8.0, bottom: 16.0),
│   │   │       │               child: RichText(
│   │   │       │                 text: TextSpan(
│   │   │       │                   style: Theme.of(context).textTheme.titleLarge?.copyWith(
│   │   │       │                         color: AppColors.primary,
│   │   │       │                       ),
│   │   │       │                   children: [
│   │   │       │                     TextSpan(text: 'discover_prefix'.i18n()),
│   │   │       │                     TextSpan(
│   │   │       │                       text: 'ksa_coasts_highlight'.i18n(),
│   │   │       │                       style:
│   │   │       │                           TextStyle(color: Theme.of(context).colorScheme.primary),
│   │   │       │                     ),
│   │   │       │                   ],
│   │   │       │                 ),
│   │   │       │               ),
│   │   │       │             ),
│   │   │       │             CarouselSlider.builder(
│   │   │       │               itemCount: _featuredBoats.length,
│   │   │       │               options: CarouselOptions(
│   │   │       │                 height: 350,
│   │   │       │                 autoPlay: _featuredBoats.length > 1,
│   │   │       │                 enlargeCenterPage: true,
│   │   │       │                 viewportFraction: 0.9,
│   │   │       │                 aspectRatio: 16 / 9,
│   │   │       │                 initialPage: 0,
│   │   │       │                 enableInfiniteScroll: _featuredBoats.length > 1,
│   │   │       │                 autoPlayAnimationDuration: const Duration(milliseconds: 1200),
│   │   │       │                 autoPlayCurve: Curves.easeInOutCubic,
│   │   │       │                 pauseAutoPlayOnTouch: true,
│   │   │       │                 onPageChanged: (index, reason) =>
│   │   │       │                     setState(() => _currentCarouselIndex = index),
│   │   │       │               ),
│   │   │       │               itemBuilder: (BuildContext context, int index, int realIndex) {
│   │   │       │                 final boat = _featuredBoats[index];
│   │   │       │                 return _buildCarouselItem(
│   │   │       │                     context,
│   │   │       │                     boat.mainImageUrl ?? FALLBACK_IMAGE_URL,
│   │   │       │                     boat.name,
│   │   │       │                     boat.locationDescription,
│   │   │       │                     boat.averageRating.toStringAsFixed(1), () {
│   │   │       │                   Navigator.push(
│   │   │       │                     context,
│   │   │       │                     MaterialPageRoute(
│   │   │       │                         builder: (_) =>
│   │   │       │                             owner_details.BoatDetailsScreen(boatId: boat.id)),
│   │   │       │                   );
│   │   │       │                 });
│   │   │       │               },
│   │   │       │             ),
│   │   │       │             Row(
│   │   │       │               mainAxisAlignment: MainAxisAlignment.center,
│   │   │       │               children: _featuredBoats.asMap().entries.map((entry) {
│   │   │       │                 return GestureDetector(
│   │   │       │                   onTap: () => _currentCarouselIndex =
│   │   │       │                       entry.key, // Consider animating page change here
│   │   │       │                   child: AnimatedContainer(
│   │   │       │                     duration: const Duration(milliseconds: 300),
│   │   │       │                     width: _currentCarouselIndex == entry.key ? 12.0 : 8.0,
│   │   │       │                     height: _currentCarouselIndex == entry.key ? 12.0 : 8.0,
│   │   │       │                     margin: const EdgeInsets.symmetric(
│   │   │       │                         vertical: 10.0, horizontal: 4.0),
│   │   │       │                     decoration: BoxDecoration(
│   │   │       │                         shape: BoxShape.circle,
│   │   │       │                         color: (Theme.of(context).brightness == Brightness.dark
│   │   │       │                                 ? Colors.white
│   │   │       │                                 : Theme.of(context).primaryColor)
│   │   │       │                             .withOpacity(
│   │   │       │                                 _currentCarouselIndex == entry.key ? 0.9 : 0.4)),
│   │   │       │                   ),
│   │   │       │                 );
│   │   │       │               }).toList(),
│   │   │       │             ),
│   │   │       │           ],
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Carousel Item Widget (Accepts onTap) ---
│   │   │       │     Widget _buildCarouselItem(BuildContext context, String imagePathOrUrl,
│   │   │       │         String title, String location, String rating, VoidCallback onTap) {
│   │   │       │       return GestureDetector(
│   │   │       │         onTap: onTap,
│   │   │       │         child: Container(
│   │   │       │           margin: const EdgeInsets.symmetric(horizontal: 4.0, vertical: 16),
│   │   │       │           decoration: BoxDecoration(
│   │   │       │             borderRadius: BorderRadius.circular(24.0),
│   │   │       │             boxShadow: [
│   │   │       │               BoxShadow(
│   │   │       │                 color: Colors.black.withOpacity(0.2),
│   │   │       │                 spreadRadius: 0,
│   │   │       │                 blurRadius: 15,
│   │   │       │                 offset: const Offset(0, 8),
│   │   │       │               ),
│   │   │       │             ],
│   │   │       │           ),
│   │   │       │           child: ClipRRect(
│   │   │       │             borderRadius: BorderRadius.circular(24.0),
│   │   │       │             child: Stack(
│   │   │       │               fit: StackFit.expand,
│   │   │       │               children: [
│   │   │       │                 ShaderMask(
│   │   │       │                   shaderCallback: (rect) => LinearGradient(
│   │   │       │                     begin: Alignment.topCenter,
│   │   │       │                     end: Alignment.bottomCenter,
│   │   │       │                     colors: [
│   │   │       │                       Colors.black,
│   │   │       │                       Colors.black.withOpacity(0.8),
│   │   │       │                       Colors.transparent
│   │   │       │                     ],
│   │   │       │                     stops: const [0.0, 0.7, 1.0],
│   │   │       │                   ).createShader(rect),
│   │   │       │                   blendMode: BlendMode.dstIn,
│   │   │       │                   child: imagePathOrUrl.startsWith('http')
│   │   │       │                       ? Image.network(imagePathOrUrl,
│   │   │       │                           fit: BoxFit.cover,
│   │   │       │                           width: double.infinity,
│   │   │       │                           height: double.infinity,
│   │   │       │                           errorBuilder: (c, e, s) =>
│   │   │       │                               const Icon(Icons.error, color: Colors.grey))
│   │   │       │                       : Image.asset(imagePathOrUrl,
│   │   │       │                           fit: BoxFit.cover,
│   │   │       │                           width: double.infinity,
│   │   │       │                           height: double.infinity,
│   │   │       │                           errorBuilder: (c, e, s) =>
│   │   │       │                               const Icon(Icons.error, color: Colors.grey)),
│   │   │       │                 ),
│   │   │       │                 Container(
│   │   │       │                   decoration: BoxDecoration(
│   │   │       │                     gradient: LinearGradient(
│   │   │       │                       colors: [Colors.transparent, Colors.black.withOpacity(0.7)],
│   │   │       │                       begin: Alignment.topCenter,
│   │   │       │                       end: Alignment.bottomCenter,
│   │   │       │                     ),
│   │   │       │                   ),
│   │   │       │                 ),
│   │   │       │                 Padding(
│   │   │       │                   padding: const EdgeInsets.all(24.0),
│   │   │       │                   child: Column(
│   │   │       │                     crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │                     mainAxisAlignment: MainAxisAlignment.end,
│   │   │       │                     children: [
│   │   │       │                       Container(
│   │   │       │                         padding: const EdgeInsets.symmetric(
│   │   │       │                             horizontal: 12, vertical: 6),
│   │   │       │                         decoration: BoxDecoration(
│   │   │       │                           color: Theme.of(context)
│   │   │       │                               .colorScheme
│   │   │       │                               .primary
│   │   │       │                               .withOpacity(0.8),
│   │   │       │                           borderRadius: BorderRadius.circular(30),
│   │   │       │                         ),
│   │   │       │                         child: Text(
│   │   │       │                           'featured_destination_tag'.i18n(),
│   │   │       │                           style: const TextStyle(
│   │   │       │                             color: Colors.white,
│   │   │       │                             fontSize: 12,
│   │   │       │                             fontWeight: FontWeight.bold,
│   │   │       │                           ),
│   │   │       │                         ),
│   │   │       │                       ),
│   │   │       │                       const SizedBox(height: 12),
│   │   │       │                       Text(
│   │   │       │                         title,
│   │   │       │                         style:
│   │   │       │                             Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │       │                           color: Colors.white,
│   │   │       │                           fontWeight: FontWeight.w900,
│   │   │       │                           fontSize: 28,
│   │   │       │                           height: 1.2,
│   │   │       │                           shadows: [
│   │   │       │                             const Shadow(
│   │   │       │                                 blurRadius: 8.0,
│   │   │       │                                 color: Colors.black54,
│   │   │       │                                 offset: Offset(0, 2.0)),
│   │   │       │                           ],
│   │   │       │                         ),
│   │   │       │                       ),
│   │   │       │                       const SizedBox(height: 10),
│   │   │       │                       Row(children: [
│   │   │       │                         Icon(
│   │   │       │                           Icons.location_on,
│   │   │       │                           color: Colors.white.withOpacity(0.9),
│   │   │       │                           size: 16,
│   │   │       │                         ),
│   │   │       │                         const SizedBox(width: 4),
│   │   │       │                         Expanded(
│   │   │       │                             child: Text(
│   │   │       │                           location,
│   │   │       │                           style: TextStyle(
│   │   │       │                             color: Colors.white.withOpacity(0.9),
│   │   │       │                             fontWeight: FontWeight.w500,
│   │   │       │                           ),
│   │   │       │                           overflow: TextOverflow.ellipsis,
│   │   │       │                         )),
│   │   │       │                         Container(
│   │   │       │                           padding: const EdgeInsets.symmetric(
│   │   │       │                               horizontal: 12, vertical: 6),
│   │   │       │                           decoration: BoxDecoration(
│   │   │       │                             color: Colors.white.withOpacity(0.2),
│   │   │       │                             borderRadius: BorderRadius.circular(20),
│   │   │       │                           ),
│   │   │       │                           child: Row(
│   │   │       │                             children: [
│   │   │       │                               const Icon(
│   │   │       │                                 Icons.star,
│   │   │       │                                 color: Colors.amber,
│   │   │       │                                 size: 16,
│   │   │       │                               ),
│   │   │       │                               const SizedBox(width: 4),
│   │   │       │                               Text(
│   │   │       │                                 rating,
│   │   │       │                                 style: const TextStyle(
│   │   │       │                                   color: Colors.white,
│   │   │       │                                   fontWeight: FontWeight.bold,
│   │   │       │                                 ),
│   │   │       │                               ),
│   │   │       │                             ],
│   │   │       │                           ),
│   │   │       │                         ),
│   │   │       │                       ]),
│   │   │       │                     ],
│   │   │       │                   ),
│   │   │       │                 ),
│   │   │       │               ],
│   │   │       │             ),
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Boat Types Section ---
│   │   │       │     Widget _buildBoatTypesSection(BuildContext context) {
│   │   │       │       final List<Map<String, dynamic>> boatTypes = [
│   │   │       │         {
│   │   │       │           'name': 'luxury_yachts_category'.i18n(),
│   │   │       │           'icon': Icons.directions_boat,
│   │   │       │           'gradient': [Colors.blue.shade300, Colors.blue.shade700],
│   │   │       │           'type_filter': 'Yacht'
│   │   │       │         },
│   │   │       │         {
│   │   │       │           'name': 'speed_boats_category'.i18n(),
│   │   │       │           'icon': Icons.directions_boat_filled,
│   │   │       │           'gradient': [Colors.orange.shade300, Colors.orange.shade700],
│   │   │       │           'type_filter': 'Speed Boat'
│   │   │       │         },
│   │   │       │         {
│   │   │       │           'name': 'fishing_boats_category'.i18n(),
│   │   │       │           'icon': Icons.rowing,
│   │   │       │           'gradient': [Colors.green.shade300, Colors.green.shade700],
│   │   │       │           'type_filter': 'Fishing Boat'
│   │   │       │         },
│   │   │       │         {
│   │   │       │           'name': 'dhow_boats_category'.i18n(),
│   │   │       │           'icon': Icons.sailing,
│   │   │       │           'gradient': [Colors.teal.shade300, Colors.teal.shade700],
│   │   │       │           'type_filter': 'Dhow'
│   │   │       │         },
│   │   │       │       ];
│   │   │       │       return Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
│   │   │       │         Padding(
│   │   │       │           padding: const EdgeInsets.symmetric(horizontal: 24.0),
│   │   │       │           child: Row(
│   │   │       │             mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │       │             children: [
│   │   │       │               Text(
│   │   │       │                 'explore_boat_categories_title'.i18n(),
│   │   │       │                 style: Theme.of(context).textTheme.titleLarge?.copyWith(
│   │   │       │                       color: AppColors.primary,
│   │   │       │                     ),
│   │   │       │               ),
│   │   │       │               TextButton(
│   │   │       │                 onPressed: () => Navigator.push(
│   │   │       │                   context,
│   │   │       │                   MaterialPageRoute(
│   │   │       │                       builder: (_) => const RenterListBoatsScreen()),
│   │   │       │                 ),
│   │   │       │                 child: Text(
│   │   │       │                   'view_all_button'.i18n(),
│   │   │       │                   style: TextStyle(
│   │   │       │                     color: Theme.of(context).colorScheme.primary,
│   │   │       │                     fontWeight: FontWeight.w600,
│   │   │       │                   ),
│   │   │       │                 ),
│   │   │       │               ),
│   │   │       │             ],
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │         const SizedBox(height: 15),
│   │   │       │         GridView.builder(
│   │   │       │           padding: const EdgeInsets.symmetric(horizontal: 20.0),
│   │   │       │           shrinkWrap: true,
│   │   │       │           physics: const NeverScrollableScrollPhysics(),
│   │   │       │           gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
│   │   │       │             crossAxisCount: 4,
│   │   │       │             crossAxisSpacing: 12,
│   │   │       │             mainAxisSpacing: 16,
│   │   │       │             childAspectRatio: 0.8,
│   │   │       │           ),
│   │   │       │           itemCount: boatTypes.length,
│   │   │       │           itemBuilder: (context, index) =>
│   │   │       │               _buildBoatTypeItem(context, boatTypes[index]),
│   │   │       │         ),
│   │   │       │       ]);
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Boat Type Item ---
│   │   │       │     Widget _buildBoatTypeItem(
│   │   │       │         BuildContext context, Map<String, dynamic> boatType) {
│   │   │       │       return GestureDetector(
│   │   │       │         onTap: () {
│   │   │       │           Navigator.push(
│   │   │       │               context,
│   │   │       │               MaterialPageRoute(
│   │   │       │                   builder: (_) => RenterListBoatsScreen(
│   │   │       │                       initialFilter: {'boat_type': boatType['type_filter']})));
│   │   │       │         },
│   │   │       │         child: Column(
│   │   │       │           mainAxisAlignment: MainAxisAlignment.center,
│   │   │       │           children: [
│   │   │       │             Container(
│   │   │       │               height: 60,
│   │   │       │               width: 60,
│   │   │       │               decoration: BoxDecoration(
│   │   │       │                 gradient: LinearGradient(
│   │   │       │                   colors: boatType['gradient'],
│   │   │       │                   begin: Alignment.topLeft,
│   │   │       │                   end: Alignment.bottomRight,
│   │   │       │                 ),
│   │   │       │                 borderRadius: BorderRadius.circular(20),
│   │   │       │                 boxShadow: [
│   │   │       │                   BoxShadow(
│   │   │       │                     color: boatType['gradient'][1].withOpacity(0.4),
│   │   │       │                     spreadRadius: 0,
│   │   │       │                     blurRadius: 8,
│   │   │       │                     offset: const Offset(0, 4),
│   │   │       │                   ),
│   │   │       │                 ],
│   │   │       │               ),
│   │   │       │               child: Icon(
│   │   │       │                 boatType['icon'],
│   │   │       │                 color: Colors.white,
│   │   │       │                 size: 30,
│   │   │       │               ),
│   │   │       │             ),
│   │   │       │             const SizedBox(height: 8),
│   │   │       │             Text(
│   │   │       │               boatType['name'],
│   │   │       │               style: Theme.of(context).textTheme.bodySmall?.copyWith(
│   │   │       │                     color: AppColors.primary,
│   │   │       │                     fontWeight: FontWeight.w500,
│   │   │       │                     fontSize: 10,
│   │   │       │                   ),
│   │   │       │               textAlign: TextAlign.center,
│   │   │       │               maxLines: 2,
│   │   │       │               overflow: TextOverflow.ellipsis,
│   │   │       │             ),
│   │   │       │           ],
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Popular Destinations Section (DYNAMIC) ---
│   │   │       │     Widget _buildPopularBoatDestinationsSection(BuildContext context) {
│   │   │       │       return Column(
│   │   │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │         children: [
│   │   │       │           Padding(
│   │   │       │             padding: const EdgeInsets.symmetric(horizontal: 24.0),
│   │   │       │             child: Row(
│   │   │       │               mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │       │               children: [
│   │   │       │                 Text(
│   │   │       │                   'popular_ksa_boat_spots_title'.i18n(),
│   │   │       │                   style: Theme.of(context).textTheme.titleLarge?.copyWith(
│   │   │       │                         color: AppColors.primary,
│   │   │       │                       ),
│   │   │       │                 ),
│   │   │       │                 TextButton(
│   │   │       │                   onPressed: () => Navigator.push(
│   │   │       │                     context,
│   │   │       │                     MaterialPageRoute(
│   │   │       │                         builder: (_) => const RenterListBoatsScreen()),
│   │   │       │                   ),
│   │   │       │                   child: Text(
│   │   │       │                     'view_all_button'.i18n(),
│   │   │       │                     style: TextStyle(
│   │   │       │                       color: Theme.of(context).colorScheme.primary,
│   │   │       │                       fontWeight: FontWeight.w600,
│   │   │       │                     ),
│   │   │       │                   ),
│   │   │       │                 ),
│   │   │       │               ],
│   │   │       │             ),
│   │   │       │           ),
│   │   │       │           const SizedBox(height: 15),
│   │   │       │           if (_popularDestinations.isEmpty)
│   │   │       │             Container(
│   │   │       │               height: 280,
│   │   │       │               alignment: Alignment.center,
│   │   │       │               child: Text('no_popular_destinations'.i18n(),
│   │   │       │                   style: TextStyle(color: Colors.grey[600])),
│   │   │       │             )
│   │   │       │           else
│   │   │       │             SizedBox(
│   │   │       │               height: 280,
│   │   │       │               child: ListView.separated(
│   │   │       │                 padding: const EdgeInsets.symmetric(horizontal: 20.0),
│   │   │       │                 scrollDirection: Axis.horizontal,
│   │   │       │                 itemCount: _popularDestinations.length,
│   │   │       │                 separatorBuilder: (context, index) => const SizedBox(width: 16),
│   │   │       │                 itemBuilder: (context, index) =>
│   │   │       │                     _buildDestinationItem(context, _popularDestinations[index]),
│   │   │       │               ),
│   │   │       │             ),
│   │   │       │         ],
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Destination Item Widget (Uses Dynamic Data) ---
│   │   │       │     Widget _buildDestinationItem(
│   │   │       │         BuildContext context, Map<String, dynamic> destination) {
│   │   │       │       return Container(
│   │   │       │         margin: const EdgeInsets.symmetric(vertical: 8),
│   │   │       │         width: 200,
│   │   │       │         decoration: BoxDecoration(
│   │   │       │           borderRadius: BorderRadius.circular(20),
│   │   │       │           boxShadow: [
│   │   │       │             BoxShadow(
│   │   │       │               color: Colors.black.withOpacity(0.1),
│   │   │       │               spreadRadius: 0,
│   │   │       │               blurRadius: 12,
│   │   │       │               offset: const Offset(0, 5),
│   │   │       │             ),
│   │   │       │           ],
│   │   │       │         ),
│   │   │       │         child: ClipRRect(
│   │   │       │           borderRadius: BorderRadius.circular(20),
│   │   │       │           child: Material(
│   │   │       │             color: Colors.white,
│   │   │       │             child: InkWell(
│   │   │       │               onTap: () {
│   │   │       │                 Navigator.push(
│   │   │       │                     context,
│   │   │       │                     MaterialPageRoute(
│   │   │       │                         builder: (_) => RenterListBoatsScreen(
│   │   │       │                             initialSearch:
│   │   │       │                                 destination['location_filter'] as String?)));
│   │   │       │               },
│   │   │       │               child:
│   │   │       │                   Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
│   │   │       │                 Stack(children: [
│   │   │       │                   SizedBox(
│   │   │       │                       height: 180,
│   │   │       │                       width: double.infinity,
│   │   │       │                       child: ShaderMask(
│   │   │       │                           shaderCallback: (rect) => const LinearGradient(
│   │   │       │                                 begin: Alignment.topCenter,
│   │   │       │                                 end: Alignment.bottomCenter,
│   │   │       │                                 colors: [Colors.black, Colors.transparent],
│   │   │       │                                 stops: [0.8, 1.0],
│   │   │       │                               ).createShader(rect),
│   │   │       │                           blendMode: BlendMode.dstIn,
│   │   │       │                           child: Image.network(destination['image'],
│   │   │       │                               fit: BoxFit.cover,
│   │   │       │                               errorBuilder: (c, e, s) => Icon(Icons.error)))),
│   │   │       │                   Positioned(
│   │   │       │                     top: 12,
│   │   │       │                     right: 12,
│   │   │       │                     child: Container(
│   │   │       │                       height: 36,
│   │   │       │                       width: 36,
│   │   │       │                       decoration: BoxDecoration(
│   │   │       │                         color: Colors.white.withOpacity(0.9),
│   │   │       │                         shape: BoxShape.circle,
│   │   │       │                         boxShadow: [
│   │   │       │                           BoxShadow(
│   │   │       │                             color: Colors.black.withOpacity(0.1),
│   │   │       │                             spreadRadius: 0,
│   │   │       │                             blurRadius: 4,
│   │   │       │                             offset: const Offset(0, 2),
│   │   │       │                           ),
│   │   │       │                         ],
│   │   │       │                       ),
│   │   │       │                       child: Center(
│   │   │       │                         child: Icon(
│   │   │       │                           Icons.favorite_border,
│   │   │       │                           color: Theme.of(context).colorScheme.primary,
│   │   │       │                           size: 20,
│   │   │       │                         ),
│   │   │       │                       ),
│   │   │       │                     ),
│   │   │       │                   ),
│   │   │       │                   Positioned(
│   │   │       │                     bottom: 12,
│   │   │       │                     left: 12,
│   │   │       │                     child: Container(
│   │   │       │                       padding:
│   │   │       │                           const EdgeInsets.symmetric(horizontal: 10, vertical: 5),
│   │   │       │                       decoration: BoxDecoration(
│   │   │       │                         color: Theme.of(context).colorScheme.primary,
│   │   │       │                         borderRadius: BorderRadius.circular(20),
│   │   │       │                         boxShadow: [
│   │   │       │                           BoxShadow(
│   │   │       │                             color: Theme.of(context)
│   │   │       │                                 .colorScheme
│   │   │       │                                 .primary
│   │   │       │                                 .withOpacity(0.5),
│   │   │       │                             spreadRadius: 0,
│   │   │       │                             blurRadius: 4,
│   │   │       │                             offset: const Offset(0, 2),
│   │   │       │                           ),
│   │   │       │                         ],
│   │   │       │                       ),
│   │   │       │                       child: Text(
│   │   │       │                         destination['price'],
│   │   │       │                         style: const TextStyle(
│   │   │       │                           color: Colors.white,
│   │   │       │                           fontWeight: FontWeight.bold,
│   │   │       │                           fontSize: 12,
│   │   │       │                         ),
│   │   │       │                       ),
│   │   │       │                     ),
│   │   │       │                   ),
│   │   │       │                 ]),
│   │   │       │                 Padding(
│   │   │       │                   padding: const EdgeInsets.all(12.0),
│   │   │       │                   child: Column(
│   │   │       │                       crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │                       children: [
│   │   │       │                         Text(
│   │   │       │                           destination['name'],
│   │   │       │                           style:
│   │   │       │                               Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │       │                                     color: AppColors.primary,
│   │   │       │                                   ),
│   │   │       │                           maxLines: 1,
│   │   │       │                           overflow: TextOverflow.ellipsis,
│   │   │       │                         ),
│   │   │       │                         const SizedBox(height: 8),
│   │   │       │                         Row(children: [
│   │   │       │                           const Icon(
│   │   │       │                             Icons.star,
│   │   │       │                             color: Colors.amber,
│   │   │       │                             size: 16,
│   │   │       │                           ),
│   │   │       │                           const SizedBox(width: 4),
│   │   │       │                           Text(destination['rating'],
│   │   │       │                               style: TextStyle(
│   │   │       │                                 fontWeight: FontWeight.w600,
│   │   │       │                                 color: Colors.grey.shade700,
│   │   │       │                                 fontSize: 14,
│   │   │       │                               )),
│   │   │       │                         ]),
│   │   │       │                       ]),
│   │   │       │                 ),
│   │   │       │               ]),
│   │   │       │             ),
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Rental Ideas Section (Full Code) ---
│   │   │       │     Widget _buildRentalIdeasSection(BuildContext context) {
│   │   │       │       final List<Map<String, dynamic>> rentalIdeas = [
│   │   │       │         {
│   │   │       │           'title': 'red_sea_diving_trip_idea'.i18n(),
│   │   │       │           'description': 'red_sea_diving_trip_desc'.i18n(),
│   │   │       │           'image': 'assets/images/home/rental_idea_diving.png',
│   │   │       │           'duration': 'rental_idea_diving_duration'.i18n()
│   │   │       │         },
│   │   │       │         {
│   │   │       │           'title': 'jeddah_coastal_cruise_idea'.i18n(),
│   │   │       │           'description': 'jeddah_coastal_cruise_desc'.i18n(),
│   │   │       │           'image': 'assets/images/home/rental_idea_jeddah_cruise.png',
│   │   │       │           'duration': 'jeddah_coastal_cruise_duration'.i18n()
│   │   │       │         },
│   │   │       │         {
│   │   │       │           'title': 'farasan_islands_getaway_idea'.i18n(),
│   │   │       │           'description': 'farasan_islands_getaway_desc'.i18n(),
│   │   │       │           'image': 'assets/images/home/rental_idea_farasan_islands.png',
│   │   │       │           'duration': 'farasan_islands_getaway_duration'.i18n()
│   │   │       │         },
│   │   │       │         {
│   │   │       │           'title': 'luxury_yacht_experience_idea'.i18n(),
│   │   │       │           'description': 'luxury_yacht_experience_desc'.i18n(),
│   │   │       │           'image': 'assets/images/home/rental_idea_ksa_yacht.png',
│   │   │       │           'duration': 'luxury_yacht_experience_duration'.i18n()
│   │   │       │         },
│   │   │       │       ];
│   │   │       │   
│   │   │       │       return Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
│   │   │       │         Padding(
│   │   │       │             padding: const EdgeInsets.symmetric(horizontal: 24.0),
│   │   │       │             child:
│   │   │       │                 Row(mainAxisAlignment: MainAxisAlignment.spaceBetween, children: [
│   │   │       │               Text(
│   │   │       │                 'ksa_rental_experiences_title'.i18n(),
│   │   │       │                 style: Theme.of(context).textTheme.titleLarge?.copyWith(
│   │   │       │                       color: AppColors.primary,
│   │   │       │                     ),
│   │   │       │               ),
│   │   │       │               TextButton(
│   │   │       │                 onPressed: () => _showSnackBar(
│   │   │       │                     context, 'view_all_ksa_rental_experiences_message'.i18n()),
│   │   │       │                 child: Text(
│   │   │       │                   'view_all_button'.i18n(),
│   │   │       │                   style: TextStyle(
│   │   │       │                     color: Theme.of(context).colorScheme.primary,
│   │   │       │                     fontWeight: FontWeight.w600,
│   │   │       │                   ),
│   │   │       │                 ),
│   │   │       │               ),
│   │   │       │             ])),
│   │   │       │         const SizedBox(height: 15),
│   │   │       │         SizedBox(
│   │   │       │           height: 324,
│   │   │       │           child: ListView.separated(
│   │   │       │             padding: const EdgeInsets.symmetric(horizontal: 20.0),
│   │   │       │             scrollDirection: Axis.horizontal,
│   │   │       │             itemCount: rentalIdeas.length,
│   │   │       │             separatorBuilder: (c, i) => const SizedBox(width: 20),
│   │   │       │             itemBuilder: (c, i) => _buildRentalIdeaItem(context, rentalIdeas[i]),
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │       ]);
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Rental Idea Item (Full Code) ---
│   │   │       │     Widget _buildRentalIdeaItem(
│   │   │       │         BuildContext context, Map<String, dynamic> rentalIdea) {
│   │   │       │       return Container(
│   │   │       │         margin: const EdgeInsets.symmetric(vertical: 8),
│   │   │       │         width: 280,
│   │   │       │         decoration: BoxDecoration(
│   │   │       │           borderRadius: BorderRadius.circular(24),
│   │   │       │           color: Colors.white,
│   │   │       │           boxShadow: [
│   │   │       │             BoxShadow(
│   │   │       │               color: Colors.black.withOpacity(0.1),
│   │   │       │               spreadRadius: 0,
│   │   │       │               blurRadius: 15,
│   │   │       │               offset: const Offset(0, 8),
│   │   │       │             ),
│   │   │       │           ],
│   │   │       │         ),
│   │   │       │         child: ClipRRect(
│   │   │       │           borderRadius: BorderRadius.circular(24),
│   │   │       │           child: Material(
│   │   │       │             color: Colors.transparent,
│   │   │       │             child: InkWell(
│   │   │       │               onTap: () {
│   │   │       │                 /* TODO: Navigate to filtered list based on idea */ _showSnackBar(
│   │   │       │                     context,
│   │   │       │                     '${rentalIdea['title']} ${'idea_selected_message'.i18n()}');
│   │   │       │               },
│   │   │       │               child:
│   │   │       │                   Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
│   │   │       │                 Stack(children: [
│   │   │       │                   // Image Stack
│   │   │       │                   SizedBox(
│   │   │       │                       height: 180,
│   │   │       │                       width: double.infinity,
│   │   │       │                       child: Image.asset(rentalIdea['image'],
│   │   │       │                           fit: BoxFit.cover,
│   │   │       │                           errorBuilder: (c, e, s) => const Icon(Icons.error))),
│   │   │       │                   Positioned(
│   │   │       │                     // Gradient Overlay
│   │   │       │                     top: 0, left: 0, right: 0, bottom: 0,
│   │   │       │                     child: Container(
│   │   │       │                       decoration: BoxDecoration(
│   │   │       │                         gradient: LinearGradient(
│   │   │       │                           begin: Alignment.topCenter,
│   │   │       │                           end: Alignment.bottomCenter,
│   │   │       │                           colors: [
│   │   │       │                             Colors.black.withOpacity(0.6),
│   │   │       │                             Colors.transparent
│   │   │       │                           ],
│   │   │       │                           stops: const [0.0, 0.4],
│   │   │       │                         ),
│   │   │       │                       ),
│   │   │       │                     ),
│   │   │       │                   ),
│   │   │       │                   Positioned(
│   │   │       │                     // Duration Text
│   │   │       │                     bottom: 16, left: 16,
│   │   │       │                     child: Text(
│   │   │       │                       rentalIdea['duration'],
│   │   │       │                       style: const TextStyle(
│   │   │       │                         color: Colors.white,
│   │   │       │                         fontWeight: FontWeight.bold,
│   │   │       │                         fontSize: 16,
│   │   │       │                       ),
│   │   │       │                     ),
│   │   │       │                   ),
│   │   │       │                 ]),
│   │   │       │                 Padding(
│   │   │       │                   // Text Content
│   │   │       │                   padding: const EdgeInsets.all(16.0),
│   │   │       │                   child: Column(
│   │   │       │                       crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │                       children: [
│   │   │       │                         Text(
│   │   │       │                           rentalIdea['title'],
│   │   │       │                           style:
│   │   │       │                               Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │       │                                     color: AppColors.primary,
│   │   │       │                                   ),
│   │   │       │                           maxLines: 2,
│   │   │       │                           overflow: TextOverflow.ellipsis,
│   │   │       │                         ),
│   │   │       │                         const SizedBox(height: 10),
│   │   │       │                         Text(
│   │   │       │                           rentalIdea['description'],
│   │   │       │                           style: TextStyle(
│   │   │       │                             color: Colors.grey.shade700,
│   │   │       │                             fontSize: 14,
│   │   │       │                             height: 1.4,
│   │   │       │                           ),
│   │   │       │                           maxLines: 3,
│   │   │       │                           overflow: TextOverflow.ellipsis,
│   │   │       │                         ),
│   │   │       │                       ]),
│   │   │       │                 ),
│   │   │       │               ]),
│   │   │       │             ),
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- KSA Inspiration Quote (Full Code) ---
│   │   │       │     Widget _buildKSAInspirationQuote(BuildContext context) {
│   │   │       │       return Padding(
│   │   │       │         padding: const EdgeInsets.symmetric(horizontal: 24.0),
│   │   │       │         child: ClipRRect(
│   │   │       │           borderRadius: BorderRadius.circular(20),
│   │   │       │           child: BackdropFilter(
│   │   │       │             filter: ImageFilter.blur(sigmaX: 20, sigmaY: 20),
│   │   │       │             child: Container(
│   │   │       │               padding: const EdgeInsets.symmetric(horizontal: 30, vertical: 40),
│   │   │       │               decoration: BoxDecoration(
│   │   │       │                 color: Colors.white.withOpacity(0.3),
│   │   │       │                 borderRadius: BorderRadius.circular(20),
│   │   │       │                 border:
│   │   │       │                     Border.all(color: Colors.white.withOpacity(0.2), width: 1.5),
│   │   │       │                 boxShadow: [
│   │   │       │                   BoxShadow(
│   │   │       │                     color: Colors.black.withOpacity(0.1),
│   │   │       │                     spreadRadius: 0,
│   │   │       │                     blurRadius: 15,
│   │   │       │                     offset: const Offset(0, 8),
│   │   │       │                   ),
│   │   │       │                 ],
│   │   │       │               ),
│   │   │       │               child: Column(children: [
│   │   │       │                 Icon(
│   │   │       │                   Icons.water_outlined,
│   │   │       │                   size: 40,
│   │   │       │                   color: AppColors.primary,
│   │   │       │                 ),
│   │   │       │                 const SizedBox(height: 20),
│   │   │       │                 Text(
│   │   │       │                   'ksa_inspiration_quote_text'.i18n(),
│   │   │       │                   textAlign: TextAlign.center,
│   │   │       │                   style: Theme.of(context).textTheme.bodyLarge?.copyWith(
│   │   │       │                         color: AppColors.primary,
│   │   │       │                         fontStyle: FontStyle.italic,
│   │   │       │                       ),
│   │   │       │                 ),
│   │   │       │                 const SizedBox(height: 20),
│   │   │       │                 Text(
│   │   │       │                   'saudi_tourism_authority'.i18n(),
│   │   │       │                   textAlign: TextAlign.center,
│   │   │       │                   style: Theme.of(context).textTheme.bodySmall?.copyWith(
│   │   │       │                         color: AppColors.primary,
│   │   │       │                         fontWeight: FontWeight.bold,
│   │   │       │                       ),
│   │   │       │                 ),
│   │   │       │               ]),
│   │   │       │             ),
│   │   │       │           ),
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- Newsletter Section (Full Code) ---
│   │   │       │     Widget _buildNewsletter(BuildContext context) {
│   │   │       │       return Padding(
│   │   │       │         padding: const EdgeInsets.symmetric(horizontal: 24.0),
│   │   │       │         child: Container(
│   │   │       │           padding: const EdgeInsets.all(30),
│   │   │       │           decoration: BoxDecoration(
│   │   │       │             color: Theme.of(context).colorScheme.secondary.withOpacity(0.1),
│   │   │       │             borderRadius: BorderRadius.circular(20),
│   │   │       │             border: Border.all(
│   │   │       │                 color: Theme.of(context).colorScheme.secondary.withOpacity(0.2),
│   │   │       │                 width: 1),
│   │   │       │           ),
│   │   │       │           child: Column(children: [
│   │   │       │             Text(
│   │   │       │               'newsletter_ksa_title'.i18n(),
│   │   │       │               textAlign: TextAlign.center,
│   │   │       │               style: Theme.of(context).textTheme.titleMedium?.copyWith(
│   │   │       │                     color: AppColors.primary,
│   │   │       │                   ),
│   │   │       │             ),
│   │   │       │             const SizedBox(height: 15),
│   │   │       │             Text(
│   │   │       │               'newsletter_ksa_description'.i18n(),
│   │   │       │               textAlign: TextAlign.center,
│   │   │       │               style: Theme.of(context).textTheme.bodyMedium?.copyWith(
│   │   │       │                     color: AppColors.subtleTextColor,
│   │   │       │                   ),
│   │   │       │             ),
│   │   │       │             const SizedBox(height: 25),
│   │   │       │             TextField(
│   │   │       │               // Simple TextField for now
│   │   │       │               decoration: InputDecoration(
│   │   │       │                 hintText: 'email_address_hint'.i18n(),
│   │   │       │                 hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │       │                 filled: true,
│   │   │       │                 fillColor: Colors.white,
│   │   │       │                 border: OutlineInputBorder(
│   │   │       │                   borderRadius: BorderRadius.circular(15),
│   │   │       │                   borderSide: BorderSide.none,
│   │   │       │                 ),
│   │   │       │                 contentPadding:
│   │   │       │                     const EdgeInsets.symmetric(horizontal: 20, vertical: 16),
│   │   │       │                 suffixIcon: InkWell(
│   │   │       │                   // Send button
│   │   │       │                   onTap: () {
│   │   │       │                     /* TODO: Implement newsletter sign-up logic */ _showSnackBar(
│   │   │       │                         context, 'newsletter_subscribe_message'.i18n());
│   │   │       │                   },
│   │   │       │                   child: Container(
│   │   │       │                     margin: const EdgeInsets.all(8),
│   │   │       │                     decoration: BoxDecoration(
│   │   │       │                       color: Theme.of(context).colorScheme.primary,
│   │   │       │                       borderRadius: BorderRadius.circular(10),
│   │   │       │                     ),
│   │   │       │                     child: const Icon(Icons.send, color: Colors.white),
│   │   │       │                   ),
│   │   │       │                 ),
│   │   │       │               ),
│   │   │       │             ),
│   │   │       │           ]),
│   │   │       │         ),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   
│   │   │       │     // --- SnackBar Utility ---
│   │   │       │     void _showSnackBar(BuildContext context, String message) {
│   │   │       │       SnackBarUtil.showSuccessSnackBar(message: message, title: '');
│   │   │       │     }
│   │   │       │   } // End of _HomeScreenState
│   │   ├── initializer/
│   │   │   └── screen.dart
│   │   │       │   import 'dart:async';
│   │   │       │   import 'package:flutter/material.dart';
│   │   │       │   import 'package:shared_preferences/shared_preferences.dart';
│   │   │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart';
│   │   │       │   
│   │   │       │   // Import your screen routes
│   │   │       │   import 'package:app/features/general/onboarding/screen.dart'; // Use correct path & name
│   │   │       │   import 'package:app/features/auth/login/screen.dart'; // Use correct path & name
│   │   │       │   import 'package:app/features/home/screen.dart'; // Use correct path & name
│   │   │       │   
│   │   │       │   class InitializerScreen extends StatefulWidget {
│   │   │       │     const InitializerScreen({super.key});
│   │   │       │   
│   │   │       │     @override
│   │   │       │     State<InitializerScreen> createState() => _InitializerScreenState();
│   │   │       │   }
│   │   │       │   
│   │   │       │   class _InitializerScreenState extends State<InitializerScreen> {
│   │   │       │     final _storage = const FlutterSecureStorage();
│   │   │       │   
│   │   │       │     @override
│   │   │       │     void initState() {
│   │   │       │       super.initState();
│   │   │       │       _checkAppStateAndNavigate();
│   │   │       │     }
│   │   │       │   
│   │   │       │     Future<void> _checkAppStateAndNavigate() async {
│   │   │       │       // Add a small delay to ensure the loading indicator is visible briefly
│   │   │       │       await Future.delayed(const Duration(milliseconds: 1500));
│   │   │       │   
│   │   │       │       // Check onboarding status
│   │   │       │       final prefs = await SharedPreferences.getInstance();
│   │   │       │       final bool hasSeenOnboarding = prefs.getBool('hasSeenOnboarding') ?? false;
│   │   │       │   
│   │   │       │       if (!mounted) return; // Check if widget is still in the tree
│   │   │       │   
│   │   │       │       if (!hasSeenOnboarding) {
│   │   │       │         // Navigate to Onboarding Screen
│   │   │       │         Navigator.pushReplacement(
│   │   │       │           context,
│   │   │       │           MaterialPageRoute(builder: (_) => const OnboardingScreen()),
│   │   │       │         );
│   │   │       │         return; // Exit after navigation
│   │   │       │       }
│   │   │       │   
│   │   │       │       // Check login status (look for stored access token)
│   │   │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │       │   
│   │   │       │       if (!mounted) return; // Check again after async gap
│   │   │       │   
│   │   │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │       │         // Navigate to Login Screen
│   │   │       │         Navigator.pushReplacement(
│   │   │       │           context,
│   │   │       │           MaterialPageRoute(builder: (_) => const LoginScreen()),
│   │   │       │         );
│   │   │       │       } else {
│   │   │       │         // TODO: Optional - Add token validation here
│   │   │       │         // You could try making a quick authenticated API call (like /profile)
│   │   │       │         // or decode the token locally to check expiry. If invalid, go to Login.
│   │   │       │         // For simplicity now, we assume presence means logged in.
│   │   │       │   
│   │   │       │         // Navigate to Home Screen
│   │   │       │         Navigator.pushReplacement(
│   │   │       │           context,
│   │   │       │           MaterialPageRoute(builder: (_) => const HomeScreen()),
│   │   │       │         );
│   │   │       │       }
│   │   │       │     }
│   │   │       │   
│   │   │       │     @override
│   │   │       │     Widget build(BuildContext context) {
│   │   │       │       // Display a loading indicator while checking state
│   │   │       │       return const Scaffold(
│   │   │       │         body: Center(
│   │   │       │             child: Column(
│   │   │       │           mainAxisAlignment: MainAxisAlignment.center,
│   │   │       │           children: [
│   │   │       │             CircularProgressIndicator(),
│   │   │       │             SizedBox(height: 20),
│   │   │       │             Text("Initializing..."),
│   │   │       │           ],
│   │   │       │         )),
│   │   │       │       );
│   │   │       │     }
│   │   │       │   }
│   │   ├── owner/
│   │   │   └── boats/
│   │   │       ├── add/
│   │   │       │   └── screen.dart
│   │   │       │       │   // lib/features/owner/boats/add/screen.dart
│   │   │       │       │   
│   │   │       │       │   import 'dart:io'; // Import dart:io for File
│   │   │       │       │   import 'package:app/utils/snackbar.dart';
│   │   │       │       │   import 'package:flutter/material.dart';
│   │   │       │       │   import 'package:app/app/theme.dart';
│   │   │       │       │   import 'package:get/get.dart';
│   │   │       │       │   import 'package:localization/localization.dart';
│   │   │       │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │       │       │   import 'package:image_picker/image_picker.dart'; // For picking images
│   │   │       │       │   
│   │   │       │       │   // --- Import Controller ---
│   │   │       │       │   import 'package:app/controllers/boat.dart'; // Use correct controller name
│   │   │       │       │   import 'package:app/models/boat.dart'; // Use correct model name
│   │   │       │       │   
│   │   │       │       │   class AddBoatScreen extends StatefulWidget {
│   │   │       │       │     const AddBoatScreen({super.key});
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     State<AddBoatScreen> createState() => _AddBoatScreenState();
│   │   │       │       │   }
│   │   │       │       │   
│   │   │       │       │   class _AddBoatScreenState extends State<AddBoatScreen>
│   │   │       │       │       with TickerProviderStateMixin {
│   │   │       │       │     final _formKey = GlobalKey<FormState>();
│   │   │       │       │   
│   │   │       │       │     // --- Controllers for Text Inputs ---
│   │   │       │       │     final _boatNameController = TextEditingController();
│   │   │       │       │     final _descriptionController =
│   │   │       │       │         TextEditingController(); // Renamed from _specificationsController
│   │   │       │       │     final _rentalPriceController = TextEditingController();
│   │   │       │       │     final _locationDescController =
│   │   │       │       │         TextEditingController(); // For location description
│   │   │       │       │     final _lengthController = TextEditingController();
│   │   │       │       │     final _capacityController = TextEditingController();
│   │   │       │       │     final _cabinsController = TextEditingController();
│   │   │       │       │     final _driverNameController = TextEditingController();
│   │   │       │       │     final _driverDetailsController = TextEditingController();
│   │   │       │       │   
│   │   │       │       │     // --- State Variables ---
│   │   │       │       │     String? _selectedBoatType; // For Dropdown
│   │   │       │       │     String _selectedStatus =
│   │   │       │       │         'DRAFT'; // Default status ('DRAFT', 'ACTIVE', 'INACTIVE')
│   │   │       │       │     bool _driverAvailable = false;
│   │   │       │       │     File? _mainImageFile; // To hold the selected main image file
│   │   │       │       │     List<File> _additionalImageFiles = []; // To hold selected additional images
│   │   │       │       │     final ImagePicker _picker = ImagePicker(); // Image picker instance
│   │   │       │       │   
│   │   │       │       │     bool _isLoading = false; // Submission loading state
│   │   │       │       │   
│   │   │       │       │     // --- API and Storage ---
│   │   │       │       │     final BoatController _boatController = BoatController();
│   │   │       │       │     final _storage = const FlutterSecureStorage();
│   │   │       │       │   
│   │   │       │       │     // Animation (keep if used, remove otherwise)
│   │   │       │       │     // late AnimationController _logoAnimationController;
│   │   │       │       │     // late Animation<double> _logoAnimation;
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void initState() {
│   │   │       │       │       super.initState();
│   │   │       │       │       // Initialize animations if needed
│   │   │       │       │       // _logoAnimationController = ...
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void dispose() {
│   │   │       │       │       // Dispose all text controllers
│   │   │       │       │       _boatNameController.dispose();
│   │   │       │       │       _descriptionController.dispose();
│   │   │       │       │       _rentalPriceController.dispose();
│   │   │       │       │       _locationDescController.dispose();
│   │   │       │       │       _lengthController.dispose();
│   │   │       │       │       _capacityController.dispose();
│   │   │       │       │       _cabinsController.dispose();
│   │   │       │       │       _driverNameController.dispose();
│   │   │       │       │       _driverDetailsController.dispose();
│   │   │       │       │       // Dispose animations if needed
│   │   │       │       │       // _logoAnimationController.dispose();
│   │   │       │       │       super.dispose();
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Image Picking Functions ---
│   │   │       │       │     Future<void> _pickMainImage(ImageSource source) async {
│   │   │       │       │       try {
│   │   │       │       │         final pickedFile = await _picker.pickImage(
│   │   │       │       │             source: source,
│   │   │       │       │             imageQuality: 80, // Optional: Adjust quality
│   │   │       │       │             maxWidth: 1024 // Optional: Resize image
│   │   │       │       │             );
│   │   │       │       │         if (pickedFile != null) {
│   │   │       │       │           setState(() {
│   │   │       │       │             _mainImageFile = File(pickedFile.path);
│   │   │       │       │           });
│   │   │       │       │         }
│   │   │       │       │       } catch (e) {
│   │   │       │       │         print("Error picking main image: $e");
│   │   │       │       │         if (mounted)
│   │   │       │       │           _showSnackBar(context, 'Error picking image: $e', isError: true);
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     Future<void> _pickAdditionalImages() async {
│   │   │       │       │       try {
│   │   │       │       │         final List<XFile> pickedFiles =
│   │   │       │       │             await _picker.pickMultiImage(imageQuality: 80, maxWidth: 1024);
│   │   │       │       │         if (pickedFiles.isNotEmpty) {
│   │   │       │       │           setState(() {
│   │   │       │       │             // Add only new files, prevent duplicates if user picks same file again
│   │   │       │       │             _additionalImageFiles.addAll(pickedFiles
│   │   │       │       │                     .map((file) => File(file.path))
│   │   │       │       │                     .where((newFile) => !_additionalImageFiles.any((existing) =>
│   │   │       │       │                         existing.path ==
│   │   │       │       │                         newFile.path)) // Basic duplicate check by path
│   │   │       │       │                 );
│   │   │       │       │             // Optional: Limit the number of additional images
│   │   │       │       │             // if (_additionalImageFiles.length > 5) {
│   │   │       │       │             //   _additionalImageFiles = _additionalImageFiles.sublist(_additionalImageFiles.length - 5);
│   │   │       │       │             //   _showSnackBar(context, 'Maximum 5 additional images allowed.');
│   │   │       │       │             // }
│   │   │       │       │           });
│   │   │       │       │         }
│   │   │       │       │       } catch (e) {
│   │   │       │       │         print("Error picking additional images: $e");
│   │   │       │       │         if (mounted)
│   │   │       │       │           _showSnackBar(context, 'Error picking images: $e', isError: true);
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     void _removeAdditionalImage(int index) {
│   │   │       │       │       setState(() {
│   │   │       │       │         _additionalImageFiles.removeAt(index);
│   │   │       │       │       });
│   │   │       │       │     }
│   │   │       │       │     // --- End Image Picking ---
│   │   │       │       │   
│   │   │       │       │     // --- Perform API Call ---
│   │   │       │       │     Future<void> _performAddBoat() async {
│   │   │       │       │       if (!_formKey.currentState!.validate()) {
│   │   │       │       │         _showSnackBar(context, 'Please fix the errors in the form.',
│   │   │       │       │             isError: true);
│   │   │       │       │         return;
│   │   │       │       │       }
│   │   │       │       │       if (_mainImageFile == null) {
│   │   │       │       │         _showSnackBar(context, 'Please select a main image for the boat.',
│   │   │       │       │             isError: true);
│   │   │       │       │         return;
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │       │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │       │       │         if (mounted)
│   │   │       │       │           _showSnackBar(context, 'Authentication error. Please log in again.',
│   │   │       │       │               isError: true);
│   │   │       │       │         return;
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       setState(() => _isLoading = true);
│   │   │       │       │   
│   │   │       │       │       // Parse numeric fields safely
│   │   │       │       │       double? length = double.tryParse(_lengthController.text);
│   │   │       │       │       int? capacity = int.tryParse(_capacityController.text);
│   │   │       │       │       int? cabins = int.tryParse(_cabinsController.text);
│   │   │       │       │       double? price = double.tryParse(_rentalPriceController.text);
│   │   │       │       │   
│   │   │       │       │       if (price == null) {
│   │   │       │       │         // Price is required by the controller/API
│   │   │       │       │         if (mounted)
│   │   │       │       │           _showSnackBar(context, 'Invalid rental price format.', isError: true);
│   │   │       │       │         setState(() => _isLoading = false);
│   │   │       │       │         return;
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       try {
│   │   │       │       │         final newBoat = await _boatController.createBoat(
│   │   │       │       │           accessToken: accessToken,
│   │   │       │       │           name: _boatNameController.text.trim(),
│   │   │       │       │           boatType: _selectedBoatType!, // Assumes validation ensures not null
│   │   │       │       │           rentalPricePerDay: price,
│   │   │       │       │           locationDescription: _locationDescController.text.trim(),
│   │   │       │       │           description: _descriptionController.text.trim(),
│   │   │       │       │           length: length, // Pass nullable double
│   │   │       │       │           capacity: capacity, // Pass nullable int
│   │   │       │       │           cabins: cabins, // Pass nullable int
│   │   │       │       │           driverAvailable: _driverAvailable,
│   │   │       │       │           driverName: _driverNameController.text.trim().isNotEmpty
│   │   │       │       │               ? _driverNameController.text.trim()
│   │   │       │       │               : null,
│   │   │       │       │           driverDetails: _driverDetailsController.text.trim().isNotEmpty
│   │   │       │       │               ? _driverDetailsController.text.trim()
│   │   │       │       │               : null,
│   │   │       │       │           status: _selectedStatus,
│   │   │       │       │           mainImageFile: _mainImageFile!, // We validated it's not null
│   │   │       │       │           additionalImageFiles:
│   │   │       │       │               _additionalImageFiles.isNotEmpty ? _additionalImageFiles : null,
│   │   │       │       │         );
│   │   │       │       │   
│   │   │       │       │         if (!mounted) return;
│   │   │       │       │   
│   │   │       │       │         if (newBoat != null) {
│   │   │       │       │           _showSnackBar(context, 'Boat "${newBoat.name}" created successfully!');
│   │   │       │       │           // Navigate back to owner's boat list or clear form
│   │   │       │       │           Navigator.pop(context, true); // Return true to indicate success
│   │   │       │       │         } else {
│   │   │       │       │           _showSnackBar(context, 'Failed to create boat. Please check details.',
│   │   │       │       │               isError: true);
│   │   │       │       │         }
│   │   │       │       │       } catch (e) {
│   │   │       │       │         print("Add Boat Error: $e");
│   │   │       │       │         if (mounted)
│   │   │       │       │           _showSnackBar(context, 'An error occurred: $e', isError: true);
│   │   │       │       │       } finally {
│   │   │       │       │         if (mounted) setState(() => _isLoading = false);
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │     // --- End API Call ---
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     Widget build(BuildContext context) {
│   │   │       │       │       return Scaffold(
│   │   │       │       │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │       │       │         appBar: AppBar(
│   │   │       │       │           title: Text('add_new_boat_title_appbar'.i18n()),
│   │   │       │       │           centerTitle: true,
│   │   │       │       │           elevation: 1,
│   │   │       │       │         ),
│   │   │       │       │         body: SingleChildScrollView(
│   │   │       │       │           // Make the body scrollable
│   │   │       │       │           padding: const EdgeInsets.all(24.0), // Padding around the form
│   │   │       │       │           child: Form(
│   │   │       │       │             // Wrap content in Form
│   │   │       │       │             key: _formKey,
│   │   │       │       │             child: Column(
│   │   │       │       │               crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │       │       │               children: <Widget>[
│   │   │       │       │                 // Consider removing logo or making it smaller if space is tight
│   │   │       │       │                 // _buildAppLogo(),
│   │   │       │       │                 // const SizedBox(height: 30),
│   │   │       │       │   
│   │   │       │       │                 Text('boat_details_section_title'.i18n(),
│   │   │       │       │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 // --- Form Fields ---
│   │   │       │       │                 TextFormField(
│   │   │       │       │                   controller: _boatNameController,
│   │   │       │       │                   decoration: _inputDecoration(
│   │   │       │       │                       label: 'boat_name_label'.i18n(),
│   │   │       │       │                       hint: 'boat_name_hint'.i18n(),
│   │   │       │       │                       icon: Icons.directions_boat_outlined),
│   │   │       │       │                   validator: (value) =>
│   │   │       │       │                       value!.isEmpty ? 'boat_name_required_error'.i18n() : null,
│   │   │       │       │                 ),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 DropdownButtonFormField<String>(
│   │   │       │       │                   value: _selectedBoatType,
│   │   │       │       │                   items: [
│   │   │       │       │                     'Yacht',
│   │   │       │       │                     'Speed Boat',
│   │   │       │       │                     'Fishing Boat',
│   │   │       │       │                     'Dhow',
│   │   │       │       │                     'Sailboat',
│   │   │       │       │                     'Other'
│   │   │       │       │                   ] // Example Types
│   │   │       │       │                       .map((type) =>
│   │   │       │       │                           DropdownMenuItem(value: type, child: Text(type)))
│   │   │       │       │                       .toList(),
│   │   │       │       │                   onChanged: (value) => setState(() => _selectedBoatType = value),
│   │   │       │       │                   decoration: _inputDecoration(
│   │   │       │       │                       label: 'boat_type_label'.i18n(),
│   │   │       │       │                       hint: 'boat_type_hint'.i18n(),
│   │   │       │       │                       icon: Icons.category_outlined),
│   │   │       │       │                   validator: (value) =>
│   │   │       │       │                       value == null ? 'boat_type_required_error'.i18n() : null,
│   │   │       │       │                 ),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 TextFormField(
│   │   │       │       │                   controller:
│   │   │       │       │                       _descriptionController, // Changed from specifications
│   │   │       │       │                   decoration: _inputDecoration(
│   │   │       │       │                       label: 'boat_description_label'.i18n(),
│   │   │       │       │                       hint: 'boat_description_hint'.i18n(),
│   │   │       │       │                       icon: Icons.description_outlined),
│   │   │       │       │                   maxLines: 4,
│   │   │       │       │                   textCapitalization: TextCapitalization.sentences,
│   │   │       │       │                   // Description might not be required
│   │   │       │       │                   // validator: (value) => value!.isEmpty ? 'Description cannot be empty.' : null,
│   │   │       │       │                 ),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 Row(
│   │   │       │       │                   // Row for Length, Capacity, Cabins
│   │   │       │       │                   children: [
│   │   │       │       │                     Expanded(
│   │   │       │       │                       child: TextFormField(
│   │   │       │       │                         controller: _lengthController,
│   │   │       │       │                         decoration: _inputDecoration(
│   │   │       │       │                             label: 'length_label'.i18n(),
│   │   │       │       │                             hint: 'e.g., 45.5',
│   │   │       │       │                             icon: Icons.straighten),
│   │   │       │       │                         keyboardType:
│   │   │       │       │                             const TextInputType.numberWithOptions(decimal: true),
│   │   │       │       │                       ),
│   │   │       │       │                     ),
│   │   │       │       │                     const SizedBox(width: 16),
│   │   │       │       │                     Expanded(
│   │   │       │       │                       child: TextFormField(
│   │   │       │       │                         controller: _capacityController,
│   │   │       │       │                         decoration: _inputDecoration(
│   │   │       │       │                             label: 'capacity_label'.i18n(),
│   │   │       │       │                             hint: 'e.g., 8',
│   │   │       │       │                             icon: Icons.people_outline),
│   │   │       │       │                         keyboardType: TextInputType.number,
│   │   │       │       │                       ),
│   │   │       │       │                     ),
│   │   │       │       │                     const SizedBox(width: 16),
│   │   │       │       │                     Expanded(
│   │   │       │       │                       child: TextFormField(
│   │   │       │       │                         controller: _cabinsController,
│   │   │       │       │                         decoration: _inputDecoration(
│   │   │       │       │                             label: 'cabins_label'.i18n(),
│   │   │       │       │                             hint: 'e.g., 2',
│   │   │       │       │                             icon: Icons.cabin_outlined),
│   │   │       │       │                         keyboardType: TextInputType.number,
│   │   │       │       │                       ),
│   │   │       │       │                     ),
│   │   │       │       │                   ],
│   │   │       │       │                 ),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 TextFormField(
│   │   │       │       │                   controller: _rentalPriceController,
│   │   │       │       │                   decoration: _inputDecoration(
│   │   │       │       │                       label: 'rental_price_label'.i18n(),
│   │   │       │       │                       hint: 'rental_price_hint'.i18n(),
│   │   │       │       │                       icon: Icons.attach_money),
│   │   │       │       │                   keyboardType:
│   │   │       │       │                       const TextInputType.numberWithOptions(decimal: true),
│   │   │       │       │                   validator: (value) {
│   │   │       │       │                     if (value == null || value.isEmpty)
│   │   │       │       │                       return 'rental_price_required_error'.i18n();
│   │   │       │       │                     if (double.tryParse(value) == null ||
│   │   │       │       │                         double.parse(value) <= 0)
│   │   │       │       │                       return 'invalid_price_format_error'.i18n();
│   │   │       │       │                     return null;
│   │   │       │       │                   },
│   │   │       │       │                 ),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 TextFormField(
│   │   │       │       │                   controller: _locationDescController,
│   │   │       │       │                   decoration: _inputDecoration(
│   │   │       │       │                       label: 'location_description_label'.i18n(),
│   │   │       │       │                       hint: 'location_description_hint'.i18n(),
│   │   │       │       │                       icon: Icons.location_on_outlined),
│   │   │       │       │                   validator: (value) =>
│   │   │       │       │                       value!.isEmpty ? 'Location description is required.' : null,
│   │   │       │       │                 ),
│   │   │       │       │                 // TODO: Add Map Picker for Lat/Lon if needed
│   │   │       │       │   
│   │   │       │       │                 const SizedBox(height: 24),
│   │   │       │       │                 Text('driver_options_section_title'.i18n(),
│   │   │       │       │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │       │       │                 const SizedBox(height: 8),
│   │   │       │       │   
│   │   │       │       │                 SwitchListTile(
│   │   │       │       │                   title: Text('driver_available_label'.i18n()),
│   │   │       │       │                   value: _driverAvailable,
│   │   │       │       │                   onChanged: (bool value) =>
│   │   │       │       │                       setState(() => _driverAvailable = value),
│   │   │       │       │                   secondary: Icon(
│   │   │       │       │                       _driverAvailable
│   │   │       │       │                           ? Icons.check_circle
│   │   │       │       │                           : Icons.cancel_outlined,
│   │   │       │       │                       color: _driverAvailable ? Colors.green : Colors.grey),
│   │   │       │       │                 ),
│   │   │       │       │                 if (_driverAvailable) ...[
│   │   │       │       │                   // Show driver fields only if available
│   │   │       │       │                   const SizedBox(height: 16),
│   │   │       │       │                   TextFormField(
│   │   │       │       │                     controller: _driverNameController,
│   │   │       │       │                     decoration: _inputDecoration(
│   │   │       │       │                         label: 'driver_name_label'.i18n(),
│   │   │       │       │                         hint: 'driver_name_hint'.i18n(),
│   │   │       │       │                         icon: Icons.person_pin_outlined),
│   │   │       │       │                   ),
│   │   │       │       │                   const SizedBox(height: 16),
│   │   │       │       │                   TextFormField(
│   │   │       │       │                     controller: _driverDetailsController,
│   │   │       │       │                     decoration: _inputDecoration(
│   │   │       │       │                         label: 'driver_details_label'.i18n(),
│   │   │       │       │                         hint: 'driver_details_hint'.i18n(),
│   │   │       │       │                         icon: Icons.notes_outlined),
│   │   │       │       │                     maxLines: 2,
│   │   │       │       │                   ),
│   │   │       │       │                 ],
│   │   │       │       │   
│   │   │       │       │                 const SizedBox(height: 24),
│   │   │       │       │                 Text('listing_status_section_title'.i18n(),
│   │   │       │       │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 DropdownButtonFormField<String>(
│   │   │       │       │                   value: _selectedStatus,
│   │   │       │       │                   items: ['DRAFT', 'ACTIVE', 'INACTIVE']
│   │   │       │       │                       .map((status) => DropdownMenuItem(
│   │   │       │       │                           value: status,
│   │   │       │       │                           child: Text(
│   │   │       │       │                               status.toLowerCase().capitalizeFirst ?? status)))
│   │   │       │       │                       .toList(),
│   │   │       │       │                   onChanged: (value) => setState(() => _selectedStatus = value!),
│   │   │       │       │                   decoration: _inputDecoration(
│   │   │       │       │                       label: 'status_label'.i18n(),
│   │   │       │       │                       icon: Icons.toggle_on_outlined,
│   │   │       │       │                       hint: 'status_hint'.i18n()),
│   │   │       │       │                   validator: (value) =>
│   │   │       │       │                       value == null ? 'Status is required.' : null,
│   │   │       │       │                 ),
│   │   │       │       │   
│   │   │       │       │                 const SizedBox(height: 24),
│   │   │       │       │                 Text('images_section_title'.i18n(),
│   │   │       │       │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │       │       │                 const SizedBox(height: 16),
│   │   │       │       │   
│   │   │       │       │                 // --- Main Image Picker ---
│   │   │       │       │                 _buildImagePicker(
│   │   │       │       │                   label: 'main_image_label'.i18n(),
│   │   │       │       │                   imageFile: _mainImageFile,
│   │   │       │       │                   onPickImage: _pickMainImage, // Pass the function
│   │   │       │       │                   onRemoveImage: () => setState(() => _mainImageFile = null),
│   │   │       │       │                 ),
│   │   │       │       │                 const SizedBox(height: 20),
│   │   │       │       │   
│   │   │       │       │                 // --- Additional Images Picker ---
│   │   │       │       │                 _buildAdditionalImagePicker(),
│   │   │       │       │                 const SizedBox(height: 30),
│   │   │       │       │   
│   │   │       │       │                 // --- Submit Button ---
│   │   │       │       │                 ElevatedButton.icon(
│   │   │       │       │                   onPressed: _isLoading ? null : _performAddBoat,
│   │   │       │       │                   icon: _isLoading
│   │   │       │       │                       ? Container(
│   │   │       │       │                           width: 24,
│   │   │       │       │                           height: 24,
│   │   │       │       │                           padding: const EdgeInsets.all(2.0),
│   │   │       │       │                           child: const CircularProgressIndicator(
│   │   │       │       │                               color: Colors.white, strokeWidth: 3))
│   │   │       │       │                       : const Icon(Icons.add_circle_outline_rounded),
│   │   │       │       │                   label: Text(_isLoading
│   │   │       │       │                       ? 'creating_boat_button'.i18n()
│   │   │       │       │                       : 'add_boat_button'.i18n()),
│   │   │       │       │                   style: ElevatedButton.styleFrom(
│   │   │       │       │                     padding: const EdgeInsets.symmetric(vertical: 16),
│   │   │       │       │                     textStyle: const TextStyle(
│   │   │       │       │                         fontSize: 16, fontWeight: FontWeight.bold),
│   │   │       │       │                     backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │       │       │                     foregroundColor: Colors.white,
│   │   │       │       │                     shape: RoundedRectangleBorder(
│   │   │       │       │                         borderRadius: BorderRadius.circular(15)),
│   │   │       │       │                   ),
│   │   │       │       │                 ),
│   │   │       │       │               ],
│   │   │       │       │             ),
│   │   │       │       │           ),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Helper for Input Decoration
│   │   │       │       │     InputDecoration _inputDecoration(
│   │   │       │       │         {required String label, required String hint, required IconData icon}) {
│   │   │       │       │       return InputDecoration(
│   │   │       │       │         labelText: label,
│   │   │       │       │         hintText: hint,
│   │   │       │       │         prefixIcon: Icon(icon,
│   │   │       │       │             color: Theme.of(context).colorScheme.primary.withOpacity(0.8)),
│   │   │       │       │         border: OutlineInputBorder(borderRadius: BorderRadius.circular(12)),
│   │   │       │       │         enabledBorder: OutlineInputBorder(
│   │   │       │       │           borderRadius: BorderRadius.circular(12),
│   │   │       │       │           borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │       │       │         ),
│   │   │       │       │         focusedBorder: OutlineInputBorder(
│   │   │       │       │           borderRadius: BorderRadius.circular(12),
│   │   │       │       │           borderSide: BorderSide(
│   │   │       │       │               color: Theme.of(context).colorScheme.primary, width: 1.5),
│   │   │       │       │         ),
│   │   │       │       │         filled: true,
│   │   │       │       │         fillColor: Colors.grey.shade50,
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Helper widget for single image picker (Main Image)
│   │   │       │       │     Widget _buildImagePicker({
│   │   │       │       │       required String label,
│   │   │       │       │       required File? imageFile,
│   │   │       │       │       required Function(ImageSource) onPickImage,
│   │   │       │       │       required VoidCallback onRemoveImage,
│   │   │       │       │     }) {
│   │   │       │       │       return Column(
│   │   │       │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │         children: [
│   │   │       │       │           Text(label, style: Theme.of(context).textTheme.titleMedium),
│   │   │       │       │           const SizedBox(height: 8),
│   │   │       │       │           Container(
│   │   │       │       │             height: 150,
│   │   │       │       │             width: double.infinity,
│   │   │       │       │             decoration: BoxDecoration(
│   │   │       │       │               border: Border.all(color: Colors.grey.shade400),
│   │   │       │       │               borderRadius: BorderRadius.circular(12),
│   │   │       │       │               color: Colors.grey.shade100,
│   │   │       │       │             ),
│   │   │       │       │             child: imageFile != null
│   │   │       │       │                 ? Stack(
│   │   │       │       │                     alignment: Alignment.center,
│   │   │       │       │                     children: [
│   │   │       │       │                       ClipRRect(
│   │   │       │       │                           borderRadius: BorderRadius.circular(11),
│   │   │       │       │                           child: Image.file(imageFile,
│   │   │       │       │                               fit: BoxFit.cover,
│   │   │       │       │                               width: double.infinity,
│   │   │       │       │                               height: 150)),
│   │   │       │       │                       Positioned(
│   │   │       │       │                           top: 4,
│   │   │       │       │                           right: 4,
│   │   │       │       │                           child: CircleAvatar(
│   │   │       │       │                             radius: 14,
│   │   │       │       │                             backgroundColor: Colors.black54,
│   │   │       │       │                             child: IconButton(
│   │   │       │       │                               padding: EdgeInsets.zero,
│   │   │       │       │                               iconSize: 16,
│   │   │       │       │                               icon: const Icon(Icons.close, color: Colors.white),
│   │   │       │       │                               onPressed: onRemoveImage,
│   │   │       │       │                               tooltip: 'Remove Image',
│   │   │       │       │                             ),
│   │   │       │       │                           )),
│   │   │       │       │                     ],
│   │   │       │       │                   )
│   │   │       │       │                 : Center(
│   │   │       │       │                     child: Text('no_image_selected'.i18n(),
│   │   │       │       │                         style: TextStyle(color: Colors.grey.shade600))),
│   │   │       │       │           ),
│   │   │       │       │           const SizedBox(height: 8),
│   │   │       │       │           Row(
│   │   │       │       │             mainAxisAlignment: MainAxisAlignment.spaceEvenly,
│   │   │       │       │             children: [
│   │   │       │       │               TextButton.icon(
│   │   │       │       │                 icon: const Icon(Icons.photo_library_outlined),
│   │   │       │       │                 label: Text('gallery'.i18n()),
│   │   │       │       │                 onPressed: () => onPickImage(ImageSource.gallery),
│   │   │       │       │               ),
│   │   │       │       │               TextButton.icon(
│   │   │       │       │                 icon: const Icon(Icons.camera_alt_outlined),
│   │   │       │       │                 label: Text('camera'.i18n()),
│   │   │       │       │                 onPressed: () => onPickImage(ImageSource.camera),
│   │   │       │       │               ),
│   │   │       │       │             ],
│   │   │       │       │           )
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Helper widget for additional images
│   │   │       │       │     Widget _buildAdditionalImagePicker() {
│   │   │       │       │       return Column(
│   │   │       │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │         children: [
│   │   │       │       │           Text('additional_images_label'.i18n(),
│   │   │       │       │               style: Theme.of(context).textTheme.titleMedium),
│   │   │       │       │           const SizedBox(height: 8),
│   │   │       │       │           Wrap(
│   │   │       │       │             // Use Wrap to display multiple images horizontally
│   │   │       │       │             spacing: 10,
│   │   │       │       │             runSpacing: 10,
│   │   │       │       │             children: [
│   │   │       │       │               // Display existing selected images with remove button
│   │   │       │       │               ..._additionalImageFiles.asMap().entries.map((entry) {
│   │   │       │       │                 int index = entry.key;
│   │   │       │       │                 File file = entry.value;
│   │   │       │       │                 return SizedBox(
│   │   │       │       │                   width: 80,
│   │   │       │       │                   height: 80,
│   │   │       │       │                   child: Stack(
│   │   │       │       │                     children: [
│   │   │       │       │                       ClipRRect(
│   │   │       │       │                           borderRadius: BorderRadius.circular(8),
│   │   │       │       │                           child: Image.file(file,
│   │   │       │       │                               fit: BoxFit.cover, width: 80, height: 80)),
│   │   │       │       │                       Positioned(
│   │   │       │       │                           top: -5,
│   │   │       │       │                           right: -5,
│   │   │       │       │                           child: CircleAvatar(
│   │   │       │       │                             radius: 12,
│   │   │       │       │                             backgroundColor: Colors.black54,
│   │   │       │       │                             child: IconButton(
│   │   │       │       │                               padding: EdgeInsets.zero,
│   │   │       │       │                               iconSize: 14,
│   │   │       │       │                               icon: const Icon(Icons.close, color: Colors.white),
│   │   │       │       │                               onPressed: () => _removeAdditionalImage(index),
│   │   │       │       │                               tooltip: 'Remove',
│   │   │       │       │                             ),
│   │   │       │       │                           )),
│   │   │       │       │                     ],
│   │   │       │       │                   ),
│   │   │       │       │                 );
│   │   │       │       │               }).toList(),
│   │   │       │       │               // "Add More" button
│   │   │       │       │               if (_additionalImageFiles.length < 5) // Limit number of images
│   │   │       │       │                 InkWell(
│   │   │       │       │                   onTap: _pickAdditionalImages,
│   │   │       │       │                   borderRadius: BorderRadius.circular(8),
│   │   │       │       │                   child: Container(
│   │   │       │       │                     width: 80,
│   │   │       │       │                     height: 80,
│   │   │       │       │                     decoration: BoxDecoration(
│   │   │       │       │                       border: Border.all(
│   │   │       │       │                           color: Colors.grey.shade400,
│   │   │       │       │                           style: BorderStyle.solid,
│   │   │       │       │                           width: 1.5),
│   │   │       │       │                       borderRadius: BorderRadius.circular(8),
│   │   │       │       │                       color: Colors.grey.shade100,
│   │   │       │       │                     ),
│   │   │       │       │                     child: Icon(Icons.add_a_photo_outlined,
│   │   │       │       │                         color: Colors.grey.shade600),
│   │   │       │       │                   ),
│   │   │       │       │                 ),
│   │   │       │       │             ],
│   │   │       │       │           )
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- SnackBar Utility ---
│   │   │       │       │     void _showSnackBar(BuildContext context, String message,
│   │   │       │       │         {bool isError = false}) {
│   │   │       │       │       if (isError) {
│   │   │       │       │         SnackBarUtil.showErrorSnackBar(title: '', message: message);
│   │   │       │       │       } else {
│   │   │       │       │         SnackBarUtil.showSuccessSnackBar(title: '', message: message);
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   }
│   │   │       ├── delete/
│   │   │       │   └── screen.dart
│   │   │       │       │   // lib/features/owner/boats/delete/screen.dart
│   │   │       │       │   
│   │   │       │       │   import 'package:app/utils/snackbar.dart';
│   │   │       │       │   import 'package:flutter/material.dart';
│   │   │       │       │   import 'package:localization/localization.dart';
│   │   │       │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │       │       │   
│   │   │       │       │   // --- Import Controller ---
│   │   │       │       │   import 'package:app/controllers/boat.dart'; // Use correct controller name
│   │   │       │       │   import 'package:app/app/theme.dart'; // For theme access
│   │   │       │       │   
│   │   │       │       │   class DeleteBoatScreen extends StatefulWidget {
│   │   │       │       │     // --- Accept boatId and boatName ---
│   │   │       │       │     final int boatId;
│   │   │       │       │     final String boatName;
│   │   │       │       │   
│   │   │       │       │     const DeleteBoatScreen({
│   │   │       │       │       super.key,
│   │   │       │       │       required this.boatId,
│   │   │       │       │       required this.boatName,
│   │   │       │       │     });
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     State<DeleteBoatScreen> createState() => _DeleteBoatScreenState();
│   │   │       │       │   }
│   │   │       │       │   
│   │   │       │       │   class _DeleteBoatScreenState extends State<DeleteBoatScreen>
│   │   │       │       │       with TickerProviderStateMixin {
│   │   │       │       │     // --- State Variables ---
│   │   │       │       │     bool _isLoading = false; // Loading state for deletion
│   │   │       │       │   
│   │   │       │       │     // --- Controller and Storage ---
│   │   │       │       │     final BoatController _boatController = BoatController();
│   │   │       │       │     final _storage = const FlutterSecureStorage();
│   │   │       │       │   
│   │   │       │       │     // Animation (keep if used)
│   │   │       │       │     late AnimationController _logoAnimationController;
│   │   │       │       │     late Animation<double> _logoAnimation;
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void initState() {
│   │   │       │       │       super.initState();
│   │   │       │       │       // Keep animation setup if used
│   │   │       │       │       _logoAnimationController = AnimationController(
│   │   │       │       │         duration: const Duration(milliseconds: 1500), // Adjust duration if needed
│   │   │       │       │         vsync: this,
│   │   │       │       │       )..forward();
│   │   │       │       │       _logoAnimation = CurvedAnimation(
│   │   │       │       │         parent: _logoAnimationController,
│   │   │       │       │         curve: Curves.easeInOutCubic, // Or a different curve like easeOutBack
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void dispose() {
│   │   │       │       │       _logoAnimationController.dispose(); // Dispose animation controller
│   │   │       │       │       super.dispose();
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Perform API Delete ---
│   │   │       │       │     Future<void> _performDeleteBoat() async {
│   │   │       │       │       setState(() => _isLoading = true);
│   │   │       │       │   
│   │   │       │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │       │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │       │       │         if (mounted) {
│   │   │       │       │           _showSnackBar(context, 'Authentication error. Please log in again.',
│   │   │       │       │               isError: true);
│   │   │       │       │           setState(() => _isLoading = false);
│   │   │       │       │         }
│   │   │       │       │         return;
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       try {
│   │   │       │       │         final bool success =
│   │   │       │       │             await _boatController.deleteBoat(widget.boatId, accessToken);
│   │   │       │       │   
│   │   │       │       │         if (!mounted) return;
│   │   │       │       │   
│   │   │       │       │         if (success) {
│   │   │       │       │           _showSnackBar(
│   │   │       │       │               context, 'delete_boat_success_message'.i18n([widget.boatName]));
│   │   │       │       │           // Navigate back, potentially passing a success flag to the previous screen
│   │   │       │       │           Navigator.pop(context, true); // Return true indicates success
│   │   │       │       │         } else {
│   │   │       │       │           _showSnackBar(context, 'Failed to delete boat. Please try again.',
│   │   │       │       │               isError: true);
│   │   │       │       │         }
│   │   │       │       │       } catch (e) {
│   │   │       │       │         print("Delete Boat Error: $e");
│   │   │       │       │         if (mounted)
│   │   │       │       │           _showSnackBar(context, 'An error occurred: $e', isError: true);
│   │   │       │       │       } finally {
│   │   │       │       │         if (mounted) setState(() => _isLoading = false);
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │     // --- End API Delete ---
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     Widget build(BuildContext context) {
│   │   │       │       │       return Scaffold(
│   │   │       │       │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │       │       │         appBar: AppBar(
│   │   │       │       │           title: Text('delete_boat_title_appbar'.i18n()),
│   │   │       │       │           centerTitle: true,
│   │   │       │       │           elevation: 1,
│   │   │       │       │         ),
│   │   │       │       │         body: Padding(
│   │   │       │       │           // Use Padding directly for content placement
│   │   │       │       │           padding: const EdgeInsets.symmetric(horizontal: 32.0, vertical: 16.0),
│   │   │       │       │           child: Column(
│   │   │       │       │             mainAxisAlignment: MainAxisAlignment.center, // Center vertically
│   │   │       │       │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │       │       │             children: <Widget>[
│   │   │       │       │               const Spacer(flex: 1), // Push content down slightly
│   │   │       │       │               _buildAppLogo(), // Your logo/icon
│   │   │       │       │               const SizedBox(height: 40),
│   │   │       │       │               _buildDeleteConfirmation(context), // Confirmation card
│   │   │       │       │               const Spacer(flex: 2), // Push buttons towards bottom
│   │   │       │       │             ],
│   │   │       │       │           ),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Keep Logo builder
│   │   │       │       │     Widget _buildAppLogo() {
│   │   │       │       │       return ScaleTransition(
│   │   │       │       │         scale: _logoAnimation,
│   │   │       │       │         child: FadeTransition(
│   │   │       │       │           opacity: _logoAnimation,
│   │   │       │       │           child: const Hero(
│   │   │       │       │             tag: 'app-logo-delete', // Use a unique tag if needed elsewhere
│   │   │       │       │             child: Icon(
│   │   │       │       │               Icons.warning_amber_rounded, // Warning icon more appropriate
│   │   │       │       │               size: 100,
│   │   │       │       │               color: Colors.redAccent,
│   │   │       │       │             ),
│   │   │       │       │           ),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Update Confirmation Card to use widget.boatName and button logic
│   │   │       │       │     Widget _buildDeleteConfirmation(BuildContext context) {
│   │   │       │       │       return Container(
│   │   │       │       │         padding: const EdgeInsets.all(32.0),
│   │   │       │       │         decoration: BoxDecoration(
│   │   │       │       │           color: Colors.white,
│   │   │       │       │           borderRadius: BorderRadius.circular(20),
│   │   │       │       │           boxShadow: [
│   │   │       │       │             BoxShadow(
│   │   │       │       │                 color: Colors.grey.shade200,
│   │   │       │       │                 blurRadius: 10,
│   │   │       │       │                 spreadRadius: 2,
│   │   │       │       │                 offset: const Offset(0, 4))
│   │   │       │       │           ],
│   │   │       │       │         ),
│   │   │       │       │         child: Column(
│   │   │       │       │           children: <Widget>[
│   │   │       │       │             Text(
│   │   │       │       │               'delete_boat_confirmation_title'.i18n(),
│   │   │       │       │               style: Theme.of(context)
│   │   │       │       │                   .textTheme
│   │   │       │       │                   .headlineMedium
│   │   │       │       │                   ?.copyWith(color: Colors.red),
│   │   │       │       │               textAlign: TextAlign.center,
│   │   │       │       │             ),
│   │   │       │       │             const SizedBox(height: 24),
│   │   │       │       │             Text(
│   │   │       │       │               // Use widget.boatName passed to the screen
│   │   │       │       │               'delete_boat_confirmation_message'.i18n([widget.boatName]),
│   │   │       │       │               style: Theme.of(context).textTheme.bodyLarge,
│   │   │       │       │               textAlign: TextAlign.center,
│   │   │       │       │             ),
│   │   │       │       │             const SizedBox(height: 32),
│   │   │       │       │             Row(
│   │   │       │       │               // Buttons side-by-side
│   │   │       │       │               mainAxisAlignment: MainAxisAlignment.spaceEvenly,
│   │   │       │       │               children: [
│   │   │       │       │                 // --- Cancel Button ---
│   │   │       │       │                 OutlinedButton(
│   │   │       │       │                   onPressed: _isLoading
│   │   │       │       │                       ? null
│   │   │       │       │                       : () => Navigator.pop(context), // Disable if loading
│   │   │       │       │                   style: OutlinedButton.styleFrom(
│   │   │       │       │                     foregroundColor: Theme.of(context).colorScheme.primary,
│   │   │       │       │                     side: BorderSide(
│   │   │       │       │                         color: Theme.of(context).colorScheme.primary, width: 1.2),
│   │   │       │       │                     padding:
│   │   │       │       │                         const EdgeInsets.symmetric(vertical: 14, horizontal: 24),
│   │   │       │       │                     shape: RoundedRectangleBorder(
│   │   │       │       │                         borderRadius: BorderRadius.circular(15)),
│   │   │       │       │                     disabledForegroundColor: Colors.grey.withOpacity(0.7),
│   │   │       │       │                   ),
│   │   │       │       │                   child: Text('cancel_button'.i18n(),
│   │   │       │       │                       style: const TextStyle(fontSize: 16)),
│   │   │       │       │                 ),
│   │   │       │       │                 // --- Delete Button (Updated) ---
│   │   │       │       │                 ElevatedButton.icon(
│   │   │       │       │                   onPressed:
│   │   │       │       │                       _isLoading ? null : _performDeleteBoat, // Call API delete
│   │   │       │       │                   icon: _isLoading
│   │   │       │       │                       ? Container(
│   │   │       │       │                           width: 18,
│   │   │       │       │                           height: 18,
│   │   │       │       │                           padding: const EdgeInsets.all(2.0),
│   │   │       │       │                           child: const CircularProgressIndicator(
│   │   │       │       │                               color: Colors.white, strokeWidth: 2))
│   │   │       │       │                       : const Icon(Icons.delete_forever_rounded, size: 20),
│   │   │       │       │                   label: Text('delete_boat_button'.i18n(),
│   │   │       │       │                       style: const TextStyle(fontSize: 16)),
│   │   │       │       │                   style: ElevatedButton.styleFrom(
│   │   │       │       │                     backgroundColor: Colors.red, // Red background
│   │   │       │       │                     foregroundColor: Colors.white,
│   │   │       │       │                     padding:
│   │   │       │       │                         const EdgeInsets.symmetric(vertical: 14, horizontal: 24),
│   │   │       │       │                     shape: RoundedRectangleBorder(
│   │   │       │       │                         borderRadius: BorderRadius.circular(15)),
│   │   │       │       │                     disabledBackgroundColor:
│   │   │       │       │                         Colors.red.withOpacity(0.5), // Disabled style
│   │   │       │       │                   ),
│   │   │       │       │                 ),
│   │   │       │       │               ],
│   │   │       │       │             ),
│   │   │       │       │           ],
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Keep SnackBar Utility
│   │   │       │       │     void _showSnackBar(BuildContext context, String message,
│   │   │       │       │         {bool isError = false}) {
│   │   │       │       │       ScaffoldMessenger.of(context).removeCurrentSnackBar();
│   │   │       │       │       if (isError) {
│   │   │       │       │         SnackBarUtil.showErrorSnackBar(
│   │   │       │       │           message: message,
│   │   │       │       │           title: 'Error',
│   │   │       │       │         );
│   │   │       │       │       } else {
│   │   │       │       │         SnackBarUtil.showSuccessSnackBar(
│   │   │       │       │           message: message,
│   │   │       │       │           title: 'Success',
│   │   │       │       │         );
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   }
│   │   │       ├── details/
│   │   │       │   └── screen.dart
│   │   │       │       │   // lib/features/owner/boats/details/screen.dart
│   │   │       │       │   
│   │   │       │       │   import 'package:app/utils/snackbar.dart';
│   │   │       │       │   import 'package:flutter/material.dart';
│   │   │       │       │   import 'package:app/app/theme.dart';
│   │   │       │       │   import 'package:get/get.dart'; // Assuming GetX is used based on imports in old file
│   │   │       │       │   import 'package:localization/localization.dart';
│   │   │       │       │   import 'package:carousel_slider/carousel_slider.dart';
│   │   │       │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │       │       │   
│   │   │       │       │   // --- Import Models and Controllers ---
│   │   │       │       │   import 'package:app/models/boat.dart'; // Use correct name
│   │   │       │       │   import 'package:app/models/review.dart'; // Use correct name
│   │   │       │       │   import 'package:app/controllers/boat.dart'; // Use correct name
│   │   │       │       │   import 'package:app/controllers/review.dart'; // Use correct name
│   │   │       │       │   
│   │   │       │       │   // --- Import Navigation Targets ---
│   │   │       │       │   import 'package:app/features/bookings/add/screen.dart'; // For "Book Now"
│   │   │       │       │   import 'package:app/features/owner/boats/update/screen.dart'; // For "Edit"
│   │   │       │       │   import 'package:app/features/owner/boats/delete/screen.dart'; // For "Delete"
│   │   │       │       │   
│   │   │       │       │   // Remove dummy model definitions if they exist here
│   │   │       │       │   
│   │   │       │       │   class BoatDetailsScreen extends StatefulWidget {
│   │   │       │       │     // --- Accept boatId ---
│   │   │       │       │     final int boatId;
│   │   │       │       │   
│   │   │       │       │     const BoatDetailsScreen({
│   │   │       │       │       super.key,
│   │   │       │       │       required this.boatId, // Require the ID
│   │   │       │       │     });
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     State<BoatDetailsScreen> createState() => _BoatDetailsScreenState();
│   │   │       │       │   }
│   │   │       │       │   
│   │   │       │       │   class _BoatDetailsScreenState extends State<BoatDetailsScreen>
│   │   │       │       │       with TickerProviderStateMixin {
│   │   │       │       │     // --- Controllers and State Variables ---
│   │   │       │       │     final BoatController _boatController = BoatController();
│   │   │       │       │     final ReviewController _reviewController = ReviewController();
│   │   │       │       │     final _storage = const FlutterSecureStorage();
│   │   │       │       │   
│   │   │       │       │     Boat? _boatDetails; // Holds fetched boat details
│   │   │       │       │     List<Review> _boatReviews = []; // Holds fetched reviews
│   │   │       │       │     bool _isLoading = true;
│   │   │       │       │     String? _errorMessage;
│   │   │       │       │     // Add state for owner actions if applicable (e.g., is this user the owner?)
│   │   │       │       │     bool _isOwner = false; // Placeholder, determine actual ownership
│   │   │       │       │   
│   │   │       │       │     // Remove animation controllers if not used
│   │   │       │       │     // late AnimationController _logoAnimationController;
│   │   │       │       │     // late Animation<double> _logoAnimation;
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void initState() {
│   │   │       │       │       super.initState();
│   │   │       │       │       _fetchAllData(); // Fetch boat details and reviews
│   │   │       │       │       // Initialize animations if used
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void dispose() {
│   │   │       │       │       // Dispose animations if used
│   │   │       │       │       super.dispose();
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Fetch Combined Data ---
│   │   │       │       │     Future<void> _fetchAllData() async {
│   │   │       │       │       setState(() {
│   │   │       │       │         _isLoading = true;
│   │   │       │       │         _errorMessage = null;
│   │   │       │       │       });
│   │   │       │       │   
│   │   │       │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │       │       │       // Token might be needed for owner checks or potentially even viewing details
│   │   │       │       │       // if (!mounted) return; // Check early if needed
│   │   │       │       │   
│   │   │       │       │       // if (accessToken == null || accessToken.isEmpty) {
│   │   │       │       │       //    if(mounted) setState(() { _isLoading = false; _errorMessage = 'Authentication Error.'; });
│   │   │       │       │       //    return;
│   │   │       │       │       // }
│   │   │       │       │   
│   │   │       │       │       try {
│   │   │       │       │         // Fetch boat details and reviews concurrently
│   │   │       │       │         final results = await Future.wait([
│   │   │       │       │           _boatController.fetchBoatDetails(widget.boatId,
│   │   │       │       │               accessToken: accessToken),
│   │   │       │       │           _reviewController.fetchReviews(
│   │   │       │       │             boatId: widget.boatId,
│   │   │       │       │           ), // Pass token if needed
│   │   │       │       │         ]);
│   │   │       │       │   
│   │   │       │       │         if (!mounted) return;
│   │   │       │       │   
│   │   │       │       │         final boatResult = results[0] as Boat?;
│   │   │       │       │         final reviewsResult = results[1] as List<Review>;
│   │   │       │       │   
│   │   │       │       │         if (boatResult != null) {
│   │   │       │       │           setState(() {
│   │   │       │       │             _boatDetails = boatResult;
│   │   │       │       │             _boatReviews = reviewsResult;
│   │   │       │       │             // TODO: Determine if the current user is the owner
│   │   │       │       │             // This requires comparing the logged-in user ID (from storage/state)
│   │   │       │       │             // with _boatDetails?.owner?.id
│   │   │       │       │             // _isOwner = checkOwnership(_boatDetails?.owner?.id);
│   │   │       │       │             _isLoading = false;
│   │   │       │       │           });
│   │   │       │       │         } else {
│   │   │       │       │           setState(() {
│   │   │       │       │             _isLoading = false;
│   │   │       │       │             _errorMessage = 'Failed to load boat details.';
│   │   │       │       │           });
│   │   │       │       │         }
│   │   │       │       │       } catch (e) {
│   │   │       │       │         print("Fetch Boat Details/Reviews Error: $e");
│   │   │       │       │         if (mounted) {
│   │   │       │       │           setState(() {
│   │   │       │       │             _isLoading = false;
│   │   │       │       │             _errorMessage = 'An error occurred: $e';
│   │   │       │       │           });
│   │   │       │       │         }
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Placeholder for ownership check ---
│   │   │       │       │     // bool checkOwnership(int? ownerId) {
│   │   │       │       │     //   // Replace with your actual logic to get current user ID
│   │   │       │       │     //   final currentUserId = /* Get from secure storage or auth provider */;
│   │   │       │       │     //   return ownerId != null && ownerId == currentUserId;
│   │   │       │       │     // }
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     Widget build(BuildContext context) {
│   │   │       │       │       return Scaffold(
│   │   │       │       │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │       │       │         // Use extendBodyBehindAppBar for immersive feel if desired
│   │   │       │       │         // extendBodyBehindAppBar: true,
│   │   │       │       │         appBar: _buildAppBar(context),
│   │   │       │       │         body: _buildBodyContent(),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Build Body based on State ---
│   │   │       │       │     Widget _buildBodyContent() {
│   │   │       │       │       if (_isLoading) {
│   │   │       │       │         return const Center(child: CircularProgressIndicator());
│   │   │       │       │       }
│   │   │       │       │       if (_errorMessage != null) {
│   │   │       │       │         return Center(
│   │   │       │       │             /* ... Error Message + Retry Button ... */
│   │   │       │       │             child: Padding(
│   │   │       │       │                 padding: const EdgeInsets.all(20.0),
│   │   │       │       │                 child: Column(
│   │   │       │       │                   mainAxisSize: MainAxisSize.min,
│   │   │       │       │                   children: [
│   │   │       │       │                     Icon(Icons.error_outline,
│   │   │       │       │                         color: Colors.red.shade400, size: 60),
│   │   │       │       │                     const SizedBox(height: 16),
│   │   │       │       │                     Text(_errorMessage!,
│   │   │       │       │                         textAlign: TextAlign.center,
│   │   │       │       │                         style: TextStyle(color: Colors.red.shade700)),
│   │   │       │       │                     const SizedBox(height: 16),
│   │   │       │       │                     ElevatedButton.icon(
│   │   │       │       │                         onPressed: _fetchAllData,
│   │   │       │       │                         icon: const Icon(Icons.refresh),
│   │   │       │       │                         label: const Text('Retry'))
│   │   │       │       │                   ],
│   │   │       │       │                 )));
│   │   │       │       │       }
│   │   │       │       │       if (_boatDetails == null) {
│   │   │       │       │         return const Center(
│   │   │       │       │             child: Text('Boat not found.')); // Should be caught by error
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       // --- Display Boat Details ---
│   │   │       │       │       return RefreshIndicator(
│   │   │       │       │         // Add pull-to-refresh
│   │   │       │       │         onRefresh: _fetchAllData,
│   │   │       │       │         child: SingleChildScrollView(
│   │   │       │       │           physics:
│   │   │       │       │               const AlwaysScrollableScrollPhysics(), // Ensure scrollable for RefreshIndicator
│   │   │       │       │           child: Column(
│   │   │       │       │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │       │       │             children: <Widget>[
│   │   │       │       │               _buildImageCarousel(context, _boatDetails!), // Pass fetched data
│   │   │       │       │               Padding(
│   │   │       │       │                 padding: const EdgeInsets.all(24.0),
│   │   │       │       │                 child: Column(
│   │   │       │       │                   crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │                   children: [
│   │   │       │       │                     Text(_boatDetails!.name,
│   │   │       │       │                         style: Theme.of(context)
│   │   │       │       │                             .textTheme
│   │   │       │       │                             .headlineMedium
│   │   │       │       │                             ?.copyWith(fontWeight: FontWeight.w800)),
│   │   │       │       │                     const SizedBox(height: 12),
│   │   │       │       │                     _buildRatingAndLocationRow(
│   │   │       │       │                         context, _boatDetails!), // Pass fetched data
│   │   │       │       │                     const SizedBox(height: 24),
│   │   │       │       │                     _buildDetailsSection(
│   │   │       │       │                         context, _boatDetails!), // Pass fetched data
│   │   │       │       │                     const SizedBox(height: 32),
│   │   │       │       │                     _buildOwnerDriverSection(
│   │   │       │       │                         context, _boatDetails!), // Pass fetched data
│   │   │       │       │                     const SizedBox(height: 40),
│   │   │       │       │                     // Conditionally show Book Now (for Renters) or Edit/Delete (for Owners)
│   │   │       │       │                     if (!_isOwner) // Assuming _isOwner state is correctly set
│   │   │       │       │                       _buildBookNowButton(context, _boatDetails!)
│   │   │       │       │                     else
│   │   │       │       │                       _buildOwnerActionButtons(
│   │   │       │       │                           context, _boatDetails!), // NEW owner buttons
│   │   │       │       │                     const SizedBox(height: 24),
│   │   │       │       │                     _buildReviewsSection(
│   │   │       │       │                         context, _boatReviews), // Pass fetched reviews
│   │   │       │       │                     const SizedBox(height: 20), // Bottom padding
│   │   │       │       │                   ],
│   │   │       │       │                 ),
│   │   │       │       │               ),
│   │   │       │       │             ],
│   │   │       │       │           ),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- AppBar --- (Add Owner actions if applicable)
│   │   │       │       │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │       │       │       return AppBar(
│   │   │       │       │         title: Text('boat_details_title_appbar'.i18n(),
│   │   │       │       │             style: const TextStyle(fontWeight: FontWeight.w700)),
│   │   │       │       │         centerTitle: true,
│   │   │       │       │         elevation: 1, // Keep subtle shadow
│   │   │       │       │         actions: [
│   │   │       │       │           // Optionally add favorite button or other actions here
│   │   │       │       │           IconButton(
│   │   │       │       │             icon: const Icon(Icons.favorite_border), // Example favorite
│   │   │       │       │             tooltip: 'Add to favorites',
│   │   │       │       │             onPressed: () {/* TODO: Implement favorite logic */},
│   │   │       │       │           ),
│   │   │       │       │           // Conditionally add Edit/Delete icons for owner? Or keep buttons below.
│   │   │       │       │           // if (_isOwner) ...
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Image Carousel --- (Uses fetched _boatDetails)
│   │   │       │       │     Widget _buildImageCarousel(BuildContext context, Boat boat) {
│   │   │       │       │       // Use actual image URLs or main image
│   │   │       │       │       final List<String> imageUrls =
│   │   │       │       │           boat.images?.map((img) => img.imageUrl).toList() ?? [];
│   │   │       │       │       if (imageUrls.isEmpty && boat.mainImageUrl != null) {
│   │   │       │       │         imageUrls.add(boat.mainImageUrl!);
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       if (imageUrls.isEmpty) {
│   │   │       │       │         return Container(
│   │   │       │       │             height: 350,
│   │   │       │       │             color: Colors.grey[300],
│   │   │       │       │             child: const Center(child: Icon(Icons.image_not_supported)));
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       return CarouselSlider(
│   │   │       │       │         options: CarouselOptions(
│   │   │       │       │           height: 350.0, enlargeCenterPage: true, autoPlay: imageUrls.length > 1,
│   │   │       │       │           aspectRatio: 16 / 9, enableInfiniteScroll: imageUrls.length > 1,
│   │   │       │       │           autoPlayAnimationDuration: const Duration(milliseconds: 800),
│   │   │       │       │           viewportFraction: 0.85, // Slightly wider view
│   │   │       │       │         ),
│   │   │       │       │         items: imageUrls.map((imageUrl) {
│   │   │       │       │           return ClipRRect(
│   │   │       │       │             borderRadius: BorderRadius.circular(16.0),
│   │   │       │       │             child: Image.network(
│   │   │       │       │               imageUrl,
│   │   │       │       │               fit: BoxFit.cover,
│   │   │       │       │               width: MediaQuery.of(context).size.width,
│   │   │       │       │               errorBuilder: (context, error, stackTrace) =>
│   │   │       │       │                   const Center(child: Icon(Icons.error_outline)),
│   │   │       │       │               loadingBuilder: (context, child, loadingProgress) {
│   │   │       │       │                 // Add loading indicator
│   │   │       │       │                 if (loadingProgress == null) return child;
│   │   │       │       │                 return Center(
│   │   │       │       │                     child: CircularProgressIndicator(
│   │   │       │       │                   value: loadingProgress.expectedTotalBytes != null
│   │   │       │       │                       ? loadingProgress.cumulativeBytesLoaded /
│   │   │       │       │                           loadingProgress.expectedTotalBytes!
│   │   │       │       │                       : null,
│   │   │       │       │                 ));
│   │   │       │       │               },
│   │   │       │       │             ),
│   │   │       │       │           );
│   │   │       │       │         }).toList(),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Rating/Location Row --- (Uses fetched _boatDetails)
│   │   │       │       │     Widget _buildRatingAndLocationRow(BuildContext context, Boat boat) {
│   │   │       │       │       return Row(
│   │   │       │       │         mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │       │       │         children: [
│   │   │       │       │           Row(
│   │   │       │       │             children: [
│   │   │       │       │               const Icon(Icons.star_rounded, color: Colors.amber, size: 24),
│   │   │       │       │               const SizedBox(width: 4),
│   │   │       │       │               // Use fetched rating and review count
│   │   │       │       │               Text(
│   │   │       │       │                   '${boat.rating} (${_boatReviews.length} ${'reviews_count'.i18n()})',
│   │   │       │       │                   style: Theme.of(context).textTheme.titleSmall),
│   │   │       │       │             ],
│   │   │       │       │           ),
│   │   │       │       │           Flexible(
│   │   │       │       │             // Allow location to wrap if long
│   │   │       │       │             child: Row(
│   │   │       │       │               mainAxisAlignment: MainAxisAlignment.end, // Align to right
│   │   │       │       │               mainAxisSize: MainAxisSize.min, // Take only needed space
│   │   │       │       │               children: [
│   │   │       │       │                 Icon(Icons.location_on_rounded,
│   │   │       │       │                     color: Theme.of(context).colorScheme.primary, size: 20),
│   │   │       │       │                 const SizedBox(width: 4),
│   │   │       │       │                 Flexible(
│   │   │       │       │                     // Let text wrap within the row
│   │   │       │       │                     child: Text(
│   │   │       │       │                   boat.locationDescription,
│   │   │       │       │                   style: Theme.of(context).textTheme.bodyMedium,
│   │   │       │       │                   overflow: TextOverflow.ellipsis,
│   │   │       │       │                 )),
│   │   │       │       │               ],
│   │   │       │       │             ),
│   │   │       │       │           ),
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Details Section --- (Uses fetched _boatDetails)
│   │   │       │       │     Widget _buildDetailsSection(BuildContext context, Boat boat) {
│   │   │       │       │       // Dynamically build specifications from the fetched boat object if needed
│   │   │       │       │       // Or display specific fields like length, capacity, cabins
│   │   │       │       │       return Column(
│   │   │       │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │         children: [
│   │   │       │       │           Text('specifications_title'.i18n(),
│   │   │       │       │               style: Theme.of(context)
│   │   │       │       │                   .textTheme
│   │   │       │       │                   .titleLarge
│   │   │       │       │                   ?.copyWith(fontWeight: FontWeight.w700)),
│   │   │       │       │           const SizedBox(height: 12),
│   │   │       │       │           if (boat.length != null)
│   │   │       │       │             _buildDetailItem(context, Icons.straighten_outlined,
│   │   │       │       │                 'length_label'.i18n(), '${boat.length} ft'),
│   │   │       │       │           if (boat.capacity != null)
│   │   │       │       │             _buildDetailItem(context, Icons.people_outline,
│   │   │       │       │                 'capacity_label'.i18n(), '${boat.capacity} guests'),
│   │   │       │       │           if (boat.cabins != null)
│   │   │       │       │             _buildDetailItem(context, Icons.cabin_outlined, 'cabins_label'.i18n(),
│   │   │       │       │                 '${boat.cabins}'),
│   │   │       │       │           // Add more specs as needed
│   │   │       │       │           if (boat.length != null || boat.capacity != null || boat.cabins != null)
│   │   │       │       │             const Divider(height: 20, thickness: 0.5),
│   │   │       │       │   
│   │   │       │       │           Text('description_title'.i18n(),
│   │   │       │       │               style: Theme.of(context)
│   │   │       │       │                   .textTheme
│   │   │       │       │                   .titleLarge
│   │   │       │       │                   ?.copyWith(fontWeight: FontWeight.w700)),
│   │   │       │       │           const SizedBox(height: 12),
│   │   │       │       │           Text(boat.description ?? 'no_description_available'.i18n(),
│   │   │       │       │               style:
│   │   │       │       │                   Theme.of(context).textTheme.bodyMedium?.copyWith(height: 1.5)),
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Helper for detail items
│   │   │       │       │     Widget _buildDetailItem(
│   │   │       │       │         BuildContext context, IconData icon, String label, String value) {
│   │   │       │       │       return Padding(
│   │   │       │       │         padding: const EdgeInsets.symmetric(vertical: 4.0),
│   │   │       │       │         child: Row(children: [
│   │   │       │       │           Icon(icon, size: 18, color: Theme.of(context).colorScheme.primary),
│   │   │       │       │           const SizedBox(width: 8),
│   │   │       │       │           Text('$label: ',
│   │   │       │       │               style: Theme.of(context)
│   │   │       │       │                   .textTheme
│   │   │       │       │                   .bodyMedium
│   │   │       │       │                   ?.copyWith(fontWeight: FontWeight.w600)),
│   │   │       │       │           Text(value,
│   │   │       │       │               style: Theme.of(context)
│   │   │       │       │                   .textTheme
│   │   │       │       │                   .bodyMedium
│   │   │       │       │                   ?.copyWith(color: AppColors.subtleTextColor)),
│   │   │       │       │         ]),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Owner/Driver Section --- (Uses fetched _boatDetails)
│   │   │       │       │     Widget _buildOwnerDriverSection(BuildContext context, Boat boat) {
│   │   │       │       │       return Column(
│   │   │       │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │         children: [
│   │   │       │       │           Text('owner_driver_info_title'.i18n(),
│   │   │       │       │               style: Theme.of(context)
│   │   │       │       │                   .textTheme
│   │   │       │       │                   .titleLarge
│   │   │       │       │                   ?.copyWith(fontWeight: FontWeight.w700)),
│   │   │       │       │           const SizedBox(height: 12),
│   │   │       │       │           ListTile(
│   │   │       │       │             leading: const Icon(Icons.person_outline_rounded),
│   │   │       │       │             // Display owner's name if available in nested object
│   │   │       │       │             title: Text(
│   │   │       │       │                 '${'owner_label'.i18n()}: ${boat.owner?.firstName ?? boat.ownerEmail ?? 'N/A'} ${boat.owner?.lastName ?? ''}'),
│   │   │       │       │             dense: true, contentPadding: EdgeInsets.zero,
│   │   │       │       │           ),
│   │   │       │       │           if (boat.driverAvailable) // Show driver info only if available
│   │   │       │       │             ListTile(
│   │   │       │       │               leading: const Icon(Icons.drive_eta_outlined),
│   │   │       │       │               title: Text(
│   │   │       │       │                   '${'driver_label'.i18n()}: ${boat.driverName ?? 'Available'}'),
│   │   │       │       │               subtitle:
│   │   │       │       │                   boat.driverDetails != null && boat.driverDetails!.isNotEmpty
│   │   │       │       │                       ? Text(boat.driverDetails!)
│   │   │       │       │                       : null,
│   │   │       │       │               dense: true,
│   │   │       │       │               contentPadding: EdgeInsets.zero,
│   │   │       │       │             ),
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Book Now Button (for Renters) ---
│   │   │       │       │     Widget _buildBookNowButton(BuildContext context, Boat boat) {
│   │   │       │       │       return ElevatedButton.icon(
│   │   │       │       │         onPressed: () {
│   │   │       │       │           Navigator.push(
│   │   │       │       │               context,
│   │   │       │       │               MaterialPageRoute(
│   │   │       │       │                   builder: (_) =>
│   │   │       │       │                       BookBoatScreen(boatId: boat.id.toString(), boat: boat)));
│   │   │       │       │         },
│   │   │       │       │         icon: const Icon(Icons.calendar_today_rounded, size: 20),
│   │   │       │       │         label: Text('book_now_button'.i18n(),
│   │   │       │       │             style: const TextStyle(fontSize: 16, fontWeight: FontWeight.w600)),
│   │   │       │       │         style: ElevatedButton.styleFrom(
│   │   │       │       │           padding: const EdgeInsets.symmetric(vertical: 16),
│   │   │       │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
│   │   │       │       │           minimumSize: const Size(double.infinity, 50),
│   │   │       │       │           backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │       │       │           foregroundColor: Colors.white,
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Owner Action Buttons ---
│   │   │       │       │     Widget _buildOwnerActionButtons(BuildContext context, Boat boat) {
│   │   │       │       │       return Row(
│   │   │       │       │         mainAxisAlignment: MainAxisAlignment.spaceEvenly,
│   │   │       │       │         children: [
│   │   │       │       │           OutlinedButton.icon(
│   │   │       │       │             icon: const Icon(Icons.edit_note_outlined),
│   │   │       │       │             label: Text('edit_button'.i18n()),
│   │   │       │       │             onPressed: () {
│   │   │       │       │               Navigator.push(
│   │   │       │       │                   context,
│   │   │       │       │                   MaterialPageRoute(
│   │   │       │       │                       builder: (_) => UpdateBoatScreen(
│   │   │       │       │                           boat: boat))); // Pass boat object to UpdateScreen
│   │   │       │       │             },
│   │   │       │       │             style: OutlinedButton.styleFrom(
│   │   │       │       │               foregroundColor:
│   │   │       │       │                   Theme.of(context).colorScheme.secondary, // Use secondary color
│   │   │       │       │               side: BorderSide(color: Theme.of(context).colorScheme.secondary),
│   │   │       │       │               padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 14),
│   │   │       │       │               shape:
│   │   │       │       │                   RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
│   │   │       │       │             ),
│   │   │       │       │           ),
│   │   │       │       │           OutlinedButton.icon(
│   │   │       │       │             icon: const Icon(Icons.delete_forever_outlined),
│   │   │       │       │             label: Text('delete_button'.i18n()),
│   │   │       │       │             onPressed: () async {
│   │   │       │       │               final result = await Navigator.push<bool>(
│   │   │       │       │                   context,
│   │   │       │       │                   MaterialPageRoute(
│   │   │       │       │                       builder: (_) => DeleteBoatScreen(
│   │   │       │       │                           boatId: boat.id, boatName: boat.name)));
│   │   │       │       │               if (result == true && mounted) {
│   │   │       │       │                 // If deletion was successful, pop this details screen as well
│   │   │       │       │                 Navigator.pop(
│   │   │       │       │                     context, true); // Indicate success to previous screen
│   │   │       │       │               }
│   │   │       │       │             },
│   │   │       │       │             style: OutlinedButton.styleFrom(
│   │   │       │       │               foregroundColor: Colors.redAccent,
│   │   │       │       │               side: BorderSide(color: Colors.redAccent.shade100),
│   │   │       │       │               padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 14),
│   │   │       │       │               shape:
│   │   │       │       │                   RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
│   │   │       │       │             ),
│   │   │       │       │           ),
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Reviews Section --- (Uses fetched _boatReviews)
│   │   │       │       │     Widget _buildReviewsSection(BuildContext context, List<Review> reviews) {
│   │   │       │       │       return Column(
│   │   │       │       │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │         children: [
│   │   │       │       │           Text('reviews_title'.i18n(),
│   │   │       │       │                   style: Theme.of(context)
│   │   │       │       │                       .textTheme
│   │   │       │       │                       .titleLarge
│   │   │       │       │                       ?.copyWith(fontWeight: FontWeight.w700))
│   │   │       │       │               .paddingOnly(bottom: 16, top: 16),
│   │   │       │       │           const SizedBox(height: 12),
│   │   │       │       │           if (reviews.isEmpty)
│   │   │       │       │             Center(
│   │   │       │       │                 child: Padding(
│   │   │       │       │               padding: const EdgeInsets.symmetric(vertical: 20.0),
│   │   │       │       │               child: Text('no_reviews_listed_yet_message'.i18n(),
│   │   │       │       │                   style: Theme.of(context)
│   │   │       │       │                       .textTheme
│   │   │       │       │                       .bodyMedium
│   │   │       │       │                       ?.copyWith(color: Colors.grey.shade600)),
│   │   │       │       │             ))
│   │   │       │       │           else
│   │   │       │       │             ListView.builder(
│   │   │       │       │               shrinkWrap: true,
│   │   │       │       │               physics: const NeverScrollableScrollPhysics(),
│   │   │       │       │               itemCount: reviews.length,
│   │   │       │       │               itemBuilder: (context, index) {
│   │   │       │       │                 return _buildReviewCard(
│   │   │       │       │                     context, reviews[index]); // Build card for each review
│   │   │       │       │               },
│   │   │       │       │             ),
│   │   │       │       │         ],
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Keep Review Card builder, Rating Stars, Date Formatters
│   │   │       │       │     Widget _buildReviewCard(BuildContext context, Review review) {
│   │   │       │       │       // Use the existing fancy review card from RateBoatScreen or DetailsScreen
│   │   │       │       │       return Container(
│   │   │       │       │         padding: const EdgeInsets.all(4),
│   │   │       │       │         margin: const EdgeInsets.only(bottom: 16),
│   │   │       │       │         decoration: BoxDecoration(
│   │   │       │       │           color: Theme.of(context).cardColor,
│   │   │       │       │           borderRadius: BorderRadius.circular(12),
│   │   │       │       │           boxShadow: [
│   │   │       │       │             BoxShadow(
│   │   │       │       │               color: Colors.grey.withOpacity(0.3),
│   │   │       │       │               blurRadius: 10,
│   │   │       │       │               offset: const Offset(0, 2),
│   │   │       │       │             ),
│   │   │       │       │           ],
│   │   │       │       │         ),
│   │   │       │       │         child: Padding(
│   │   │       │       │           padding: const EdgeInsets.all(16.0),
│   │   │       │       │           child: Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
│   │   │       │       │             Row(children: [
│   │   │       │       │               // replace CircleAvatar with Icon.person
│   │   │       │       │               Icon(Icons.person,
│   │   │       │       │                   size: 40,
│   │   │       │       │                   color:
│   │   │       │       │                       Theme.of(context).colorScheme.primary), // Placeholder icon
│   │   │       │       │               const SizedBox(width: 12),
│   │   │       │       │               Expanded(
│   │   │       │       │                   child: Column(
│   │   │       │       │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │                 children: [
│   │   │       │       │                   Text(
│   │   │       │       │                       '${review.renter?.firstName ?? 'User'} ${review.renter?.lastName ?? ''}',
│   │   │       │       │                       style: Theme.of(context)
│   │   │       │       │                           .textTheme
│   │   │       │       │                           .titleSmall
│   │   │       │       │                           ?.copyWith(fontWeight: FontWeight.w600)),
│   │   │       │       │                   const SizedBox(height: 4),
│   │   │       │       │                   _buildRatingStars(review.rating.toDouble()), // Pass rating
│   │   │       │       │                 ],
│   │   │       │       │               )),
│   │   │       │       │               Text(
│   │   │       │       │                 _formatReviewDate(review.createdAt),
│   │   │       │       │                 style: Theme.of(context)
│   │   │       │       │                     .textTheme
│   │   │       │       │                     .bodySmall
│   │   │       │       │                     ?.copyWith(color: Colors.grey.shade600),
│   │   │       │       │               ),
│   │   │       │       │             ]),
│   │   │       │       │             const SizedBox(height: 12),
│   │   │       │       │             if (review.comment != null && review.comment!.isNotEmpty)
│   │   │       │       │               Text(review.comment!,
│   │   │       │       │                   style: Theme.of(context)
│   │   │       │       │                       .textTheme
│   │   │       │       │                       .bodyMedium
│   │   │       │       │                       ?.copyWith(height: 1.4)),
│   │   │       │       │           ]),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     Widget _buildRatingStars(double rating) {
│   │   │       │       │       return Row(
│   │   │       │       │           mainAxisSize: MainAxisSize.min,
│   │   │       │       │           children: List.generate(5, (index) {
│   │   │       │       │             return Icon(
│   │   │       │       │                 index < rating ? Icons.star_rounded : Icons.star_border_rounded,
│   │   │       │       │                 color: Colors.amber,
│   │   │       │       │                 size: 18);
│   │   │       │       │           }));
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     String _formatReviewDate(DateTime date) =>
│   │   │       │       │         "${date.day} ${getMonthName(date.month)} ${date.year}";
│   │   │       │       │     String getMonthName(int month) {
│   │   │       │       │       /* ... same month name logic ... */
│   │   │       │       │       const months = [
│   │   │       │       │         "",
│   │   │       │       │         "Jan",
│   │   │       │       │         "Feb",
│   │   │       │       │         "Mar",
│   │   │       │       │         "Apr",
│   │   │       │       │         "May",
│   │   │       │       │         "Jun",
│   │   │       │       │         "Jul",
│   │   │       │       │         "Aug",
│   │   │       │       │         "Sep",
│   │   │       │       │         "Oct",
│   │   │       │       │         "Nov",
│   │   │       │       │         "Dec"
│   │   │       │       │       ];
│   │   │       │       │       return months[month];
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- SnackBar Utility ---
│   │   │       │       │     void _showSnackBar(BuildContext context, String message,
│   │   │       │       │         {bool isError = false}) {
│   │   │       │       │       if (isError) {
│   │   │       │       │         SnackBarUtil.showErrorSnackBar(message: message, title: 'Error');
│   │   │       │       │       } else {
│   │   │       │       │         SnackBarUtil.showSuccessSnackBar(message: message, title: 'Success');
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   }
│   │   │       ├── list/
│   │   │       │   └── screen.dart
│   │   │       │       │   // lib/features/owner/boats/list/screen.dart
│   │   │       │       │   
│   │   │       │       │   import 'package:app/app/theme.dart';
│   │   │       │       │   // --- Import Models, Controller, and Screens ---
│   │   │       │       │   import 'package:app/controllers/boat.dart'; // Use correct controller name
│   │   │       │       │   import 'package:app/features/owner/boats/add/screen.dart'; // Add Boat Screen
│   │   │       │       │   import 'package:app/features/owner/boats/details/screen.dart'; // Optional: Navigate to details from list
│   │   │       │       │   import 'package:app/features/owner/boats/update/screen.dart'; // Update Boat Screen
│   │   │       │       │   import 'package:app/models/boat.dart'; // Use correct model name
│   │   │       │       │   import 'package:app/utils/snackbar.dart';
│   │   │       │       │   import 'package:flutter/material.dart';
│   │   │       │       │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │       │       │   import 'package:get/get.dart';
│   │   │       │       │   import 'package:localization/localization.dart';
│   │   │       │       │   
│   │   │       │       │   class ListBoatsScreen extends StatefulWidget {
│   │   │       │       │     const ListBoatsScreen({super.key});
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     State<ListBoatsScreen> createState() => _ListBoatsScreenState();
│   │   │       │       │   }
│   │   │       │       │   
│   │   │       │       │   class _ListBoatsScreenState extends State<ListBoatsScreen>
│   │   │       │       │       with TickerProviderStateMixin {
│   │   │       │       │     // --- Controller and State Variables ---
│   │   │       │       │     final BoatController _boatController = BoatController();
│   │   │       │       │     final _storage = const FlutterSecureStorage();
│   │   │       │       │     List<Boat> _ownerBoats = []; // Holds fetched owner's boats
│   │   │       │       │     List<Boat> _filteredBoats = []; // Holds boats after applying local filters
│   │   │       │       │     bool _isLoading = true;
│   │   │       │       │     String? _errorMessage;
│   │   │       │       │   
│   │   │       │       │     // Filter/Search state
│   │   │       │       │     final TextEditingController _searchController = TextEditingController();
│   │   │       │       │     String _currentSearchQuery = '';
│   │   │       │       │     String _filterStatus = 'all'; // 'all', 'active', 'inactive', 'draft'
│   │   │       │       │   
│   │   │       │       │     // Animation (Remove if not used)
│   │   │       │       │     // late AnimationController _logoAnimationController;
│   │   │       │       │     // late Animation<double> _logoAnimation;
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void initState() {
│   │   │       │       │       super.initState();
│   │   │       │       │       _fetchOwnerBoats(); // Fetch data on init
│   │   │       │       │       // Initialize animations if needed
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     void dispose() {
│   │   │       │       │       _searchController.dispose();
│   │   │       │       │       // Dispose animations if needed
│   │   │       │       │       super.dispose();
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Fetch Owner's Boat Data ---
│   │   │       │       │     Future<void> _fetchOwnerBoats() async {
│   │   │       │       │       setState(() {
│   │   │       │       │         _isLoading = true;
│   │   │       │       │         _errorMessage = null;
│   │   │       │       │       });
│   │   │       │       │   
│   │   │       │       │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │       │       │       if (accessToken == null || accessToken.isEmpty) {
│   │   │       │       │         if (mounted) {
│   │   │       │       │           setState(() {
│   │   │       │       │             _isLoading = false;
│   │   │       │       │             _errorMessage = 'Authentication Error. Please log in.';
│   │   │       │       │           });
│   │   │       │       │         }
│   │   │       │       │         return;
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       try {
│   │   │       │       │         // Fetch boats using the owner's token - Controller/Backend handles filtering
│   │   │       │       │         final fetchedBoats = await _boatController.fetchBoats(
│   │   │       │       │             // Provide the token to get owner-specific boats
│   │   │       │       │             // Pass filter/search/order parameters if API supports them server-side
│   │   │       │       │             // filters: _currentFilters.isNotEmpty ? _currentFilters : null, // Example for server-side filter
│   │   │       │       │             // searchQuery: _currentSearchQuery.isNotEmpty ? _currentSearchQuery : null,
│   │   │       │       │             // ordering: _currentOrdering,
│   │   │       │       │             );
│   │   │       │       │   
│   │   │       │       │         if (!mounted) return;
│   │   │       │       │   
│   │   │       │       │         setState(() {
│   │   │       │       │           _ownerBoats = fetchedBoats;
│   │   │       │       │           _applyLocalFilters(); // Apply local filters to the fetched list
│   │   │       │       │           _isLoading = false;
│   │   │       │       │         });
│   │   │       │       │       } catch (e) {
│   │   │       │       │         print("Fetch Owner Boats Error: $e");
│   │   │       │       │         if (mounted) {
│   │   │       │       │           setState(() {
│   │   │       │       │             _isLoading = false;
│   │   │       │       │             _errorMessage = 'Failed to load your boats. Please try again.';
│   │   │       │       │           });
│   │   │       │       │         }
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Apply Local Filtering and Searching ---
│   │   │       │       │     void _applyLocalFilters() {
│   │   │       │       │       _filteredBoats = _ownerBoats.where((boat) {
│   │   │       │       │         // Apply status filter
│   │   │       │       │         bool statusMatch = true;
│   │   │       │       │         if (_filterStatus != 'all') {
│   │   │       │       │           statusMatch = boat.status.toLowerCase() == _filterStatus.toLowerCase();
│   │   │       │       │         }
│   │   │       │       │   
│   │   │       │       │         // Apply search query (simple local search on name/type)
│   │   │       │       │         bool searchMatch = true;
│   │   │       │       │         if (_currentSearchQuery.isNotEmpty) {
│   │   │       │       │           final query = _currentSearchQuery.toLowerCase();
│   │   │       │       │           searchMatch = boat.name.toLowerCase().contains(query) ||
│   │   │       │       │               boat.boatType.toLowerCase().contains(query);
│   │   │       │       │         }
│   │   │       │       │   
│   │   │       │       │         return statusMatch && searchMatch;
│   │   │       │       │       }).toList();
│   │   │       │       │   
│   │   │       │       │       // Trigger UI rebuild after filtering
│   │   │       │       │       setState(
│   │   │       │       │           () {}); // Explicitly call setState here if filters are applied outside of _fetchOwnerBoats
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Navigation Helpers with Refresh ---
│   │   │       │       │     Future<void> _navigateToAddBoat() async {
│   │   │       │       │       final result = await Navigator.push<bool>(
│   │   │       │       │           context, MaterialPageRoute(builder: (_) => const AddBoatScreen()));
│   │   │       │       │       // If the Add screen returned true (meaning success), refresh the list
│   │   │       │       │       if (result == true && mounted) {
│   │   │       │       │         _fetchOwnerBoats();
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     Future<void> _navigateToUpdateBoat(Boat boat) async {
│   │   │       │       │       final result = await Navigator.push<bool>(
│   │   │       │       │           context,
│   │   │       │       │           MaterialPageRoute(
│   │   │       │       │               builder: (_) =>
│   │   │       │       │                   UpdateBoatScreen(boat: boat)) // Pass the boat object
│   │   │       │       │           );
│   │   │       │       │       // If the Update or Delete screen returned true, refresh the list
│   │   │       │       │       if (result == true && mounted) {
│   │   │       │       │         _fetchOwnerBoats();
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Delete is handled within Update screen now, but keep stub if needed
│   │   │       │       │     // Future<void> _navigateToDeleteBoat(int boatId, String boatName) async { ... }
│   │   │       │       │   
│   │   │       │       │     @override
│   │   │       │       │     Widget build(BuildContext context) {
│   │   │       │       │       return Scaffold(
│   │   │       │       │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │       │       │         appBar: _buildAppBar(context),
│   │   │       │       │         body: _buildBodyContent(),
│   │   │       │       │         floatingActionButton: FloatingActionButton(
│   │   │       │       │           // Add FAB to add boats
│   │   │       │       │           onPressed: _navigateToAddBoat,
│   │   │       │       │           tooltip: 'add_new_boat_tooltip'.i18n(),
│   │   │       │       │           child: const Icon(Icons.add),
│   │   │       │       │           backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │       │       │           foregroundColor: Colors.white,
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Build Body Content ---
│   │   │       │       │     Widget _buildBodyContent() {
│   │   │       │       │       if (_isLoading) {
│   │   │       │       │         return const Center(child: CircularProgressIndicator());
│   │   │       │       │       }
│   │   │       │       │       if (_errorMessage != null) {
│   │   │       │       │         return Center(
│   │   │       │       │             /* ... Error Message + Retry Button ... */
│   │   │       │       │             child: Padding(
│   │   │       │       │                 padding: const EdgeInsets.all(20.0),
│   │   │       │       │                 child: Column(
│   │   │       │       │                   mainAxisSize: MainAxisSize.min,
│   │   │       │       │                   children: [
│   │   │       │       │                     Icon(Icons.error_outline,
│   │   │       │       │                         color: Colors.red.shade400, size: 60),
│   │   │       │       │                     const SizedBox(height: 16),
│   │   │       │       │                     Text(_errorMessage!,
│   │   │       │       │                         textAlign: TextAlign.center,
│   │   │       │       │                         style: TextStyle(color: Colors.red.shade700)),
│   │   │       │       │                     const SizedBox(height: 16),
│   │   │       │       │                     ElevatedButton.icon(
│   │   │       │       │                         onPressed: _fetchOwnerBoats,
│   │   │       │       │                         icon: const Icon(Icons.refresh),
│   │   │       │       │                         label: const Text('Retry'))
│   │   │       │       │                   ],
│   │   │       │       │                 )));
│   │   │       │       │       }
│   │   │       │       │       if (_ownerBoats.isEmpty) {
│   │   │       │       │         return _buildEmptyBoatList(); // Show owner-specific empty state
│   │   │       │       │       }
│   │   │       │       │       if (_filteredBoats.isEmpty) {
│   │   │       │       │         return Center(
│   │   │       │       │             // Show message when filters yield no results
│   │   │       │       │             child: Padding(
│   │   │       │       │                 padding: const EdgeInsets.all(20.0),
│   │   │       │       │                 child: Text('no_boats_match_filters_owner'.i18n(),
│   │   │       │       │                     style: Theme.of(context).textTheme.bodyLarge)));
│   │   │       │       │       }
│   │   │       │       │   
│   │   │       │       │       // Display Boat List
│   │   │       │       │       return RefreshIndicator(
│   │   │       │       │         onRefresh: _fetchOwnerBoats,
│   │   │       │       │         child: _buildBoatGridList(),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- AppBar --- (Add '+' action removed, FAB added instead)
│   │   │       │       │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │       │       │       return AppBar(
│   │   │       │       │         title: Text('my_list_boats_title_appbar'.i18n(),
│   │   │       │       │             style: const TextStyle(fontWeight: FontWeight.w700)),
│   │   │       │       │         centerTitle: true,
│   │   │       │       │         elevation: 2,
│   │   │       │       │         backgroundColor: Colors.white,
│   │   │       │       │         iconTheme: IconThemeData(color: Theme.of(context).colorScheme.primary),
│   │   │       │       │         actions: [
│   │   │       │       │           IconButton(
│   │   │       │       │             icon: const Icon(Icons.filter_alt_outlined, size: 28),
│   │   │       │       │             tooltip: 'filter_boats_tooltip'.i18n(),
│   │   │       │       │             onPressed: () => _showFilterOptions(context), // Show filter options
│   │   │       │       │           ),
│   │   │       │       │         ],
│   │   │       │       │         bottom: PreferredSize(
│   │   │       │       │           // Keep Search Bar
│   │   │       │       │           preferredSize: const Size.fromHeight(70.0),
│   │   │       │       │           child: Padding(
│   │   │       │       │             padding: const EdgeInsets.symmetric(horizontal: 16.0, vertical: 12.0),
│   │   │       │       │             child: _buildSearchBar(),
│   │   │       │       │           ),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Search Bar --- (Updates local search query)
│   │   │       │       │     Widget _buildSearchBar() {
│   │   │       │       │       return TextField(
│   │   │       │       │         controller: _searchController,
│   │   │       │       │         decoration: InputDecoration(
│   │   │       │       │           hintText: 'search_your_boats_hint'.i18n(),
│   │   │       │       │           // Owner specific hint
│   │   │       │       │           prefixIcon:
│   │   │       │       │               Icon(Icons.search, color: Theme.of(context).colorScheme.primary),
│   │   │       │       │           suffixIcon: _currentSearchQuery.isNotEmpty
│   │   │       │       │               ? IconButton(
│   │   │       │       │                   icon: const Icon(Icons.clear, size: 20),
│   │   │       │       │                   onPressed: () {
│   │   │       │       │                     _searchController.clear();
│   │   │       │       │                     setState(() {
│   │   │       │       │                       _currentSearchQuery = '';
│   │   │       │       │                       _applyLocalFilters();
│   │   │       │       │                     });
│   │   │       │       │                   },
│   │   │       │       │                 )
│   │   │       │       │               : null,
│   │   │       │       │           filled: true,
│   │   │       │       │           fillColor: Colors.grey.shade50,
│   │   │       │       │           border: OutlineInputBorder(
│   │   │       │       │             borderRadius: BorderRadius.circular(25),
│   │   │       │       │             borderSide: BorderSide.none,
│   │   │       │       │           ),
│   │   │       │       │           enabledBorder: OutlineInputBorder(
│   │   │       │       │             borderRadius: BorderRadius.circular(25),
│   │   │       │       │             borderSide: BorderSide(color: Colors.grey.shade300, width: 1),
│   │   │       │       │           ),
│   │   │       │       │           focusedBorder: OutlineInputBorder(
│   │   │       │       │             borderRadius: BorderRadius.circular(25),
│   │   │       │       │             borderSide:
│   │   │       │       │                 BorderSide(color: Theme.of(context).primaryColor, width: 1.5),
│   │   │       │       │           ),
│   │   │       │       │           contentPadding:
│   │   │       │       │               const EdgeInsets.symmetric(horizontal: 20, vertical: 14),
│   │   │       │       │         ),
│   │   │       │       │         onChanged: (value) {
│   │   │       │       │           setState(() {
│   │   │       │       │             _currentSearchQuery = value;
│   │   │       │       │             _applyLocalFilters();
│   │   │       │       │           });
│   │   │       │       │         },
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Owner's Empty Boat List ---
│   │   │       │       │     Widget _buildEmptyBoatList() {
│   │   │       │       │       // Using the empty state from your previous owner list UI code
│   │   │       │       │       return Center(
│   │   │       │       │         child: Padding(
│   │   │       │       │           padding: const EdgeInsets.symmetric(horizontal: 40.0),
│   │   │       │       │           child: Column(
│   │   │       │       │             mainAxisAlignment: MainAxisAlignment.center,
│   │   │       │       │             children: [
│   │   │       │       │               const Icon(Icons.directions_boat_outlined,
│   │   │       │       │                   size: 80, color: Colors.grey),
│   │   │       │       │               // Icon indicating boats
│   │   │       │       │               const SizedBox(height: 30),
│   │   │       │       │               Text(
│   │   │       │       │                 'no_boats_listed_message_owner'.i18n(), // Owner specific message
│   │   │       │       │                 style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │       │       │                     color: AppColors.subtleTextColor,
│   │   │       │       │                     fontWeight: FontWeight.w500),
│   │   │       │       │                 textAlign: TextAlign.center,
│   │   │       │       │               ),
│   │   │       │       │               const SizedBox(height: 30),
│   │   │       │       │               ElevatedButton.icon(
│   │   │       │       │                 onPressed: _navigateToAddBoat, // Use navigation helper
│   │   │       │       │                 icon: const Icon(Icons.add_rounded),
│   │   │       │       │                 label: Text('add_first_boat_button'.i18n(),
│   │   │       │       │                     style: const TextStyle(
│   │   │       │       │                         fontSize: 16, fontWeight: FontWeight.w600)),
│   │   │       │       │                 style: ElevatedButton.styleFrom(
│   │   │       │       │                   padding:
│   │   │       │       │                       const EdgeInsets.symmetric(horizontal: 30, vertical: 16),
│   │   │       │       │                   shape: RoundedRectangleBorder(
│   │   │       │       │                       borderRadius: BorderRadius.circular(15)),
│   │   │       │       │                   elevation: 2,
│   │   │       │       │                   backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │       │       │                   // Match FAB
│   │   │       │       │                   foregroundColor: Colors.white,
│   │   │       │       │                 ),
│   │   │       │       │               ),
│   │   │       │       │             ],
│   │   │       │       │           ),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Grid List using Filtered Data ---
│   │   │       │       │     Widget _buildBoatGridList() {
│   │   │       │       │       return GridView.builder(
│   │   │       │       │         padding: const EdgeInsets.fromLTRB(16, 16, 16, 80), // Add padding for FAB
│   │   │       │       │         gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
│   │   │       │       │           crossAxisCount: 1,
│   │   │       │       │           // Single column list is usually better for management
│   │   │       │       │           crossAxisSpacing: 16,
│   │   │       │       │           mainAxisSpacing: 16,
│   │   │       │       │           childAspectRatio: 1.6, // Adjust aspect ratio for card height
│   │   │       │       │         ),
│   │   │       │       │         itemCount: _filteredBoats.length,
│   │   │       │       │         itemBuilder: (context, index) {
│   │   │       │       │           final boat = _filteredBoats[index];
│   │   │       │       │           return _buildOwnerBoatCard(context, boat); // Use owner-specific card
│   │   │       │       │         },
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // --- Owner Boat Card with Actions ---
│   │   │       │       │     Widget _buildOwnerBoatCard(BuildContext context, Boat boat) {
│   │   │       │       │       // Using structure similar to the previous fancy card but with owner actions
│   │   │       │       │       return SizedBox(
│   │   │       │       │         child: Container(
│   │   │       │       │           decoration: BoxDecoration(
│   │   │       │       │             color: Colors.white,
│   │   │       │       │             borderRadius: BorderRadius.circular(20),
│   │   │       │       │             boxShadow: [
│   │   │       │       │               BoxShadow(
│   │   │       │       │                   color: Colors.grey.shade200,
│   │   │       │       │                   blurRadius: 10,
│   │   │       │       │                   spreadRadius: 1,
│   │   │       │       │                   offset: const Offset(0, 4))
│   │   │       │       │             ],
│   │   │       │       │           ),
│   │   │       │       │           child: Column(
│   │   │       │       │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │       │       │             children: [
│   │   │       │       │               Expanded(
│   │   │       │       │                 // Image
│   │   │       │       │                 flex: 3, // More space for image
│   │   │       │       │                 child: ClipRRect(
│   │   │       │       │                   borderRadius:
│   │   │       │       │                       const BorderRadius.vertical(top: Radius.circular(20)),
│   │   │       │       │                   child: Stack(fit: StackFit.expand, children: [
│   │   │       │       │                     Image.network(
│   │   │       │       │                         boat.mainImageUrl ??
│   │   │       │       │                             'https://placehold.co/600x400/E0E0E0/BDBDBD?text=N/A',
│   │   │       │       │                         fit: BoxFit.cover,
│   │   │       │       │                         errorBuilder: (c, e, s) =>
│   │   │       │       │                             const Icon(Icons.broken_image)),
│   │   │       │       │                     Positioned(
│   │   │       │       │                         top: 8,
│   │   │       │       │                         right: 8,
│   │   │       │       │                         child: _buildStatusBadge(boat.status, context)),
│   │   │       │       │                     // Status Badge
│   │   │       │       │                   ]),
│   │   │       │       │                 ),
│   │   │       │       │               ),
│   │   │       │       │               Expanded(
│   │   │       │       │                 // Content + Actions
│   │   │       │       │                 flex: 2, // Less space for text/buttons
│   │   │       │       │                 child: Padding(
│   │   │       │       │                   padding: const EdgeInsets.fromLTRB(12.0, 6.0, 12.0, 4.0),
│   │   │       │       │                   // Reduced padding
│   │   │       │       │                   child: Column(
│   │   │       │       │                     crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │                     mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │       │       │                     children: [
│   │   │       │       │                       // Boat Name & Type
│   │   │       │       │                       Column(
│   │   │       │       │                         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │                         mainAxisSize: MainAxisSize.min, // Take minimum space
│   │   │       │       │                         children: [
│   │   │       │       │                           Text(
│   │   │       │       │                             boat.name,
│   │   │       │       │                             style: Theme.of(context)
│   │   │       │       │                                 .textTheme
│   │   │       │       │                                 .titleMedium
│   │   │       │       │                                 ?.copyWith(fontWeight: FontWeight.w700),
│   │   │       │       │                             maxLines: 1,
│   │   │       │       │                             overflow: TextOverflow.ellipsis,
│   │   │       │       │                           ),
│   │   │       │       │                           const SizedBox(height: 2),
│   │   │       │       │                           Text(
│   │   │       │       │                             boat.boatType,
│   │   │       │       │                             style: Theme.of(context)
│   │   │       │       │                                 .textTheme
│   │   │       │       │                                 .bodySmall
│   │   │       │       │                                 ?.copyWith(color: AppColors.subtleTextColor),
│   │   │       │       │                           ),
│   │   │       │       │                         ],
│   │   │       │       │                       ),
│   │   │       │       │                       // Action Buttons
│   │   │       │       │                       Row(
│   │   │       │       │                         mainAxisAlignment: MainAxisAlignment.end,
│   │   │       │       │                         // Align buttons right
│   │   │       │       │                         children: [
│   │   │       │       │                           IconButton(
│   │   │       │       │                               icon: const Icon(Icons.edit_outlined, size: 22),
│   │   │       │       │                               tooltip: 'edit_boat_tooltip'.i18n(),
│   │   │       │       │                               color: Theme.of(context).colorScheme.secondary,
│   │   │       │       │                               padding: EdgeInsets.zero,
│   │   │       │       │                               visualDensity: VisualDensity.compact,
│   │   │       │       │                               onPressed: () => _navigateToUpdateBoat(boat)),
│   │   │       │       │                           IconButton(
│   │   │       │       │                               icon: Icon(Icons.visibility_outlined,
│   │   │       │       │                                   size: 22,
│   │   │       │       │                                   color: Theme.of(context).colorScheme.primary),
│   │   │       │       │                               tooltip: 'view_details_tooltip'.i18n(),
│   │   │       │       │                               padding: EdgeInsets.zero,
│   │   │       │       │                               visualDensity: VisualDensity.compact,
│   │   │       │       │                               onPressed: () {
│   │   │       │       │                                 Navigator.push(
│   │   │       │       │                                     context,
│   │   │       │       │                                     MaterialPageRoute(
│   │   │       │       │                                         builder: (_) =>
│   │   │       │       │                                             BoatDetailsScreen(boatId: boat.id)));
│   │   │       │       │                               }),
│   │   │       │       │                           // Delete is now typically accessed from the Update screen
│   │   │       │       │                           // IconButton( icon: const Icon(Icons.delete_outline, size: 22), tooltip: 'delete_boat_tooltip'.i18n(), color: Colors.redAccent, padding: EdgeInsets.zero, visualDensity: VisualDensity.compact, onPressed: () => _navigateToDeleteBoat(boat.id, boat.name) ),
│   │   │       │       │                         ],
│   │   │       │       │                       ),
│   │   │       │       │                     ],
│   │   │       │       │                   ),
│   │   │       │       │                 ),
│   │   │       │       │               ),
│   │   │       │       │             ],
│   │   │       │       │           ),
│   │   │       │       │         ),
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Keep Status Badge helper
│   │   │       │       │     Widget _buildStatusBadge(String status, BuildContext context) {
│   │   │       │       │       Color badgeColor;
│   │   │       │       │       Color textColor;
│   │   │       │       │       switch (status.toUpperCase()) {
│   │   │       │       │         // Use uppercase for reliable comparison
│   │   │       │       │         case 'ACTIVE':
│   │   │       │       │           badgeColor = Colors.green.shade100;
│   │   │       │       │           textColor = Colors.green.shade800;
│   │   │       │       │           break;
│   │   │       │       │         case 'INACTIVE':
│   │   │       │       │           badgeColor = Colors.amber.shade100;
│   │   │       │       │           textColor = Colors.amber.shade800;
│   │   │       │       │           break;
│   │   │       │       │         case 'DRAFT':
│   │   │       │       │           badgeColor = Colors.blueGrey.shade100;
│   │   │       │       │           textColor = Colors.blueGrey.shade800;
│   │   │       │       │           break;
│   │   │       │       │         default:
│   │   │       │       │           badgeColor = Colors.grey.shade200;
│   │   │       │       │           textColor = Colors.grey.shade800;
│   │   │       │       │       }
│   │   │       │       │       String displayStatus = status.toLowerCase().capitalizeFirst ?? status;
│   │   │       │       │       return Container(
│   │   │       │       │           padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 5),
│   │   │       │       │           decoration: BoxDecoration(
│   │   │       │       │               color: badgeColor,
│   │   │       │       │               borderRadius: BorderRadius.circular(20),
│   │   │       │       │               boxShadow: [
│   │   │       │       │                 BoxShadow(
│   │   │       │       │                     color: badgeColor.withOpacity(0.4),
│   │   │       │       │                     blurRadius: 3,
│   │   │       │       │                     offset: const Offset(0, 1))
│   │   │       │       │               ]),
│   │   │       │       │           child: Text(
│   │   │       │       │             displayStatus,
│   │   │       │       │             style: TextStyle(
│   │   │       │       │               color: textColor,
│   │   │       │       │               fontWeight: FontWeight.w600,
│   │   │       │       │               fontSize: 11,
│   │   │       │       │             ),
│   │   │       │       │           ));
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Keep Filter Options Modal helper
│   │   │       │       │     void _showFilterOptions(BuildContext context) {
│   │   │       │       │       showModalBottomSheet(
│   │   │       │       │         context: context,
│   │   │       │       │         shape: const RoundedRectangleBorder(
│   │   │       │       │             borderRadius: BorderRadius.vertical(top: Radius.circular(25.0))),
│   │   │       │       │         builder: (BuildContext context) {
│   │   │       │       │           // Use StatefulBuilder to manage selection within the modal
│   │   │       │       │           return StatefulBuilder(
│   │   │       │       │               builder: (BuildContext context, StateSetter setModalState) {
│   │   │       │       │             return Padding(
│   │   │       │       │               padding: const EdgeInsets.all(20.0),
│   │   │       │       │               child: Column(
│   │   │       │       │                 mainAxisSize: MainAxisSize.min,
│   │   │       │       │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │       │       │                 children: <Widget>[
│   │   │       │       │                   Text('filter_by_status'.i18n(),
│   │   │       │       │                       style: Theme.of(context).textTheme.titleLarge),
│   │   │       │       │                   const SizedBox(height: 10),
│   │   │       │       │                   // Use RadioListTile for single selection
│   │   │       │       │                   RadioListTile<String>(
│   │   │       │       │                       title: Text('all_statuses'.i18n()),
│   │   │       │       │                       value: 'all',
│   │   │       │       │                       groupValue: _filterStatus,
│   │   │       │       │                       onChanged: (v) => setModalState(() => _filterStatus = v!)),
│   │   │       │       │                   RadioListTile<String>(
│   │   │       │       │                       title: Text('status_active'.i18n()),
│   │   │       │       │                       value: 'active',
│   │   │       │       │                       groupValue: _filterStatus,
│   │   │       │       │                       onChanged: (v) => setModalState(() => _filterStatus = v!)),
│   │   │       │       │                   RadioListTile<String>(
│   │   │       │       │                       title: Text('status_inactive'.i18n()),
│   │   │       │       │                       value: 'inactive',
│   │   │       │       │                       groupValue: _filterStatus,
│   │   │       │       │                       onChanged: (v) => setModalState(() => _filterStatus = v!)),
│   │   │       │       │                   RadioListTile<String>(
│   │   │       │       │                       title: Text('status_draft'.i18n()),
│   │   │       │       │                       value: 'draft',
│   │   │       │       │                       groupValue: _filterStatus,
│   │   │       │       │                       onChanged: (v) => setModalState(() => _filterStatus = v!)),
│   │   │       │       │                   const SizedBox(height: 20),
│   │   │       │       │                   Row(
│   │   │       │       │                     mainAxisAlignment: MainAxisAlignment.end,
│   │   │       │       │                     children: [
│   │   │       │       │                       TextButton(
│   │   │       │       │                         onPressed: () => Navigator.pop(context),
│   │   │       │       │                         child: Text('cancel_button'.i18n()),
│   │   │       │       │                       ),
│   │   │       │       │                       const SizedBox(width: 10),
│   │   │       │       │                       ElevatedButton(
│   │   │       │       │                         onPressed: () {
│   │   │       │       │                           setState(() {}); // Trigger rebuild with new filter
│   │   │       │       │                           _applyLocalFilters(); // Apply filter to the list
│   │   │       │       │                           Navigator.pop(context);
│   │   │       │       │                         },
│   │   │       │       │                         child: Text('apply_filters_button'.i18n()),
│   │   │       │       │                       ),
│   │   │       │       │                     ],
│   │   │       │       │                   )
│   │   │       │       │                 ],
│   │   │       │       │               ),
│   │   │       │       │             );
│   │   │       │       │           });
│   │   │       │       │         },
│   │   │       │       │       );
│   │   │       │       │     }
│   │   │       │       │   
│   │   │       │       │     // Keep SnackBar Utility
│   │   │       │       │     void _showSnackBar(BuildContext context, String message,
│   │   │       │       │         {bool isError = false}) {
│   │   │       │       │       if (isError) {
│   │   │       │       │         SnackBarUtil.showErrorSnackBar(message: message, title: '');
│   │   │       │       │       } else {
│   │   │       │       │         SnackBarUtil.showSuccessSnackBar(message: message, title: '');
│   │   │       │       │       }
│   │   │       │       │     }
│   │   │       │       │   }
│   │   │       └── update/
│   │   │           └── screen.dart
│   │   │               │   // lib/features/owner/boats/update/screen.dart
│   │   │               │   
│   │   │               │   import 'dart:io'; // For File
│   │   │               │   
│   │   │               │   // --- Import Models, Controllers, Screens ---
│   │   │               │   import 'package:app/controllers/boat.dart'; // Use correct controller name
│   │   │               │   import 'package:app/features/owner/boats/delete/screen.dart'; // For delete navigation
│   │   │               │   import 'package:app/models/boat.dart'; // Use correct model name
│   │   │               │   import 'package:app/models/boat_image.dart'; // Import BoatImage model
│   │   │               │   import 'package:app/utils/snackbar.dart';
│   │   │               │   import 'package:flutter/material.dart';
│   │   │               │   import 'package:flutter_secure_storage/flutter_secure_storage.dart';
│   │   │               │   import 'package:get/get.dart';
│   │   │               │   import 'package:image_picker/image_picker.dart';
│   │   │               │   import 'package:localization/localization.dart';
│   │   │               │   
│   │   │               │   class UpdateBoatScreen extends StatefulWidget {
│   │   │               │     // --- Accept the full Boat object to pre-fill ---
│   │   │               │     final Boat boat;
│   │   │               │   
│   │   │               │     const UpdateBoatScreen({
│   │   │               │       super.key,
│   │   │               │       required this.boat,
│   │   │               │     });
│   │   │               │   
│   │   │               │     @override
│   │   │               │     State<UpdateBoatScreen> createState() => _UpdateBoatScreenState();
│   │   │               │   }
│   │   │               │   
│   │   │               │   class _UpdateBoatScreenState extends State<UpdateBoatScreen>
│   │   │               │       with TickerProviderStateMixin {
│   │   │               │     final _formKey = GlobalKey<FormState>();
│   │   │               │   
│   │   │               │     // --- Text Controllers ---
│   │   │               │     late TextEditingController _boatNameController;
│   │   │               │     late TextEditingController _descriptionController;
│   │   │               │     late TextEditingController _rentalPriceController;
│   │   │               │     late TextEditingController _locationDescController;
│   │   │               │     late TextEditingController _lengthController;
│   │   │               │     late TextEditingController _capacityController;
│   │   │               │     late TextEditingController _cabinsController;
│   │   │               │     late TextEditingController _driverNameController;
│   │   │               │     late TextEditingController _driverDetailsController;
│   │   │               │   
│   │   │               │     // --- State Variables ---
│   │   │               │     String? _selectedBoatType;
│   │   │               │     late String _selectedStatus; // Initialize in initState
│   │   │               │     late bool _driverAvailable; // Initialize in initState
│   │   │               │     File? _newMainImageFile; // For selecting a *new* main image
│   │   │               │     List<File> _newAdditionalImageFiles =
│   │   │               │         []; // For adding *new* additional images
│   │   │               │     List<BoatImage> _existingImages = []; // To display existing additional images
│   │   │               │     String? _existingMainImageUrl; // To display existing main image
│   │   │               │   
│   │   │               │     final ImagePicker _picker = ImagePicker();
│   │   │               │     bool _isLoading = false; // Submission loading state
│   │   │               │   
│   │   │               │     // --- API and Storage ---
│   │   │               │     final BoatController _boatController = BoatController();
│   │   │               │     final _storage = const FlutterSecureStorage();
│   │   │               │   
│   │   │               │     // Animation (Remove if not used)
│   │   │               │     // late AnimationController _logoAnimationController;
│   │   │               │     // late Animation<double> _logoAnimation;
│   │   │               │   
│   │   │               │     @override
│   │   │               │     void initState() {
│   │   │               │       super.initState();
│   │   │               │       // --- Pre-fill controllers and state from widget.boat ---
│   │   │               │       _boatNameController = TextEditingController(text: widget.boat.name);
│   │   │               │       _descriptionController =
│   │   │               │           TextEditingController(text: widget.boat.description ?? '');
│   │   │               │       _rentalPriceController = TextEditingController(
│   │   │               │           text: widget.boat.rentalPricePerDay.toStringAsFixed(2)); // Format price
│   │   │               │       _locationDescController =
│   │   │               │           TextEditingController(text: widget.boat.locationDescription);
│   │   │               │       _lengthController =
│   │   │               │           TextEditingController(text: widget.boat.length?.toString() ?? '');
│   │   │               │       _capacityController =
│   │   │               │           TextEditingController(text: widget.boat.capacity?.toString() ?? '');
│   │   │               │       _cabinsController =
│   │   │               │           TextEditingController(text: widget.boat.cabins?.toString() ?? '');
│   │   │               │       _driverNameController =
│   │   │               │           TextEditingController(text: widget.boat.driverName ?? '');
│   │   │               │       _driverDetailsController =
│   │   │               │           TextEditingController(text: widget.boat.driverDetails ?? '');
│   │   │               │   
│   │   │               │       _selectedBoatType = widget.boat.boatType;
│   │   │               │       _selectedStatus = widget.boat.status;
│   │   │               │       _driverAvailable = widget.boat.driverAvailable;
│   │   │               │       _existingMainImageUrl =
│   │   │               │           widget.boat.mainImageUrl; // Store existing main image URL
│   │   │               │       _existingImages =
│   │   │               │           widget.boat.images ?? []; // Store existing additional images
│   │   │               │   
│   │   │               │       // Initialize animations if needed
│   │   │               │       // _logoAnimationController = ...
│   │   │               │     }
│   │   │               │   
│   │   │               │     @override
│   │   │               │     void dispose() {
│   │   │               │       // Dispose all text controllers
│   │   │               │       _boatNameController.dispose();
│   │   │               │       _descriptionController.dispose();
│   │   │               │       _rentalPriceController.dispose();
│   │   │               │       _locationDescController.dispose();
│   │   │               │       _lengthController.dispose();
│   │   │               │       _capacityController.dispose();
│   │   │               │       _cabinsController.dispose();
│   │   │               │       _driverNameController.dispose();
│   │   │               │       _driverDetailsController.dispose();
│   │   │               │       // Dispose animations if needed
│   │   │               │       super.dispose();
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- Image Picking Functions (similar to Add screen) ---
│   │   │               │     Future<void> _pickMainImage(ImageSource source) async {
│   │   │               │       try {
│   │   │               │         final pickedFile = await _picker.pickImage(
│   │   │               │             source: source, imageQuality: 80, maxWidth: 1024);
│   │   │               │         if (pickedFile != null) {
│   │   │               │           setState(() {
│   │   │               │             _newMainImageFile = File(pickedFile.path);
│   │   │               │             _existingMainImageUrl =
│   │   │               │                 null; // Clear existing URL if new one is picked
│   │   │               │           });
│   │   │               │         }
│   │   │               │       } catch (e) {
│   │   │               │         /* ... error handling ... */ if (mounted) {
│   │   │               │           _showSnackBar(context, 'Error picking image: $e', isError: true);
│   │   │               │         }
│   │   │               │       }
│   │   │               │     }
│   │   │               │   
│   │   │               │     Future<void> _pickAdditionalImages() async {
│   │   │               │       try {
│   │   │               │         final List<XFile> pickedFiles =
│   │   │               │             await _picker.pickMultiImage(imageQuality: 80, maxWidth: 1024);
│   │   │               │         if (pickedFiles.isNotEmpty) {
│   │   │               │           setState(() {
│   │   │               │             _newAdditionalImageFiles.addAll(pickedFiles
│   │   │               │                 .map((file) => File(file.path))
│   │   │               │                 .where((newFile) => !_newAdditionalImageFiles
│   │   │               │                     .any((existing) => existing.path == newFile.path)));
│   │   │               │             // Limit total images (existing + new)? Consider your API limits.
│   │   │               │           });
│   │   │               │         }
│   │   │               │       } catch (e) {
│   │   │               │         /* ... error handling ... */ if (mounted) {
│   │   │               │           _showSnackBar(context, 'Error picking images: $e', isError: true);
│   │   │               │         }
│   │   │               │       }
│   │   │               │     }
│   │   │               │   
│   │   │               │     void _removeNewAdditionalImage(int index) {
│   │   │               │       setState(() {
│   │   │               │         _newAdditionalImageFiles.removeAt(index);
│   │   │               │       });
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- TODO: Add Function to remove EXISTING additional images ---
│   │   │               │     // This would likely require a separate API call or modifying the update logic
│   │   │               │     // void _removeExistingAdditionalImage(int imageId) async { ... call API to delete imageId ... }
│   │   │               │     // --- End Image Picking ---
│   │   │               │   
│   │   │               │     // --- Perform API Update ---
│   │   │               │     Future<void> _performUpdateBoat() async {
│   │   │               │       if (!_formKey.currentState!.validate()) {
│   │   │               │         _showSnackBar(context, 'Please fix the errors in the form.',
│   │   │               │             isError: true);
│   │   │               │         return;
│   │   │               │       }
│   │   │               │       // Note: Main image is now optional for update, but if they remove existing, they should add new? Validation depends on requirements.
│   │   │               │   
│   │   │               │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │               │       if (accessToken == null || accessToken.isEmpty) {
│   │   │               │         if (mounted) {
│   │   │               │           _showSnackBar(context, 'Authentication error. Please log in again.',
│   │   │               │               isError: true);
│   │   │               │         }
│   │   │               │         return;
│   │   │               │       }
│   │   │               │   
│   │   │               │       setState(() => _isLoading = true);
│   │   │               │   
│   │   │               │       // Parse numeric fields safely
│   │   │               │       double? length = double.tryParse(_lengthController.text);
│   │   │               │       int? capacity = int.tryParse(_capacityController.text);
│   │   │               │       int? cabins = int.tryParse(_cabinsController.text);
│   │   │               │       double? price = double.tryParse(_rentalPriceController.text);
│   │   │               │   
│   │   │               │       if (price == null) {
│   │   │               │         if (mounted) {
│   │   │               │           _showSnackBar(context, 'Invalid rental price format.', isError: true);
│   │   │               │         }
│   │   │               │         setState(() => _isLoading = false);
│   │   │               │         return;
│   │   │               │       }
│   │   │               │   
│   │   │               │       try {
│   │   │               │         // Only pass changed values if using PATCH efficiently, or pass all current values
│   │   │               │         final updatedBoat = await _boatController.updateBoat(
│   │   │               │           boatId: widget.boat.id,
│   │   │               │           // Use ID from the initial boat object
│   │   │               │           accessToken: accessToken,
│   │   │               │           // Pass current values from controllers/state
│   │   │               │           name: _boatNameController.text.trim(),
│   │   │               │           boatType: _selectedBoatType!,
│   │   │               │           rentalPricePerDay: price,
│   │   │               │           locationDescription: _locationDescController.text.trim(),
│   │   │               │           description: _descriptionController.text.trim(),
│   │   │               │           length: length,
│   │   │               │           capacity: capacity,
│   │   │               │           cabins: cabins,
│   │   │               │           driverAvailable: _driverAvailable,
│   │   │               │           driverName: _driverNameController.text.trim().isNotEmpty
│   │   │               │               ? _driverNameController.text.trim()
│   │   │               │               : null,
│   │   │               │           driverDetails: _driverDetailsController.text.trim().isNotEmpty
│   │   │               │               ? _driverDetailsController.text.trim()
│   │   │               │               : null,
│   │   │               │           status: _selectedStatus,
│   │   │               │           // Pass *new* image files
│   │   │               │           mainImageFile: _newMainImageFile,
│   │   │               │           // Pass the new File object if selected
│   │   │               │           additionalImageFiles: _newAdditionalImageFiles.isNotEmpty
│   │   │               │               ? _newAdditionalImageFiles
│   │   │               │               : null,
│   │   │               │         );
│   │   │               │   
│   │   │               │         if (!mounted) return;
│   │   │               │   
│   │   │               │         if (updatedBoat != null) {
│   │   │               │           _showSnackBar(
│   │   │               │               context, 'Boat "${updatedBoat.name}" updated successfully!');
│   │   │               │           // Navigate back, potentially passing the updated boat data or just a success flag
│   │   │               │           Navigator.pop(context, true); // Return true to indicate success
│   │   │               │         } else {
│   │   │               │           _showSnackBar(context, 'Failed to update boat. Please check details.',
│   │   │               │               isError: true);
│   │   │               │         }
│   │   │               │       } catch (e) {
│   │   │               │         print("Update Boat Error: $e");
│   │   │               │         if (mounted) {
│   │   │               │           _showSnackBar(context, 'An error occurred: $e', isError: true);
│   │   │               │         }
│   │   │               │       } finally {
│   │   │               │         if (mounted) setState(() => _isLoading = false);
│   │   │               │       }
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- End API Update ---
│   │   │               │   
│   │   │               │     // --- Navigate to Delete Screen ---
│   │   │               │     Future<void> _navigateToDelete() async {
│   │   │               │       final result = await Navigator.push<bool>(
│   │   │               │           context,
│   │   │               │           MaterialPageRoute(
│   │   │               │               builder: (_) => DeleteBoatScreen(
│   │   │               │                   boatId: widget.boat.id,
│   │   │               │                   boatName: widget.boat.name // Pass current name
│   │   │               │                   )));
│   │   │               │       if (result == true && mounted) {
│   │   │               │         // If deletion was successful on the next screen, pop this update screen too
│   │   │               │         Navigator.pop(context, true); // Propagate success back
│   │   │               │       }
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- End Delete Navigation ---
│   │   │               │   
│   │   │               │     @override
│   │   │               │     Widget build(BuildContext context) {
│   │   │               │       // Reuse the AddBoatScreen structure, but pre-fill data and change button text/action
│   │   │               │       return Scaffold(
│   │   │               │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │               │         appBar: AppBar(
│   │   │               │           title: Text('update_boat_title_appbar'.i18n()), // Changed title
│   │   │               │           centerTitle: true,
│   │   │               │           elevation: 1,
│   │   │               │         ),
│   │   │               │         body: SingleChildScrollView(
│   │   │               │           padding: const EdgeInsets.all(24.0),
│   │   │               │           child: Form(
│   │   │               │             key: _formKey,
│   │   │               │             child: Column(
│   │   │               │               crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │               │               children: <Widget>[
│   │   │               │                 // Removed logo for more form space on update screen
│   │   │               │                 // _buildAppLogo(),
│   │   │               │                 // const SizedBox(height: 30),
│   │   │               │   
│   │   │               │                 Text('boat_details_section_title'.i18n(),
│   │   │               │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │   
│   │   │               │                 // --- Form Fields (Pre-filled) ---
│   │   │               │                 TextFormField(
│   │   │               │                   controller: _boatNameController,
│   │   │               │                   /* ... same decoration/validation ... */
│   │   │               │                   decoration: _inputDecoration(
│   │   │               │                       label: 'boat_name_label'.i18n(),
│   │   │               │                       hint: 'boat_name_hint'.i18n(),
│   │   │               │                       icon: Icons.directions_boat_outlined),
│   │   │               │                   validator: (v) =>
│   │   │               │                       v!.isEmpty ? 'boat_name_required_error'.i18n() : null,
│   │   │               │                 ),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │                 DropdownButtonFormField<String>(
│   │   │               │                   value: _selectedBoatType,
│   │   │               │                   /* ... same items/validation ... */
│   │   │               │                   items: [
│   │   │               │                     'Yacht',
│   │   │               │                     'Speed Boat',
│   │   │               │                     'Fishing Boat',
│   │   │               │                     'Dhow',
│   │   │               │                     'Sailboat',
│   │   │               │                     'Jet Ski',
│   │   │               │                     'Other'
│   │   │               │                   ]
│   │   │               │                       .map((t) => DropdownMenuItem(value: t, child: Text(t)))
│   │   │               │                       .toList(),
│   │   │               │                   onChanged: (v) => setState(() => _selectedBoatType = v),
│   │   │               │                   decoration: _inputDecoration(
│   │   │               │                       label: 'boat_type_label'.i18n(),
│   │   │               │                       hint: 'boat_type_hint'.i18n(),
│   │   │               │                       icon: Icons.category_outlined),
│   │   │               │                   validator: (v) =>
│   │   │               │                       v == null ? 'boat_type_required_error'.i18n() : null,
│   │   │               │                 ),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │                 TextFormField(
│   │   │               │                   controller: _descriptionController,
│   │   │               │                   /* ... same decoration ... */
│   │   │               │                   decoration: _inputDecoration(
│   │   │               │                       label: 'boat_description_label'.i18n(),
│   │   │               │                       hint: 'boat_description_hint'.i18n(),
│   │   │               │                       icon: Icons.description_outlined),
│   │   │               │                   maxLines: 4,
│   │   │               │                   textCapitalization: TextCapitalization.sentences,
│   │   │               │                 ),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │                 Row(
│   │   │               │                   children: [
│   │   │               │                     Expanded(
│   │   │               │                         child: TextFormField(
│   │   │               │                       controller: _lengthController,
│   │   │               │                       /* ... decoration/keyboard ... */
│   │   │               │                       decoration: _inputDecoration(
│   │   │               │                           label: 'length_label'.i18n(),
│   │   │               │                           hint: 'e.g., 45.5',
│   │   │               │                           icon: Icons.straighten),
│   │   │               │                       keyboardType:
│   │   │               │                           const TextInputType.numberWithOptions(decimal: true),
│   │   │               │                     )),
│   │   │               │                     const SizedBox(width: 16),
│   │   │               │                     Expanded(
│   │   │               │                         child: TextFormField(
│   │   │               │                       controller: _capacityController,
│   │   │               │                       /* ... decoration/keyboard ... */
│   │   │               │                       decoration: _inputDecoration(
│   │   │               │                           label: 'capacity_label'.i18n(),
│   │   │               │                           hint: 'e.g., 8',
│   │   │               │                           icon: Icons.people_outline),
│   │   │               │                       keyboardType: TextInputType.number,
│   │   │               │                     )),
│   │   │               │                     const SizedBox(width: 16),
│   │   │               │                     Expanded(
│   │   │               │                         child: TextFormField(
│   │   │               │                       controller: _cabinsController,
│   │   │               │                       /* ... decoration/keyboard ... */
│   │   │               │                       decoration: _inputDecoration(
│   │   │               │                           label: 'cabins_label'.i18n(),
│   │   │               │                           hint: 'e.g., 2',
│   │   │               │                           icon: Icons.cabin_outlined),
│   │   │               │                       keyboardType: TextInputType.number,
│   │   │               │                     )),
│   │   │               │                   ],
│   │   │               │                 ),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │                 TextFormField(
│   │   │               │                   controller: _rentalPriceController,
│   │   │               │                   /* ... same decoration/validation ... */
│   │   │               │                   decoration: _inputDecoration(
│   │   │               │                       label: 'rental_price_label'.i18n(),
│   │   │               │                       hint: 'rental_price_hint'.i18n(),
│   │   │               │                       icon: Icons.attach_money),
│   │   │               │                   keyboardType:
│   │   │               │                       const TextInputType.numberWithOptions(decimal: true),
│   │   │               │                   validator: (v) {
│   │   │               │                     if (v == null || v.isEmpty) {
│   │   │               │                       return 'rental_price_required_error'.i18n();
│   │   │               │                     }
│   │   │               │                     if (double.tryParse(v) == null || double.parse(v) <= 0) {
│   │   │               │                       return 'invalid_price_format_error'.i18n();
│   │   │               │                     }
│   │   │               │                     return null;
│   │   │               │                   },
│   │   │               │                 ),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │                 TextFormField(
│   │   │               │                   controller: _locationDescController,
│   │   │               │                   /* ... same decoration/validation ... */
│   │   │               │                   decoration: _inputDecoration(
│   │   │               │                       label: 'location_description_label'.i18n(),
│   │   │               │                       hint: 'location_description_hint'.i18n(),
│   │   │               │                       icon: Icons.location_on_outlined),
│   │   │               │                   validator: (v) =>
│   │   │               │                       v!.isEmpty ? 'Location description is required.' : null,
│   │   │               │                 ),
│   │   │               │   
│   │   │               │                 const SizedBox(height: 24),
│   │   │               │                 Text('driver_options_section_title'.i18n(),
│   │   │               │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │               │                 const SizedBox(height: 8),
│   │   │               │                 SwitchListTile(
│   │   │               │                   title: Text('driver_available_label'.i18n()),
│   │   │               │                   value: _driverAvailable,
│   │   │               │                   onChanged: (v) => setState(
│   │   │               │                       () => _driverAvailable = v), /* ... same icon ... */
│   │   │               │                 ),
│   │   │               │                 if (_driverAvailable) ...[
│   │   │               │                   const SizedBox(height: 16),
│   │   │               │                   TextFormField(
│   │   │               │                       controller: _driverNameController,
│   │   │               │                       decoration: _inputDecoration(
│   │   │               │                           label: 'driver_name_label'.i18n(),
│   │   │               │                           hint: 'driver_name_hint'.i18n(),
│   │   │               │                           icon: Icons.person_pin_outlined)),
│   │   │               │                   const SizedBox(height: 16),
│   │   │               │                   TextFormField(
│   │   │               │                     controller: _driverDetailsController,
│   │   │               │                     decoration: _inputDecoration(
│   │   │               │                         label: 'driver_details_label'.i18n(),
│   │   │               │                         hint: 'driver_details_hint'.i18n(),
│   │   │               │                         icon: Icons.notes_outlined),
│   │   │               │                     maxLines: 2,
│   │   │               │                   ),
│   │   │               │                 ],
│   │   │               │   
│   │   │               │                 const SizedBox(height: 24),
│   │   │               │                 Text('listing_status_section_title'.i18n(),
│   │   │               │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │                 DropdownButtonFormField<String>(
│   │   │               │                   value: _selectedStatus,
│   │   │               │                   /* ... same items/validation ... */
│   │   │               │                   items: ['DRAFT', 'ACTIVE', 'INACTIVE']
│   │   │               │                       .map((s) => DropdownMenuItem(
│   │   │               │                           value: s,
│   │   │               │                           child: Text(s.toLowerCase().capitalizeFirst ?? s)))
│   │   │               │                       .toList(),
│   │   │               │                   onChanged: (v) => setState(() => _selectedStatus = v!),
│   │   │               │                   decoration: _inputDecoration(
│   │   │               │                     label: 'status_label'.i18n(),
│   │   │               │                     icon: Icons.toggle_on_outlined,
│   │   │               │                     hint: 'status_hint'.i18n(),
│   │   │               │                   ),
│   │   │               │                   validator: (v) => v == null ? 'Status is required.' : null,
│   │   │               │                 ),
│   │   │               │   
│   │   │               │                 const SizedBox(height: 24),
│   │   │               │                 Text('images_section_title'.i18n(),
│   │   │               │                     style: Theme.of(context).textTheme.titleLarge),
│   │   │               │                 const SizedBox(height: 16),
│   │   │               │   
│   │   │               │                 // --- Main Image Picker (Handles existing/new) ---
│   │   │               │                 _buildUpdateImagePicker(
│   │   │               │                   label: 'main_image_label'.i18n(),
│   │   │               │                   existingImageUrl: _existingMainImageUrl,
│   │   │               │                   newImageFile: _newMainImageFile,
│   │   │               │                   onPickImage: _pickMainImage,
│   │   │               │                   onRemoveImage: () => setState(() {
│   │   │               │                     _newMainImageFile = null;
│   │   │               │                     _existingMainImageUrl = null;
│   │   │               │                   }), // Allow removing main image entirely? Or require one?
│   │   │               │                 ),
│   │   │               │                 const SizedBox(height: 20),
│   │   │               │   
│   │   │               │                 // --- Additional Images Picker ---
│   │   │               │                 _buildUpdateAdditionalImagePicker(),
│   │   │               │                 // Handles existing and new additional images
│   │   │               │                 const SizedBox(height: 30),
│   │   │               │   
│   │   │               │                 // --- Update Button ---
│   │   │               │                 ElevatedButton.icon(
│   │   │               │                   onPressed: _isLoading ? null : _performUpdateBoat,
│   │   │               │                   // Call update function
│   │   │               │                   icon: _isLoading
│   │   │               │                       ? Container(
│   │   │               │                           width: 24,
│   │   │               │                           height: 24,
│   │   │               │                           padding: const EdgeInsets.all(2.0),
│   │   │               │                           child: const CircularProgressIndicator(
│   │   │               │                               color: Colors.white, strokeWidth: 3))
│   │   │               │                       : const Icon(Icons.save_alt_rounded),
│   │   │               │                   // Save icon
│   │   │               │                   label: Text(_isLoading
│   │   │               │                       ? 'updating_boat_button'.i18n()
│   │   │               │                       : 'update_boat_button'.i18n()),
│   │   │               │                   // Update text
│   │   │               │                   style: ElevatedButton.styleFrom(
│   │   │               │                     /* ... same style as add screen ... */
│   │   │               │                     padding: const EdgeInsets.symmetric(vertical: 16),
│   │   │               │                     textStyle: const TextStyle(
│   │   │               │                         fontSize: 16, fontWeight: FontWeight.bold),
│   │   │               │                     backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │               │                     foregroundColor: Colors.white,
│   │   │               │                     shape: RoundedRectangleBorder(
│   │   │               │                         borderRadius: BorderRadius.circular(15)),
│   │   │               │                   ),
│   │   │               │                 ),
│   │   │               │                 const SizedBox(height: 10),
│   │   │               │                 // --- Delete Button (Navigates) ---
│   │   │               │                 TextButton.icon(
│   │   │               │                   onPressed: _isLoading ? null : _navigateToDelete,
│   │   │               │                   // Navigate to delete confirmation
│   │   │               │                   icon: Icon(Icons.delete_forever_outlined,
│   │   │               │                       color: Colors.red.shade400),
│   │   │               │                   label: Text('delete_boat_button'.i18n(),
│   │   │               │                       style: TextStyle(
│   │   │               │                           color: Colors.red.shade400,
│   │   │               │                           fontWeight: FontWeight.w600)),
│   │   │               │                   style: TextButton.styleFrom(
│   │   │               │                     padding: const EdgeInsets.symmetric(vertical: 12),
│   │   │               │                   ),
│   │   │               │                 ),
│   │   │               │               ],
│   │   │               │             ),
│   │   │               │           ),
│   │   │               │         ),
│   │   │               │       );
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- Updated Main Image Picker for Update Screen ---
│   │   │               │     Widget _buildUpdateImagePicker({
│   │   │               │       required String label,
│   │   │               │       required String? existingImageUrl, // URL of existing image
│   │   │               │       required File? newImageFile, // Newly picked file
│   │   │               │       required Function(ImageSource) onPickImage,
│   │   │               │       required VoidCallback onRemoveImage, // To remove both existing and new
│   │   │               │     }) {
│   │   │               │       Widget imageWidget;
│   │   │               │       if (newImageFile != null) {
│   │   │               │         imageWidget = Image.file(newImageFile,
│   │   │               │             fit: BoxFit.cover, width: double.infinity, height: 150);
│   │   │               │       } else if (existingImageUrl != null) {
│   │   │               │         imageWidget = Image.network(
│   │   │               │           existingImageUrl,
│   │   │               │           fit: BoxFit.cover,
│   │   │               │           width: double.infinity,
│   │   │               │           height: 150,
│   │   │               │           errorBuilder: (c, e, s) =>
│   │   │               │               const Icon(Icons.broken_image, color: Colors.grey),
│   │   │               │           loadingBuilder: (c, child, progress) => progress == null
│   │   │               │               ? child
│   │   │               │               : const Center(child: CircularProgressIndicator()),
│   │   │               │         );
│   │   │               │       } else {
│   │   │               │         imageWidget = Center(
│   │   │               │             child: Text('no_image_selected'.i18n(),
│   │   │               │                 style: TextStyle(color: Colors.grey.shade600)));
│   │   │               │       }
│   │   │               │   
│   │   │               │       return Column(
│   │   │               │         /* ... same structure as _buildImagePicker ... */
│   │   │               │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │               │         children: [
│   │   │               │           Text(label, style: Theme.of(context).textTheme.titleMedium),
│   │   │               │           const SizedBox(height: 8),
│   │   │               │           Container(
│   │   │               │             height: 150,
│   │   │               │             width: double.infinity,
│   │   │               │             decoration: BoxDecoration(
│   │   │               │               border: Border.all(color: Colors.grey.shade400),
│   │   │               │               borderRadius: BorderRadius.circular(12),
│   │   │               │               color: Colors.grey.shade100,
│   │   │               │             ),
│   │   │               │             child: Stack(alignment: Alignment.center, children: [
│   │   │               │               ClipRRect(
│   │   │               │                   borderRadius: BorderRadius.circular(11), child: imageWidget),
│   │   │               │               // Show remove button only if there's an image (new or existing)
│   │   │               │               if (newImageFile != null || existingImageUrl != null)
│   │   │               │                 Positioned(
│   │   │               │                     top: 4,
│   │   │               │                     right: 4,
│   │   │               │                     child: CircleAvatar(
│   │   │               │                       radius: 14,
│   │   │               │                       backgroundColor: Colors.black54,
│   │   │               │                       child: IconButton(
│   │   │               │                         padding: EdgeInsets.zero,
│   │   │               │                         iconSize: 16,
│   │   │               │                         icon: const Icon(Icons.close, color: Colors.white),
│   │   │               │                         onPressed: onRemoveImage,
│   │   │               │                         tooltip: 'Remove Image',
│   │   │               │                       ),
│   │   │               │                     )),
│   │   │               │             ]),
│   │   │               │           ),
│   │   │               │           const SizedBox(height: 8),
│   │   │               │           Row(
│   │   │               │             /* ... same gallery/camera buttons ... */
│   │   │               │             mainAxisAlignment: MainAxisAlignment.spaceEvenly,
│   │   │               │             children: [
│   │   │               │               TextButton.icon(
│   │   │               │                 icon: const Icon(Icons.photo_library_outlined),
│   │   │               │                 label: Text('gallery'.i18n()),
│   │   │               │                 onPressed: () => onPickImage(ImageSource.gallery),
│   │   │               │               ),
│   │   │               │               TextButton.icon(
│   │   │               │                 icon: const Icon(Icons.camera_alt_outlined),
│   │   │               │                 label: Text('camera'.i18n()),
│   │   │               │                 onPressed: () => onPickImage(ImageSource.camera),
│   │   │               │               ),
│   │   │               │             ],
│   │   │               │           )
│   │   │               │         ],
│   │   │               │       );
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- Updated Additional Image Picker for Update Screen ---
│   │   │               │     Widget _buildUpdateAdditionalImagePicker() {
│   │   │               │       return Column(
│   │   │               │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │               │         children: [
│   │   │               │           Text('additional_images_label'.i18n(),
│   │   │               │               style: Theme.of(context).textTheme.titleMedium),
│   │   │               │           const SizedBox(height: 8),
│   │   │               │           Wrap(
│   │   │               │             spacing: 10,
│   │   │               │             runSpacing: 10,
│   │   │               │             children: [
│   │   │               │               // Display existing images (no direct remove button here, handled separately if needed)
│   │   │               │               ..._existingImages.map((img) {
│   │   │               │                 return SizedBox(
│   │   │               │                   width: 80, height: 80,
│   │   │               │                   child: ClipRRect(
│   │   │               │                       borderRadius: BorderRadius.circular(8),
│   │   │               │                       child: Image.network(img.imageUrl,
│   │   │               │                           fit: BoxFit.cover,
│   │   │               │                           errorBuilder: (c, e, s) => const Icon(Icons.error))),
│   │   │               │                   // TODO: Add delete functionality for existing images if required
│   │   │               │                   // Maybe an overlay button that calls _removeExistingAdditionalImage(img.id)
│   │   │               │                 );
│   │   │               │               }).toList(),
│   │   │               │               // Display newly added images with remove button
│   │   │               │               ..._newAdditionalImageFiles.asMap().entries.map((entry) {
│   │   │               │                 int index = entry.key;
│   │   │               │                 File file = entry.value;
│   │   │               │                 return SizedBox(
│   │   │               │                   width: 80,
│   │   │               │                   height: 80,
│   │   │               │                   child: Stack(
│   │   │               │                     children: [
│   │   │               │                       ClipRRect(
│   │   │               │                           borderRadius: BorderRadius.circular(8),
│   │   │               │                           child: Image.file(file,
│   │   │               │                               fit: BoxFit.cover, width: 80, height: 80)),
│   │   │               │                       Positioned(
│   │   │               │                           top: -5,
│   │   │               │                           right: -5,
│   │   │               │                           child: CircleAvatar(
│   │   │               │                             radius: 12,
│   │   │               │                             backgroundColor: Colors.black54,
│   │   │               │                             child: IconButton(
│   │   │               │                               padding: EdgeInsets.zero,
│   │   │               │                               iconSize: 14,
│   │   │               │                               icon: const Icon(Icons.close, color: Colors.white),
│   │   │               │                               onPressed: () => _removeNewAdditionalImage(index),
│   │   │               │                               tooltip: 'Remove',
│   │   │               │                             ),
│   │   │               │                           )),
│   │   │               │                     ],
│   │   │               │                   ),
│   │   │               │                 );
│   │   │               │               }).toList(),
│   │   │               │               // "Add More" button
│   │   │               │               if ((_existingImages.length + _newAdditionalImageFiles.length) <
│   │   │               │                   5) // Example limit
│   │   │               │                 InkWell(
│   │   │               │                   onTap: _pickAdditionalImages,
│   │   │               │                   borderRadius: BorderRadius.circular(8),
│   │   │               │                   child: Container(
│   │   │               │                     width: 80,
│   │   │               │                     height: 80,
│   │   │               │                     decoration: BoxDecoration(
│   │   │               │                       border: Border.all(color: Colors.grey.shade400, width: 1.5),
│   │   │               │                       borderRadius: BorderRadius.circular(8),
│   │   │               │                       color: Colors.grey.shade100,
│   │   │               │                     ),
│   │   │               │                     child: Icon(Icons.add_a_photo_outlined,
│   │   │               │                         color: Colors.grey.shade600),
│   │   │               │                   ),
│   │   │               │                 ),
│   │   │               │             ],
│   │   │               │           )
│   │   │               │         ],
│   │   │               │       );
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- Keep Input Decoration Helper ---
│   │   │               │     InputDecoration _inputDecoration(
│   │   │               │         {required String label, required String hint, required IconData icon}) {
│   │   │               │       return InputDecoration(
│   │   │               │         /* ... Same as Add Screen ... */
│   │   │               │         labelText: label,
│   │   │               │         hintText: hint,
│   │   │               │         prefixIcon: Icon(icon,
│   │   │               │             color: Theme.of(context).colorScheme.primary.withOpacity(0.8)),
│   │   │               │         border: OutlineInputBorder(borderRadius: BorderRadius.circular(12)),
│   │   │               │         enabledBorder: OutlineInputBorder(
│   │   │               │           borderRadius: BorderRadius.circular(12),
│   │   │               │           borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │               │         ),
│   │   │               │         focusedBorder: OutlineInputBorder(
│   │   │               │           borderRadius: BorderRadius.circular(12),
│   │   │               │           borderSide: BorderSide(
│   │   │               │               color: Theme.of(context).colorScheme.primary, width: 1.5),
│   │   │               │         ),
│   │   │               │         filled: true,
│   │   │               │         fillColor: Colors.grey.shade50,
│   │   │               │       );
│   │   │               │     }
│   │   │               │   
│   │   │               │     // --- Keep SnackBar Utility ---
│   │   │               │     void _showSnackBar(BuildContext context, String message,
│   │   │               │         {bool isError = false}) {
│   │   │               │       if (isError) {
│   │   │               │         SnackBarUtil.showErrorSnackBar(
│   │   │               │           message: message,
│   │   │               │           title: 'Error',
│   │   │               │         );
│   │   │               │       } else {
│   │   │               │         SnackBarUtil.showSuccessSnackBar(
│   │   │               │           message: message,
│   │   │               │           title: 'Success',
│   │   │               │         );
│   │   │               │       }
│   │   │               │     }
│   │   │               │   } // End of _UpdateBoatScreenState
│   │   │               │   
│   │   │               │   // Helper extension if not defined elsewhere
│   │   ├── renter/
│   │   │   ├── boats/
│   │   │   │   └── list/
│   │   │   │       └── screen.dart
│   │   │   │           │   // lib/features/renter/boats/list/screen.dart
│   │   │   │           │   
│   │   │   │           │   import 'package:app/utils/snackbar.dart';
│   │   │   │           │   import 'package:flutter/material.dart';
│   │   │   │           │   import 'package:app/app/theme.dart';
│   │   │   │           │   import 'package:localization/localization.dart';
│   │   │   │           │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For potential token usage
│   │   │   │           │   
│   │   │   │           │   // --- Import Models, Controller, and Screens ---
│   │   │   │           │   import 'package:app/controllers/boat.dart'; // Use correct controller name
│   │   │   │           │   import 'package:app/models/boat.dart' as BoatModel; // Use correct model name
│   │   │   │           │   // Import details screen for navigation (Renters likely view the same details screen as owners)
│   │   │   │           │   import 'package:app/features/owner/boats/details/screen.dart'; // Or a specific RenterDetailsScreen if you create one
│   │   │   │           │   import 'package:app/features/bookings/add/screen.dart'; // Import booking screen
│   │   │   │           │   
│   │   │   │           │   class RenterListBoatsScreen extends StatefulWidget {
│   │   │   │           │     // Optional: Receive initial filter/search parameters
│   │   │   │           │     final Map<String, String>? initialFilter;
│   │   │   │           │     final String? initialSearch;
│   │   │   │           │     final String? initialSort;
│   │   │   │           │   
│   │   │   │           │     const RenterListBoatsScreen({
│   │   │   │           │       super.key,
│   │   │   │           │       this.initialFilter,
│   │   │   │           │       this.initialSearch,
│   │   │   │           │       this.initialSort,
│   │   │   │           │     });
│   │   │   │           │   
│   │   │   │           │     @override
│   │   │   │           │     State<RenterListBoatsScreen> createState() => _RenterListBoatsScreenState();
│   │   │   │           │   }
│   │   │   │           │   
│   │   │   │           │   class _RenterListBoatsScreenState extends State<RenterListBoatsScreen>
│   │   │   │           │       with TickerProviderStateMixin {
│   │   │   │           │     // --- Controller and State Variables ---
│   │   │   │           │     final BoatController _boatController = BoatController();
│   │   │   │           │     final _storage = const FlutterSecureStorage();
│   │   │   │           │     List<BoatModel.Boat> _boats = []; // Holds all fetched (active) boats
│   │   │   │           │     List<BoatModel.Boat> _filteredBoats =
│   │   │   │           │         []; // Holds boats after applying local filters
│   │   │   │           │     bool _isLoading = true;
│   │   │   │           │     String? _errorMessage;
│   │   │   │           │   
│   │   │   │           │     // Filter/Search state
│   │   │   │           │     final TextEditingController _searchController = TextEditingController();
│   │   │   │           │     String _currentSearchQuery = '';
│   │   │   │           │     Map<String, String> _currentFilters =
│   │   │   │           │         {}; // Store current filters (e.g., {'boat_type': 'Yacht'})
│   │   │   │           │     String? _currentOrdering; // e.g., 'rental_price_per_day'
│   │   │   │           │   
│   │   │   │           │     // Animation controllers (remove if not used)
│   │   │   │           │     // late AnimationController _logoAnimationController;
│   │   │   │           │     // late Animation<double> _logoAnimation;
│   │   │   │           │   
│   │   │   │           │     @override
│   │   │   │           │     void initState() {
│   │   │   │           │       super.initState();
│   │   │   │           │       // Apply initial parameters passed to the widget
│   │   │   │           │       _currentSearchQuery = widget.initialSearch ?? '';
│   │   │   │           │       _searchController.text = _currentSearchQuery;
│   │   │   │           │       _currentFilters = widget.initialFilter ?? {};
│   │   │   │           │       _currentOrdering = widget.initialSort;
│   │   │   │           │   
│   │   │   │           │       // Fetch initial boat data
│   │   │   │           │       _fetchBoats();
│   │   │   │           │   
│   │   │   │           │       // Initialize animations if needed
│   │   │   │           │       // _logoAnimationController = ...
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     @override
│   │   │   │           │     void dispose() {
│   │   │   │           │       // Dispose animations if needed
│   │   │   │           │       // _logoAnimationController.dispose();
│   │   │   │           │       _searchController.dispose();
│   │   │   │           │       super.dispose();
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- Fetch Boat Data ---
│   │   │   │           │     Future<void> _fetchBoats() async {
│   │   │   │           │       setState(() {
│   │   │   │           │         _isLoading = true;
│   │   │   │           │         _errorMessage = null;
│   │   │   │           │       });
│   │   │   │           │   
│   │   │   │           │       // Renters view public data, token might not be needed unless API requires auth for listing
│   │   │   │           │       // final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │   │           │   
│   │   │   │           │       try {
│   │   │   │           │         // Pass current filters, search, and ordering to the controller
│   │   │   │           │         final fetchedBoats = await _boatController.fetchBoats(
│   │   │   │           │           // accessToken: accessToken, // Pass if required by API
│   │   │   │           │           filters: _currentFilters.isNotEmpty ? _currentFilters : null,
│   │   │   │           │           searchQuery:
│   │   │   │           │               _currentSearchQuery.isNotEmpty ? _currentSearchQuery : null,
│   │   │   │           │           ordering: _currentOrdering,
│   │   │   │           │         );
│   │   │   │           │   
│   │   │   │           │         if (!mounted) return;
│   │   │   │           │   
│   │   │   │           │         setState(() {
│   │   │   │           │           _boats = fetchedBoats; // Store the master list
│   │   │   │           │           _applyLocalFilters(); // Apply local filters initially
│   │   │   │           │           _isLoading = false;
│   │   │   │           │         });
│   │   │   │           │       } catch (e) {
│   │   │   │           │         print("Fetch Renter Boats Error: $e");
│   │   │   │           │         if (mounted) {
│   │   │   │           │           setState(() {
│   │   │   │           │             _isLoading = false;
│   │   │   │           │             _errorMessage = 'Failed to load boats. Please try again.';
│   │   │   │           │           });
│   │   │   │           │         }
│   │   │   │           │       }
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- Apply Local Filtering and Searching ---
│   │   │   │           │     void _applyLocalFilters() {
│   │   │   │           │       // Start with the full list of fetched boats
│   │   │   │           │       _filteredBoats = _boats.where((boat) {
│   │   │   │           │         // Apply search query (simple local search)
│   │   │   │           │         bool searchMatch = true;
│   │   │   │           │         if (_currentSearchQuery.isNotEmpty) {
│   │   │   │           │           final query = _currentSearchQuery.toLowerCase();
│   │   │   │           │           searchMatch = boat.name.toLowerCase().contains(query) ||
│   │   │   │           │               (boat.description?.toLowerCase() ?? '').contains(query) ||
│   │   │   │           │               boat.boatType.toLowerCase().contains(query) ||
│   │   │   │           │               boat.locationDescription.toLowerCase().contains(query);
│   │   │   │           │         }
│   │   │   │           │   
│   │   │   │           │         // Apply filters (can be extended)
│   │   │   │           │         bool filterMatch = true;
│   │   │   │           │         // Example: Filter by boat_type if present in _currentFilters
│   │   │   │           │         if (_currentFilters.containsKey('boat_type')) {
│   │   │   │           │           filterMatch &= boat.boatType.toLowerCase() ==
│   │   │   │           │               _currentFilters['boat_type']!.toLowerCase();
│   │   │   │           │         }
│   │   │   │           │         // Add more filter logic here based on _currentFilters map keys
│   │   │   │           │   
│   │   │   │           │         return searchMatch && filterMatch;
│   │   │   │           │       }).toList();
│   │   │   │           │   
│   │   │   │           │       // Note: Local sorting is not implemented here, rely on server ordering (_currentOrdering)
│   │   │   │           │       // If local sorting is needed, add logic here using _filteredBoats.sort(...)
│   │   │   │           │   
│   │   │   │           │       // Trigger UI rebuild after filtering
│   │   │   │           │       // setState(() {}); // setState is implicitly called after _fetchBoats completes
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     @override
│   │   │   │           │     Widget build(BuildContext context) {
│   │   │   │           │       return Scaffold(
│   │   │   │           │         backgroundColor: Theme.of(context).scaffoldBackgroundColor,
│   │   │   │           │         appBar: _buildAppBar(context),
│   │   │   │           │         body: _buildBodyContent(),
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- Build Body Content based on State ---
│   │   │   │           │     Widget _buildBodyContent() {
│   │   │   │           │       if (_isLoading) {
│   │   │   │           │         return const Center(child: CircularProgressIndicator());
│   │   │   │           │       }
│   │   │   │           │       if (_errorMessage != null) {
│   │   │   │           │         return Center(
│   │   │   │           │             /* ... Error Message + Retry Button ... */
│   │   │   │           │             child: Padding(
│   │   │   │           │                 padding: const EdgeInsets.all(20.0),
│   │   │   │           │                 child: Column(
│   │   │   │           │                   mainAxisSize: MainAxisSize.min,
│   │   │   │           │                   children: [
│   │   │   │           │                     Icon(Icons.cloud_off, color: Colors.grey.shade400, size: 60),
│   │   │   │           │                     const SizedBox(height: 16),
│   │   │   │           │                     Text(_errorMessage!,
│   │   │   │           │                         textAlign: TextAlign.center,
│   │   │   │           │                         style: TextStyle(color: Colors.red.shade700)),
│   │   │   │           │                     const SizedBox(height: 16),
│   │   │   │           │                     ElevatedButton.icon(
│   │   │   │           │                         onPressed: _fetchBoats,
│   │   │   │           │                         icon: const Icon(Icons.refresh),
│   │   │   │           │                         label: const Text('Retry'))
│   │   │   │           │                   ],
│   │   │   │           │                 )));
│   │   │   │           │       }
│   │   │   │           │       if (_boats.isEmpty) {
│   │   │   │           │         // Check original list for truly empty state
│   │   │   │           │         return _buildEmptyBoatList(); // Show empty state (no boats available at all)
│   │   │   │           │       }
│   │   │   │           │       if (_filteredBoats.isEmpty) {
│   │   │   │           │         // Check filtered list for "no results" state
│   │   │   │           │         return Center(
│   │   │   │           │             child: Padding(
│   │   │   │           │                 padding: const EdgeInsets.all(20.0),
│   │   │   │           │                 child: Text('no_boats_match_filters'.i18n(),
│   │   │   │           │                     style: Theme.of(context)
│   │   │   │           │                         .textTheme
│   │   │   │           │                         .bodyLarge) // Message for no filter results
│   │   │   │           │                 ));
│   │   │   │           │       }
│   │   │   │           │   
│   │   │   │           │       // Display Boat List
│   │   │   │           │       return RefreshIndicator(
│   │   │   │           │           // Add pull-to-refresh
│   │   │   │           │           onRefresh: _fetchBoats,
│   │   │   │           │           child: _buildBoatGridList());
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // Keep AppBar structure, link search/filter actions
│   │   │   │           │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │   │           │       return AppBar(
│   │   │   │           │         title: Text('list_boats_title_appbar'.i18n(),
│   │   │   │           │             style: const TextStyle(fontWeight: FontWeight.w700)),
│   │   │   │           │         centerTitle: true,
│   │   │   │           │         elevation: 2,
│   │   │   │           │         backgroundColor: Colors.white,
│   │   │   │           │         iconTheme: IconThemeData(color: Theme.of(context).colorScheme.primary),
│   │   │   │           │         actions: [
│   │   │   │           │           IconButton(
│   │   │   │           │             icon: const Icon(Icons.filter_alt_outlined, size: 28),
│   │   │   │           │             tooltip: 'filter_boats_tooltip'.i18n(),
│   │   │   │           │             onPressed: () {
│   │   │   │           │               _showFilterOptions(context);
│   │   │   │           │             }, // Call filter modal function
│   │   │   │           │           ),
│   │   │   │           │         ],
│   │   │   │           │         bottom: PreferredSize(
│   │   │   │           │           preferredSize: const Size.fromHeight(70.0),
│   │   │   │           │           child: Padding(
│   │   │   │           │             padding: const EdgeInsets.symmetric(horizontal: 16.0, vertical: 12.0),
│   │   │   │           │             child: _buildSearchBar(), // Search bar updates state
│   │   │   │           │           ),
│   │   │   │           │         ),
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     Widget _buildSearchBar() {
│   │   │   │           │       return TextField(
│   │   │   │           │         controller: _searchController, // Use the controller
│   │   │   │           │         decoration: InputDecoration(
│   │   │   │           │           hintText: 'search_boats_hint'.i18n(),
│   │   │   │           │           prefixIcon:
│   │   │   │           │               Icon(Icons.search, color: Theme.of(context).colorScheme.primary),
│   │   │   │           │           // Add clear button
│   │   │   │           │           suffixIcon: _currentSearchQuery.isNotEmpty
│   │   │   │           │               ? IconButton(
│   │   │   │           │                   icon: const Icon(Icons.clear, size: 20),
│   │   │   │           │                   onPressed: () {
│   │   │   │           │                     _searchController.clear();
│   │   │   │           │                     setState(() {
│   │   │   │           │                       _currentSearchQuery = '';
│   │   │   │           │                       _applyLocalFilters(); // Re-apply filters after clearing search
│   │   │   │           │                     });
│   │   │   │           │                   },
│   │   │   │           │                 )
│   │   │   │           │               : null,
│   │   │   │           │           filled: true,
│   │   │   │           │           fillColor: Colors.grey.shade50,
│   │   │   │           │           border: OutlineInputBorder(
│   │   │   │           │             borderRadius: BorderRadius.circular(25),
│   │   │   │           │             borderSide: BorderSide.none,
│   │   │   │           │           ),
│   │   │   │           │           enabledBorder: OutlineInputBorder(
│   │   │   │           │             borderRadius: BorderRadius.circular(25),
│   │   │   │           │             borderSide: BorderSide(color: Colors.grey.shade300, width: 1),
│   │   │   │           │           ),
│   │   │   │           │           focusedBorder: OutlineInputBorder(
│   │   │   │           │             borderRadius: BorderRadius.circular(25),
│   │   │   │           │             borderSide:
│   │   │   │           │                 BorderSide(color: Theme.of(context).primaryColor, width: 1.5),
│   │   │   │           │           ),
│   │   │   │           │           contentPadding:
│   │   │   │           │               const EdgeInsets.symmetric(horizontal: 20, vertical: 14),
│   │   │   │           │         ),
│   │   │   │           │         onChanged: (value) {
│   │   │   │           │           // Apply filter on change (debounce recommended for real app)
│   │   │   │           │           setState(() {
│   │   │   │           │             _currentSearchQuery = value;
│   │   │   │           │             _applyLocalFilters(); // Apply local filters as user types
│   │   │   │           │           });
│   │   │   │           │         },
│   │   │   │           │         onSubmitted: (value) {
│   │   │   │           │           // Optional: trigger API search on submit
│   │   │   │           │           // setState(() { _currentSearchQuery = value; });
│   │   │   │           │           // _fetchBoats(); // Trigger API refetch with search param
│   │   │   │           │         },
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     Widget _buildEmptyBoatList() {
│   │   │   │           │       // Renter-specific empty state
│   │   │   │           │       return Center(
│   │   │   │           │         child: Padding(
│   │   │   │           │           padding: const EdgeInsets.symmetric(horizontal: 40.0),
│   │   │   │           │           child: Column(
│   │   │   │           │             mainAxisAlignment: MainAxisAlignment.center,
│   │   │   │           │             children: [
│   │   │   │           │               const Icon(Icons.sentiment_dissatisfied_outlined,
│   │   │   │           │                   size: 80, color: Colors.grey), // Sad face icon
│   │   │   │           │               const SizedBox(height: 30),
│   │   │   │           │               Text(
│   │   │   │           │                 'no_boats_available_renter'.i18n(), // Renter-specific message
│   │   │   │           │                 style: Theme.of(context).textTheme.headlineSmall?.copyWith(
│   │   │   │           │                     color: AppColors.subtleTextColor,
│   │   │   │           │                     fontWeight: FontWeight.w500),
│   │   │   │           │                 textAlign: TextAlign.center,
│   │   │   │           │               ),
│   │   │   │           │               const SizedBox(height: 30),
│   │   │   │           │               ElevatedButton.icon(
│   │   │   │           │                 onPressed: _fetchBoats, // Allow refresh
│   │   │   │           │                 icon: const Icon(Icons.refresh_rounded),
│   │   │   │           │                 label: Text('refresh_list_button'.i18n(),
│   │   │   │           │                     style: const TextStyle(
│   │   │   │           │                         fontSize: 16, fontWeight: FontWeight.w600)),
│   │   │   │           │                 style: ElevatedButton.styleFrom(
│   │   │   │           │                   padding:
│   │   │   │           │                       const EdgeInsets.symmetric(horizontal: 30, vertical: 16),
│   │   │   │           │                   shape: RoundedRectangleBorder(
│   │   │   │           │                       borderRadius: BorderRadius.circular(15)),
│   │   │   │           │                   elevation: 2,
│   │   │   │           │                 ),
│   │   │   │           │               ),
│   │   │   │           │             ],
│   │   │   │           │           ),
│   │   │   │           │         ),
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- Build Grid using Filtered Data ---
│   │   │   │           │     Widget _buildBoatGridList() {
│   │   │   │           │       return GridView.builder(
│   │   │   │           │         padding: const EdgeInsets.all(16.0),
│   │   │   │           │         gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
│   │   │   │           │           crossAxisCount: 1, // Or 2 if you prefer grid on mobile
│   │   │   │           │           crossAxisSpacing: 16,
│   │   │   │           │           mainAxisSpacing: 16,
│   │   │   │           │           childAspectRatio:
│   │   │   │           │               1.0, // Adjust for potentially taller cards with price/book button
│   │   │   │           │         ),
│   │   │   │           │         itemCount: _filteredBoats.length, // Use filtered list count
│   │   │   │           │         itemBuilder: (context, index) {
│   │   │   │           │           final BoatModel.Boat boat =
│   │   │   │           │               _filteredBoats[index]; // Use boat from filtered list
│   │   │   │           │           return _buildFancyBoatCard(context, boat);
│   │   │   │           │         },
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- Fancy Boat Card for Renters ---
│   │   │   │           │     Widget _buildFancyBoatCard(BuildContext context, BoatModel.Boat boat) {
│   │   │   │           │       return Container(
│   │   │   │           │         decoration: BoxDecoration(
│   │   │   │           │           /* ... Keep Card Styling ... */
│   │   │   │           │           color: Colors.white,
│   │   │   │           │           borderRadius: BorderRadius.circular(25),
│   │   │   │           │           boxShadow: [
│   │   │   │           │             BoxShadow(
│   │   │   │           │               color: Colors.grey.shade300,
│   │   │   │           │               blurRadius: 12,
│   │   │   │           │               spreadRadius: 2,
│   │   │   │           │               offset: const Offset(0, 6),
│   │   │   │           │             ),
│   │   │   │           │             BoxShadow(
│   │   │   │           │               color: Colors.grey.shade100,
│   │   │   │           │               blurRadius: 8,
│   │   │   │           │               spreadRadius: 1,
│   │   │   │           │               offset: const Offset(0, 2),
│   │   │   │           │             ),
│   │   │   │           │           ],
│   │   │   │           │         ),
│   │   │   │           │         child: InkWell(
│   │   │   │           │           // --- Navigate to Details on Tap ---
│   │   │   │           │           onTap: () {
│   │   │   │           │             Navigator.push(
│   │   │   │           │               context,
│   │   │   │           │               MaterialPageRoute(
│   │   │   │           │                   // Use the Owner's detail screen for now, or create a renter-specific one
│   │   │   │           │                   builder: (_) => BoatDetailsScreen(boatId: boat.id)),
│   │   │   │           │             );
│   │   │   │           │           },
│   │   │   │           │           borderRadius: BorderRadius.circular(25),
│   │   │   │           │           child: Column(
│   │   │   │           │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │   │           │             children: [
│   │   │   │           │               Expanded(
│   │   │   │           │                 // Image Section
│   │   │   │           │                 flex: 3, // Give image more space
│   │   │   │           │                 child: ClipRRect(
│   │   │   │           │                   borderRadius:
│   │   │   │           │                       const BorderRadius.vertical(top: Radius.circular(25)),
│   │   │   │           │                   child: Stack(
│   │   │   │           │                     fit: StackFit.expand,
│   │   │   │           │                     children: [
│   │   │   │           │                       Image.network(
│   │   │   │           │                         // Display boat image
│   │   │   │           │                         boat.mainImageUrl ??
│   │   │   │           │                             'https://placehold.co/600x400/E0E0E0/BDBDBD?text=No+Image', // Fallback
│   │   │   │           │                         fit: BoxFit.cover,
│   │   │   │           │                         errorBuilder: (context, error, stackTrace) =>
│   │   │   │           │                             const Center(child: Icon(Icons.error_outline)),
│   │   │   │           │                       ),
│   │   │   │           │                       // Remove status badge - renters only see active boats
│   │   │   │           │                       // Positioned(top: 10, right: 10, child: _buildStatusBadge(boat.status, context)), // REMOVED
│   │   │   │           │                       DecoratedBox(
│   │   │   │           │                         // Gradient overlay
│   │   │   │           │                         decoration: BoxDecoration(
│   │   │   │           │                           gradient: LinearGradient(
│   │   │   │           │                             begin: Alignment.topCenter,
│   │   │   │           │                             end: Alignment.bottomCenter,
│   │   │   │           │                             colors: [
│   │   │   │           │                               Colors.transparent,
│   │   │   │           │                               Colors.black.withOpacity(0.5)
│   │   │   │           │                             ],
│   │   │   │           │                             stops: const [0.6, 1.0],
│   │   │   │           │                           ),
│   │   │   │           │                         ),
│   │   │   │           │                       ),
│   │   │   │           │                       Positioned(
│   │   │   │           │                           // Rating Badge
│   │   │   │           │                           bottom: 8,
│   │   │   │           │                           left: 12,
│   │   │   │           │                           child: Container(
│   │   │   │           │                             padding: const EdgeInsets.symmetric(
│   │   │   │           │                                 horizontal: 8, vertical: 4),
│   │   │   │           │                             decoration: BoxDecoration(
│   │   │   │           │                                 color: Colors.black.withOpacity(0.6),
│   │   │   │           │                                 borderRadius: BorderRadius.circular(12)),
│   │   │   │           │                             child: Row(mainAxisSize: MainAxisSize.min, children: [
│   │   │   │           │                               const Icon(Icons.star,
│   │   │   │           │                                   color: Colors.amber, size: 14),
│   │   │   │           │                               const SizedBox(width: 4),
│   │   │   │           │                               Text(boat.rating.toString(),
│   │   │   │           │                                   style: const TextStyle(
│   │   │   │           │                                       color: Colors.white,
│   │   │   │           │                                       fontSize: 12,
│   │   │   │           │                                       fontWeight: FontWeight.bold)),
│   │   │   │           │                             ]),
│   │   │   │           │                           ))
│   │   │   │           │                     ],
│   │   │   │           │                   ),
│   │   │   │           │                 ),
│   │   │   │           │               ),
│   │   │   │           │               Expanded(
│   │   │   │           │                 // Content Section
│   │   │   │           │                 flex: 2, // Less space for content compared to image
│   │   │   │           │                 child: Padding(
│   │   │   │           │                   padding: const EdgeInsets.fromLTRB(
│   │   │   │           │                       14.0, 10.0, 14.0, 8.0), // Reduced vertical padding
│   │   │   │           │                   child: Column(
│   │   │   │           │                     crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │           │                     mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │   │           │                     children: [
│   │   │   │           │                       // Boat Name and Type
│   │   │   │           │                       Column(
│   │   │   │           │                         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │           │                         children: [
│   │   │   │           │                           Text(
│   │   │   │           │                             boat.name,
│   │   │   │           │                             style: Theme.of(context)
│   │   │   │           │                                 .textTheme
│   │   │   │           │                                 .titleMedium
│   │   │   │           │                                 ?.copyWith(
│   │   │   │           │                                     fontWeight: FontWeight
│   │   │   │           │                                         .w700), // Slightly smaller title
│   │   │   │           │                             maxLines: 1, overflow: TextOverflow.ellipsis,
│   │   │   │           │                           ),
│   │   │   │           │                           const SizedBox(height: 2),
│   │   │   │           │                           Text(
│   │   │   │           │                             boat.boatType,
│   │   │   │           │                             style: Theme.of(context)
│   │   │   │           │                                 .textTheme
│   │   │   │           │                                 .bodySmall
│   │   │   │           │                                 ?.copyWith(color: AppColors.subtleTextColor),
│   │   │   │           │                             maxLines: 1,
│   │   │   │           │                             overflow: TextOverflow.ellipsis,
│   │   │   │           │                           ),
│   │   │   │           │                         ],
│   │   │   │           │                       ),
│   │   │   │           │                       // Price and Book Button Row
│   │   │   │           │                       Row(
│   │   │   │           │                         mainAxisAlignment: MainAxisAlignment.spaceBetween,
│   │   │   │           │                         crossAxisAlignment: CrossAxisAlignment.end,
│   │   │   │           │                         children: [
│   │   │   │           │                           Column(
│   │   │   │           │                             crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │           │                             mainAxisSize: MainAxisSize.min,
│   │   │   │           │                             children: [
│   │   │   │           │                               Text(
│   │   │   │           │                                 'price_per_day_label'.i18n(), // Localized label
│   │   │   │           │                                 style: Theme.of(context)
│   │   │   │           │                                     .textTheme
│   │   │   │           │                                     .bodySmall
│   │   │   │           │                                     ?.copyWith(
│   │   │   │           │                                         color: AppColors.subtleTextColor,
│   │   │   │           │                                         fontSize: 11),
│   │   │   │           │                               ),
│   │   │   │           │                               Text(
│   │   │   │           │                                 "SAR ${boat.rentalPricePerDay.toStringAsFixed(0)}", // Format price
│   │   │   │           │                                 style: Theme.of(context)
│   │   │   │           │                                     .textTheme
│   │   │   │           │                                     .titleMedium
│   │   │   │           │                                     ?.copyWith(
│   │   │   │           │                                         fontWeight: FontWeight.bold,
│   │   │   │           │                                         color: Theme.of(context)
│   │   │   │           │                                             .colorScheme
│   │   │   │           │                                             .primary),
│   │   │   │           │                               ),
│   │   │   │           │                             ],
│   │   │   │           │                           ),
│   │   │   │           │                           _buildBookNowButton(
│   │   │   │           │                               context, boat), // Pass boat to book button
│   │   │   │           │                         ],
│   │   │   │           │                       ),
│   │   │   │           │                     ],
│   │   │   │           │                   ),
│   │   │   │           │                 ),
│   │   │   │           │               ),
│   │   │   │           │             ],
│   │   │   │           │           ),
│   │   │   │           │         ),
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- Book Now Button for Card ---
│   │   │   │           │     Widget _buildBookNowButton(BuildContext context, BoatModel.Boat boat) {
│   │   │   │           │       return ElevatedButton(
│   │   │   │           │         onPressed: () {
│   │   │   │           │           // Navigate to Add Booking Screen, passing boat info
│   │   │   │           │           Navigator.push(
│   │   │   │           │             context,
│   │   │   │           │             MaterialPageRoute(
│   │   │   │           │               builder: (_) => BookBoatScreen(
│   │   │   │           │                 boatId:
│   │   │   │           │                     boat.id.toString(), // Pass ID as String if needed by screen
│   │   │   │           │                 boat: boat, // Pass the full boat object
│   │   │   │           │               ),
│   │   │   │           │             ),
│   │   │   │           │           );
│   │   │   │           │         },
│   │   │   │           │         style: ElevatedButton.styleFrom(
│   │   │   │           │           padding: const EdgeInsets.symmetric(
│   │   │   │           │               horizontal: 16, vertical: 8), // Smaller padding
│   │   │   │           │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
│   │   │   │           │           backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │   │           │           foregroundColor: Colors.white,
│   │   │   │           │           textStyle: const TextStyle(
│   │   │   │           │               fontSize: 13, fontWeight: FontWeight.w600), // Smaller text
│   │   │   │           │         ),
│   │   │   │           │         child: Text('book_now_short_button'.i18n()), // Short button text
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- Filter Options Modal ---
│   │   │   │           │     void _showFilterOptions(BuildContext context) {
│   │   │   │           │       // TODO: Implement filter modal - allow filtering by type, price range, capacity etc.
│   │   │   │           │       // Update _currentFilters state and call _applyLocalFilters() when filters change
│   │   │   │           │       showModalBottomSheet(
│   │   │   │           │         context: context,
│   │   │   │           │         shape: const RoundedRectangleBorder(
│   │   │   │           │             borderRadius: BorderRadius.vertical(top: Radius.circular(25.0))),
│   │   │   │           │         builder: (BuildContext context) {
│   │   │   │           │           // Example: Simple filter by type (Can be made much more complex)
│   │   │   │           │           String? selectedType = _currentFilters['boat_type'];
│   │   │   │           │           final boatTypes = [
│   │   │   │           │             'Yacht',
│   │   │   │           │             'Speed Boat',
│   │   │   │           │             'Fishing Boat',
│   │   │   │           │             'Dhow',
│   │   │   │           │             'Sailboat'
│   │   │   │           │           ]; // Example types
│   │   │   │           │   
│   │   │   │           │           return StatefulBuilder(
│   │   │   │           │               // Use StatefulBuilder to manage state within the modal
│   │   │   │           │               builder: (BuildContext context, StateSetter setModalState) {
│   │   │   │           │             return Padding(
│   │   │   │           │               padding: const EdgeInsets.all(20.0),
│   │   │   │           │               child: Column(
│   │   │   │           │                 mainAxisSize: MainAxisSize.min,
│   │   │   │           │                 crossAxisAlignment: CrossAxisAlignment.start,
│   │   │   │           │                 children: <Widget>[
│   │   │   │           │                   Text('filter_by_type'.i18n(),
│   │   │   │           │                       style: Theme.of(context).textTheme.titleLarge),
│   │   │   │           │                   const SizedBox(height: 10),
│   │   │   │           │                   DropdownButton<String>(
│   │   │   │           │                     value: selectedType,
│   │   │   │           │                     hint: Text('select_boat_type'.i18n()),
│   │   │   │           │                     isExpanded: true,
│   │   │   │           │                     items: [
│   │   │   │           │                       DropdownMenuItem<String>(
│   │   │   │           │                           value: null,
│   │   │   │           │                           child: Text('all_types'.i18n())), // Option for all
│   │   │   │           │                       ...boatTypes.map((String value) {
│   │   │   │           │                         return DropdownMenuItem<String>(
│   │   │   │           │                             value: value, child: Text(value));
│   │   │   │           │                       }).toList(),
│   │   │   │           │                     ],
│   │   │   │           │                     onChanged: (String? newValue) {
│   │   │   │           │                       setModalState(() {
│   │   │   │           │                         // Update modal state
│   │   │   │           │                         selectedType = newValue;
│   │   │   │           │                       });
│   │   │   │           │                     },
│   │   │   │           │                   ),
│   │   │   │           │                   const SizedBox(height: 20),
│   │   │   │           │                   // Add more filters here (Price Range Slider, Capacity Stepper, etc.)
│   │   │   │           │                   Row(
│   │   │   │           │                     mainAxisAlignment: MainAxisAlignment.end,
│   │   │   │           │                     children: [
│   │   │   │           │                       TextButton(
│   │   │   │           │                         onPressed: () => Navigator.pop(context),
│   │   │   │           │                         child: Text('cancel_button'.i18n()),
│   │   │   │           │                       ),
│   │   │   │           │                       const SizedBox(width: 10),
│   │   │   │           │                       ElevatedButton(
│   │   │   │           │                         onPressed: () {
│   │   │   │           │                           setState(() {
│   │   │   │           │                             // Update main screen state
│   │   │   │           │                             if (selectedType == null) {
│   │   │   │           │                               _currentFilters.remove('boat_type');
│   │   │   │           │                             } else {
│   │   │   │           │                               _currentFilters['boat_type'] = selectedType!;
│   │   │   │           │                             }
│   │   │   │           │                             _applyLocalFilters(); // Apply the selected filters
│   │   │   │           │                           });
│   │   │   │           │                           Navigator.pop(context); // Close modal
│   │   │   │           │                         },
│   │   │   │           │                         child: Text('apply_filters_button'.i18n()),
│   │   │   │           │                       ),
│   │   │   │           │                     ],
│   │   │   │           │                   )
│   │   │   │           │                 ],
│   │   │   │           │               ),
│   │   │   │           │             );
│   │   │   │           │           });
│   │   │   │           │         },
│   │   │   │           │       );
│   │   │   │           │     }
│   │   │   │           │   
│   │   │   │           │     // --- SnackBar Utility --- (Keep existing)
│   │   │   │           │     void _showSnackBar(BuildContext context, String message,
│   │   │   │           │         {bool isError = false}) {
│   │   │   │           │       if (isError) {
│   │   │   │           │         SnackBarUtil.showErrorSnackBar(
│   │   │   │           │           message: message,
│   │   │   │           │           title: 'Error',
│   │   │   │           │         );
│   │   │   │           │       } else {
│   │   │   │           │         SnackBarUtil.showSuccessSnackBar(
│   │   │   │           │           message: message,
│   │   │   │           │           title: 'Success',
│   │   │   │           │         );
│   │   │   │           │       }
│   │   │   │           │     }
│   │   │   │           │   }
│   │   │   └── review/
│   │   │       └── screen.dart
│   │   │           │   // lib/features/renter/review/screen.dart
│   │   │           │   import 'package:app/models/booking.dart';
│   │   │           │   import 'package:app/utils/snackbar.dart';
│   │   │           │   import 'package:flutter/material.dart';
│   │   │           │   import 'package:localization/localization.dart';
│   │   │           │   import 'package:carousel_slider/carousel_slider.dart';
│   │   │           │   import 'package:flutter_animate/flutter_animate.dart'; // For animations if used
│   │   │           │   import 'package:flutter_secure_storage/flutter_secure_storage.dart'; // For token
│   │   │           │   
│   │   │           │   // --- Import Models and Controllers ---
│   │   │           │   import 'package:app/models/boat.dart'; // Use correct name
│   │   │           │   import 'package:app/models/review.dart'; // Use correct name
│   │   │           │   import 'package:app/controllers/review.dart'; // Use correct name
│   │   │           │   import 'package:app/app/theme.dart'; // For theme access
│   │   │           │   
│   │   │           │   // Remove dummy model definitions if they exist here
│   │   │           │   
│   │   │           │   class RateBoatScreen extends StatefulWidget {
│   │   │           │     final Booking booking; // Pass the boat object for details and ID
│   │   │           │   
│   │   │           │     const RateBoatScreen({
│   │   │           │       super.key,
│   │   │           │       required this.booking, // Require the boat object
│   │   │           │     });
│   │   │           │   
│   │   │           │     @override
│   │   │           │     State<RateBoatScreen> createState() => _RateBoatScreenState();
│   │   │           │   }
│   │   │           │   
│   │   │           │   class _RateBoatScreenState extends State<RateBoatScreen>
│   │   │           │       with TickerProviderStateMixin {
│   │   │           │     // --- Controller and State Variables ---
│   │   │           │     final ReviewController _reviewController = ReviewController();
│   │   │           │     final _storage = const FlutterSecureStorage();
│   │   │           │     bool _isSubmitting = false; // Loading state for submission
│   │   │           │     double _userRating =
│   │   │           │         0; // State for user's selected rating (1-5, 0 means unselected)
│   │   │           │     final TextEditingController _reviewCommentController =
│   │   │           │         TextEditingController();
│   │   │           │   
│   │   │           │     // Animation controllers (keep if used, remove otherwise)
│   │   │           │     // late AnimationController _logoAnimationController;
│   │   │           │     // late Animation<double> _logoAnimation;
│   │   │           │   
│   │   │           │     // Keep local list for displaying existing reviews if needed (optional)
│   │   │           │     // List<Review> _existingReviews = []; // Fetch if needed
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void initState() {
│   │   │           │       super.initState();
│   │   │           │       // Initialize animations if used
│   │   │           │       // _logoAnimationController = ...
│   │   │           │       // _logoAnimation = ...
│   │   │           │   
│   │   │           │       // Optionally fetch existing reviews for display
│   │   │           │       // _fetchExistingReviews();
│   │   │           │     }
│   │   │           │   
│   │   │           │     @override
│   │   │           │     void dispose() {
│   │   │           │       // Dispose animations if used
│   │   │           │       // _logoAnimationController.dispose();
│   │   │           │       _reviewCommentController.dispose();
│   │   │           │       super.dispose();
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Function to Submit Review via API ---
│   │   │           │     Future<void> _submitReview() async {
│   │   │           │       if (_userRating == 0) {
│   │   │           │         _showSnackBar(context, 'Please select a star rating.', isError: true);
│   │   │           │         return;
│   │   │           │       }
│   │   │           │   
│   │   │           │       final String? accessToken = await _storage.read(key: 'accessToken');
│   │   │           │       if (accessToken == null || accessToken.isEmpty) {
│   │   │           │         if (mounted) {
│   │   │           │           _showSnackBar(context, 'Authentication error. Please log in again.',
│   │   │           │               isError: true);
│   │   │           │         }
│   │   │           │         return;
│   │   │           │       }
│   │   │           │   
│   │   │           │       setState(() => _isSubmitting = true);
│   │   │           │   
│   │   │           │       try {
│   │   │           │         final newReview = await _reviewController.createReview(
│   │   │           │           bookingId: widget.booking.id, // Use the boat ID from the passed object
│   │   │           │           rating: _userRating.toInt(), // Convert double rating to int
│   │   │           │           comment: _reviewCommentController.text.trim().isNotEmpty
│   │   │           │               ? _reviewCommentController.text.trim()
│   │   │           │               : null, // Send comment if not empty
│   │   │           │         );
│   │   │           │   
│   │   │           │         if (!mounted) return;
│   │   │           │   
│   │   │           │         if (newReview != null) {
│   │   │           │           // --- Success ---
│   │   │           │           _showSnackBar(context, 'Review submitted successfully!');
│   │   │           │           // Optionally clear form and disable further submission? Or pop screen?
│   │   │           │           _reviewCommentController.clear();
│   │   │           │           setState(() {
│   │   │           │             // _userRating = 0; // Reset rating locally? Or just pop?
│   │   │           │             // Maybe navigate back or show a success message and stay
│   │   │           │           });
│   │   │           │           // Example: Pop screen after successful submission
│   │   │           │           await Future.delayed(
│   │   │           │               const Duration(seconds: 1)); // Short delay for snackbar
│   │   │           │           if (mounted) Navigator.pop(context);
│   │   │           │         } else {
│   │   │           │           // --- Failure ---
│   │   │           │           // Controller prints details, show generic error
│   │   │           │           _showSnackBar(context,
│   │   │           │               'Failed to submit review. You might have already reviewed this boat or booking.',
│   │   │           │               isError: true);
│   │   │           │         }
│   │   │           │       } catch (e) {
│   │   │           │         print("Submit Review Error: $e");
│   │   │           │         if (mounted) {
│   │   │           │           _showSnackBar(context, 'An unexpected error occurred.', isError: true);
│   │   │           │         }
│   │   │           │       } finally {
│   │   │           │         if (mounted) {
│   │   │           │           setState(() => _isSubmitting = false);
│   │   │           │         }
│   │   │           │       }
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- End Submit Review Function ---
│   │   │           │   
│   │   │           │     @override
│   │   │           │     Widget build(BuildContext context) {
│   │   │           │       // Using structure similar to BookBoatScreen
│   │   │           │       return Scaffold(
│   │   │           │         backgroundColor: const Color(0xFFF9FAFC), // Match background
│   │   │           │         extendBodyBehindAppBar: true,
│   │   │           │         appBar: _buildAppBar(context),
│   │   │           │         body: SingleChildScrollView(
│   │   │           │           child: Column(
│   │   │           │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │           │             children: <Widget>[
│   │   │           │               _buildHeroImageCarousel(context), // Display boat images
│   │   │           │               Transform.translate(
│   │   │           │                 // Pull content up over image bottom
│   │   │           │                 offset: const Offset(0, -30),
│   │   │           │                 child: Container(
│   │   │           │                   decoration: const BoxDecoration(
│   │   │           │                     // Rounded top corners
│   │   │           │                     color: Color(0xFFF9FAFC),
│   │   │           │                     borderRadius: BorderRadius.only(
│   │   │           │                       topLeft: Radius.circular(40),
│   │   │           │                       topRight: Radius.circular(40),
│   │   │           │                     ),
│   │   │           │                   ),
│   │   │           │                   padding: const EdgeInsets.fromLTRB(24.0, 30.0, 24.0, 24.0),
│   │   │           │                   child: Column(
│   │   │           │                     crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │           │                     children: [
│   │   │           │                       _buildBoatInfoSection(context),
│   │   │           │                       // Show basic boat info
│   │   │           │                       const SizedBox(height: 30),
│   │   │           │                       _buildRatingInputSection(context),
│   │   │           │                       // Section to input rating/comment
│   │   │           │                       // Optionally show existing reviews below the input section
│   │   │           │                       // const SizedBox(height: 30),
│   │   │           │                       // _buildReviewsSection(context),
│   │   │           │                       const SizedBox(height: 30),
│   │   │           │                     ],
│   │   │           │                   ),
│   │   │           │                 ),
│   │   │           │               ),
│   │   │           │             ],
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- AppBar ---
│   │   │           │     PreferredSizeWidget _buildAppBar(BuildContext context) {
│   │   │           │       return AppBar(
│   │   │           │         title: Text(
│   │   │           │           'rate_boat_title_appbar'.i18n(), // Localized title
│   │   │           │           style: const TextStyle(fontWeight: FontWeight.w700, fontSize: 18),
│   │   │           │         ),
│   │   │           │         centerTitle: true,
│   │   │           │         elevation: 0,
│   │   │           │         backgroundColor: Colors.transparent,
│   │   │           │         // Transparent overlay
│   │   │           │         foregroundColor: Colors.white,
│   │   │           │         // White icons/text on image
│   │   │           │         leading: IconButton(
│   │   │           │           // Back button with background
│   │   │           │           icon: Container(
│   │   │           │             padding: const EdgeInsets.all(8),
│   │   │           │             decoration: BoxDecoration(
│   │   │           │                 color: Colors.black.withOpacity(0.2),
│   │   │           │                 borderRadius: BorderRadius.circular(12)),
│   │   │           │             child: const Icon(Icons.arrow_back_ios_new_rounded, size: 18),
│   │   │           │           ),
│   │   │           │           onPressed: () => Navigator.pop(context),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Image Carousel --- (Uses widget.boat.imageUrls)
│   │   │           │     Widget _buildHeroImageCarousel(BuildContext context) {
│   │   │           │       // Reuse the carousel logic from BookBoatScreen (or BoatDetailsScreen)
│   │   │           │       // Ensure it uses widget.boat.imageUrls
│   │   │           │       final imageURLs =
│   │   │           │           widget.booking.boat!.imageUrls ?? []; // Handle null image list
│   │   │           │       return CarouselSlider(
│   │   │           │         options: CarouselOptions(
│   │   │           │           height: 350.0,
│   │   │           │           // Adjust height as needed
│   │   │           │           viewportFraction: 1.0,
│   │   │           │           enlargeCenterPage: false,
│   │   │           │           enableInfiniteScroll: imageURLs.length > 1,
│   │   │           │           autoPlay: imageURLs.length > 1,
│   │   │           │         ),
│   │   │           │         items: imageURLs.isNotEmpty
│   │   │           │             ? imageURLs.map((url) {
│   │   │           │                 return Builder(builder: (BuildContext context) {
│   │   │           │                   return Container(
│   │   │           │                     width: MediaQuery.of(context).size.width,
│   │   │           │                     decoration: BoxDecoration(
│   │   │           │                       image: DecorationImage(
│   │   │           │                           image: NetworkImage(url), fit: BoxFit.cover),
│   │   │           │                     ),
│   │   │           │                     child: Container(/* Optional Gradient */),
│   │   │           │                   );
│   │   │           │                 });
│   │   │           │               }).toList()
│   │   │           │             : [
│   │   │           │                 Container(
│   │   │           │                     color: Colors.grey[300],
│   │   │           │                     child: const Center(child: Icon(Icons.image_not_supported)))
│   │   │           │               ], // Placeholder
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Basic Booking Info --- (Uses widget.boat)
│   │   │           │     Widget _buildBoatInfoSection(BuildContext context) {
│   │   │           │       return Column(
│   │   │           │         crossAxisAlignment: CrossAxisAlignment.start,
│   │   │           │         children: [
│   │   │           │           Text(
│   │   │           │             widget.booking.boat!.name,
│   │   │           │             style: const TextStyle(
│   │   │           │                 fontSize: 28,
│   │   │           │                 fontWeight: FontWeight.w800,
│   │   │           │                 color: Color(0xFF1A1A2E)),
│   │   │           │           ),
│   │   │           │           const SizedBox(height: 8),
│   │   │           │           Text(
│   │   │           │             widget.booking.boat!.boatType,
│   │   │           │             style: TextStyle(fontSize: 16, color: Colors.grey.shade700),
│   │   │           │           ),
│   │   │           │         ],
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Rating Input Section ---
│   │   │           │     Widget _buildRatingInputSection(BuildContext context) {
│   │   │           │       return Container(
│   │   │           │         decoration: BoxDecoration(
│   │   │           │           color: Colors.white,
│   │   │           │           borderRadius: BorderRadius.circular(24),
│   │   │           │           boxShadow: [
│   │   │           │             BoxShadow(
│   │   │           │                 color: Colors.grey.shade200,
│   │   │           │                 blurRadius: 10,
│   │   │           │                 offset: const Offset(0, 5))
│   │   │           │           ],
│   │   │           │         ),
│   │   │           │         child: Padding(
│   │   │           │           padding: const EdgeInsets.all(24.0),
│   │   │           │           child: Column(
│   │   │           │             crossAxisAlignment: CrossAxisAlignment.stretch,
│   │   │           │             children: [
│   │   │           │               Text(
│   │   │           │                 'rate_your_experience_title'.i18n(),
│   │   │           │                 style: const TextStyle(
│   │   │           │                     fontSize: 20,
│   │   │           │                     fontWeight: FontWeight.w800,
│   │   │           │                     color: Color(0xFF1A1A2E)),
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 20),
│   │   │           │               Text(
│   │   │           │                 'rate_experience_prompt'.i18n(),
│   │   │           │                 style: TextStyle(color: Colors.grey.shade700),
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 12),
│   │   │           │               _buildRatingStarsInput(), // Star input widget
│   │   │           │               const SizedBox(height: 20),
│   │   │           │               TextFormField(
│   │   │           │                 // Comment input
│   │   │           │                 controller: _reviewCommentController,
│   │   │           │                 maxLines: 4, // Allow more lines for comments
│   │   │           │                 textCapitalization: TextCapitalization.sentences,
│   │   │           │                 decoration: InputDecoration(
│   │   │           │                   hintText: 'review_comment_hint'.i18n(),
│   │   │           │                   hintStyle: TextStyle(color: Colors.grey.shade500),
│   │   │           │                   border:
│   │   │           │                       OutlineInputBorder(borderRadius: BorderRadius.circular(12)),
│   │   │           │                   enabledBorder: OutlineInputBorder(
│   │   │           │                     borderRadius: BorderRadius.circular(12),
│   │   │           │                     borderSide: BorderSide(color: Colors.grey.shade300),
│   │   │           │                   ),
│   │   │           │                   focusedBorder: OutlineInputBorder(
│   │   │           │                     // Highlight on focus
│   │   │           │                     borderRadius: BorderRadius.circular(12),
│   │   │           │                     borderSide: BorderSide(
│   │   │           │                         color: Theme.of(context).colorScheme.primary, width: 1.5),
│   │   │           │                   ),
│   │   │           │                 ),
│   │   │           │               ),
│   │   │           │               const SizedBox(height: 24),
│   │   │           │               ElevatedButton(
│   │   │           │                 // --- Use _isSubmitting state and call _submitReview ---
│   │   │           │                 onPressed: _isSubmitting ? null : _submitReview,
│   │   │           │                 style: ElevatedButton.styleFrom(
│   │   │           │                   padding: const EdgeInsets.symmetric(vertical: 16),
│   │   │           │                   shape: RoundedRectangleBorder(
│   │   │           │                       borderRadius: BorderRadius.circular(16)),
│   │   │           │                   backgroundColor: Theme.of(context).colorScheme.primary,
│   │   │           │                   foregroundColor: Colors.white,
│   │   │           │                   disabledBackgroundColor: Theme.of(context)
│   │   │           │                       .colorScheme
│   │   │           │                       .primary
│   │   │           │                       .withOpacity(0.6), // Disabled style
│   │   │           │                 ),
│   │   │           │                 child: _isSubmitting
│   │   │           │                     ? const SizedBox(
│   │   │           │                         // Loading indicator
│   │   │           │                         width: 20, height: 20,
│   │   │           │                         child: CircularProgressIndicator(
│   │   │           │                             strokeWidth: 2.5, color: Colors.white),
│   │   │           │                       )
│   │   │           │                     : Text(
│   │   │           │                         'submit_review_button'.i18n(),
│   │   │           │                         style: const TextStyle(
│   │   │           │                             fontWeight: FontWeight.w700, fontSize: 16),
│   │   │           │                       ),
│   │   │           │               ),
│   │   │           │             ],
│   │   │           │           ),
│   │   │           │         ),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- Star Rating Input Widget ---
│   │   │           │     Widget _buildRatingStarsInput() {
│   │   │           │       return Row(
│   │   │           │         mainAxisAlignment: MainAxisAlignment.center, // Center the stars
│   │   │           │         children: List.generate(5, (index) {
│   │   │           │           return IconButton(
│   │   │           │             icon: Icon(
│   │   │           │               // Filled star if index < selected rating, otherwise border
│   │   │           │               index < _userRating
│   │   │           │                   ? Icons.star_rounded
│   │   │           │                   : Icons.star_border_rounded,
│   │   │           │               color: Colors.amber,
│   │   │           │               size: 40, // Make stars larger for easier tapping
│   │   │           │             ),
│   │   │           │             onPressed: _isSubmitting
│   │   │           │                 ? null
│   │   │           │                 : () {
│   │   │           │                     // Disable stars while submitting
│   │   │           │                     setState(() {
│   │   │           │                       _userRating = index +
│   │   │           │                           1.0; // Set rating (add 1 because index is 0-based)
│   │   │           │                     });
│   │   │           │                   },
│   │   │           │           );
│   │   │           │         }),
│   │   │           │       );
│   │   │           │     }
│   │   │           │   
│   │   │           │     // --- SnackBar Utility ---
│   │   │           │     void _showSnackBar(BuildContext context, String message,
│   │   │           │         {bool isError = false}) {
│   │   │           │       if (isError) {
│   │   │           │         SnackBarUtil.showErrorSnackBar(message: message, title: '');
│   │   │           │       } else {
│   │   │           │         SnackBarUtil.showSuccessSnackBar(message: message, title: '');
│   │   │           │       }
│   │   │           │     }
│   │   │           │   }
│   ├── models/
│   │   ├── auth_token.dart
│   │   │   │   import 'package:flutter/foundation.dart' show immutable;
│   │   │   │   import 'package:app/models/user.dart';
│   │   │   │   
│   │   │   │   @immutable
│   │   │   │   class AuthToken {
│   │   │   │     final String access;
│   │   │   │     final String refresh;
│   │   │   │     final User? user;
│   │   │   │     final int userId;
│   │   │   │     final String userEmail;
│   │   │   │     final bool userIsActive;
│   │   │   │   
│   │   │   │     const AuthToken({
│   │   │   │       required this.access,
│   │   │   │       required this.refresh,
│   │   │   │       this.user,
│   │   │   │       required this.userId,
│   │   │   │       required this.userEmail,
│   │   │   │       required this.userIsActive,
│   │   │   │     });
│   │   │   │   
│   │   │   │     factory AuthToken.fromJson(Map<String, dynamic> json) {
│   │   │   │       User? userObj;
│   │   │   │   
│   │   │   │       if (json.containsKey('user')) {
│   │   │   │         userObj = User.fromJson(json['user']);
│   │   │   │       }
│   │   │   │   
│   │   │   │       return AuthToken(
│   │   │   │         access: 'access'] as String,
│   │   │   │         refresh: json['refresh'] as String,
│   │   │   │         user: userObj,
│   │   │   │         userId: json.containsKey('user_id')
│   │   │   │             ? json['user_id'] as int
│   │   │   │             : json['user']['id'] as int,
│   │   │   │         userEmail: json.containsKey('user_email')
│   │   │   │             ? json['user_email'] as String
│   │   │   │             : json['user']['email'] as String,
│   │   │   │         userIsActive: json.containsKey('user_is_active')
│   │   │   │             ? json['user_is_active'] as bool
│   │   │   │             : json['user']['is_active'] as bool,
│   │   │   │       );
│   │   │   │     }
│   │   │   │   }
│   │   ├── boat.dart
│   │   │   │   import 'package:app/models/boat_image.dart';
│   │   │   │   import 'package:app/models/user.dart';
│   │   │   │   import 'package:flutter/foundation.dart' show immutable;
│   │   │   │   
│   │   │   │   @immutable
│   │   │   │   class Boat {
│   │   │   │     final int id;
│   │   │   │     final String name;
│   │   │   │     final String boatType;
│   │   │   │     final String? description;
│   │   │   │     final double? length; // Nullable
│   │   │   │     final int? capacity; // Nullable
│   │   │   │     final int? cabins; // Nullable
│   │   │   │     final String?
│   │   │   │         mainImageUrl; // Nullable (based on BoatListSerializer and main_image field)
│   │   │   │     final List<BoatImage>? images; // Nullable (only present in detail view)
│   │   │   │     final double rentalPricePerDay;
│   │   │   │     final double averageRating;
│   │   │   │     final String locationDescription;
│   │   │   │     final double? latitude; // Nullable
│   │   │   │     final double? longitude; // Nullable
│   │   │   │     final String? driverName; // Nullable
│   │   │   │     final String? driverDetails; // Nullable
│   │   │   │     final bool driverAvailable;
│   │   │   │     final String status; // 'ACTIVE', 'INACTIVE', 'DRAFT'
│   │   │   │     final DateTime? createdAt; // Nullable (only present in detail view)
│   │   │   │     final DateTime? updatedAt; // Nullable (only present in detail view)
│   │   │   │     final User? owner; // Nullable (only present in detail view)
│   │   │   │     final String? ownerEmail; // Nullable (only present in list view)
│   │   │   │     final double? rating;
│   │   │   │   
│   │   │   │     const Boat({
│   │   │   │       required this.id,
│   │   │   │       required this.name,
│   │   │   │       required this.boatType,
│   │   │   │       this.description,
│   │   │   │       this.length,
│   │   │   │       this.capacity,
│   │   │   │       this.cabins,
│   │   │   │       this.mainImageUrl,
│   │   │   │       this.images,
│   │   │   │       required this.rentalPricePerDay,
│   │   │   │       required this.averageRating,
│   │   │   │       required this.locationDescription,
│   │   │   │       this.latitude,
│   │   │   │       this.longitude,
│   │   │   │       this.driverName,
│   │   │   │       this.driverDetails,
│   │   │   │       required this.driverAvailable,
│   │   │   │       required this.status,
│   │   │   │       this.createdAt,
│   │   │   │       this.updatedAt,
│   │   │   │       this.owner,
│   │   │   │       this.ownerEmail,
│   │   │   │       this.rating,
│   │   │   │     });
│   │   │   │   
│   │   │   │     // Factory constructor to handle both list and detail JSON structures
│   │   │   │     factory Boat.fromJson(Map<String, dynamic> json) {
│   │   │   │       // Helper function to safely parse double
│   │   │   │       double? tryParseDouble(dynamic value) {
│   │   │   │         if (value is String) {
│   │   │   │           return double.tryParse(value);
│   │   │   │         } else if (value is num) {
│   │   │   │           return value.toDouble();
│   │   │   │         }
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │   
│   │   │   │       // Helper function to safely parse int
│   │   │   │       int? tryParseInt(dynamic value) {
│   │   │   │         if (value is String) {
│   │   │   │           return int.tryParse(value);
│   │   │   │         } else if (value is num) {
│   │   │   │           return value.toInt();
│   │   │   │         }
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │   
│   │   │   │       // Parse images list if present
│   │   │   │       List<BoatImage>? parsedImages;
│   │   │   │       if (json['images'] != null && json['images'] is List) {
│   │   │   │         parsedImages = (json['images'] as List)
│   │   │   │             .map((imgJson) => BoatImage.fromJson(imgJson as Map<String, dynamic>))
│   │   │   │             .toList();
│   │   │   │       }
│   │   │   │   
│   │   │   │       // Parse owner if present
│   │   │   │       User? parsedOwner;
│   │   │   │       if (json['owner'] != null && json['owner'] is Map) {
│   │   │   │         parsedOwner = User.fromJson(json['owner'] as Map<String, dynamic>);
│   │   │   │       } else {
│   │   │   │         print("owner null");
│   │   │   │       }
│   │   │   │       print(tryParseDouble(json['rating']));
│   │   │   │   
│   │   │   │       return Boat(
│   │   │   │         id: json['id'] as int,
│   │   │   │         name: json['name'] as String,
│   │   │   │         boatType: json['boat_type'] as String,
│   │   │   │         description: json['description'] as String?,
│   │   │   │         length: tryParseDouble(json['length']),
│   │   │   │         capacity: tryParseInt(json['capacity']),
│   │   │   │         cabins: tryParseInt(json['cabins']),
│   │   │   │         // Handle both main_image_url (list) and main_image (detail)
│   │   │   │         mainImageUrl:
│   │   │   │             json['main_image_url'] as String? ?? json['main_image'] as String?,
│   │   │   │         images: parsedImages,
│   │   │   │         rentalPricePerDay: tryParseDouble(json['rental_price_per_day']) ?? 0.0,
│   │   │   │         averageRating: tryParseDouble(json['average_rating']) ?? 0.0,
│   │   │   │         locationDescription: json['location_description'] as String? ??
│   │   │   │             '', // Handle potential null
│   │   │   │         latitude: tryParseDouble(json['latitude']),
│   │   │   │         longitude: tryParseDouble(json['longitude']),
│   │   │   │         driverName: json['driver_name'] as String?,
│   │   │   │         driverDetails: json['driver_details'] as String?,
│   │   │   │         driverAvailable:
│   │   │   │             json['driver_available'] as bool? ?? false, // Provide default
│   │   │   │         status: json['status'] as String? ?? 'DRAFT', // Provide default
│   │   │   │         createdAt: json['created_at'] == null
│   │   │   │             ? null
│   │   │   │             : DateTime.parse(json['created_at'] as String),
│   │   │   │         updatedAt: json['updated_at'] == null
│   │   │   │             ? null
│   │   │   │             : DateTime.parse(json['updated_at'] as String),
│   │   │   │         owner: parsedOwner,
│   │   │   │         ownerEmail: json['owner_email'] as String?,
│   │   │   │         rating: tryParseDouble(json['rating']),
│   │   │   │       );
│   │   │   │     }
│   │   │   │     List<String> get imageUrls {
│   │   │   │       if (images != null && images!.isNotEmpty) {
│   │   │   │         return images!.map((image) => image.imageUrl).toList();
│   │   │   │       } else {
│   │   │   │         return [];
│   │   │   │       }
│   │   │   │     }
│   │   │   │   }
│   │   ├── boat_image.dart
│   │   │   │   
│   │   │   │   
│   │   │   │   import 'package:flutter/foundation.dart' show immutable;
│   │   │   │   
│   │   │   │   @immutable
│   │   │   │   class BoatImage {
│   │   │   │     final int id;
│   │   │   │     final String imageUrl; // The 'image' field from serializer likely holds the URL
│   │   │   │     final String? caption; // Nullable (blank=True in model)
│   │   │   │     final DateTime uploadedAt;
│   │   │   │   
│   │   │   │     const BoatImage({
│   │   │   │       required this.id,
│   │   │   │       required this.imageUrl,
│   │   │   │       this.caption,
│   │   │   │       required this.uploadedAt,
│   │   │   │     });
│   │   │   │   
│   │   │   │     factory BoatImage.fromJson(Map<String, dynamic> json) {
│   │   │   │       return BoatImage(
│   │   │   │         id: json['id'] as int,
│   │   │   │         imageUrl: json['image'] as String, // Assuming 'image' key holds the URL
│   │   │   │         caption: json['caption'] as String?,
│   │   │   │         uploadedAt: DateTime.parse(json['uploaded_at'] as String),
│   │   │   │       );
│   │   │   │     }
│   │   │   │   }
│   │   ├── booking.dart
│   │   │   │   import 'package:app/models/boat.dart';
│   │   │   │   import 'package:app/models/user.dart';
│   │   │   │   import 'package:flutter/foundation.dart' show immutable;
│   │   │   │   
│   │   │   │   @immutable
│   │   │   │   class Booking {
│   │   │   │     final int id;
│   │   │   │     final String bookingId;
│   │   │   │     final DateTime startDate;
│   │   │   │     final DateTime endDate;
│   │   │   │     final int? passengerCount; // Present in detail
│   │   │   │     final double totalPrice;
│   │   │   │     final String? specialRequests; // Present in detail, nullable
│   │   │   │     final String status;
│   │   │   │     final String? paymentStatus; // Present in detail, nullable
│   │   │   │     final String? paymentIntentId; // Present in detail, nullable
│   │   │   │     final DateTime createdAt;
│   │   │   │     final DateTime? updatedAt; // Present in detail, nullable
│   │   │   │   
│   │   │   │     // Fields from related objects (present in different serializers)
│   │   │   │     final User? renter; // Present in detail
│   │   │   │     final Boat? boat; // Present in detail (summary via BoatListSerializer)
│   │   │   │     final String? boatName; // Present in list
│   │   │   │     final String? boatImageUrl; // Present in list
│   │   │   │     final String? renterEmail; // Present in list
│   │   │   │   
│   │   │   │     const Booking({
│   │   │   │       required this.id,
│   │   │   │       required this.bookingId,
│   │   │   │       required this.startDate,
│   │   │   │       required this.endDate,
│   │   │   │       this.passengerCount,
│   │   │   │       required this.totalPrice,
│   │   │   │       this.specialRequests,
│   │   │   │       required this.status,
│   │   │   │       this.paymentStatus,
│   │   │   │       this.paymentIntentId,
│   │   │   │       required this.createdAt,
│   │   │   │       this.updatedAt,
│   │   │   │       this.renter,
│   │   │   │       this.boat,
│   │   │   │       this.boatName,
│   │   │   │       this.boatImageUrl,
│   │   │   │       this.renterEmail,
│   │   │   │     });
│   │   │   │   
│   │   │   │     factory Booking.fromJson(Map<String, dynamic> json) {
│   │   │   │       // Helper function to safely parse double
│   │   │   │       double? tryParseDouble(dynamic value) {
│   │   │   │         if (value is String) {
│   │   │   │           return double.tryParse(value);
│   │   │   │         } else if (value is num) {
│   │   │   │           return value.toDouble();
│   │   │   │         }
│   │   │   │         return null;
│   │   │   │       }
│   │   │   │   
│   │   │   │       // Parse renter if present
│   │   │   │       User? parsedRenter;
│   │   │   │       if (json['renter'] != null && json['renter'] is Map) {
│   │   │   │         parsedRenter = User.fromJson(json['renter'] as Map<String, dynamic>);
│   │   │   │       }
│   │   │   │   
│   │   │   │       // Parse boat summary if present
│   │   │   │       Boat? parsedBoat;
│   │   │   │       if (json['boat'] != null && json['boat'] is Map) {
│   │   │   │         // Use the Boat.fromJson which can handle list/detail variations if needed
│   │   │   │         // Assuming the 'boat' field here follows the structure of BoatListSerializer
│   │   │   │         parsedBoat = Boat.fromJson(json['boat'] as Map<String, dynamic>);
│   │   │   │       }
│   │   │   │   
│   │   │   │       return Booking(
│   │   │   │         id: json['id'] as int,
│   │   │   │         bookingId: json['booking_id'] as String? ?? '', // Handle potential null
│   │   │   │         startDate: DateTime.parse(json['start_date'] as String),
│   │   │   │         endDate: DateTime.parse(json['end_date'] as String),
│   │   │   │         passengerCount: json['passenger_count'] as int?,
│   │   │   │         totalPrice: tryParseDouble(json['total_price']) ?? 0.0,
│   │   │   │         specialRequests: json['special_requests'] as String?,
│   │   │   │         status: json['status'] as String? ?? 'PENDING', // Provide default
│   │   │   │         paymentStatus: json['payment_status'] as String?,
│   │   │   │         paymentIntentId: json['payment_intent_id'] as String?,
│   │   │   │         createdAt: DateTime.parse(json['created_at'] as String),
│   │   │   │         updatedAt: json['updated_at'] == null
│   │   │   │             ? null
│   │   │   │             : DateTime.parse(json['updated_at'] as String),
│   │   │   │         renter: parsedRenter,
│   │   │   │         boat: parsedBoat,
│   │   │   │         boatName: json['boat_name'] as String?, // From list serializer
│   │   │   │         boatImageUrl: json['boat_image_url'] as String?, // From list serializer
│   │   │   │         renterEmail: json['renter_email'] as String?, // From list serializer
│   │   │   │       );
│   │   │   │     }
│   │   │   │   }
│   │   ├── chat_room.dart
│   │   │   │   import 'package:app/models/message.dart';
│   │   │   │   import 'package:app/models/user.dart';
│   │   │   │   import 'package:flutter/foundation.dart' show immutable;
│   │   │   │   
│   │   │   │   @immutable
│   │   │   │   class ChatRoom {
│   │   │   │     final int id;
│   │   │   │     final String? name; // Nullable
│   │   │   │     final List<User> participants;
│   │   │   │     final int? bookingId; // Nullable FK
│   │   │   │     final DateTime createdAt;
│   │   │   │     final Message? lastMessage; // Nullable
│   │   │   │     final int unreadCount;
│   │   │   │   
│   │   │   │     const ChatRoom({
│   │   │   │       required this.id,
│   │   │   │       this.name,
│   │   │   │       required this.participants,
│   │   │   │       this.bookingId,
│   │   │   │       required this.createdAt,
│   │   │   │       this.lastMessage,
│   │   │   │       required this.unreadCount,
│   │   │   │     });
│   │   │   │   
│   │   │   │     factory ChatRoom.fromJson(Map<String, dynamic> json) {
│   │   │   │       // Parse participants list
│   │   │   │       List<User> parsedParticipants = [];
│   │   │   │       if (json['participants'] != null && json['participants'] is List) {
│   │   │   │         parsedParticipants = (json['participants'] as List)
│   │   │   │             .map((userJson) => User.fromJson(userJson as Map<String, dynamic>))
│   │   │   │             .toList();
│   │   │   │       }
│   │   │   │   
│   │   │   │       // Parse last message if present
│   │   │   │       Message? parsedLastMessage;
│   │   │   │       if (json['last_message'] != null && json['last_message'] is Map) {
│   │   │   │         parsedLastMessage =
│   │   │   │             Message.fromJson(json['last_message'] as Map<String, dynamic>);
│   │   │   │       }
│   │   │   │   
│   │   │   │       return ChatRoom(
│   │   │   │         id: json['id'] as int,
│   │   │   │         name: json['name'] as String?,
│   │   │   │         participants: parsedParticipants,
│   │   │   │         bookingId: json['booking'] as int?, // Assuming 'booking' holds the ID
│   │   │   │         createdAt: DateTime.parse(json['created_at'] as String),
│   │   │   │         lastMessage: parsedLastMessage,
│   │   │   │         unreadCount: json['unread_count'] as int? ?? 0, // Handle potential null
│   │   │   │       );
│   │   │   │     }
│   │   │   │   }
│   │   ├── message.dart
│   │   │   │   import 'package:app/models/user.dart';
│   │   │   │   import 'package:flutter/foundation.dart' show debugPrint, immutable;
│   │   │   │   
│   │   │   │   @immutable
│   │   │   │   class Message {
│   │   │   │     final int id;
│   │   │   │     final int roomId; // FK ID
│   │   │   │     final User? sender; // Nullable (if sender deleted)
│   │   │   │     final String content;
│   │   │   │     final DateTime timestamp;
│   │   │   │     final bool isRead;
│   │   │   │   
│   │   │   │     const Message({
│   │   │   │       required this.id,
│   │   │   │       required this.roomId,
│   │   │   │       this.sender,
│   │   │   │       required this.content,
│   │   │   │       required this.timestamp,
│   │   │   │       required this.isRead,
│   │   │   │     });
│   │   │   │   
│   │   │   │     factory Message.fromJson(Map<String, dynamic> json) {
│   │   │   │       // Parse sender if present
│   │   │   │       User? parsedSender;
│   │   │   │       if (json['sender'] != null && json['sender'] is Map) {
│   │   │   │         parsedSender =
│   │   │   │             User.fromJsonForChatting(json['sender'] as Map<String, dynamic>);
│   │   │   │       }
│   │   │   │   
│   │   │   │       return Message(
│   │   │   │         id: json['id'] as int,
│   │   │   │         roomId: json['room'] as int, // Assuming 'room' holds the ID
│   │   │   │         sender: parsedSender,
│   │   │   │         content: json['content'] as String,
│   │   │   │         timestamp: DateTime.parse(json['timestamp'] as String),
│   │   │   │         isRead: json['is_read'] as bool? ?? false, // Handle potential null
│   │   │   │       );
│   │   │   │     }
│   │   │   │   }
│   │   ├── review.dart
│   │   │   │   import 'package:app/models/boat.dart';
│   │   │   │   import 'package:app/models/user.dart';
│   │   │   │   import 'package:flutter/foundation.dart' show immutable;
│   │   │   │   
│   │   │   │   @immutable
│   │   │   │   class Review {
│   │   │   │     final int id;
│   │   │   │     final int rating; // 1-5
│   │   │   │     final String? comment; // Nullable
│   │   │   │     final DateTime createdAt;
│   │   │   │     final User? renter; // Nested User details
│   │   │   │     final Boat? boatSummary; // Nested Boat summary
│   │   │   │   
│   │   │   │     const Review({
│   │   │   │       required this.id,
│   │   │   │       required this.rating,
│   │   │   │       this.comment,
│   │   │   │       required this.createdAt,
│   │   │   │       this.renter,
│   │   │   │       this.boatSummary,
│   │   │   │     });
│   │   │   │   
│   │   │   │     factory Review.fromJson(Map<String, dynamic> json) {
│   │   │   │       // Parse renter if present
│   │   │   │       User? parsedRenter;
│   │   │   │       if (json['renter'] != null && json['renter'] is Map) {
│   │   │   │         parsedRenter = User.fromJson(json['renter'] as Map<String, dynamic>);
│   │   │   │       }
│   │   │   │   
│   │   │   │       // Parse boat summary if present
│   │   │   │       Boat? parsedBoatSummary;
│   │   │   │       if (json['boat_summary'] != null && json['boat_summary'] is Map) {
│   │   │   │         parsedBoatSummary =
│   │   │   │             Boat.fromJson(json['boat_summary'] as Map<String, dynamic>);
│   │   │   │       }
│   │   │   │   
│   │   │   │       return Review(
│   │   │   │         id: json['id'] as int,
│   │   │   │         rating: json['rating'] as int,
│   │   │   │         comment: json['comment'] as String?,
│   │   │   │         createdAt: DateTime.parse(json['created_at'] as String),
│   │   │   │         renter: parsedRenter,
│   │   │   │         boatSummary: parsedBoatSummary,
│   │   │   │       );
│   │   │   │     }
│   │   │   │   }
│   │   └── user.dart
│   │       │   import 'package:flutter/foundation.dart' show immutable;
│   │       │   
│   │       │   @immutable
│   │       │   class User {
│   │       │     final int id;
│   │       │     final String email;
│   │       │     final String firstName;
│   │       │     final String lastName;
│   │       │     final String role; // 'RENTER' or 'OWNER'
│   │       │     final bool isActive;
│   │       │     final DateTime dateJoined;
│   │       │     final DateTime? lastLogin; // Nullable as it might not always be present
│   │       │     final bool isOwner;
│   │       │     final bool isRenter;
│   │       │   
│   │       │     const User({
│   │       │       required this.id,
│   │       │       required this.email,
│   │       │       required this.firstName,
│   │       │       required this.lastName,
│   │       │       required this.role,
│   │       │       required this.isActive,
│   │       │       required this.dateJoined,
│   │       │       this.lastLogin,
│   │       │       required this.isOwner,
│   │       │       required this.isRenter,
│   │       │     });
│   │       │   
│   │       │     factory User.fromJson(Map<String, dynamic> json) {
│   │       │       return User(
│   │       │         id: json['id'] as int,
│   │       │         email: json['email'] ?? '',
│   │       │         firstName: json['first_name'] as String,
│   │       │         lastName: json['last_name'] as String,
│   │       │         role: json['role'] ?? '',
│   │       │         isActive: json['is_active'] != null ? json['is_active'] as bool : false,
│   │       │         dateJoined: DateTime.parse(json['date_joined'] as String),
│   │       │         // Handle nullable DateTime
│   │       │         lastLogin: json['last_login'] == null
│   │       │             ? null
│   │       │             : DateTime.parse(json['last_login'] as String),
│   │       │         isOwner: json['is_owner'] as bool,
│   │       │         isRenter: json['is_renter'] as bool,
│   │       │       );
│   │       │     }
│   │       │     factory User.fromJsonForChatting(Map<String, dynamic> json) {
│   │       │       return User(
│   │       │         id: json['id'] as int,
│   │       │         email: json['email'] ?? '',
│   │       │         firstName: json['first_name'] as String,
│   │       │         lastName: json['last_name'] as String,
│   │       │         role: '',
│   │       │         isActive: true,
│   │       │         dateJoined: DateTime.now(),
│   │       │         // Handle nullable DateTime
│   │       │         lastLogin: null,
│   │       │         isOwner: false,
│   │       │         isRenter: false,
│   │       │       );
│   │       │     }
│   │       │     String get fullName => '$firstName $lastName';
│   │       │   
│   │       │     @override
│   │       │     String toString() {
│   │       │       return 'User(id: $id, email: $email, firstName: $firstName, lastName: $lastName, role: $role, isActive: $isActive, dateJoined: $dateJoined, lastLogin: $lastLogin, isOwner: $isOwner, isRenter: $isRenter)';
│   │       │     }
│   │       │   }
│   ├── services/
│   │   └── chat.dart
│   │       │   import 'dart:async';
│   │       │   import 'dart:convert';
│   │       │   import 'package:flutter/foundation.dart';
│   │       │   import 'package:web_socket_channel/web_socket_channel.dart';
│   │       │   import 'package:web_socket_channel/status.dart' as status;
│   │       │   import 'package:app/models/message.dart'; // Adjust import path
│   │       │   import 'package:app/config/api_config.dart'; // Adjust import path
│   │       │   import 'package:app/controllers/chat.dart';
│   │       │   
│   │       │   class ChatService {
│   │       │     WebSocketChannel? _channel;
│   │       │     StreamSubscription? _channelSubscription;
│   │       │     final ChatController _restController = ChatController(); // To load history
│   │       │   
│   │       │     // Controller to broadcast the list of messages
│   │       │     final StreamController<List<Message>> _messagesController =
│   │       │         StreamController<List<Message>>.broadcast();
│   │       │   
│   │       │     // Stream for the UI to listen to
│   │       │     Stream<List<Message>> get messagesStream => _messagesController.stream;
│   │       │   
│   │       │     // Internal list holding the messages
│   │       │     final List<Message> _messages = [];
│   │       │     bool _isLoadingHistory = false;
│   │       │     bool _isConnected = false;
│   │       │     int? _currentRoomId;
│   │       │     String? _currentToken;
│   │       │   
│   │       │     bool get isConnected => _isConnected;
│   │       │     bool get isLoadingHistory => _isLoadingHistory;
│   │       │   
│   │       │     /// Connects to the WebSocket server for a specific chat room
│   │       │     /// and fetches initial message history.
│   │       │     Future<void> connect(int roomId, String accessToken) async {
│   │       │       if (_isConnected && _currentRoomId == roomId) {
│   │       │         debugPrint("ChatService: Already connected to room $roomId");
│   │       │         return; // Already connected to this room
│   │       │       }
│   │       │   
│   │       │       // Disconnect from previous room if any
│   │       │       await disconnect();
│   │       │   
│   │       │       debugPrint("ChatService: Connecting to room $roomId...");
│   │       │       _currentRoomId = roomId;
│   │       │       _currentToken = accessToken;
│   │       │       _isLoadingHistory = true;
│   │       │       _messages.clear();
│   │       │       _messagesController.add(_messages); // Notify UI about cleared list/loading
│   │       │   
│   │       │       // 1. Fetch initial message history via REST
│   │       │       await _fetchInitialMessages(roomId, accessToken);
│   │       │       _isLoadingHistory = false;
│   │       │       // Add the loaded messages to the stream *before* connecting WS
│   │       │       _messagesController.add(List<Message>.from(_messages));
│   │       │   
│   │       │       // 2. Establish WebSocket Connection
│   │       │       final wsUrl = Uri.parse(
│   │       │           "${ApiConfig.baseUrl.replaceFirst('http', 'ws')}/ws/chat/$roomId/?token=");
│   │       │   
│   │       │       try {
│   │       │         _channel = WebSocketChannel.connect(wsUrl);
│   │       │         _isConnected = true; // Assume connected initially
│   │       │         debugPrint(
│   │       │             "ChatService: WebSocket connection established for room $roomId.");
│   │       │   
│   │       │         _channelSubscription = _channel!.stream.listen(
│   │       │           (data) {
│   │       │             _handleIncomingData(data);
│   │       │           },
│   │       │           onError: (error) {
│   │       │             debugPrint("ChatService: WebSocket Error: $error");
│   │       │             // Handle error, maybe try reconnecting or notify UI
│   │       │             _isConnected = false;
│   │       │             _messagesController.addError('Connection error: $error');
│   │       │             disconnect(); // Clean up on error
│   │       │           },
│   │       │           onDone: () {
│   │       │             debugPrint(
│   │       │                 "ChatService: WebSocket connection closed for room $roomId.");
│   │       │             _isConnected = false;
│   │       │             // Optionally notify UI that connection is closed
│   │       │             disconnect(); // Clean up fully
│   │       │           },
│   │       │           cancelOnError: true,
│   │       │         );
│   │       │         // Mark messages as read upon connecting (or potentially after loading history)
│   │       │         await markMessagesRead();
│   │       │       } catch (e) {
│   │       │         debugPrint("ChatService: Failed to connect WebSocket: $e");
│   │       │         _isLoadingHistory = false; // Ensure loading is reset
│   │       │         _messagesController.addError('Failed to connect: $e');
│   │       │         await disconnect(); // Ensure cleanup
│   │       │       }
│   │       │     }
│   │       │   
│   │       │     /// Handles incoming WebSocket data
│   │       │     void _handleIncomingData(dynamic data) {
│   │       │       debugPrint("ChatService: Received data: $data");
│   │       │       try {
│   │       │         final Map<String, dynamic> jsonData = jsonDecode(data as String);
│   │       │         // Check if it's a message broadcast or another type (like read confirmation)
│   │       │         if (jsonData.containsKey('content') && jsonData.containsKey('sender')) {
│   │       │           ;
│   │       │           final message = Message.fromJson(jsonData);
│   │       │           // Avoid adding duplicate messages if echo is on
│   │       │           if (!_messages.any((m) => m.id == message.id)) {
│   │       │             debugPrint("step 3");
│   │       │             _messages.insert(0, message); // Add to start for newest first display
│   │       │             _messages.sort(
│   │       │                 (a, b) => b.timestamp.compareTo(a.timestamp)); // Keep sorted
│   │       │             _messagesController.add(List<Message>.from(_messages)); // Notify UI
│   │       │           }
│   │       │         } else if (jsonData['type'] == 'read_status') {
│   │       │           debugPrint("ChatService: Received read status: ${jsonData['message']}");
│   │       │           // Optionally update UI based on read status confirmation
│   │       │         } else {
│   │       │           debugPrint("ChatService: Received unknown message format: $jsonData");
│   │       │         }
│   │       │       } catch (e) {
│   │       │         debugPrint("ChatService: Error processing message data: $e");
│   │       │         debugPrint("ChatService: Raw data was: $data");
│   │       │       }
│   │       │     }
│   │       │   
│   │       │     /// Fetches historical messages using the REST controller
│   │       │     Future<void> _fetchInitialMessages(int roomId, String accessToken) async {
│   │       │       debugPrint("ChatService: Fetching initial messages for room $roomId...");
│   │       │       try {
│   │       │         final history = await _restController.fetchMessages(roomId, accessToken);
│   │       │         _messages.addAll(history);
│   │       │         _messages.sort(
│   │       │             (a, b) => b.timestamp.compareTo(a.timestamp)); // Sort newest first
│   │       │         debugPrint("ChatService: Fetched ${history.length} initial messages.");
│   │       │       } catch (e) {
│   │       │         debugPrint("ChatService: Error fetching initial messages: $e");
│   │       │         _messagesController.addError('Failed to load history: $e');
│   │       │       }
│   │       │     }
│   │       │   
│   │       │     /// Sends a chat message through the WebSocket.
│   │       │     void sendMessage(String content) {
│   │       │       if (!_isConnected || _channel == null) {
│   │       │         debugPrint("ChatService: Cannot send message, not connected.");
│   │       │         // TODO: Handle this error state - maybe queue message or show error?
│   │       │         return;
│   │       │       }
│   │       │       if (content.trim().isEmpty) {
│   │       │         return; // Don't send empty messages
│   │       │       }
│   │       │   
│   │       │       final messageData = jsonEncode({
│   │       │         'message': content, // Backend consumer expects this structure
│   │       │       });
│   │       │   
│   │       │       debugPrint("ChatService: Sending message: $messageData");
│   │       │       try {
│   │       │         _channel!.sink.add(messageData);
│   │       │       } catch (e) {
│   │       │         debugPrint("ChatService: Error sending message: $e");
│   │       │         _messagesController.addError('Failed to send message: $e');
│   │       │       }
│   │       │     }
│   │       │   
│   │       │     /// Sends a request via WebSocket to mark messages in the current room as read.
│   │       │     Future<void> markMessagesRead() async {
│   │       │       if (!_isConnected || _channel == null) {
│   │       │         debugPrint("ChatService: Cannot mark read, not connected.");
│   │       │         // Try REST as fallback? Or just fail? Let's just fail for now.
│   │       │         return;
│   │       │       }
│   │       │       final markReadData = jsonEncode({'type': 'mark_read'});
│   │       │       debugPrint(
│   │       │           "ChatService: Sending mark_read request for room $_currentRoomId");
│   │       │       try {
│   │       │         _channel!.sink.add(markReadData);
│   │       │       } catch (e) {
│   │       │         debugPrint("ChatService: Error sending mark_read request: $e");
│   │       │         // Optionally notify UI of the error
│   │       │       }
│   │       │   
│   │       │       // Update local state immediately (optimistic UI update)
│   │       │       bool changed = false;
│   │       │       for (var msg in _messages) {
│   │       │         // Only mark as read if it wasn't sent by the current user
│   │       │         // Note: We don't have the current user ID easily here,
│   │       │         // so this optimistic update might mark own messages visually read.
│   │       │         // Relying on receiving updated messages might be better, but slower UX.
│   │       │         // Let's assume the backend handles the logic and potentially echoes
│   │       │         // updated message statuses if needed. For now, we just send the request.
│   │       │       }
│   │       │       // if (changed) {
│   │       │       //   _messagesController.add(List<Message>.from(_messages));
│   │       │       // }
│   │       │     }
│   │       │   
│   │       │     /// Closes the WebSocket connection and cleans up resources.
│   │       │     Future<void> disconnect() async {
│   │       │       debugPrint("ChatService: Disconnecting from room $_currentRoomId...");
│   │       │       await _channelSubscription?.cancel();
│   │       │       try {
│   │       │         await _channel?.sink.close(status.goingAway);
│   │       │       } catch (e) {
│   │       │         debugPrint("ChatService: Error closing WebSocket sink: $e");
│   │       │       }
│   │       │       _channel = null;
│   │       │       _channelSubscription = null;
│   │       │       _isConnected = false;
│   │       │       _currentRoomId = null;
│   │       │       _currentToken = null;
│   │       │       _messages.clear(); // Clear messages on disconnect
│   │       │       if (!_messagesController.isClosed) {
│   │       │         _messagesController.add([]); // Notify UI about cleared list
│   │       │       }
│   │       │       debugPrint("ChatService: Disconnected.");
│   │       │     }
│   │       │   
│   │       │     /// Closes the stream controller when the service is no longer needed.
│   │       │     void dispose() {
│   │       │       debugPrint("ChatService: Disposing.");
│   │       │       disconnect(); // Ensure connection is closed
│   │       │       _messagesController.close();
│   │       │     }
│   │       │   }
│   ├── utils/
│   │   └── snackbar.dart
│   │       │   import 'package:flutter/material.dart';
│   │       │   import 'package:get/get.dart';
│   │       │   
│   │       │   class SnackBarUtil {
│   │       │     static void showErrorSnackBar(
│   │       │         {required String message, required String title}) {
│   │       │       Get.snackbar(
│   │       │         '',
│   │       │         '',
│   │       │         backgroundColor: Colors.red,
│   │       │         colorText: Colors.white,
│   │       │         duration: const Duration(seconds: 3),
│   │       │         snackPosition: SnackPosition.BOTTOM,
│   │       │         titleText: const Text(
│   │       │           'Error',
│   │       │           style: TextStyle(
│   │       │             fontWeight: FontWeight.bold,
│   │       │             color: Colors.white,
│   │       │           ),
│   │       │         ),
│   │       │         messageText: Text(
│   │       │           message,
│   │       │           style: const TextStyle(
│   │       │             color: Colors.white,
│   │       │           ),
│   │       │         ),
│   │       │         animationDuration: const Duration(milliseconds: 300),
│   │       │         forwardAnimationCurve: Curves.easeIn,
│   │       │         reverseAnimationCurve: Curves.easeOut,
│   │       │         margin: const EdgeInsets.only(bottom: 12, left: 12, right: 12),
│   │       │       );
│   │       │     }
│   │       │   
│   │       │     static void showSuccessSnackBar(
│   │       │         {required String message, required String title}) {
│   │       │       Get.snackbar(
│   │       │         '',
│   │       │         '',
│   │       │         backgroundColor: Colors.green,
│   │       │         colorText: Colors.white,
│   │       │         duration: const Duration(seconds: 3),
│   │       │         snackPosition: SnackPosition.BOTTOM,
│   │       │         titleText: const Text(
│   │       │           'Success',
│   │       │           style: TextStyle(
│   │       │             fontWeight: FontWeight.bold,
│   │       │             color: Colors.white,
│   │       │           ),
│   │       │         ),
│   │       │         messageText: Text(
│   │       │           message,
│   │       │           style: const TextStyle(
│   │       │             color: Colors.white,
│   │       │           ),
│   │       │         ),
│   │       │         animationDuration: const Duration(milliseconds: 300),
│   │       │         forwardAnimationCurve: Curves.easeIn,
│   │       │         reverseAnimationCurve: Curves.easeOut,
│   │       │         margin: const EdgeInsets.only(bottom: 12, left: 12, right: 12),
│   │       │       );
│   │       │     }
│   │       │   }
│   ├── widgets/
│   │   └── drawer.dart
│   │       │   // lib/widgets/app_drawer.dart
│   │       │   import 'package:app/controllers/auth.dart';
│   │       │   import 'package:app/features/auth/login/screen.dart';
│   │       │   import 'package:flutter/material.dart';
│   │       │   import 'package:get/get.dart';
│   │       │   import 'package:localization/localization.dart';
│   │       │   import 'package:app/app/theme.dart'; // Access theme colors if needed
│   │       │   import 'package:flutter/services.dart'; // For haptic feedback
│   │       │   import 'dart:ui';
│   │       │   import 'dart:math' show min;
│   │       │   
│   │       │   // Import Screens for Navigation
│   │       │   import 'package:app/features/home/screen.dart';
│   │       │   import 'package:app/features/owner/boats/list/screen.dart'
│   │       │       as owner_boat_list; // Alias owner list
│   │       │   import 'package:app/features/bookings/renter-list/screen.dart'
│   │       │       as renter_booking_list; // Alias renter booking list
│   │       │   import 'package:app/features/bookings/owner-list/screen.dart'
│   │       │       as owner_booking_list; // Alias owner booking list
│   │       │   import 'package:app/features/chat/list/screen.dart'; // Import Chat List Screen
│   │       │   import 'package:app/features/general/contact-us/screen.dart';
│   │       │   import 'package:app/features/general/about-app/screen.dart';
│   │       │   
│   │       │   class AppDrawer extends StatefulWidget {
│   │       │     final Future<void> Function() onLogout;
│   │       │     // --- User info parameters ---
│   │       │     const AppDrawer({
│   │       │       super.key,
│   │       │       required this.onLogout,
│   │       │     });
│   │       │   
│   │       │     @override
│   │       │     State<AppDrawer> createState() => _AppDrawerState();
│   │       │   }
│   │       │   
│   │       │   class _AppDrawerState extends State<AppDrawer>
│   │       │       with SingleTickerProviderStateMixin {
│   │       │     late AnimationController _animationController;
│   │       │     late Animation<double> _fadeAnimation;
│   │       │     late Animation<Offset> _slideAnimation;
│   │       │     String userName = '';
│   │       │     String userEmail = '';
│   │       │     String userRole = ''; // e.g., "OWNER" or "RENTER"
│   │       │     String userProfileImage = ''; // Add image URL parameter
│   │       │   
│   │       │     // Track expanded sections
│   │       │     bool _isSettingsExpanded = false;
│   │       │     bool _isBookingsExpanded = false;
│   │       │   
│   │       │     @override
│   │       │     void initState() {
│   │       │       super.initState();
│   │       │       _animationController = AnimationController(
│   │       │         vsync: this,
│   │       │         duration: const Duration(milliseconds: 500),
│   │       │       );
│   │       │   
│   │       │       _fadeAnimation = CurvedAnimation(
│   │       │         parent: _animationController,
│   │       │         curve: Curves.easeOut,
│   │       │       );
│   │       │   
│   │       │       _slideAnimation = Tween<Offset>(
│   │       │         begin: const Offset(-0.3, 0.0),
│   │       │         end: Offset.zero,
│   │       │       ).animate(CurvedAnimation(
│   │       │         parent: _animationController,
│   │       │         curve: Curves.easeOutCubic,
│   │       │       ));
│   │       │   
│   │       │       _animationController.forward();
│   │       │       WidgetsBinding.instance.addPostFrameCallback((_) async {
│   │       │         Map<String, dynamic>? userData =
│   │       │             await AuthController.instance.getSavedUserData();
│   │       │         if (userData != null) {
│   │       │           userName = userData['first_name'] + " " + userData['last_name'];
│   │       │           userEmail = userData['email'];
│   │       │           userRole = userData['role'];
│   │       │           userProfileImage = userData['profileImage'];
│   │       │         }
│   │       │       });
│   │       │     }
│   │       │   
│   │       │     @override
│   │       │     void dispose() {
│   │       │       _animationController.dispose();
│   │       │       super.dispose();
│   │       │     }
│   │       │   
│   │       │     // Helper method for drawer items with animated entrance
│   │       │     Widget _buildDrawerItem({
│   │       │       required IconData icon,
│   │       │       required String title,
│   │       │       required VoidCallback onTap,
│   │       │       BuildContext? context,
│   │       │       Color? iconColor,
│   │       │       Color? textColor,
│   │       │       bool isSelected = false,
│   │       │       bool showBadge = false,
│   │       │       String? badgeText,
│   │       │       String? subtitle,
│   │       │       int itemIndex = 0,
│   │       │       Widget? trailing,
│   │       │     }) {
│   │       │       final theme = Theme.of(context ?? GlobalKey().currentContext!);
│   │       │   
│   │       │       return AnimatedBuilder(
│   │       │         animation: _animationController,
│   │       │         builder: (context, child) {
│   │       │           final delay = itemIndex * 50;
│   │       │           final itemAnimation = Tween<double>(begin: 0.0, end: 1.0).animate(
│   │       │             CurvedAnimation(
│   │       │               parent: _animationController,
│   │       │               curve: Interval(
│   │       │                 delay / 1000, // Staggered start time
│   │       │                 min((delay + 350) / 1000,
│   │       │                     1.0), // Staggered end time, capped at 1.0
│   │       │                 curve: Curves.easeOutCubic,
│   │       │               ),
│   │       │             ),
│   │       │           );
│   │       │   
│   │       │           return FadeTransition(
│   │       │             opacity: itemAnimation,
│   │       │             child: SlideTransition(
│   │       │               position: Tween<Offset>(
│   │       │                 begin: const Offset(0.3, 0.0),
│   │       │                 end: Offset.zero,
│   │       │               ).animate(itemAnimation),
│   │       │               child: child,
│   │       │             ),
│   │       │           );
│   │       │         },
│   │       │         child: Padding(
│   │       │           padding: const EdgeInsets.symmetric(horizontal: 12.0, vertical: 2.0),
│   │       │           child: Material(
│   │       │             color: isSelected
│   │       │                 ? theme.colorScheme.primaryContainer.withOpacity(0.5)
│   │       │                 : Colors.transparent,
│   │       │             borderRadius: BorderRadius.circular(14),
│   │       │             child: InkWell(
│   │       │               borderRadius: BorderRadius.circular(14),
│   │       │               onTap: () {
│   │       │                 HapticFeedback.lightImpact();
│   │       │                 onTap();
│   │       │               },
│   │       │               splashColor: theme.colorScheme.primary.withOpacity(0.1),
│   │       │               highlightColor: theme.colorScheme.primary.withOpacity(0.05),
│   │       │               child: Padding(
│   │       │                 padding:
│   │       │                     const EdgeInsets.symmetric(horizontal: 16.0, vertical: 12.0),
│   │       │                 child: Column(
│   │       │                   crossAxisAlignment: CrossAxisAlignment.start,
│   │       │                   children: [
│   │       │                     Row(
│   │       │                       children: [
│   │       │                         // Animated icon container
│   │       │                         AnimatedContainer(
│   │       │                           duration: const Duration(milliseconds: 300),
│   │       │                           padding: const EdgeInsets.all(10),
│   │       │                           decoration: BoxDecoration(
│   │       │                             color: isSelected
│   │       │                                 ? theme.colorScheme.primary.withOpacity(0.2)
│   │       │                                 : theme.colorScheme.surfaceVariant
│   │       │                                     .withOpacity(0.4),
│   │       │                             borderRadius: BorderRadius.circular(12),
│   │       │                             boxShadow: isSelected
│   │       │                                 ? [
│   │       │                                     BoxShadow(
│   │       │                                       color: theme.colorScheme.primary
│   │       │                                           .withOpacity(0.3),
│   │       │                                       blurRadius: 8,
│   │       │                                       spreadRadius: 1,
│   │       │                                       offset: const Offset(0, 2),
│   │       │                                     )
│   │       │                                   ]
│   │       │                                 : null,
│   │       │                           ),
│   │       │                           child: Icon(
│   │       │                             icon,
│   │       │                             color: isSelected
│   │       │                                 ? theme.colorScheme.primary
│   │       │                                 : (iconColor ??
│   │       │                                     theme.colorScheme.onSurfaceVariant),
│   │       │                             size: 22,
│   │       │                           ),
│   │       │                         ),
│   │       │                         const SizedBox(width: 16),
│   │       │                         Expanded(
│   │       │                           child: Column(
│   │       │                             crossAxisAlignment: CrossAxisAlignment.start,
│   │       │                             children: [
│   │       │                               Text(
│   │       │                                 title,
│   │       │                                 style: theme.textTheme.titleMedium?.copyWith(
│   │       │                                   color: isSelected
│   │       │                                       ? theme.colorScheme.primary
│   │       │                                       : (textColor ??
│   │       │                                           theme.textTheme.bodyLarge?.color),
│   │       │                                   fontWeight: isSelected
│   │       │                                       ? FontWeight.w600
│   │       │                                       : FontWeight.w500,
│   │       │                                 ),
│   │       │                               ),
│   │       │                               if (subtitle != null)
│   │       │                                 Padding(
│   │       │                                   padding: const EdgeInsets.only(top: 4),
│   │       │                                   child: Text(
│   │       │                                     subtitle,
│   │       │                                     style: theme.textTheme.bodySmall?.copyWith(
│   │       │                                       color: theme.colorScheme.onSurfaceVariant
│   │       │                                           .withOpacity(0.8),
│   │       │                                     ),
│   │       │                                   ),
│   │       │                                 ),
│   │       │                             ],
│   │       │                           ),
│   │       │                         ),
│   │       │                         // Badge with bounce animation if new
│   │       │                         if (showBadge)
│   │       │                           TweenAnimationBuilder<double>(
│   │       │                             tween: Tween<double>(begin: 0.8, end: 1.0),
│   │       │                             duration: const Duration(milliseconds: 500),
│   │       │                             curve: Curves.elasticOut,
│   │       │                             builder: (context, value, child) {
│   │       │                               return Transform.scale(
│   │       │                                 scale: value,
│   │       │                                 child: Container(
│   │       │                                   padding: const EdgeInsets.symmetric(
│   │       │                                       horizontal: 8, vertical: 2),
│   │       │                                   decoration: BoxDecoration(
│   │       │                                     color: theme.colorScheme.error,
│   │       │                                     borderRadius: BorderRadius.circular(12),
│   │       │                                     boxShadow: [
│   │       │                                       BoxShadow(
│   │       │                                         color: theme.colorScheme.error
│   │       │                                             .withOpacity(0.4),
│   │       │                                         blurRadius: 4,
│   │       │                                         spreadRadius: 0,
│   │       │                                         offset: const Offset(0, 1),
│   │       │                                       )
│   │       │                                     ],
│   │       │                                   ),
│   │       │                                   child: Text(
│   │       │                                     badgeText ?? '',
│   │       │                                     style: theme.textTheme.labelSmall?.copyWith(
│   │       │                                       color: theme.colorScheme.onError,
│   │       │                                       fontWeight: FontWeight.bold,
│   │       │                                     ),
│   │       │                                   ),
│   │       │                                 ),
│   │       │                               );
│   │       │                             },
│   │       │                           ),
│   │       │                         // Custom trailing widget or default chevron
│   │       │                         if (trailing != null)
│   │       │                           trailing
│   │       │                         else if (!isSelected && !showBadge)
│   │       │                           AnimatedContainer(
│   │       │                             duration: const Duration(milliseconds: 200),
│   │       │                             transform: Matrix4.translationValues(
│   │       │                                 isSelected ? -5.0 : 0.0, 0.0, 0.0),
│   │       │                             child: Icon(
│   │       │                               Icons.chevron_right,
│   │       │                               size: 18,
│   │       │                               color: theme.colorScheme.onSurfaceVariant
│   │       │                                   .withOpacity(0.4),
│   │       │                             ),
│   │       │                           ),
│   │       │                       ],
│   │       │                     ),
│   │       │                   ],
│   │       │                 ),
│   │       │               ),
│   │       │             ),
│   │       │           ),
│   │       │         ),
│   │       │       );
│   │       │     }
│   │       │   
│   │       │     // Helper for expandable section
│   │       │     Widget _buildExpandableSection({
│   │       │       required String title,
│   │       │       required IconData icon,
│   │       │       required List<Widget> children,
│   │       │       required bool isExpanded,
│   │       │       required Function(bool) onToggle,
│   │       │       required BuildContext context,
│   │       │       int sectionIndex = 0,
│   │       │     }) {
│   │       │       final theme = Theme.of(context);
│   │       │   
│   │       │       return Column(
│   │       │         children: [
│   │       │           _buildDrawerItem(
│   │       │             icon: icon,
│   │       │             title: title,
│   │       │             context: context,
│   │       │             itemIndex: 10 + sectionIndex,
│   │       │             onTap: () {
│   │       │               setState(() {
│   │       │                 onToggle(!isExpanded);
│   │       │               });
│   │       │             },
│   │       │             trailing: Row(
│   │       │               mainAxisSize: MainAxisSize.min,
│   │       │               children: [
│   │       │                 AnimatedRotation(
│   │       │                   turns: isExpanded ? 0.25 : 0.0,
│   │       │                   duration: const Duration(milliseconds: 200),
│   │       │                   child: Icon(
│   │       │                     Icons.chevron_right,
│   │       │                     size: 18,
│   │       │                     color: theme.colorScheme.onSurfaceVariant,
│   │       │                   ),
│   │       │                 ),
│   │       │               ],
│   │       │             ),
│   │       │           ),
│   │       │           AnimatedContainer(
│   │       │             duration: const Duration(milliseconds: 300),
│   │       │             curve: Curves.easeInOut,
│   │       │             height: isExpanded ? children.length * 60.0 : 0,
│   │       │             child: AnimatedOpacity(
│   │       │               opacity: isExpanded ? 1.0 : 0.0,
│   │       │               duration: const Duration(milliseconds: 200),
│   │       │               child: ListView(
│   │       │                 padding: EdgeInsets.zero,
│   │       │                 physics: const NeverScrollableScrollPhysics(),
│   │       │                 shrinkWrap: true,
│   │       │                 children: children,
│   │       │               ),
│   │       │             ),
│   │       │           ),
│   │       │         ],
│   │       │       );
│   │       │     }
│   │       │   
│   │       │     // Helper for section headers
│   │       │     Widget _buildSectionHeader(String title, BuildContext context,
│   │       │         {int index = 0, IconData? icon}) {
│   │       │       final theme = Theme.of(context);
│   │       │   
│   │       │       return FadeTransition(
│   │       │         opacity: CurvedAnimation(
│   │       │           parent: _animationController,
│   │       │           curve: Interval(
│   │       │             0.1 + (index * 0.1),
│   │       │             0.4 + (index * 0.1),
│   │       │             curve: Curves.easeOut,
│   │       │           ),
│   │       │         ),
│   │       │         child: SlideTransition(
│   │       │           position: Tween<Offset>(
│   │       │             begin: const Offset(0, 0.2),
│   │       │             end: Offset.zero,
│   │       │           ).animate(CurvedAnimation(
│   │       │             parent: _animationController,
│   │       │             curve: Interval(
│   │       │               0.1 + (index * 0.1),
│   │       │               0.4 + (index * 0.1),
│   │       │               curve: Curves.easeOut,
│   │       │             ),
│   │       │           )),
│   │       │           child: Container(
│   │       │             margin: const EdgeInsets.fromLTRB(24, 16, 24, 8),
│   │       │             child: Row(
│   │       │               children: [
│   │       │                 if (icon != null) ...[
│   │       │                   Icon(
│   │       │                     icon,
│   │       │                     size: 14,
│   │       │                     color: theme.colorScheme.primary.withOpacity(0.8),
│   │       │                   ),
│   │       │                   const SizedBox(width: 8),
│   │       │                 ],
│   │       │                 Text(
│   │       │                   title,
│   │       │                   style: theme.textTheme.labelSmall?.copyWith(
│   │       │                     color: theme.colorScheme.primary,
│   │       │                     fontWeight: FontWeight.w600,
│   │       │                     letterSpacing: 1.2,
│   │       │                   ),
│   │       │                 ),
│   │       │                 const SizedBox(width: 8),
│   │       │                 Expanded(
│   │       │                   child: Container(
│   │       │                     height: 1,
│   │       │                     decoration: BoxDecoration(
│   │       │                       gradient: LinearGradient(
│   │       │                         colors: [
│   │       │                           theme.colorScheme.primary.withOpacity(0.3),
│   │       │                           theme.colorScheme.primary.withOpacity(0.0),
│   │       │                         ],
│   │       │                       ),
│   │       │                     ),
│   │       │                   ),
│   │       │                 ),
│   │       │               ],
│   │       │             ),
│   │       │           ),
│   │       │         ),
│   │       │       );
│   │       │     }
│   │       │   
│   │       │     // Helper for dividers
│   │       │     Widget _buildDivider() {
│   │       │       return FadeTransition(
│   │       │         opacity: _fadeAnimation,
│   │       │         child: Padding(
│   │       │           padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 8),
│   │       │           child: Divider(height: 1, thickness: 0.5),
│   │       │         ),
│   │       │       );
│   │       │     }
│   │       │   
│   │       │     // Get notification count for a section
│   │       │   
│   │       │     @override
│   │       │     Widget build(BuildContext context) {
│   │       │       final theme = Theme.of(context);
│   │       │       final bool isOwner = userRole == 'OWNER';
│   │       │       final bool isRenter = userRole == 'RENTER';
│   │       │       final String currentRoute = ModalRoute.of(context)?.settings.name ?? '';
│   │       │   
│   │       │       // Get gradients based on user role
│   │       │       final headerGradientColors = isOwner
│   │       │           ? [
│   │       │               AppColors.primary,
│   │       │               AppColors.primary.withBlue(min(AppColors.primary.blue + 50, 255))
│   │       │             ]
│   │       │           : isRenter
│   │       │               ? [
│   │       │                   AppColors.primary,
│   │       │                   AppColors.primary.withRed(min(AppColors.primary.red + 50, 255))
│   │       │                 ]
│   │       │               : [AppColors.primary, AppColors.primary.withOpacity(0.7)];
│   │       │   
│   │       │       return ClipRRect(
│   │       │         borderRadius: const BorderRadius.only(
│   │       │           topRight: Radius.circular(24),
│   │       │           bottomRight: Radius.circular(24),
│   │       │         ),
│   │       │         child: Drawer(
│   │       │           elevation: 0,
│   │       │           shape: const RoundedRectangleBorder(
│   │       │             borderRadius: BorderRadius.only(
│   │       │               topRight: Radius.circular(24),
│   │       │               bottomRight: Radius.circular(24),
│   │       │             ),
│   │       │           ),
│   │       │           child: Container(
│   │       │             decoration: BoxDecoration(
│   │       │               color: theme.scaffoldBackgroundColor,
│   │       │               borderRadius: const BorderRadius.only(
│   │       │                 topRight: Radius.circular(24),
│   │       │                 bottomRight: Radius.circular(24),
│   │       │               ),
│   │       │             ),
│   │       │             child: Column(
│   │       │               children: <Widget>[
│   │       │                 // Animated elegant header
│   │       │                 FadeTransition(
│   │       │                   opacity: _fadeAnimation,
│   │       │                   child: SlideTransition(
│   │       │                     position: _slideAnimation,
│   │       │                     child: Stack(
│   │       │                       children: [
│   │       │                         // Background with gradient and pattern
│   │       │                         Container(
│   │       │                           width: double.infinity,
│   │       │                           padding: EdgeInsets.only(
│   │       │                             top: MediaQuery.of(context).padding.top + 16,
│   │       │                             bottom: 64,
│   │       │                           ),
│   │       │                           decoration: BoxDecoration(
│   │       │                             gradient: LinearGradient(
│   │       │                               begin: Alignment.topLeft,
│   │       │                               end: Alignment.bottomRight,
│   │       │                               colors: headerGradientColors,
│   │       │                             ),
│   │       │                           ),
│   │       │                           // Clip height to content + padding
│   │       │                           child: Column(
│   │       │                             children: [
│   │       │                               // Profile Image with animated effects
│   │       │                               GestureDetector(
│   │       │                                 onTap: () {
│   │       │                                   HapticFeedback.mediumImpact();
│   │       │                                   Navigator.pop(context);
│   │       │                                   _showSnackBar(
│   │       │                                       context, 'Profile screen coming soon!');
│   │       │                                 },
│   │       │                                 child: Container(
│   │       │                                   decoration: BoxDecoration(
│   │       │                                     shape: BoxShape.circle,
│   │       │                                     border: Border.all(
│   │       │                                       color: Colors.white.withOpacity(0.7),
│   │       │                                       width: 3,
│   │       │                                     ),
│   │       │                                     boxShadow: [
│   │       │                                       BoxShadow(
│   │       │                                         color: Colors.black.withOpacity(0.2),
│   │       │                                         blurRadius: 15,
│   │       │                                         spreadRadius: 2,
│   │       │                                       ),
│   │       │                                     ],
│   │       │                                   ),
│   │       │                                   child: Hero(
│   │       │                                     tag: 'user-avatar',
│   │       │                                     child: CircleAvatar(
│   │       │                                       radius: 44,
│   │       │                                       backgroundColor:
│   │       │                                           theme.colorScheme.primaryContainer,
│   │       │                                       backgroundImage: userProfileImage != ''
│   │       │                                           ? NetworkImage(userProfileImage)
│   │       │                                           : null,
│   │       │                                       child: userProfileImage == ''
│   │       │                                           ? Text(
│   │       │                                               userName.isNotEmpty
│   │       │                                                   ? userName[0].toUpperCase()
│   │       │                                                   : 'G',
│   │       │                                               style: TextStyle(
│   │       │                                                 fontSize: 34.0,
│   │       │                                                 color: theme.colorScheme
│   │       │                                                     .onPrimaryContainer,
│   │       │                                                 fontWeight: FontWeight.bold,
│   │       │                                               ),
│   │       │                                             )
│   │       │                                           : null,
│   │       │                                     ),
│   │       │                                   ),
│   │       │                                 ),
│   │       │                               ),
│   │       │                               const SizedBox(height: 16),
│   │       │                               // User Name with shadow for better readability
│   │       │                               Text(
│   │       │                                 userName,
│   │       │                                 style: theme.textTheme.titleLarge?.copyWith(
│   │       │                                   fontWeight: FontWeight.bold,
│   │       │                                   color: Colors.white,
│   │       │                                   shadows: [
│   │       │                                     Shadow(
│   │       │                                       blurRadius: 4.0,
│   │       │                                       color: Colors.black.withOpacity(0.3),
│   │       │                                       offset: const Offset(0, 1),
│   │       │                                     ),
│   │       │                                   ],
│   │       │                                 ),
│   │       │                               ),
│   │       │                               // User Email with translucent style
│   │       │                               if (userEmail.isNotEmpty)
│   │       │                                 Padding(
│   │       │                                   padding: const EdgeInsets.only(top: 4),
│   │       │                                   child: Text(
│   │       │                                     userEmail!,
│   │       │                                     style: theme.textTheme.bodyMedium?.copyWith(
│   │       │                                       color: Colors.white.withOpacity(0.85),
│   │       │                                       shadows: [
│   │       │                                         Shadow(
│   │       │                                           color: Colors.black.withOpacity(0.2),
│   │       │                                           blurRadius: 2,
│   │       │                                           offset: const Offset(0, 1),
│   │       │                                         ),
│   │       │                                       ],
│   │       │                                     ),
│   │       │                                   ),
│   │       │                                 ),
│   │       │                               // Role badge with glassy effect
│   │       │                               if (userRole.isNotEmpty)
│   │       │                                 Padding(
│   │       │                                   padding: const EdgeInsets.only(top: 12),
│   │       │                                   child: ClipRRect(
│   │       │                                     borderRadius: BorderRadius.circular(16),
│   │       │                                     child: BackdropFilter(
│   │       │                                       filter:
│   │       │                                           ImageFilter.blur(sigmaX: 5, sigmaY: 5),
│   │       │                                       child: Container(
│   │       │                                         padding: const EdgeInsets.symmetric(
│   │       │                                             horizontal: 14, vertical: 6),
│   │       │                                         decoration: BoxDecoration(
│   │       │                                           color: Colors.white.withOpacity(0.15),
│   │       │                                           borderRadius: BorderRadius.circular(16),
│   │       │                                           border: Border.all(
│   │       │                                             color: Colors.white.withOpacity(0.2),
│   │       │                                             width: 1,
│   │       │                                           ),
│   │       │                                         ),
│   │       │                                         child: Text(
│   │       │                                           isOwner
│   │       │                                               ? 'owner_role'.i18n()
│   │       │                                               : 'renter_role'.i18n(),
│   │       │                                           style: theme.textTheme.labelSmall
│   │       │                                               ?.copyWith(
│   │       │                                             color: Colors.white,
│   │       │                                             fontWeight: FontWeight.bold,
│   │       │                                             letterSpacing: 0.5,
│   │       │                                           ),
│   │       │                                         ),
│   │       │                                       ),
│   │       │                                     ),
│   │       │                                   ),
│   │       │                                 ),
│   │       │                             ],
│   │       │                           ),
│   │       │                         ),
│   │       │                         // Subtle pattern overlay
│   │       │                         Positioned.fill(
│   │       │                           child: Opacity(
│   │       │                             opacity: 0.07,
│   │       │                             child: Image.network(
│   │       │                               'https://www.transparenttextures.com/patterns/cubes.png',
│   │       │                               repeat: ImageRepeat.repeat,
│   │       │                             ),
│   │       │                           ),
│   │       │                         ),
│   │       │                       ],
│   │       │                     ),
│   │       │                   ),
│   │       │                 ),
│   │       │   
│   │       │                 // Scrollable menu items with animations
│   │       │                 Expanded(
│   │       │                   child: FadeTransition(
│   │       │                     opacity: _fadeAnimation,
│   │       │                     child: ListView(
│   │       │                       padding: EdgeInsets.zero,
│   │       │                       children: <Widget>[
│   │       │                         const SizedBox(height: 8),
│   │       │   
│   │       │                         // Main Navigation
│   │       │                         _buildSectionHeader(
│   │       │                           'drawer_main_section'.i18n(),
│   │       │                           context,
│   │       │                           index: 0,
│   │       │                           icon: Icons.navigation,
│   │       │                         ),
│   │       │   
│   │       │                         _buildDrawerItem(
│   │       │                           icon: Icons.home_rounded,
│   │       │                           title: 'drawer_home'.i18n(),
│   │       │                           context: context,
│   │       │                           isSelected: currentRoute == '/',
│   │       │                           onTap: () {
│   │       │                             Navigator.pop(context);
│   │       │                             if (ModalRoute.of(context)?.settings.name != '/') {
│   │       │                               Navigator.pushReplacement(
│   │       │                                   context,
│   │       │                                   MaterialPageRoute(
│   │       │                                       builder: (_) => const HomeScreen(),
│   │       │                                       settings: const RouteSettings(name: '/')));
│   │       │                             }
│   │       │                           },
│   │       │                           itemIndex: 0,
│   │       │                         ),
│   │       │   
│   │       │                         // Chat with notification badge example
│   │       │                         _buildDrawerItem(
│   │       │                           icon: Icons.chat_rounded,
│   │       │                           title: 'Chats'.i18n(),
│   │       │                           subtitle: 'Chats'.i18n(),
│   │       │                           context: context,
│   │       │                           isSelected: currentRoute == '/chats',
│   │       │                           onTap: () {
│   │       │                             Navigator.pop(context);
│   │       │                             Navigator.push(
│   │       │                                 context,
│   │       │                                 MaterialPageRoute(
│   │       │                                     builder: (_) => const ChatListScreen(),
│   │       │                                     settings:
│   │       │                                         const RouteSettings(name: '/chats')));
│   │       │                           },
│   │       │                           itemIndex: 2,
│   │       │                         ),
│   │       │   
│   │       │                         _buildDivider(),
│   │       │   
│   │       │                         // Role-specific section
│   │       │   
│   │       │                         // Conditional Owner Item - Boat Listings
│   │       │                         if (isOwner)
│   │       │                           _buildDrawerItem(
│   │       │                             icon: Icons.sailing_rounded,
│   │       │                             title: 'My Boats'.i18n(),
│   │       │                             subtitle: 'My Boats'.i18n(),
│   │       │                             context: context,
│   │       │                             isSelected: currentRoute == '/owner/boats',
│   │       │                             onTap: () {
│   │       │                               Navigator.pop(context);
│   │       │                               Navigator.push(
│   │       │                                   context,
│   │       │                                   MaterialPageRoute(
│   │       │                                       builder: (_) =>
│   │       │                                           const owner_boat_list.ListBoatsScreen(),
│   │       │                                       settings: const RouteSettings(
│   │       │                                           name: '/owner/boats')));
│   │       │                             },
│   │       │                             itemIndex: 3,
│   │       │                           ),
│   │       │   
│   │       │                         // Expandable Bookings Section
│   │       │   
│   │       │                         _buildDrawerItem(
│   │       │                           icon: Icons.today_rounded,
│   │       │                           title: isOwner
│   │       │                               ? 'Manage Bookings'.i18n()
│   │       │                               : 'My Bookings'.i18n(),
│   │       │                           context: context,
│   │       │                           isSelected: currentRoute ==
│   │       │                               (isOwner
│   │       │                                   ? '/owner/bookings/past'
│   │       │                                   : '/renter/bookings/past'),
│   │       │                           onTap: () {
│   │       │                             Navigator.pop(context);
│   │       │                             if (isOwner) {
│   │       │                               Navigator.push(
│   │       │                                   context,
│   │       │                                   MaterialPageRoute(
│   │       │                                       builder: (_) => const owner_booking_list
│   │       │                                           .ManageBookingsScreen(),
│   │       │                                       settings: const RouteSettings(
│   │       │                                           name: '/owner/bookings/upcoming')));
│   │       │                             } else {
│   │       │                               Navigator.push(
│   │       │                                   context,
│   │       │                                   MaterialPageRoute(
│   │       │                                       builder: (_) => const renter_booking_list
│   │       │                                           .ListBookingsScreen(),
│   │       │                                       settings: const RouteSettings(
│   │       │                                           name: '/renter/bookings/upcoming')));
│   │       │                             }
│   │       │                           },
│   │       │                           itemIndex: 4,
│   │       │                         ),
│   │       │   
│   │       │                         // Add favorites for renter
│   │       │                         if (isRenter)
│   │       │                           _buildDrawerItem(
│   │       │                             icon: Icons.favorite_rounded,
│   │       │                             title: 'Favorites'.i18n(),
│   │       │                             subtitle: 'Favorites'.i18n(),
│   │       │                             context: context,
│   │       │                             isSelected: currentRoute == '/favorites',
│   │       │                             onTap: () {
│   │       │                               Navigator.pop(context);
│   │       │                               _showSnackBar(
│   │       │                                   context, 'Favorites screen coming soon!');
│   │       │                             },
│   │       │                             itemIndex: 7,
│   │       │                           ),
│   │       │   
│   │       │                         _buildDivider(),
│   │       │   
│   │       │                         // Settings & Support Section
│   │       │   
│   │       │                         // Support Section
│   │       │                         _buildDrawerItem(
│   │       │                           icon: Icons.support_agent_rounded,
│   │       │                           title: 'Contact Us'.i18n(),
│   │       │                           subtitle: 'Contact Us'.i18n(),
│   │       │                           context: context,
│   │       │                           isSelected: currentRoute == '/contact',
│   │       │                           onTap: () {
│   │       │                             Navigator.pop(context);
│   │       │                             Navigator.push(
│   │       │                                 context,
│   │       │                                 MaterialPageRoute(
│   │       │                                     builder: (_) => const ContactUsScreen(),
│   │       │                                     settings:
│   │       │                                         const RouteSettings(name: '/contact')));
│   │       │                           },
│   │       │                           itemIndex: 12,
│   │       │                         ),
│   │       │   
│   │       │                         _buildDrawerItem(
│   │       │                           icon: Icons.info_rounded,
│   │       │                           title: 'drawer_about'.i18n(),
│   │       │                           context: context,
│   │       │                           isSelected: currentRoute == '/about',
│   │       │                           onTap: () {
│   │       │                             Navigator.pop(context);
│   │       │                             Navigator.push(
│   │       │                                 context,
│   │       │                                 MaterialPageRoute(
│   │       │                                     builder: (_) => const AboutAppScreen(),
│   │       │                                     settings:
│   │       │                                         const RouteSettings(name: '/about')));
│   │       │                           },
│   │       │                           itemIndex: 13,
│   │       │                         ),
│   │       │                       ],
│   │       │                     ),
│   │       │                   ),
│   │       │                 ),
│   │       │   
│   │       │                 // Bottom logout section with glassmorphism effect
│   │       │                 FadeTransition(
│   │       │                   opacity: _fadeAnimation,
│   │       │                   child: ClipRRect(
│   │       │                     child: BackdropFilter(
│   │       │                       filter: ImageFilter.blur(sigmaX: 5, sigmaY: 5),
│   │       │                       child: Container(
│   │       │                         padding: const EdgeInsets.symmetric(
│   │       │                             vertical: 16, horizontal: 12),
│   │       │                         decoration: BoxDecoration(
│   │       │                           color: theme.colorScheme.surface.withOpacity(0.8),
│   │       │                           boxShadow: [
│   │       │                             BoxShadow(
│   │       │                               color: Colors.black.withOpacity(0.05),
│   │       │                               blurRadius: 10,
│   │       │                               offset: const Offset(0, -2),
│   │       │                             ),
│   │       │                           ],
│   │       │                           border: Border(
│   │       │                             top: BorderSide(
│   │       │                               color: theme.colorScheme.outline.withOpacity(0.2),
│   │       │                               width: 1,
│   │       │                             ),
│   │       │                           ),
│   │       │                         ),
│   │       │                         child: _buildDrawerItem(
│   │       │                           icon: Icons.logout_rounded,
│   │       │                           title: 'Logout'.i18n(),
│   │       │                           context: context,
│   │       │                           iconColor: Colors.redAccent,
│   │       │                           textColor: Colors.redAccent,
│   │       │                           onTap: () async {
│   │       │                             HapticFeedback.mediumImpact();
│   │       │                             await _showLogoutConfirmation(context);
│   │       │                           },
│   │       │                           itemIndex: 14,
│   │       │                         ),
│   │       │                       ),
│   │       │                     ),
│   │       │                   ),
│   │       │                 ),
│   │       │               ],
│   │       │             ),
│   │       │           ),
│   │       │         ),
│   │       │       );
│   │       │     }
│   │       │   
│   │       │     // Show a stylish confirmation dialog before logout
│   │       │     Future<void> _showLogoutConfirmation(BuildContext context) async {
│   │       │       final theme = Theme.of(context);
│   │       │   
│   │       │       showDialog(
│   │       │         context: context,
│   │       │         builder: (context) => AlertDialog(
│   │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
│   │       │           title: Row(
│   │       │             children: [
│   │       │               Icon(Icons.logout_rounded, color: Colors.redAccent, size: 24),
│   │       │               const SizedBox(width: 10),
│   │       │               Text('Confirm Logout'.i18n()),
│   │       │             ],
│   │       │           ),
│   │       │           content: Text('Are you sure you want to logout?'.i18n()),
│   │       │           actions: [
│   │       │             TextButton(
│   │       │               onPressed: () => Navigator.pop(context),
│   │       │               child: Text(
│   │       │                 'Cancel'.i18n(),
│   │       │                 style: TextStyle(color: theme.colorScheme.primary),
│   │       │               ),
│   │       │             ),
│   │       │             ElevatedButton(
│   │       │               style: ElevatedButton.styleFrom(
│   │       │                 backgroundColor: Colors.redAccent,
│   │       │                 foregroundColor: Colors.white,
│   │       │                 shape: RoundedRectangleBorder(
│   │       │                   borderRadius: BorderRadius.circular(12),
│   │       │                 ),
│   │       │               ),
│   │       │               onPressed: () async {
│   │       │                 Navigator.pop(context); // Close dialog
│   │       │                 Navigator.pop(context); // Close drawer
│   │       │                 await AuthController.instance.logout();
│   │       │                 Get.offAll(() => const LoginScreen());
│   │       │               },
│   │       │               child: Text('Confirm'.i18n()),
│   │       │             ),
│   │       │           ],
│   │       │         ),
│   │       │       );
│   │       │     }
│   │       │   
│   │       │     // Helper to show snackbar for coming soon features
│   │       │     void _showSnackBar(BuildContext context, String message) {
│   │       │       ScaffoldMessenger.of(context).hideCurrentSnackBar();
│   │       │       ScaffoldMessenger.of(context).showSnackBar(
│   │       │         SnackBar(
│   │       │           content: Row(
│   │       │             children: [
│   │       │               Icon(Icons.info_outline, color: Colors.white, size: 16),
│   │       │               const SizedBox(width: 12),
│   │       │               Text(message),
│   │       │             ],
│   │       │           ),
│   │       │           behavior: SnackBarBehavior.floating,
│   │       │           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
│   │       │           backgroundColor: AppColors.primary.withOpacity(0.9),
│   │       │           margin: EdgeInsets.only(
│   │       │             bottom: MediaQuery.of(context).size.height - 150,
│   │       │             left: 20,
│   │       │             right: 20,
│   │       │           ),
│   │       │           duration: const Duration(seconds: 2),
│   │       │           action: SnackBarAction(
│   │       │             label: 'OK',
│   │       │             textColor: Colors.white,
│   │       │             onPressed: () {
│   │       │               ScaffoldMessenger.of(context).hideCurrentSnackBar();
│   │       │             },
│   │       │           ),
│   │       │         ),
│   │       │       );
│   │       │     }
│   │       │   }
│   └── main.dart
│       │   import 'package:app/app/app.dart';
│       │   import 'package:flutter/material.dart';
│       │   
│       │   void main() {
│       │     runApp(const BoatRentalApp());
│       │   }
├── pubspec.yaml
│   │   name: app
│   │   description: "A new Flutter project."
│   │   # The following line prevents the package from being accidentally published to
│   │   # pub.dev using `flutter pub publish`. This is preferred for private packages.
│   │   publish_to: 'none' # Remove this line if you wish to publish to pub.dev
│   │   
│   │   version: 1.0.0+1
│   │   
│   │   environment:
│   │     sdk: ^3.5.4
│   │   
│   │   # Dependencies specify other packages that your package needs in order to work.
│   │   # To automatically upgrade your package dependencies to the latest versions
│   │   # consider running `flutter pub upgrade --major-versions`. Alternatively,
│   │   # dependencies can be manually updated by changing the version numbers below to
│   │   # the latest version available on pub.dev. To see which dependencies have newer
│   │   # versions available, run `flutter pub outdated`.
│   │   dependencies:
│   │     flutter:
│   │       sdk: flutter
│   │     flutter_localizations:
│   │       sdk: flutter
│   │   
│   │   
│   │     # The following adds the Cupertino Icons font to your application.
│   │     # Use with the CupertinoIcons class for iOS style icons.
│   │     cupertino_icons: ^1.0.8
│   │     flutter_animate: ^4.5.2
│   │     get: ^4.7.2
│   │     carousel_slider: ^5.0.0
│   │     localization: ^2.1.1
│   │     animate_do: ^4.2.0
│   │     package_info_plus: ^8.3.0
│   │     http: ^1.3.0
│   │     http_parser: ^4.0.2
│   │     web_socket_channel: ^3.0.2
│   │     shared_preferences: ^2.5.3
│   │     flutter_secure_storage: ^9.2.4
│   │     image_picker: ^1.1.2
│   │     flutter_launcher_icons: ^0.14.3
│   │   
│   │   
│   │   flutter_launcher_icons:
│   │     android: "launcher_icon"
│   │     background_color: "#000"
│   │     image_path: "assets/logo.png"
│   │     min_sdk_android: 21 # android min sdk min:16, default 21
│   │   
│   │   
│   │   dev_dependencies:
│   │     flutter_test:
│   │       sdk: flutter
│   │   
│   │     # The "flutter_lints" package below contains a set of recommended lints to
│   │     # encourage good coding practices. The lint set provided by the package is
│   │     # activated in the `analysis_options.yaml` file located at the root of your
│   │     # package. See that file for information about deactivating specific lint
│   │     # rules and activating additional ones.
│   │     flutter_lints: ^4.0.0
│   │   
│   │   # For information on the generic Dart part of this file, see the
│   │   # following page: https://dart.dev/tools/pub/pubspec
│   │   
│   │   # The following section is specific to Flutter packages.
│   │   flutter:
│   │   
│   │     # The following line ensures that the Material Icons font is
│   │     # included with your application, so that you can use the icons in
│   │     # the material Icons class.
│   │     uses-material-design: true
│   │   
│   │     # To add assets to your application, add an assets section, like this:
│   │     assets:
│   │       - assets/
│   │       - assets/i18n/
│   │       - assets/images/
│   │       - assets/icons/
│   │       - assets/images/auth/
│   │       - assets/images/home/
│   │   
│   │     #   - images/a_dot_burr.jpeg
│   │     #   - images/a_dot_ham.jpeg
│   │   
│   │     # An image asset can refer to one or more resolution-specific "variants", see
│   │     # https://flutter.dev/to/resolution-aware-images
│   │   
│   │     # For details regarding adding assets from package dependencies, see
│   │     # https://flutter.dev/to/asset-from-package
│   │   
│   │     # To add custom fonts to your application, add a fonts section here,
│   │     # in this "flutter" section. Each entry in this list should have a
│   │     # "family" key with the font family name, and a "fonts" key with a
│   │     # list giving the asset and other descriptors for the font. For
│   │     # example:
│   │     # fonts:
│   │     #   - family: Schyler
│   │     #     fonts:
│   │     #       - asset: fonts/Schyler-Regular.ttf
│   │     #       - asset: fonts/Schyler-Italic.ttf
│   │     #         style: italic
│   │     #   - family: Trajan Pro
│   │     #     fonts:
│   │     #       - asset: fonts/TrajanPro.ttf
│   │     #       - asset: fonts/TrajanPro_Bold.ttf
│   │     #         weight: 700
│   │     #
│   │     # For details regarding fonts from package dependencies,
│   │     # see https://flutter.dev/to/font-from-package
